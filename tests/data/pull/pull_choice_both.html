








<!DOCTYPE html>
<!--[if lte IE 9]><html class="ie ie9 lte9" lang="ru"><![endif]-->
<!--[if !IE]><!--><html lang="ru"><!--<![endif]-->
<head dir="ltr">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="origin-trial" content="ArNBN7d1AkvMhJTGWXlJ8td/AN4lOokzOnqKRNkTnLqaqx0HpfYvmx8JePPs/emKh6O5fckx14LeZIGJ1AQYjgAAAABzeyJvcmlnaW4iOiJodHRwOi8vbG9jYWxob3N0OjE4MDAwIiwiZmVhdHVyZSI6IkRpc2FibGVEaWZmZXJlbnRPcmlnaW5TdWJmcmFtZURpYWxvZ1N1cHByZXNzaW9uIiwiZXhwaXJ5IjoxNjM5NTI2Mzk5fQ==">




  <title>

 Содержание курса HIST | Открытое образование
</title>




  <script type="text/javascript" src="https://cdn2.openedu.ru/static/js/i18n/ru/djangojs.673a32bb50b9.js"></script>
  <script type="text/javascript" src="https://cdn2.openedu.ru/static/js/ie11_find_array.bd1c6dc7a133.js"></script>

  <link rel="icon" type="image/x-icon" href="https://cdn2.openedu.ru/static/edx-theme/images/favicon.bd3d272022e9.ico"/>






    <link href="https://cdn2.openedu.ru/static/edx-theme/css/lms-style-vendor.68e48093f5dd.css" rel="stylesheet" type="text/css" />






    <link href="https://cdn2.openedu.ru/static/edx-theme/css/lms-main-v1.4fcbf1c0bdb5.css" rel="stylesheet" type="text/css" />






<script type="text/javascript" src="https://cdn2.openedu.ru/static/js/lms-main_vendor.3c3c9a2604d6.js" charset="utf-8"></script>




<script type="text/javascript" src="https://cdn2.openedu.ru/static/js/lms-application.5ba2aca48790.js" charset="utf-8"></script>






    <script type="text/javascript" src="https://cdn2.openedu.ru/static/bundles/commons.18ca13fd3a36eedcddd3.6ddbb79b7234.js" ></script>



  <script>
    window.baseUrl = "https://cdn2.openedu.ru/static/";
    (function (require) {
      require.config({
          baseUrl: window.baseUrl
      });
    }).call(this, require || RequireJS.require);
  </script>
  <script type="text/javascript" src="https://cdn2.openedu.ru/static/lms/js/require-config.38226099c6ad.js"></script>

    <script type="text/javascript">
        (function (require) {
          require.config({
              paths: {
                'course_bookmarks/js/views/bookmark_button': 'course_bookmarks/js/views/bookmark_button.d4cfaf3361fa',
'js/views/message_banner': 'js/views/message_banner.141974fd4f5d',
'moment': 'common/js/vendor/moment-with-locales.e3cc27d412a1',
'moment-timezone': 'common/js/vendor/moment-timezone-with-data.60142e6c4416',
'js/courseware/course_info_events': 'js/courseware/course_info_events.2fc35b57627f',
'js/courseware/accordion_events': 'js/courseware/accordion_events.6064c7809de5',
'js/dateutil_factory': 'js/dateutil_factory.a28baef97506',
'js/courseware/link_clicked_events': 'js/courseware/link_clicked_events',
'js/courseware/toggle_element_visibility': 'js/courseware/toggle_element_visibility.474ff5ba9de3',
'js/student_account/logistration_factory': 'js/student_account/logistration_factory.5e55252d0ace',
'js/courseware/courseware_factory': 'js/courseware/courseware_factory.1504fc10caef',
'js/groups/views/cohorts_dashboard_factory': 'js/groups/views/cohorts_dashboard_factory.abc7c817c498',
'js/groups/discussions_management/discussions_dashboard_factory': 'js/discussions_management/views/discussions_dashboard_factory.2e10d9097343',
'draggabilly': 'js/vendor/draggabilly.26caba6f7187',
'hls': 'common/js/vendor/hls.5e0c7e1b3bfd'
            }
          });
        }).call(this, require || RequireJS.require);
    </script>






    <link href="https://cdn2.openedu.ru/static/edx-theme/css/lms-style-course-vendor.cc467ea1c47d.css" rel="stylesheet" type="text/css" />






    <link href="https://cdn2.openedu.ru/static/edx-theme/css/lms-course.d3e35273eae9.css" rel="stylesheet" type="text/css" />




<script type="text/javascript" src="https://cdn2.openedu.ru/static/js/jquery.autocomplete.964a0bfb4fd2.js" async></script>
<script type="text/javascript" src="https://cdn2.openedu.ru/static/js/src/tooltip_manager.b8fa94d4cefc.js" async></script>

<link href="https://cdn2.openedu.ru/static/css/vendor/jquery.autocomplete.css" rel="preload" type="text/css">
  <style type='text/css'>
@charset "UTF-8";@keyframes plyr-progress{to{background-position:25px 0;background-position:var(--plyr-progress-loading-size,25px) 0}}@keyframes plyr-popup{0%{opacity:.5;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes plyr-fade-in{0%{opacity:0}to{opacity:1}}.plyr{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;align-items:center;direction:ltr;display:flex;flex-direction:column;font-family:inherit;font-family:var(--plyr-font-family,inherit);font-variant-numeric:tabular-nums;font-weight:400;font-weight:var(--plyr-font-weight-regular,400);line-height:1.7;line-height:var(--plyr-line-height,1.7);max-width:100%;min-width:200px;position:relative;text-shadow:none;transition:box-shadow .3s ease;z-index:0}.plyr audio,.plyr iframe,.plyr video{display:block;height:100%;width:100%}.plyr button{font:inherit;line-height:inherit;width:auto}.plyr:focus{outline:0}.plyr--full-ui{box-sizing:border-box}.plyr--full-ui *,.plyr--full-ui :after,.plyr--full-ui :before{box-sizing:inherit}.plyr--full-ui a,.plyr--full-ui button,.plyr--full-ui input,.plyr--full-ui label{touch-action:manipulation}.plyr__badge{background:#4a5464;background:var(--plyr-badge-background,#4a5464);border-radius:2px;border-radius:var(--plyr-badge-border-radius,2px);color:#fff;color:var(--plyr-badge-text-color,#fff);font-size:9px;font-size:var(--plyr-font-size-badge,9px);line-height:1;padding:3px 4px}.plyr--full-ui ::-webkit-media-text-track-container{display:none}.plyr__captions{animation:plyr-fade-in .3s ease;bottom:0;display:none;font-size:13px;font-size:var(--plyr-font-size-small,13px);left:0;padding:10px;padding:var(--plyr-control-spacing,10px);position:absolute;text-align:center;transition:transform .4s ease-in-out;width:100%}.plyr__captions span:empty{display:none}@media (min-width:480px){.plyr__captions{font-size:15px;font-size:var(--plyr-font-size-base,15px);padding:20px;padding:calc(var(--plyr-control-spacing, 10px)*2)}}@media (min-width:768px){.plyr__captions{font-size:18px;font-size:var(--plyr-font-size-large,18px)}}.plyr--captions-active .plyr__captions{display:block}.plyr:not(.plyr--hide-controls) .plyr__controls:not(:empty)~.plyr__captions{transform:translateY(-40px);transform:translateY(calc(var(--plyr-control-spacing, 10px)*-4))}.plyr__caption{background:#000c;background:var(--plyr-captions-background,#000c);border-radius:2px;-webkit-box-decoration-break:clone;box-decoration-break:clone;color:#fff;color:var(--plyr-captions-text-color,#fff);line-height:185%;padding:.2em .5em;white-space:pre-wrap}.plyr__caption div{display:inline}.plyr__control{background:#0000;border:0;border-radius:4px;border-radius:var(--plyr-control-radius,4px);color:inherit;cursor:pointer;flex-shrink:0;overflow:visible;padding:7px;padding:calc(var(--plyr-control-spacing, 10px)*.7);position:relative;transition:all .3s ease}.plyr__control svg{fill:currentColor;display:block;height:18px;height:var(--plyr-control-icon-size,18px);pointer-events:none;width:18px;width:var(--plyr-control-icon-size,18px)}.plyr__control:focus{outline:0}.plyr__control:focus-visible{outline:2px dashed #00b2ff;outline:2px dashed var(--plyr-focus-visible-color,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));outline-offset:2px}a.plyr__control{text-decoration:none}.plyr__control.plyr__control--pressed .icon--not-pressed,.plyr__control.plyr__control--pressed .label--not-pressed,.plyr__control:not(.plyr__control--pressed) .icon--pressed,.plyr__control:not(.plyr__control--pressed) .label--pressed,a.plyr__control:after,a.plyr__control:before{display:none}.plyr--full-ui ::-webkit-media-controls{display:none}.plyr__controls{align-items:center;display:flex;justify-content:flex-end;text-align:center}.plyr__controls .plyr__progress__container{flex:1;min-width:0}.plyr__controls .plyr__controls__item{margin-left:2.5px;margin-left:calc(var(--plyr-control-spacing, 10px)/4)}.plyr__controls .plyr__controls__item:first-child{margin-left:0;margin-right:auto}.plyr__controls .plyr__controls__item.plyr__progress__container{padding-left:2.5px;padding-left:calc(var(--plyr-control-spacing, 10px)/4)}.plyr__controls .plyr__controls__item.plyr__time{padding:0 5px;padding:0 calc(var(--plyr-control-spacing, 10px)/2)}.plyr__controls .plyr__controls__item.plyr__progress__container:first-child,.plyr__controls .plyr__controls__item.plyr__time+.plyr__time,.plyr__controls .plyr__controls__item.plyr__time:first-child{padding-left:0}.plyr [data-plyr=airplay],.plyr [data-plyr=captions],.plyr [data-plyr=fullscreen],.plyr [data-plyr=pip],.plyr__controls:empty{display:none}.plyr--airplay-supported [data-plyr=airplay],.plyr--captions-enabled [data-plyr=captions],.plyr--fullscreen-enabled [data-plyr=fullscreen],.plyr--pip-supported [data-plyr=pip]{display:inline-block}.plyr__menu{display:flex;position:relative}.plyr__menu .plyr__control svg{transition:transform .3s ease}.plyr__menu .plyr__control[aria-expanded=true] svg{transform:rotate(90deg)}.plyr__menu .plyr__control[aria-expanded=true] .plyr__tooltip{display:none}.plyr__menu__container{animation:plyr-popup .2s ease;background:#ffffffe6;background:var(--plyr-menu-background,#ffffffe6);border-radius:8px;border-radius:var(--plyr-menu-radius,8px);bottom:100%;box-shadow:0 1px 2px #00000026;box-shadow:var(--plyr-menu-shadow,0 1px 2px #00000026);color:#4a5464;color:var(--plyr-menu-color,#4a5464);font-size:15px;font-size:var(--plyr-font-size-base,15px);margin-bottom:10px;position:absolute;right:-3px;text-align:left;white-space:nowrap;z-index:3}.plyr__menu__container>div{overflow:hidden;transition:height .35s cubic-bezier(.4,0,.2,1),width .35s cubic-bezier(.4,0,.2,1)}.plyr__menu__container:after{border:4px solid #0000;border:var(--plyr-menu-arrow-size,4px) solid #0000;border-top-color:var(--plyr-menu-background,#ffffffe6);content:"";height:0;position:absolute;right:14px;right:calc(var(--plyr-control-icon-size, 18px)/2 + var(--plyr-control-spacing, 10px)*.7 - var(--plyr-menu-arrow-size, 4px)/2);top:100%;width:0}.plyr__menu__container [role=menu]{padding:7px;padding:calc(var(--plyr-control-spacing, 10px)*.7)}.plyr__menu__container [role=menuitem],.plyr__menu__container [role=menuitemradio]{margin-top:2px}.plyr__menu__container [role=menuitem]:first-child,.plyr__menu__container [role=menuitemradio]:first-child{margin-top:0}.plyr__menu__container .plyr__control{align-items:center;color:#4a5464;color:var(--plyr-menu-color,#4a5464);display:flex;font-size:13px;font-size:var(--plyr-font-size-menu,var(--plyr-font-size-small,13px));padding:4.66667px 10.5px;padding:calc(var(--plyr-control-spacing, 10px)*.7/1.5) calc(var(--plyr-control-spacing, 10px)*.7*1.5);-webkit-user-select:none;user-select:none;width:100%}.plyr__menu__container .plyr__control>span{align-items:inherit;display:flex;width:100%}.plyr__menu__container .plyr__control:after{border:4px solid #0000;border:var(--plyr-menu-item-arrow-size,4px) solid #0000;content:"";position:absolute;top:50%;transform:translateY(-50%)}.plyr__menu__container .plyr__control--forward{padding-right:28px;padding-right:calc(var(--plyr-control-spacing, 10px)*.7*4)}.plyr__menu__container .plyr__control--forward:after{border-left-color:#728197;border-left-color:var(--plyr-menu-arrow-color,#728197);right:6.5px;right:calc(var(--plyr-control-spacing, 10px)*.7*1.5 - var(--plyr-menu-item-arrow-size, 4px))}.plyr__menu__container .plyr__control--forward:focus-visible:after,.plyr__menu__container .plyr__control--forward:hover:after{border-left-color:initial}.plyr__menu__container .plyr__control--back{font-weight:400;font-weight:var(--plyr-font-weight-regular,400);margin:7px;margin:calc(var(--plyr-control-spacing, 10px)*.7);margin-bottom:3.5px;margin-bottom:calc(var(--plyr-control-spacing, 10px)*.7/2);padding-left:28px;padding-left:calc(var(--plyr-control-spacing, 10px)*.7*4);position:relative;width:calc(100% - 14px);width:calc(100% - var(--plyr-control-spacing, 10px)*.7*2)}.plyr__menu__container .plyr__control--back:after{border-right-color:#728197;border-right-color:var(--plyr-menu-arrow-color,#728197);left:6.5px;left:calc(var(--plyr-control-spacing, 10px)*.7*1.5 - var(--plyr-menu-item-arrow-size, 4px))}.plyr__menu__container .plyr__control--back:before{background:#dcdfe5;background:var(--plyr-menu-back-border-color,#dcdfe5);box-shadow:0 1px 0 #fff;box-shadow:0 1px 0 var(--plyr-menu-back-border-shadow-color,#fff);content:"";height:1px;left:0;margin-top:3.5px;margin-top:calc(var(--plyr-control-spacing, 10px)*.7/2);overflow:hidden;position:absolute;right:0;top:100%}.plyr__menu__container .plyr__control--back:focus-visible:after,.plyr__menu__container .plyr__control--back:hover:after{border-right-color:initial}.plyr__menu__container .plyr__control[role=menuitemradio]{padding-left:7px;padding-left:calc(var(--plyr-control-spacing, 10px)*.7)}.plyr__menu__container .plyr__control[role=menuitemradio]:after,.plyr__menu__container .plyr__control[role=menuitemradio]:before{border-radius:100%}.plyr__menu__container .plyr__control[role=menuitemradio]:before{background:#0000001a;content:"";display:block;flex-shrink:0;height:16px;margin-right:10px;margin-right:var(--plyr-control-spacing,10px);transition:all .3s ease;width:16px}.plyr__menu__container .plyr__control[role=menuitemradio]:after{background:#fff;border:0;height:6px;left:12px;opacity:0;top:50%;transform:translateY(-50%) scale(0);transition:transform .3s ease,opacity .3s ease;width:6px}.plyr__menu__container .plyr__control[role=menuitemradio][aria-checked=true]:before{background:#00b2ff;background:var(--plyr-control-toggle-checked-background,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)))}.plyr__menu__container .plyr__control[role=menuitemradio][aria-checked=true]:after{opacity:1;transform:translateY(-50%) scale(1)}.plyr__menu__container .plyr__control[role=menuitemradio]:focus-visible:before,.plyr__menu__container .plyr__control[role=menuitemradio]:hover:before{background:#23282f1a}.plyr__menu__container .plyr__menu__value{align-items:center;display:flex;margin-left:auto;margin-right:-5px;margin-right:calc(var(--plyr-control-spacing, 10px)*.7*-1 + 2px);overflow:hidden;padding-left:24.5px;padding-left:calc(var(--plyr-control-spacing, 10px)*.7*3.5);pointer-events:none}.plyr--full-ui input[type=range]{-webkit-appearance:none;appearance:none;background:#0000;border:0;border-radius:26px;border-radius:calc(var(--plyr-range-thumb-height, 13px)*2);color:#00b2ff;color:var(--plyr-range-fill-background,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));display:block;height:19px;height:calc(var(--plyr-range-thumb-active-shadow-width, 3px)*2 + var(--plyr-range-thumb-height, 13px));margin:0;min-width:0;padding:0;transition:box-shadow .3s ease;width:100%}.plyr--full-ui input[type=range]::-webkit-slider-runnable-track{background:#0000;background-image:linear-gradient(90deg,currentColor,#0000 0);background-image:linear-gradient(to right,currentColor var(--value,0),#0000 var(--value,0));border:0;border-radius:2.5px;border-radius:calc(var(--plyr-range-track-height, 5px)/2);height:5px;height:var(--plyr-range-track-height,5px);-webkit-transition:box-shadow .3s ease;transition:box-shadow .3s ease;-webkit-user-select:none;user-select:none}.plyr--full-ui input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:#fff;background:var(--plyr-range-thumb-background,#fff);border:0;border-radius:100%;box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33);height:13px;height:var(--plyr-range-thumb-height,13px);margin-top:-4px;margin-top:calc((var(--plyr-range-thumb-height, 13px) - var(--plyr-range-track-height, 5px))/2*-1);position:relative;-webkit-transition:all .2s ease;transition:all .2s ease;width:13px;width:var(--plyr-range-thumb-height,13px)}.plyr--full-ui input[type=range]::-moz-range-track{background:#0000;border:0;border-radius:2.5px;border-radius:calc(var(--plyr-range-track-height, 5px)/2);height:5px;height:var(--plyr-range-track-height,5px);-moz-transition:box-shadow .3s ease;transition:box-shadow .3s ease;user-select:none}.plyr--full-ui input[type=range]::-moz-range-thumb{background:#fff;background:var(--plyr-range-thumb-background,#fff);border:0;border-radius:100%;box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33);height:13px;height:var(--plyr-range-thumb-height,13px);position:relative;-moz-transition:all .2s ease;transition:all .2s ease;width:13px;width:var(--plyr-range-thumb-height,13px)}.plyr--full-ui input[type=range]::-moz-range-progress{background:currentColor;border-radius:2.5px;border-radius:calc(var(--plyr-range-track-height, 5px)/2);height:5px;height:var(--plyr-range-track-height,5px)}.plyr--full-ui input[type=range]::-ms-track{color:#0000}.plyr--full-ui input[type=range]::-ms-fill-upper,.plyr--full-ui input[type=range]::-ms-track{background:#0000;border:0;border-radius:2.5px;border-radius:calc(var(--plyr-range-track-height, 5px)/2);height:5px;height:var(--plyr-range-track-height,5px);-ms-transition:box-shadow .3s ease;transition:box-shadow .3s ease;user-select:none}.plyr--full-ui input[type=range]::-ms-fill-lower{background:#0000;background:currentColor;border:0;border-radius:2.5px;border-radius:calc(var(--plyr-range-track-height, 5px)/2);height:5px;height:var(--plyr-range-track-height,5px);-ms-transition:box-shadow .3s ease;transition:box-shadow .3s ease;user-select:none}.plyr--full-ui input[type=range]::-ms-thumb{background:#fff;background:var(--plyr-range-thumb-background,#fff);border:0;border-radius:100%;box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33);height:13px;height:var(--plyr-range-thumb-height,13px);margin-top:0;position:relative;-ms-transition:all .2s ease;transition:all .2s ease;width:13px;width:var(--plyr-range-thumb-height,13px)}.plyr--full-ui input[type=range]::-ms-tooltip{display:none}.plyr--full-ui input[type=range]::-moz-focus-outer{border:0}.plyr--full-ui input[type=range]:focus{outline:0}.plyr--full-ui input[type=range]:focus-visible::-webkit-slider-runnable-track{outline:2px dashed #00b2ff;outline:2px dashed var(--plyr-focus-visible-color,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));outline-offset:2px}.plyr--full-ui input[type=range]:focus-visible::-moz-range-track{outline:2px dashed #00b2ff;outline:2px dashed var(--plyr-focus-visible-color,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));outline-offset:2px}.plyr--full-ui input[type=range]:focus-visible::-ms-track{outline:2px dashed #00b2ff;outline:2px dashed var(--plyr-focus-visible-color,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));outline-offset:2px}.plyr__poster{background-color:#000;background-color:var(--plyr-video-background,var(--plyr-video-background,#000));background-position:50% 50%;background-repeat:no-repeat;background-size:contain;height:100%;left:0;opacity:0;position:absolute;top:0;transition:opacity .2s ease;width:100%;z-index:1}.plyr--stopped.plyr__poster-enabled .plyr__poster{opacity:1}.plyr--youtube.plyr--paused.plyr__poster-enabled:not(.plyr--stopped) .plyr__poster{display:none}.plyr__time{font-size:13px;font-size:var(--plyr-font-size-time,var(--plyr-font-size-small,13px))}.plyr__time+.plyr__time:before{content:"⁄";margin-right:10px;margin-right:var(--plyr-control-spacing,10px)}@media (max-width:767px){.plyr__time+.plyr__time{display:none}}.plyr__tooltip{background:#fff;background:var(--plyr-tooltip-background,#fff);border-radius:5px;border-radius:var(--plyr-tooltip-radius,5px);bottom:100%;box-shadow:0 1px 2px #00000026;box-shadow:var(--plyr-tooltip-shadow,0 1px 2px #00000026);color:#4a5464;color:var(--plyr-tooltip-color,#4a5464);font-size:13px;font-size:var(--plyr-font-size-small,13px);font-weight:400;font-weight:var(--plyr-font-weight-regular,400);left:50%;line-height:1.3;margin-bottom:10px;margin-bottom:calc(var(--plyr-control-spacing, 10px)/2*2);opacity:0;padding:5px 7.5px;padding:calc(var(--plyr-control-spacing, 10px)/2) calc(var(--plyr-control-spacing, 10px)/2*1.5);pointer-events:none;position:absolute;transform:translate(-50%,10px) scale(.8);transform-origin:50% 100%;transition:transform .2s ease .1s,opacity .2s ease .1s;white-space:nowrap;z-index:2}.plyr__tooltip:before{border-left:4px solid #0000;border-left:var(--plyr-tooltip-arrow-size,4px) solid #0000;border-right:4px solid #0000;border-right:var(--plyr-tooltip-arrow-size,4px) solid #0000;border-top:4px solid #fff;border-top:var(--plyr-tooltip-arrow-size,4px) solid var(--plyr-tooltip-background,#fff);bottom:-4px;bottom:calc(var(--plyr-tooltip-arrow-size, 4px)*-1);content:"";height:0;left:50%;position:absolute;transform:translateX(-50%);width:0;z-index:2}.plyr .plyr__control:focus-visible .plyr__tooltip,.plyr .plyr__control:hover .plyr__tooltip,.plyr__tooltip--visible{opacity:1;transform:translate(-50%) scale(1)}.plyr .plyr__control:hover .plyr__tooltip{z-index:3}.plyr__controls>.plyr__control:first-child .plyr__tooltip,.plyr__controls>.plyr__control:first-child+.plyr__control .plyr__tooltip{left:0;transform:translateY(10px) scale(.8);transform-origin:0 100%}.plyr__controls>.plyr__control:first-child .plyr__tooltip:before,.plyr__controls>.plyr__control:first-child+.plyr__control .plyr__tooltip:before{left:16px;left:calc(var(--plyr-control-icon-size, 18px)/2 + var(--plyr-control-spacing, 10px)*.7)}.plyr__controls>.plyr__control:last-child .plyr__tooltip{left:auto;right:0;transform:translateY(10px) scale(.8);transform-origin:100% 100%}.plyr__controls>.plyr__control:last-child .plyr__tooltip:before{left:auto;right:16px;right:calc(var(--plyr-control-icon-size, 18px)/2 + var(--plyr-control-spacing, 10px)*.7);transform:translateX(50%)}.plyr__controls>.plyr__control:first-child .plyr__tooltip--visible,.plyr__controls>.plyr__control:first-child+.plyr__control .plyr__tooltip--visible,.plyr__controls>.plyr__control:first-child+.plyr__control:focus-visible .plyr__tooltip,.plyr__controls>.plyr__control:first-child+.plyr__control:hover .plyr__tooltip,.plyr__controls>.plyr__control:first-child:focus-visible .plyr__tooltip,.plyr__controls>.plyr__control:first-child:hover .plyr__tooltip,.plyr__controls>.plyr__control:last-child .plyr__tooltip--visible,.plyr__controls>.plyr__control:last-child:focus-visible .plyr__tooltip,.plyr__controls>.plyr__control:last-child:hover .plyr__tooltip{transform:translate(0) scale(1)}.plyr__progress{left:6.5px;left:calc(var(--plyr-range-thumb-height, 13px)*.5);margin-right:13px;margin-right:var(--plyr-range-thumb-height,13px);position:relative}.plyr__progress input[type=range],.plyr__progress__buffer{margin-left:-6.5px;margin-left:calc(var(--plyr-range-thumb-height, 13px)*-.5);margin-right:-6.5px;margin-right:calc(var(--plyr-range-thumb-height, 13px)*-.5);width:calc(100% + 13px);width:calc(100% + var(--plyr-range-thumb-height, 13px))}.plyr__progress input[type=range]{position:relative;z-index:2}.plyr__progress .plyr__tooltip{left:0;max-width:120px;overflow-wrap:break-word}.plyr__progress__buffer{-webkit-appearance:none;background:#0000;border:0;border-radius:100px;height:5px;height:var(--plyr-range-track-height,5px);left:0;margin-top:-2.5px;margin-top:calc(var(--plyr-range-track-height, 5px)/2*-1);padding:0;position:absolute;top:50%}.plyr__progress__buffer::-webkit-progress-bar{background:#0000}.plyr__progress__buffer::-webkit-progress-value{background:currentColor;border-radius:100px;min-width:5px;min-width:var(--plyr-range-track-height,5px);-webkit-transition:width .2s ease;transition:width .2s ease}.plyr__progress__buffer::-moz-progress-bar{background:currentColor;border-radius:100px;min-width:5px;min-width:var(--plyr-range-track-height,5px);-moz-transition:width .2s ease;transition:width .2s ease}.plyr__progress__buffer::-ms-fill{border-radius:100px;-ms-transition:width .2s ease;transition:width .2s ease}.plyr--loading .plyr__progress__buffer{animation:plyr-progress 1s linear infinite;background-image:linear-gradient(-45deg,#23282f99 25%,#0000 0,#0000 50%,#23282f99 0,#23282f99 75%,#0000 0,#0000);background-image:linear-gradient(-45deg,var(--plyr-progress-loading-background,#23282f99) 25%,#0000 25%,#0000 50%,var(--plyr-progress-loading-background,#23282f99) 50%,var(--plyr-progress-loading-background,#23282f99) 75%,#0000 75%,#0000);background-repeat:repeat-x;background-size:25px 25px;background-size:var(--plyr-progress-loading-size,25px) var(--plyr-progress-loading-size,25px);color:#0000}.plyr--video.plyr--loading .plyr__progress__buffer{background-color:#ffffff40;background-color:var(--plyr-video-progress-buffered-background,#ffffff40)}.plyr--audio.plyr--loading .plyr__progress__buffer{background-color:#c1c8d199;background-color:var(--plyr-audio-progress-buffered-background,#c1c8d199)}.plyr__progress__marker{background-color:#fff;background-color:var(--plyr-progress-marker-background,#fff);border-radius:1px;height:5px;height:var(--plyr-range-track-height,5px);position:absolute;top:50%;transform:translate(-50%,-50%);width:3px;width:var(--plyr-progress-marker-width,3px);z-index:3}.plyr__volume{align-items:center;display:flex;position:relative}.plyr__volume input[type=range]{margin-left:5px;margin-left:calc(var(--plyr-control-spacing, 10px)/2);margin-right:5px;margin-right:calc(var(--plyr-control-spacing, 10px)/2);max-width:90px;min-width:60px;position:relative;z-index:2}.plyr--audio{display:block}.plyr--audio .plyr__controls{background:#fff;background:var(--plyr-audio-controls-background,#fff);border-radius:inherit;color:#4a5464;color:var(--plyr-audio-control-color,#4a5464);padding:10px;padding:var(--plyr-control-spacing,10px)}.plyr--audio .plyr__control:focus-visible,.plyr--audio .plyr__control:hover,.plyr--audio .plyr__control[aria-expanded=true]{background:#00b2ff;background:var(--plyr-audio-control-background-hover,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));color:#fff;color:var(--plyr-audio-control-color-hover,#fff)}.plyr--full-ui.plyr--audio input[type=range]::-webkit-slider-runnable-track{background-color:#c1c8d199;background-color:var(--plyr-audio-range-track-background,var(--plyr-audio-progress-buffered-background,#c1c8d199))}.plyr--full-ui.plyr--audio input[type=range]::-moz-range-track{background-color:#c1c8d199;background-color:var(--plyr-audio-range-track-background,var(--plyr-audio-progress-buffered-background,#c1c8d199))}.plyr--full-ui.plyr--audio input[type=range]::-ms-track{background-color:#c1c8d199;background-color:var(--plyr-audio-range-track-background,var(--plyr-audio-progress-buffered-background,#c1c8d199))}.plyr--full-ui.plyr--audio input[type=range]:active::-webkit-slider-thumb{box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33,0 0 0 3px #23282f1a;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33),0 0 0 var(--plyr-range-thumb-active-shadow-width,3px) var(--plyr-audio-range-thumb-active-shadow-color,#23282f1a)}.plyr--full-ui.plyr--audio input[type=range]:active::-moz-range-thumb{box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33,0 0 0 3px #23282f1a;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33),0 0 0 var(--plyr-range-thumb-active-shadow-width,3px) var(--plyr-audio-range-thumb-active-shadow-color,#23282f1a)}.plyr--full-ui.plyr--audio input[type=range]:active::-ms-thumb{box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33,0 0 0 3px #23282f1a;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33),0 0 0 var(--plyr-range-thumb-active-shadow-width,3px) var(--plyr-audio-range-thumb-active-shadow-color,#23282f1a)}.plyr--audio .plyr__progress__buffer{color:#c1c8d199;color:var(--plyr-audio-progress-buffered-background,#c1c8d199)}.plyr--video{overflow:hidden}.plyr--video.plyr--menu-open{overflow:visible}.plyr__video-wrapper{background:#000;background:var(--plyr-video-background,var(--plyr-video-background,#000));border-radius:inherit;height:100%;margin:auto;overflow:hidden;position:relative;width:100%}.plyr__video-embed,.plyr__video-wrapper--fixed-ratio{aspect-ratio:16/9}@supports not (aspect-ratio:16/9){.plyr__video-embed,.plyr__video-wrapper--fixed-ratio{height:0;padding-bottom:56.25%;position:relative}}.plyr__video-embed iframe,.plyr__video-wrapper--fixed-ratio video{border:0;height:100%;left:0;position:absolute;top:0;width:100%}.plyr--full-ui .plyr__video-embed>.plyr__video-embed__container{padding-bottom:240%;position:relative;transform:translateY(-38.28125%)}.plyr--video .plyr__controls{background:linear-gradient(#0000,#000000bf);background:var(--plyr-video-controls-background,linear-gradient(#0000,#000000bf));border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;bottom:0;color:#fff;color:var(--plyr-video-control-color,#fff);left:0;padding:5px;padding:calc(var(--plyr-control-spacing, 10px)/2);padding-top:20px;padding-top:calc(var(--plyr-control-spacing, 10px)*2);position:absolute;right:0;transition:opacity .4s ease-in-out,transform .4s ease-in-out;z-index:3}@media (min-width:480px){.plyr--video .plyr__controls{padding:10px;padding:var(--plyr-control-spacing,10px);padding-top:35px;padding-top:calc(var(--plyr-control-spacing, 10px)*3.5)}}.plyr--video.plyr--hide-controls .plyr__controls{opacity:0;pointer-events:none;transform:translateY(100%)}.plyr--video .plyr__control:focus-visible,.plyr--video .plyr__control:hover,.plyr--video .plyr__control[aria-expanded=true]{background:#00b2ff;background:var(--plyr-video-control-background-hover,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));color:#fff;color:var(--plyr-video-control-color-hover,#fff)}.plyr__control--overlaid{background:#00b2ff;background:var(--plyr-video-control-background-hover,var(--plyr-color-main,var(--plyr-color-main,#00b2ff)));border:0;border-radius:100%;color:#fff;color:var(--plyr-video-control-color,#fff);display:none;left:50%;opacity:.9;padding:15px;padding:calc(var(--plyr-control-spacing, 10px)*1.5);position:absolute;top:50%;transform:translate(-50%,-50%);transition:.3s;z-index:2}.plyr__control--overlaid svg{left:2px;position:relative}.plyr__control--overlaid:focus,.plyr__control--overlaid:hover{opacity:1}.plyr--playing .plyr__control--overlaid{opacity:0;visibility:hidden}.plyr--full-ui.plyr--video .plyr__control--overlaid{display:block}.plyr--full-ui.plyr--video input[type=range]::-webkit-slider-runnable-track{background-color:#ffffff40;background-color:var(--plyr-video-range-track-background,var(--plyr-video-progress-buffered-background,#ffffff40))}.plyr--full-ui.plyr--video input[type=range]::-moz-range-track{background-color:#ffffff40;background-color:var(--plyr-video-range-track-background,var(--plyr-video-progress-buffered-background,#ffffff40))}.plyr--full-ui.plyr--video input[type=range]::-ms-track{background-color:#ffffff40;background-color:var(--plyr-video-range-track-background,var(--plyr-video-progress-buffered-background,#ffffff40))}.plyr--full-ui.plyr--video input[type=range]:active::-webkit-slider-thumb{box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33,0 0 0 3px #ffffff80;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33),0 0 0 var(--plyr-range-thumb-active-shadow-width,3px) var(--plyr-audio-range-thumb-active-shadow-color,#ffffff80)}.plyr--full-ui.plyr--video input[type=range]:active::-moz-range-thumb{box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33,0 0 0 3px #ffffff80;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33),0 0 0 var(--plyr-range-thumb-active-shadow-width,3px) var(--plyr-audio-range-thumb-active-shadow-color,#ffffff80)}.plyr--full-ui.plyr--video input[type=range]:active::-ms-thumb{box-shadow:0 1px 1px #23282f26,0 0 0 1px #23282f33,0 0 0 3px #ffffff80;box-shadow:var(--plyr-range-thumb-shadow,0 1px 1px #23282f26,0 0 0 1px #23282f33),0 0 0 var(--plyr-range-thumb-active-shadow-width,3px) var(--plyr-audio-range-thumb-active-shadow-color,#ffffff80)}.plyr--video .plyr__progress__buffer{color:#ffffff40;color:var(--plyr-video-progress-buffered-background,#ffffff40)}.plyr:-webkit-full-screen{background:#000;border-radius:0!important;height:100%;margin:0;width:100%}.plyr:fullscreen{background:#000;border-radius:0!important;height:100%;margin:0;width:100%}.plyr:-webkit-full-screen video{height:100%}.plyr:fullscreen video{height:100%}.plyr:-webkit-full-screen .plyr__control .icon--exit-fullscreen{display:block}.plyr:fullscreen .plyr__control .icon--exit-fullscreen{display:block}.plyr:-webkit-full-screen .plyr__control .icon--exit-fullscreen+svg{display:none}.plyr:fullscreen .plyr__control .icon--exit-fullscreen+svg{display:none}.plyr:-webkit-full-screen.plyr--hide-controls{cursor:none}.plyr:fullscreen.plyr--hide-controls{cursor:none}@media (min-width:1024px){.plyr:-webkit-full-screen .plyr__captions{font-size:21px;font-size:var(--plyr-font-size-xlarge,21px)}.plyr:fullscreen .plyr__captions{font-size:21px;font-size:var(--plyr-font-size-xlarge,21px)}}.plyr--fullscreen-fallback{background:#000;border-radius:0!important;bottom:0;height:100%;left:0;margin:0;position:fixed;right:0;top:0;width:100%;z-index:10000000}.plyr--fullscreen-fallback video{height:100%}.plyr--fullscreen-fallback .plyr__control .icon--exit-fullscreen{display:block}.plyr--fullscreen-fallback .plyr__control .icon--exit-fullscreen+svg{display:none}.plyr--fullscreen-fallback.plyr--hide-controls{cursor:none}@media (min-width:1024px){.plyr--fullscreen-fallback .plyr__captions{font-size:21px;font-size:var(--plyr-font-size-xlarge,21px)}}.plyr__ads{border-radius:inherit;bottom:0;cursor:pointer;left:0;overflow:hidden;position:absolute;right:0;top:0;z-index:-1}.plyr__ads>div,.plyr__ads>div iframe{height:100%;position:absolute;width:100%}.plyr__ads:after{background:#23282f;border-radius:2px;bottom:10px;bottom:var(--plyr-control-spacing,10px);color:#fff;content:attr(data-badge-text);font-size:11px;padding:2px 6px;pointer-events:none;position:absolute;right:10px;right:var(--plyr-control-spacing,10px);z-index:3}.plyr__ads:empty:after{display:none}.plyr__cues{background:currentColor;display:block;height:5px;height:var(--plyr-range-track-height,5px);left:0;opacity:.8;position:absolute;top:50%;transform:translateY(-50%);width:3px;z-index:3}.plyr__preview-thumb{background-color:#fff;background-color:var(--plyr-tooltip-background,#fff);border-radius:8px;border-radius:var(--plyr-menu-radius,8px);bottom:100%;box-shadow:0 1px 2px #00000026;box-shadow:var(--plyr-tooltip-shadow,0 1px 2px #00000026);margin-bottom:10px;margin-bottom:calc(var(--plyr-control-spacing, 10px)/2*2);opacity:0;padding:3px;pointer-events:none;position:absolute;transform:translateY(10px) scale(.8);transform-origin:50% 100%;transition:transform .2s ease .1s,opacity .2s ease .1s;z-index:2}.plyr__preview-thumb--is-shown{opacity:1;transform:translate(0) scale(1)}.plyr__preview-thumb:before{border-left:4px solid #0000;border-left:var(--plyr-tooltip-arrow-size,4px) solid #0000;border-right:4px solid #0000;border-right:var(--plyr-tooltip-arrow-size,4px) solid #0000;border-top:4px solid #fff;border-top:var(--plyr-tooltip-arrow-size,4px) solid var(--plyr-tooltip-background,#fff);bottom:-4px;bottom:calc(var(--plyr-tooltip-arrow-size, 4px)*-1);content:"";height:0;left:calc(50% + var(--preview-arrow-offset));position:absolute;transform:translateX(-50%);width:0;z-index:2}.plyr__preview-thumb__image-container{background:#c1c8d1;border-radius:7px;border-radius:calc(var(--plyr-menu-radius, 8px) - 1px);overflow:hidden;position:relative;z-index:0}.plyr__preview-thumb__image-container img,.plyr__preview-thumb__image-container:after{height:100%;left:0;position:absolute;top:0;width:100%}.plyr__preview-thumb__image-container:after{border-radius:inherit;box-shadow:inset 0 0 0 1px #00000026;content:"";pointer-events:none}.plyr__preview-thumb__image-container img{max-height:none;max-width:none}.plyr__preview-thumb__time-container{background:linear-gradient(#0000,#000000bf);background:var(--plyr-video-controls-background,linear-gradient(#0000,#000000bf));border-bottom-left-radius:7px;border-bottom-left-radius:calc(var(--plyr-menu-radius, 8px) - 1px);border-bottom-right-radius:7px;border-bottom-right-radius:calc(var(--plyr-menu-radius, 8px) - 1px);bottom:0;left:0;line-height:1.1;padding:20px 6px 6px;position:absolute;right:0;z-index:3}.plyr__preview-thumb__time-container span{color:#fff;font-size:13px;font-size:var(--plyr-font-size-time,var(--plyr-font-size-small,13px))}.plyr__preview-scrubbing{bottom:0;filter:blur(1px);height:100%;left:0;margin:auto;opacity:0;overflow:hidden;pointer-events:none;position:absolute;right:0;top:0;transition:opacity .3s ease;width:100%;z-index:1}.plyr__preview-scrubbing--is-shown{opacity:1}.plyr__preview-scrubbing img{height:100%;left:0;max-height:none;max-width:none;object-fit:contain;position:absolute;top:0;width:100%}.plyr--no-transition{transition:none!important}.plyr__sr-only{clip:rect(1px,1px,1px,1px);border:0!important;height:1px!important;overflow:hidden;padding:0!important;position:absolute!important;width:1px!important}.plyr [hidden]{display:none!important}.videoxblock-player{display:block;height:100%;width:100%}.plyr--video .plyr__caption{font-size:1.8rem}.plyr button,.plyr button:focus,.plyr button:hover{border:none;box-shadow:none}.plyr--video .plyr__control:hover{text-shadow:none}
</style>

  <base target="_parent">

<script type="text/javascript">
  var $$course_id = "course\u002Dv1:urfu+HIST+spring_2025";
</script>










<script type="application/json" id="user-metadata">
    null
</script>









<!-- dummy Segment -->
<script type="text/javascript">
  var analytics = {
    track: function() { return; },
    trackLink: function() { return; },
    pageview: function() { return; },
    page: function() { return; }
  };
</script>
<!-- end dummy Segment -->


  <meta name="path_prefix" content="">


  <meta name="openedx-release-line" content="maple" />





</head>

<body class="ltr view-in-course view-courseware courseware  lang_ru">



<div id="page-prompt"></div>

    <a class="nav-skip sr-only sr-only-focusable" href="#main">Перейти к основному содержимому</a>













    <div class="marketing-hero"></div>

    <div class="content-wrapper main-container" id="content" dir="ltr">









<script type="text/template" id="image-modal-tpl">
    <div class="wrapper-modal wrapper-modal-image">
  <section class="image-link">
    <%= smallHTML%> <% // xss-lint: disable=underscore-not-escaped %>
    <a href="#" class="modal-ui-icon action-fullscreen" role="button">
      <span class="label">
        <span class="icon fa fa-arrows-alt fa-large" aria-hidden="true"></span> <%- gettext("Fullscreen") %>
      </span>
    </a>
  </section>

  <section class="image-modal">
    <section class="image-content">
      <div class="image-wrapper">
        <img alt="<%- largeALT %>, <%- gettext('Large') %>" src="<%- largeSRC %>" />
      </div>

      <a href="#" class="modal-ui-icon action-close" role="button">
        <span class="label">
          <span class="icon fa fa-remove fa-large" aria-hidden="true"></span> <%- gettext("Close") %>
        </span>
      </a>

      <ul class="image-controls">
        <li class="image-control">
          <a href="#" class="modal-ui-icon action-zoom-in" role="button">
            <span class="label">
              <span class="icon fa fa fa-search-plus fa-large" aria-hidden="true"></span> <%- gettext("Zoom In") %>
            </span>
          </a>
        </li>

        <li class="image-control">
          <a href="#" class="modal-ui-icon action-zoom-out is-disabled" aria-disabled="true" role="button">
            <span class="label">
              <span class="icon fa fa fa-search-minus fa-large" aria-hidden="true"></span> <%- gettext("Zoom Out") %>
            </span>
          </a>
        </li>
      </ul>
    </section>
  </section>
</div>

</script>







<div class="course-wrapper chromeless">
  <section class="course-content" id="course-content"      data-enable-completion-on-view-service="false"     style="display: block; width: auto; margin: 0;"
  >
      <main id="main" aria-label="Content">

<div class="xblock xblock-student_view xblock-student_view-vertical" data-course-id="course-v1:urfu+HIST+spring_2025" data-init="VerticalStudentView" data-runtime-class="LmsRuntime" data-runtime-version="1" data-block-type="vertical" data-usage-id="block-v1:urfu+HIST+spring_2025+type@vertical+block@ed941d07e43b4be5bbf03c78c4ced158" data-request-token="00a8b60c072311f085afbe80902eba32" data-graded="False" data-has-score="False">








<div class="vert-mod">
    <div class="vert vert-0" data-id="block-v1:urfu+HIST+spring_2025+type@html+block@d94d439bf91044a5a953f4d40a39d27f">

<div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlBlock" data-course-id="course-v1:urfu+HIST+spring_2025" data-init="XBlockToXModuleShim" data-runtime-class="LmsRuntime" data-runtime-version="1" data-block-type="html" data-usage-id="block-v1:urfu+HIST+spring_2025+type@html+block@d94d439bf91044a5a953f4d40a39d27f" data-request-token="00a8b60c072311f085afbe80902eba32" data-graded="False" data-has-score="False">
  <script type="json/xblock-args" class="xblock-json-init-args">
    {"xmodule-type": "HTMLModule"}
  </script>
  <h3 style="font-size: 1.5em;">Древнерусская культура</h3>
</div>

    </div>
    <div class="vert vert-1" data-id="block-v1:urfu+HIST+spring_2025+type@videoxblock+block@5d9d88c80662491f99b9a9ac35fffc63">

<div class="xblock xblock-student_view xblock-student_view-videoxblock" data-course-id="course-v1:urfu+HIST+spring_2025" data-init="VideoXBlock" data-runtime-class="LmsRuntime" data-runtime-version="1" data-block-type="videoxblock" data-usage-id="block-v1:urfu+HIST+spring_2025+type@videoxblock+block@5d9d88c80662491f99b9a9ac35fffc63" data-request-token="00a8b60c072311f085afbe80902eba32" data-graded="False" data-has-score="False">
  <script type="json/xblock-args" class="xblock-json-init-args">
    {"display_name": "\u0414\u0440\u0435\u0432\u043d\u0435\u0440\u0443\u0441\u0441\u043a\u0430\u044f \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u0430", "video_name": "", "hls_url": "https://video.openedu.ru/api/public/video/fb542ec1-38e9-4fea-b495-ffed65cb92ec", "thumbnail_url": "https://video-cdn.openedu.ru/ZwlHYVBlDVa4OKS7glGUCGzuVb9C9TNNHhydBLzEsi/29bCJeN1nkv64OXpczLiZXdDyf2DWQzwLd25gfd5Yu/ClRXsrrJARyGq8x1YJQ4SygVDZCEl37Nu37mwjiZH6/A02thumbnail.png", "previews": ["https://video.openedu.ru/api/public/preview/de21b5cd-8758-4e3c-b2fb-3433b2c3c930", "https://video.openedu.ru/api/public/preview/655d233f-45fc-4acc-9d94-0056e0d27c86"], "qualities": [{"label": "1080p", "height": 1080, "width": 1920, "url": "https://video-cdn.openedu.ru/v/E/i/O/xZSLBWmqJJ6pa0gqjC9PGHsjbzgrCeNsf/stream_0.ts", "status": "COMPLETED"}, {"label": "720p", "height": 720, "width": 1280, "url": "https://video-cdn.openedu.ru/S/C/c/L/rmA72Jm7shoGjTVOTVgE-I20uQMzQcWpq/stream_0.ts", "status": "COMPLETED"}, {"label": "480p", "height": 480, "width": 854, "url": "https://video-cdn.openedu.ru/1/x/m/k/5swotKi7PeUsgy0oXbt6Z1MMRbwAAxN3-/stream_0.ts", "status": "COMPLETED"}, {"label": "360p", "height": 360, "width": 640, "url": "https://video-cdn.openedu.ru/J/I/i/1/ZRLfGGmLa56Eduj9r8IQyt05olxNeaJ7f/stream_0.ts", "status": "COMPLETED"}], "subtitles": [{"lang": "ru", "url": "https://video-cdn.openedu.ru/H/E/w/u/MjUEh3UkJXQ3TYuf5x6cGQ_lPPCpo32dh/original12722012459161495024tmp"}]}
  </script>
  <div class="videoxblock-block">

<video class="videoxblock-player"
       controls
       crossorigin
       playsinline
       data-poster="https://video-cdn.openedu.ru/ZwlHYVBlDVa4OKS7glGUCGzuVb9C9TNNHhydBLzEsi/29bCJeN1nkv64OXpczLiZXdDyf2DWQzwLd25gfd5Yu/ClRXsrrJARyGq8x1YJQ4SygVDZCEl37Nu37mwjiZH6/A02thumbnail.png"
>

    <source src="https://video-cdn.openedu.ru/v/E/i/O/xZSLBWmqJJ6pa0gqjC9PGHsjbzgrCeNsf/stream_0.ts" type="video/mp2t" data-size="1920" />

    <source src="https://video-cdn.openedu.ru/S/C/c/L/rmA72Jm7shoGjTVOTVgE-I20uQMzQcWpq/stream_0.ts" type="video/mp2t" data-size="1280" />

    <source src="https://video-cdn.openedu.ru/1/x/m/k/5swotKi7PeUsgy0oXbt6Z1MMRbwAAxN3-/stream_0.ts" type="video/mp2t" data-size="854" />

    <source src="https://video-cdn.openedu.ru/J/I/i/1/ZRLfGGmLa56Eduj9r8IQyt05olxNeaJ7f/stream_0.ts" type="video/mp2t" data-size="640" />


</video>

</div>

</div>

    </div>
    <div class="vert vert-2" data-id="block-v1:urfu+HIST+spring_2025+type@html+block@f1a831d8528e40e283ad50b62a060296">

<div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlBlock" data-course-id="course-v1:urfu+HIST+spring_2025" data-init="XBlockToXModuleShim" data-runtime-class="LmsRuntime" data-runtime-version="1" data-block-type="html" data-usage-id="block-v1:urfu+HIST+spring_2025+type@html+block@f1a831d8528e40e283ad50b62a060296" data-request-token="00a8b60c072311f085afbe80902eba32" data-graded="False" data-has-score="False">
  <script type="json/xblock-args" class="xblock-json-init-args">
    {"xmodule-type": "HTMLModule"}
  </script>
  <p style="padding-bottom: 0.4em; margin-bottom: 0em; font-size: 0.9em;">ЛЕКЦИЮ ЧИТАЕТ</p>
<p style="font-size: 1.3em; padding-bottom: 0px; margin-bottom: 0px; padding-top: 0; margin-top: 0;">Рябов Сергей Михайлович</p>
<p style="font-size: 16px; padding-top: 0px; margin-top: 0px;">Ассистент кафедры истории России УГИ УрФУ</p>
</div>

    </div>
    <div class="vert vert-3" data-id="block-v1:urfu+HIST+spring_2025+type@problem+block@e33e6e3b5a1744c9ae9ec23ce702385c">

<div class="xblock xblock-student_view xblock-student_view-problem xmodule_display xmodule_ProblemBlock" data-course-id="course-v1:urfu+HIST+spring_2025" data-init="XBlockToXModuleShim" data-runtime-class="LmsRuntime" data-runtime-version="1" data-block-type="problem" data-usage-id="block-v1:urfu+HIST+spring_2025+type@problem+block@e33e6e3b5a1744c9ae9ec23ce702385c" data-request-token="00a8b60c072311f085afbe80902eba32" data-graded="False" data-has-score="True">
  <script type="json/xblock-args" class="xblock-json-init-args">
    {"xmodule-type": "Problem"}
  </script>
  <div id="problem_e33e6e3b5a1744c9ae9ec23ce702385c" class="problems-wrapper" role="group"
     aria-labelledby="e33e6e3b5a1744c9ae9ec23ce702385c-problem-title"
     data-problem-id="block-v1:urfu+HIST+spring_2025+type@problem+block@e33e6e3b5a1744c9ae9ec23ce702385c" data-url="/courses/course-v1:urfu+HIST+spring_2025/xblock/block-v1:urfu+HIST+spring_2025+type@problem+block@e33e6e3b5a1744c9ae9ec23ce702385c/handler/xmodule_handler"
     data-problem-score="3"
     data-problem-total-possible="3"
     data-attempts-used="1"
     data-content="



&lt;h3 class=&#34;hd hd-3 problem-header&#34; id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c-problem-title&#34; aria-describedby=&#34;block-v1:urfu+HIST+spring_2025+type@problem+block@e33e6e3b5a1744c9ae9ec23ce702385c-problem-progress&#34; tabindex=&#34;-1&#34;&gt;
  Тест для самоконтроля
&lt;/h3&gt;

&lt;div class=&#34;problem-progress&#34; id=&#34;block-v1:urfu+HIST+spring_2025+type@problem+block@e33e6e3b5a1744c9ae9ec23ce702385c-problem-progress&#34;&gt;&lt;/div&gt;

&lt;div class=&#34;problem&#34;&gt;
  &lt;div&gt;
&lt;p&gt;&lt;em&gt;Выберите все правильные варианты ответа&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;wrapper-problem-response&#34; tabindex=&#34;-1&#34; aria-label=&#34;Вопрос 1&#34; role=&#34;group&#34;&gt;&lt;div class=&#34;choicegroup capa_inputtype&#34; id=&#34;inputtype_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34;&gt;
    &lt;fieldset aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34;&gt;
        &lt;legend id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_2_1-legend&#34; class=&#34;response-fieldset-legend field-group-hd&#34;&gt;Среди основных отличительных черт древнерусской культуры можно выделить…&lt;/legend&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;checkbox&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1[]&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_0&#34; class=&#34;field-input input-checkbox&#34; value=&#34;choice_0&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_2_1-choice_0-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_0&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34;&gt; изоляционизм
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;checkbox&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1[]&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_1&#34; class=&#34;field-input input-checkbox submitted&#34; value=&#34;choice_1&#34; checked=&#34;true&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_2_1-choice_1-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_1&#34; class=&#34;response-label field-label label-inline choicegroup_correct&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34;&gt; синтетический характер
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;checkbox&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1[]&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_2&#34; class=&#34;field-input input-checkbox&#34; value=&#34;choice_2&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_2_1-choice_2-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_2&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34;&gt; мононациональный характер
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;checkbox&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1[]&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_3&#34; class=&#34;field-input input-checkbox submitted&#34; value=&#34;choice_3&#34; checked=&#34;true&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_2_1-choice_3-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_2_1_choice_3&#34; class=&#34;response-label field-label label-inline choicegroup_correct&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34;&gt; полиэтнический характер
            &lt;/label&gt;
          &lt;/div&gt;
        &lt;span id=&#34;answer_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34;/&gt;
    &lt;/fieldset&gt;
    &lt;div class=&#34;indicator-container&#34;&gt;


&lt;span class=&#34;status correct&#34; id=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_2_1&#34; data-tooltip=&#34;Это правильный ответ.&#34;&gt;
  &lt;span class=&#34;sr&#34;&gt;верно&lt;/span&gt;&lt;span class=&#34;status-icon&#34; aria-hidden=&#34;true&#34;/&gt;
&lt;/span&gt;

    &lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Выберите правильный вариант ответа&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;wrapper-problem-response&#34; tabindex=&#34;-1&#34; aria-label=&#34;Вопрос 2&#34; role=&#34;group&#34;&gt;&lt;div class=&#34;choicegroup capa_inputtype&#34; id=&#34;inputtype_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34;&gt;
    &lt;fieldset aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34;&gt;
        &lt;legend id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_3_1-legend&#34; class=&#34;response-fieldset-legend field-group-hd&#34;&gt;Былины являются памятником…&lt;/legend&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_3&#34; class=&#34;field-input input-radio&#34; value=&#34;choice_3&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_3_1-choice_3-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_3&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34;&gt; архитектурной древнерусской традиции
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_1&#34; class=&#34;field-input input-radio&#34; value=&#34;choice_1&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_3_1-choice_1-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_1&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34;&gt; летописной древнерусской традиции
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_2&#34; class=&#34;field-input input-radio&#34; value=&#34;choice_2&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_3_1-choice_2-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_2&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34;&gt; живописной древнерусской традиции
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_0&#34; class=&#34;field-input input-radio submitted&#34; value=&#34;choice_0&#34; checked=&#34;true&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_3_1-choice_0-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_3_1_choice_0&#34; class=&#34;response-label field-label label-inline choicegroup_correct&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34;&gt; устной древнерусской традиции
            &lt;/label&gt;
          &lt;/div&gt;
        &lt;span id=&#34;answer_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34;/&gt;
    &lt;/fieldset&gt;
    &lt;div class=&#34;indicator-container&#34;&gt;


&lt;span class=&#34;status correct&#34; id=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_3_1&#34; data-tooltip=&#34;Это правильный ответ.&#34;&gt;
  &lt;span class=&#34;sr&#34;&gt;верно&lt;/span&gt;&lt;span class=&#34;status-icon&#34; aria-hidden=&#34;true&#34;/&gt;
&lt;/span&gt;

    &lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Выберите правильный вариант ответа&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;wrapper-problem-response&#34; tabindex=&#34;-1&#34; aria-label=&#34;Вопрос 3&#34; role=&#34;group&#34;&gt;&lt;div class=&#34;choicegroup capa_inputtype&#34; id=&#34;inputtype_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34;&gt;
    &lt;fieldset aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34;&gt;
        &lt;legend id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_4_1-legend&#34; class=&#34;response-fieldset-legend field-group-hd&#34;&gt;Приглашенные итальянские мастера Пьетро Антонио Солари, Антон Фрязин и Марко Руффо участвовали в реконструкции…&lt;/legend&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_2&#34; class=&#34;field-input input-radio submitted&#34; value=&#34;choice_2&#34; checked=&#34;true&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_4_1-choice_2-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_2&#34; class=&#34;response-label field-label label-inline choicegroup_correct&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34;&gt; Московского Кремля
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_0&#34; class=&#34;field-input input-radio&#34; value=&#34;choice_0&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_4_1-choice_0-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_0&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34;&gt; Казанского кремля
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_3&#34; class=&#34;field-input input-radio&#34; value=&#34;choice_3&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_4_1-choice_3-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_3&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34;&gt; Нижегородского кремля
            &lt;/label&gt;
          &lt;/div&gt;

          &lt;div class=&#34;field&#34;&gt;
            &lt;input type=&#34;radio&#34; name=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34; id=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_1&#34; class=&#34;field-input input-radio&#34; value=&#34;choice_1&#34;/&gt;&lt;label id=&#34;e33e6e3b5a1744c9ae9ec23ce702385c_4_1-choice_1-label&#34; for=&#34;input_e33e6e3b5a1744c9ae9ec23ce702385c_4_1_choice_1&#34; class=&#34;response-label field-label label-inline&#34; aria-describedby=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34;&gt; Новгородского кремля
            &lt;/label&gt;
          &lt;/div&gt;
        &lt;span id=&#34;answer_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34;/&gt;
    &lt;/fieldset&gt;
    &lt;div class=&#34;indicator-container&#34;&gt;


&lt;span class=&#34;status correct&#34; id=&#34;status_e33e6e3b5a1744c9ae9ec23ce702385c_4_1&#34; data-tooltip=&#34;Это правильный ответ.&#34;&gt;
  &lt;span class=&#34;sr&#34;&gt;верно&lt;/span&gt;&lt;span class=&#34;status-icon&#34; aria-hidden=&#34;true&#34;/&gt;
&lt;/span&gt;

    &lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;/div&gt;
  &lt;div class=&#34;action&#34;&gt;
    &lt;input type=&#34;hidden&#34; name=&#34;problem_id&#34; value=&#34;Тест для самоконтроля&#34; /&gt;

    &lt;div class=&#34;problem-action-buttons-wrapper&#34;&gt;
      &lt;span class=&#34;problem-action-button-wrapper&#34;&gt;
          &lt;button type=&#34;button&#34; class=&#34;show problem-action-btn btn-link btn-small&#34; aria-describedby=&#34;e33e6e3b5a1744c9ae9ec23ce702385c-problem-title&#34;&gt;&lt;span class=&#34;show-label&#34;&gt;Show answer&lt;/span&gt;&lt;/button&gt;
      &lt;/span&gt;
    &lt;/div&gt;
    &lt;div class=&#34;submit-attempt-container&#34;&gt;
      &lt;button type=&#34;button&#34; class=&#34;submit btn-brand&#34; data-submitting=&#34;Отправка&#34; data-value=&#34;Отправить&#34; data-should-enable-submit-button=&#34;True&#34; aria-describedby=&#34;submission_feedback_e33e6e3b5a1744c9ae9ec23ce702385c&#34; &gt;
          &lt;span class=&#34;submit-label&#34;&gt;Отправить&lt;/span&gt;
      &lt;/button&gt;

      &lt;div class=&#34;submission-feedback &#34; id=&#34;submission_feedback_e33e6e3b5a1744c9ae9ec23ce702385c&#34;&gt;
        &lt;span class=&#34;sr&#34;&gt;В некоторых задачах доступны следующие действия: сохранение, сброс, показ подсказки или ответа. Соответствующие кнопки расположены рядом с кнопкой «Отправить».&lt;/span&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;



&lt;div class=&#34;notification warning notification-gentle-alert
      is-hidden&#34;
     tabindex=&#34;-1&#34;&gt;
    &lt;span class=&#34;icon fa fa-exclamation-circle&#34; aria-hidden=&#34;true&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;notification-message&#34; aria-describedby=&#34;e33e6e3b5a1744c9ae9ec23ce702385c-problem-title&#34;&gt;
    &lt;/span&gt;
    &lt;div class=&#34;notification-btn-wrapper&#34;&gt;
        &lt;button type=&#34;button&#34; class=&#34;btn btn-default btn-small notification-btn review-btn sr&#34;&gt;Просмотреть&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;




&lt;div class=&#34;notification warning notification-save
      is-hidden&#34;
     tabindex=&#34;-1&#34;&gt;
    &lt;span class=&#34;icon fa fa-save&#34; aria-hidden=&#34;true&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;notification-message&#34; aria-describedby=&#34;e33e6e3b5a1744c9ae9ec23ce702385c-problem-title&#34;&gt;None
    &lt;/span&gt;
    &lt;div class=&#34;notification-btn-wrapper&#34;&gt;
        &lt;button type=&#34;button&#34; class=&#34;btn btn-default btn-small notification-btn review-btn sr&#34;&gt;Просмотреть&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;





&lt;div class=&#34;notification general notification-show-answer
      is-hidden&#34;
     tabindex=&#34;-1&#34;&gt;
    &lt;span class=&#34;icon fa fa-info-circle&#34; aria-hidden=&#34;true&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;notification-message&#34; aria-describedby=&#34;e33e6e3b5a1744c9ae9ec23ce702385c-problem-title&#34;&gt;Ответы в задаче отмечены
    &lt;/span&gt;
    &lt;div class=&#34;notification-btn-wrapper&#34;&gt;
        &lt;button type=&#34;button&#34; class=&#34;btn btn-default btn-small notification-btn review-btn sr&#34;&gt;Просмотреть&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;script&gt;
    function emit_event(message) {
        parent.postMessage(message, &#39;*&#39;);
    }
&lt;/script&gt;
"
     data-graded="False">
    <p class="loading-spinner">
        <i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>
        <span class="sr">Loading&hellip;</span>
    </p>
</div>

</div>

    </div>
</div>



  <script type="text/javascript">
    (function (require) {
        require(['https://cdn2.openedu.ru/static/js/dateutil_factory.a28baef97506.js?raw'], function () {
          require(['js/dateutil_factory'], function (DateUtilFactory) {

    DateUtilFactory.transform('.localized-datetime');

          });
        });
    }).call(this, require || RequireJS.require);
  </script>


<script>
    function emit_event(message) {
        parent.postMessage(message, '*');
    }
</script>

</div>

      </main>
  </section>
</div>

<script type="text/javascript">
  (function() {
    // If this view is rendered in an iframe within the learning microfrontend app
    // it will report the height of its contents to the parent window when the
    // document loads, window resizes, or DOM mutates.
    if (window !== window.parent) {
      document.body.className += ' view-in-mfe';
      var lastHeight = window.offsetHeight;
      var lastWidth = window.offsetWidth;
      var contentElement = document.getElementById('content');

      function dispatchResizeMessage(event) {
        // Note: event is actually an Array of MutationRecord objects
        // when fired from the MutationObserver
        var eventType = event.type || 'mutate';
        var newHeight = contentElement.offsetHeight;
        var newWidth = contentElement.offsetWidth;
        if (eventType !== 'load' && newWidth === lastWidth && newHeight === lastHeight) {
            // Monitor when any anchor tag is clicked, it is checked to make sure
            // it is referencing an element's id or name (not an external website). If
            // the href attribute is an id or name, the location of the selected focus
            // element is sent through its offset attribute. The offset will
            // allow the page to scroll to the location of the focus element so
            // that it is at the top of the page. Unique ids and names are
            // required for proper scrolling.
            $('a').on("click", function(event){
              if ($(this).attr('href')[0] === "#") {
                var targetId = $(this).attr('href');
                var targetName = $(this).attr('href').slice(1);
                // Checks if the target uses an id or name to focus and gets offset.
                var targetOffset = $(targetId).offset() || $(document.getElementsByName(targetName)[0]).offset();
                if (targetOffset) {
                  event.preventDefault();
                  window.parent.postMessage({"offset": targetOffset.top}, document.referrer);
                }
              }
            })
          return;
        }
        // Monitor for messages and checks if the message contains an id. If
        // there is an id, then the location of the selected focus element
        // is sent through its offset attribute. The offset will allow the
        // page to scroll to the location of the focus element so that it is
        // at the top of the page. Unique ids and names are required for
        // proper scrolling.
        window.addEventListener('message', function (event) {
          if (event.data.hashName) {
            var targetId = event.data.hashName;
            var targetName = event.data.hashName.slice(1);
            // Checks if the target uses an id or name to focus and gets offset.
            var targetOffset = $(targetId).offset() || $(document.getElementsByName(targetName)[0]).offset();
            window.parent.postMessage({ 'offset': targetOffset.top }, document.referrer);
          }
        })

        window.parent.postMessage({
            type: 'plugin.resize',
            payload: {
              width: newWidth,
              height: newHeight,
            }
          }, document.referrer
        );

        lastHeight = newHeight;
        lastWidth = newWidth;

        // Within the learning microfrontend the iframe resizes to match the
        // height of this document and it should never scroll. It does scroll
        // ocassionally when javascript is used to focus elements on the page
        // before the parent iframe has been resized to match the content
        // height. This window.scrollTo is an attempt to keep the content at the
        // top of the page. See TNL-7094
        window.scrollTo(0, 0);
      }

      // Create an observer instance linked to the callback function
      const observer = new MutationObserver(dispatchResizeMessage);

      // Start observing the target node for configured mutations
      observer.observe(document.body, { attributes: true, childList: true, subtree: true });

      window.addEventListener('load', dispatchResizeMessage);
      const resizeObserver = new ResizeObserver(dispatchResizeMessage);
      resizeObserver.observe(document.body);
    }
  }());
</script>


    </div>





  <script type="text/javascript" src="https://cdn2.openedu.ru/static/common/js/vendor/jquery.scrollTo.525edcc52fe8.js" async></script>
  <script type="text/javascript" src="https://cdn2.openedu.ru/static/js/vendor/flot/jquery.flot.d3d45ff0c6a8.js" async></script>



<script type="text/javascript" src="https://cdn2.openedu.ru/static/js/lms-courseware.9517dcd2081d.js" charset="utf-8"></script>








<script type="text/javascript">
    // Fast Preview was introduced in 2.5. However, it
    // causes undesirable flashing/font size changes when
    // MathJax is used for interactive preview (equation editor).
    // Setting processSectionDelay to 0 (see below) fully eliminates
    // fast preview, but to reduce confusion, we are also setting
    // the option as displayed in the context menu to false.
    // When upgrading to 2.6, check if this variable name changed.
    window.MathJax = {
      menuSettings: {CHTMLpreview: false}
    };
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    messageStyle: "none",
    tex2jax: {
      inlineMath: [
        ["\\(","\\)"],
        ['[mathjaxinline]','[/mathjaxinline]']
      ],
      displayMath: [
        ["\\[","\\]"],
        ['[mathjax]','[/mathjax]']
      ]
    }
  });
</script>
<script type="text/x-mathjax-config">

  // In order to eliminate all flashing during interactive
  // preview, it is necessary to set processSectionDelay to 0
  // (remove delay between input and output phases). This
  // effectively disables fast preview, regardless of
  // the fast preview setting as shown in the context menu.
  MathJax.Hub.processSectionDelay = 0;

  MathJax.Hub.signal.Interest(function(message) {
    if(message[0] === "End Math") {
        set_mathjax_display_div_settings();
    }
  });
  function set_mathjax_display_div_settings() {
    $('.MathJax_Display').each(function( index ) {
      this.setAttribute('tabindex', '0');
      this.setAttribute('aria-live', 'off');
      this.removeAttribute('role');
      this.removeAttribute('aria-readonly');
    });
  }
</script>

<script type="text/javascript">
    // Activating Mathjax accessibility files
    window.MathJax = {
        menuSettings: {
            collapsible: true,
            autocollapse: false,
            explorer: true
        }
    };
</script>

<!-- This must appear after all mathjax-config blocks, so it is after the imports from the other templates.
     It can't be run through static.url because MathJax uses crazy url introspection to do lazy loading of
     MathJax extension libraries -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_SVG"></script>


<script src='https://cdn2.openedu.ru/static/bundles/HtmlBlockPreview.47dfb3a011d61e073bb9.68644e9f6662.js' type='application/javascript'></script>
<script src='https://cdn2.openedu.ru/static/bundles/XModuleShim.b0a0bcfa4bfc116299b0.0021dbb8621f.js' type='application/javascript'></script>
<script>
/*! For license information please see player.js.LICENSE.txt */
(()=>{var i={434:function(i){typeof window!=="undefined"&&function e(t,r){if(true)i.exports=r();else{}}(this,function(){return function(r){var i={};function n(e){if(i[e]){return i[e].exports}var t=i[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=r;n.c=i;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(t,e){if(e&1)t=n(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="/dist/";return n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,v="~";function i(){}if(Object.create){i.prototype=Object.create(null);if(!(new i).__proto__)v=false}function o(e,t,r){this.fn=e;this.context=t;this.once=r||false}function a(e,t,r,i,n){if(typeof r!=="function"){throw new TypeError("The listener must be a function")}var a=new o(r,i||e,n),s=v?v+t:t;if(!e._events[s])e._events[s]=a,e._eventsCount++;else if(!e._events[s].fn)e._events[s].push(a);else e._events[s]=[e._events[s],a];return e}function c(e,t){if(--e._eventsCount===0)e._events=new i;else delete e._events[t]}function s(){this._events=new i;this._eventsCount=0}s.prototype.eventNames=function e(){var t=[],r,i;if(this._eventsCount===0)return t;for(i in r=this._events){if(n.call(r,i))t.push(v?i.slice(1):i)}if(Object.getOwnPropertySymbols){return t.concat(Object.getOwnPropertySymbols(r))}return t};s.prototype.listeners=function e(t){var r=v?v+t:t,i=this._events[r];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,a=i.length,s=new Array(a);n<a;n++){s[n]=i[n].fn}return s};s.prototype.listenerCount=function e(t){var r=v?v+t:t,i=this._events[r];if(!i)return 0;if(i.fn)return 1;return i.length};s.prototype.emit=function e(t,r,i,n,a,s){var o=v?v+t:t;if(!this._events[o])return false;var l=this._events[o],u=arguments.length,c,d;if(l.fn){if(l.once)this.removeListener(t,l.fn,undefined,true);switch(u){case 1:return l.fn.call(l.context),true;case 2:return l.fn.call(l.context,r),true;case 3:return l.fn.call(l.context,r,i),true;case 4:return l.fn.call(l.context,r,i,n),true;case 5:return l.fn.call(l.context,r,i,n,a),true;case 6:return l.fn.call(l.context,r,i,n,a,s),true}for(d=1,c=new Array(u-1);d<u;d++){c[d-1]=arguments[d]}l.fn.apply(l.context,c)}else{var f=l.length,h;for(d=0;d<f;d++){if(l[d].once)this.removeListener(t,l[d].fn,undefined,true);switch(u){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,r);break;case 3:l[d].fn.call(l[d].context,r,i);break;case 4:l[d].fn.call(l[d].context,r,i,n);break;default:if(!c)for(h=1,c=new Array(u-1);h<u;h++){c[h-1]=arguments[h]}l[d].fn.apply(l[d].context,c)}}}return true};s.prototype.on=function e(t,r,i){return a(this,t,r,i,false)};s.prototype.once=function e(t,r,i){return a(this,t,r,i,true)};s.prototype.removeListener=function e(t,r,i,n){var a=v?v+t:t;if(!this._events[a])return this;if(!r){c(this,a);return this}var s=this._events[a];if(s.fn){if(s.fn===r&&(!n||s.once)&&(!i||s.context===i)){c(this,a)}}else{for(var o=0,l=[],u=s.length;o<u;o++){if(s[o].fn!==r||n&&!s[o].once||i&&s[o].context!==i){l.push(s[o])}}if(l.length)this._events[a]=l.length===1?l[0]:l;else c(this,a)}return this};s.prototype.removeAllListeners=function e(t){var r;if(t){r=v?v+t:t;if(this._events[r])c(this,r)}else{this._events=new i;this._eventsCount=0}return this};s.prototype.off=s.prototype.removeListener;s.prototype.addListener=s.prototype.on;s.prefixed=v;s.EventEmitter=s;if(true){e.exports=s}},"./node_modules/url-toolkit/src/url-toolkit.js":function(n,e,t){(function(e){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/;var c=/^(?=([^\/?#]*))\1([^]*)$/;var t=/(?:\/|^)\.(?=\/)/g;var i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g;var d={buildAbsoluteURL:function(e,t,r){r=r||{};e=e.trim();t=t.trim();if(!t){if(!r.alwaysNormalize){return e}var i=d.parseURL(e);if(!i){throw new Error("Error trying to parse base URL.")}i.path=d.normalizePath(i.path);return d.buildURLFromParts(i)}var n=d.parseURL(t);if(!n){throw new Error("Error trying to parse relative URL.")}if(n.scheme){if(!r.alwaysNormalize){return t}n.path=d.normalizePath(n.path);return d.buildURLFromParts(n)}var a=d.parseURL(e);if(!a){throw new Error("Error trying to parse base URL.")}if(!a.netLoc&&a.path&&a.path[0]!=="/"){var s=c.exec(a.path);a.netLoc=s[1];a.path=s[2]}if(a.netLoc&&!a.path){a.path="/"}var o={scheme:a.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc){o.netLoc=a.netLoc;if(n.path[0]!=="/"){if(!n.path){o.path=a.path;if(!n.params){o.params=a.params;if(!n.query){o.query=a.query}}}else{var l=a.path;var u=l.substring(0,l.lastIndexOf("/")+1)+n.path;o.path=d.normalizePath(u)}}}if(o.path===null){o.path=r.alwaysNormalize?d.normalizePath(n.path):n.path}return d.buildURLFromParts(o)},parseURL:function(e){var t=r.exec(e);if(!t){return null}return{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}},normalizePath:function(e){e=e.split("").reverse().join("").replace(t,"");while(e.length!==(e=e.replace(i,"")).length){}return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};if(true)n.exports=d;else{}})(this)},"./node_modules/webworkify-webpack/index.js":function(e,t,f){function u(r){var i={};function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=r;n.c=i;n.i=function(e){return e};n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};n.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="/";n.oe=function(e){console.error(e);throw e};var e=n(n.s=ENTRY_MODULE);return e.default||e}var h="[\\.|\\-|\\+|\\w|/|@]+";var v="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+h+").*?\\)";function g(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function p(e){return!isNaN(1*e)}function m(e,t,r){var i={};i[r]=[];var n=t.toString();var a=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return i;var s=a[1];var o=new RegExp("(\\\\n|\\W)"+g(s)+v,"g");var l;while(l=o.exec(n)){if(l[3]==="dll-reference")continue;i[r].push(l[3])}o=new RegExp("\\("+g(s)+'\\("(dll-reference\\s('+h+'))"\\)\\)'+v,"g");while(l=o.exec(n)){if(!e[l[2]]){i[r].push(l[1]);e[l[2]]=f(l[1]).m}i[l[2]]=i[l[2]]||[];i[l[2]].push(l[4])}var u=Object.keys(i);for(var c=0;c<u.length;c++){for(var d=0;d<i[u[c]].length;d++){if(p(i[u[c]][d])){i[u[c]][d]=1*i[u[c]][d]}}}return i}function y(r){var e=Object.keys(r);return e.reduce(function(e,t){return e||r[t].length>0},false)}function c(e,t){var r={main:[t]};var i={main:[]};var n={main:{}};while(y(r)){var a=Object.keys(r);for(var s=0;s<a.length;s++){var o=a[s];var l=r[o];var u=l.pop();n[o]=n[o]||{};if(n[o][u]||!e[o][u])continue;n[o][u]=true;i[o]=i[o]||[];i[o].push(u);var c=m(e,e[o][u],o);var d=Object.keys(c);for(var f=0;f<d.length;f++){r[d[f]]=r[d[f]]||[];r[d[f]]=r[d[f]].concat(c[d[f]])}}}return i}e.exports=function(e,t){t=t||{};var r={main:f.m};var i=t.all?{main:Object.keys(r.main)}:c(r,e);var n="";Object.keys(i).filter(function(e){return e!=="main"}).forEach(function(t){var e=0;while(i[t][e]){e++}i[t].push(e);r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })";n=n+"var "+t+" = ("+u.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i[t].map(function(e){return""+JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"});n=n+"new (("+u.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i.main.map(function(e){return""+JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);";var a=new window.Blob([n],{type:"text/javascript"});if(t.bare){return a}var s=window.URL||window.webkitURL||window.mozURL||window.msURL;var o=s.createObjectURL(a);var l=new window.Worker(o);l.objectURL=o;return l}},"./src/config.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"hlsDefaultConfig",function(){return k});r.d(t,"mergeConfig",function(){return L});r.d(t,"enableStreamingMode",function(){return D});var i=r("./src/controller/abr-controller.ts");var n=r("./src/controller/audio-stream-controller.ts");var a=r("./src/controller/audio-track-controller.ts");var s=r("./src/controller/subtitle-stream-controller.ts");var o=r("./src/controller/subtitle-track-controller.ts");var l=r("./src/controller/buffer-controller.ts");var u=r("./src/controller/timeline-controller.ts");var c=r("./src/controller/cap-level-controller.ts");var d=r("./src/controller/fps-controller.ts");var f=r("./src/controller/eme-controller.ts");var h=r("./src/controller/cmcd-controller.ts");var v=r("./src/utils/xhr-loader.ts");var g=r("./src/utils/fetch-loader.ts");var p=r("./src/utils/cues.ts");var m=r("./src/utils/mediakeys-helper.ts");var y=r("./src/utils/logger.ts");function b(){b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return b.apply(this,arguments)}function T(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function E(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?T(Object(r),!0).forEach(function(e){S(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function S(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var k=E(E({autoStartLoad:true,startPosition:-1,defaultAudioCodec:undefined,debug:false,capLevelOnFPSDrop:false,capLevelToPlayerSize:false,ignoreDevicePixelRatio:false,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:Infinity,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:undefined,liveMaxLatencyDuration:undefined,maxLiveSyncPlaybackRate:1,liveDurationInfinity:false,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:undefined,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:false,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:v["default"],fLoader:undefined,pLoader:undefined,xhrSetup:undefined,licenseXhrSetup:undefined,licenseResponseCallback:undefined,abrController:i["default"],bufferController:l["default"],capLevelController:c["default"],fpsController:d["default"],stretchShortVideoTrack:false,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:true,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:false,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:false,widevineLicenseUrl:undefined,drmSystemOptions:{},requestMediaKeySystemAccessFunc:m["requestMediaKeySystemAccess"],testBandwidth:true,progressive:false,lowLatencyMode:true,cmcd:undefined,enableDateRangeMetadataCues:true,enableEmsgMetadataCues:true,enableID3MetadataCues:true},A()),{},{subtitleStreamController:true?s["SubtitleStreamController"]:0,subtitleTrackController:true?o["default"]:0,timelineController:true?u["TimelineController"]:0,audioStreamController:true?n["default"]:0,audioTrackController:true?a["default"]:0,emeController:true?f["default"]:0,cmcdController:true?h["default"]:0});function A(){return{cueHandler:p["default"],enableWebVTT:true,enableIMSC1:true,enableCEA708Captions:true,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:true}}function L(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration")}if(t.liveMaxLatencyDurationCount!==undefined&&(t.liveSyncDurationCount===undefined||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"')}if(t.liveMaxLatencyDuration!==undefined&&(t.liveSyncDuration===undefined||t.liveMaxLatencyDuration<=t.liveSyncDuration)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"')}return b({},e,t)}function D(e){var t=e.loader;if(t!==g["default"]&&t!==v["default"]){y["logger"].log("[config]: Custom loader detected, cannot enable progressive streaming");e.progressive=false}else{var r=Object(g["fetchSupported"])();if(r){e.loader=g["default"];e.progressive=true;e.enableSoftwareAES=true;y["logger"].log("[config]: Progressive streaming enabled, using FetchLoader")}}}},"./src/controller/abr-controller.ts":function(e,t,r){"use strict";r.r(t);var k=r("./src/polyfills/number.ts");var i=r("./src/utils/ewma-bandwidth-estimator.ts");var A=r("./src/events.ts");var L=r("./src/utils/buffer-helper.ts");var n=r("./src/errors.ts");var d=r("./src/types/loader.ts");var D=r("./src/utils/logger.ts");function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function s(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var o=function(){function e(e){this.hls=void 0;this.lastLoadedFragLevel=0;this._nextAutoLevel=-1;this.timer=void 0;this.onCheck=this._abandonRulesCheck.bind(this);this.fragCurrent=null;this.partCurrent=null;this.bitrateTestDelay=0;this.bwEstimator=void 0;this.hls=e;var t=e.config;this.bwEstimator=new i["default"](t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate);this.registerListeners()}var t=e.prototype;t.registerListeners=function e(){var t=this.hls;t.on(A["Events"].FRAG_LOADING,this.onFragLoading,this);t.on(A["Events"].FRAG_LOADED,this.onFragLoaded,this);t.on(A["Events"].FRAG_BUFFERED,this.onFragBuffered,this);t.on(A["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.on(A["Events"].ERROR,this.onError,this)};t.unregisterListeners=function e(){var t=this.hls;t.off(A["Events"].FRAG_LOADING,this.onFragLoading,this);t.off(A["Events"].FRAG_LOADED,this.onFragLoaded,this);t.off(A["Events"].FRAG_BUFFERED,this.onFragBuffered,this);t.off(A["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.off(A["Events"].ERROR,this.onError,this)};t.destroy=function e(){this.unregisterListeners();this.clearTimer();this.hls=this.onCheck=null;this.fragCurrent=this.partCurrent=null};t.onFragLoading=function e(t,r){var i=r.frag;if(i.type===d["PlaylistLevelType"].MAIN){if(!this.timer){var n;this.fragCurrent=i;this.partCurrent=(n=r.part)!=null?n:null;this.timer=self.setInterval(this.onCheck,100)}}};t.onLevelLoaded=function e(t,r){var i=this.hls.config;if(r.details.live){this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive)}else{this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}};t._abandonRulesCheck=function e(){var t=this.fragCurrent,r=this.partCurrent,i=this.hls;var n=i.autoLevelEnabled,a=i.config,s=i.media;if(!t||!s){return}var o=r?r.stats:t.stats;var l=r?r.duration:t.duration;if(o.aborted){D["logger"].warn("frag loader destroy or aborted, disarm abandonRules");this.clearTimer();this._nextAutoLevel=-1;return}if(!n||s.paused||!s.playbackRate||!s.readyState){return}var u=performance.now()-o.loading.start;var c=Math.abs(s.playbackRate);if(u<=500*l/c){return}var d=i.levels,f=i.minAutoLevel;var h=d[t.level];var v=o.total||Math.max(o.loaded,Math.round(l*h.maxBitrate/8));var g=Math.max(1,o.bwEstimate?o.bwEstimate/8:o.loaded*1e3/u);var p=(v-o.loaded)/g;var m=s.currentTime;var y=(L["BufferHelper"].bufferInfo(s,m,a.maxBufferHole).end-m)/c;if(y>=2*l/c||p<=y){return}var b=Number.POSITIVE_INFINITY;var T;for(T=t.level-1;T>f;T--){var E=d[T].maxBitrate;b=l*E/(8*.8*g);if(b<y){break}}if(b>=p){return}var S=this.bwEstimator.getEstimate();D["logger"].warn("Fragment "+t.sn+(r?" part "+r.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+T+"\n      Current BW estimate: "+(Object(k["isFiniteNumber"])(S)?(S/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+p.toFixed(3)+" s\n      Estimated load time for the next fragment: "+b.toFixed(3)+" s\n      Time to underbuffer: "+y.toFixed(3)+" s");i.nextLoadLevel=T;this.bwEstimator.sample(u,o.loaded);this.clearTimer();if(t.loader){this.fragCurrent=this.partCurrent=null;t.loader.abort()}i.trigger(A["Events"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:o})};t.onFragLoaded=function e(t,r){var i=r.frag,n=r.part;if(i.type===d["PlaylistLevelType"].MAIN&&Object(k["isFiniteNumber"])(i.sn)){var a=n?n.stats:i.stats;var s=n?n.duration:i.duration;this.clearTimer();this.lastLoadedFragLevel=i.level;this._nextAutoLevel=-1;if(this.hls.config.abrMaxWithRealBitrate){var o=this.hls.levels[i.level];var l=(o.loaded?o.loaded.bytes:0)+a.loaded;var u=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:l,duration:u};o.realBitrate=Math.round(8*l/u)}if(i.bitrateTest){var c={stats:a,frag:i,part:n,id:i.type};this.onFragBuffered(A["Events"].FRAG_BUFFERED,c);i.bitrateTest=false}}};t.onFragBuffered=function e(t,r){var i=r.frag,n=r.part;var a=n?n.stats:i.stats;if(a.aborted){return}if(i.type!==d["PlaylistLevelType"].MAIN||i.sn==="initSegment"){return}var s=a.parsing.end-a.loading.start;this.bwEstimator.sample(s,a.loaded);a.bwEstimate=this.bwEstimator.getEstimate();if(i.bitrateTest){this.bitrateTestDelay=s/1e3}else{this.bitrateTestDelay=0}};t.onError=function e(t,r){switch(r.details){case n["ErrorDetails"].FRAG_LOAD_ERROR:case n["ErrorDetails"].FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}};t.clearTimer=function e(){self.clearInterval(this.timer);this.timer=undefined};t.getNextABRAutoLevel=function e(){var t=this.fragCurrent,r=this.partCurrent,i=this.hls;var n=i.maxAutoLevel,a=i.config,s=i.minAutoLevel,o=i.media;var l=r?r.duration:t?t.duration:0;var u=o?o.currentTime:0;var c=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1;var d=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate;var f=(L["BufferHelper"].bufferInfo(o,u,a.maxBufferHole).end-u)/c;var h=this.findBestLevel(d,s,n,f,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(h>=0){return h}D["logger"].trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=l?Math.min(l,a.maxStarvationDelay):a.maxStarvationDelay;var g=a.abrBandWidthFactor;var p=a.abrBandWidthUpFactor;if(!f){var m=this.bitrateTestDelay;if(m){var y=l?Math.min(l,a.maxLoadingDelay):a.maxLoadingDelay;v=y-m;D["logger"].trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms");g=p=1}}h=this.findBestLevel(d,s,n,f+v,g,p);return Math.max(h,0)};t.findBestLevel=function e(t,r,i,n,a,s){var o;var l=this.fragCurrent,u=this.partCurrent,c=this.lastLoadedFragLevel;var d=this.hls.levels;var f=d[c];var h=!!(f!==null&&f!==void 0&&(o=f.details)!==null&&o!==void 0&&o.live);var v=f===null||f===void 0?void 0:f.codecSet;var g=u?u.duration:l?l.duration:0;for(var p=i;p>=r;p--){var m=d[p];if(!m||v&&m.codecSet!==v){continue}var y=m.details;var b=(u?y===null||y===void 0?void 0:y.partTarget:y===null||y===void 0?void 0:y.averagetargetduration)||g;var T=void 0;if(p<=c){T=a*t}else{T=s*t}var E=d[p].maxBitrate;var S=E*b/T;D["logger"].trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+p+"/"+Math.round(T)+"/"+E+"/"+b+"/"+n+"/"+S);if(T>E&&(!S||h&&!this.bitrateTestDelay||S<n)){return p}}return-1};s(e,[{key:"nextAutoLevel",get:function e(){var t=this._nextAutoLevel;var r=this.bwEstimator;if(t!==-1&&(!r||!r.canEstimate())){return t}var i=this.getNextABRAutoLevel();if(t!==-1){i=Math.min(t,i)}return i},set:function e(t){this._nextAutoLevel=t}}]);return e}();t["default"]=o},"./src/controller/audio-stream-controller.ts":function(e,t,r){"use strict";r.r(t);var a=r("./src/polyfills/number.ts");var E=r("./src/controller/base-stream-controller.ts");var S=r("./src/events.ts");var b=r("./src/utils/buffer-helper.ts");var s=r("./src/controller/fragment-tracker.ts");var n=r("./src/types/level.ts");var k=r("./src/types/loader.ts");var A=r("./src/loader/fragment.ts");var L=r("./src/demux/chunk-cache.ts");var D=r("./src/demux/transmuxer-interface.ts");var w=r("./src/types/transmuxer.ts");var T=r("./src/controller/fragment-finders.ts");var c=r("./src/utils/discontinuities.ts");var o=r("./src/errors.ts");function C(){C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return C.apply(this,arguments)}function i(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;l(e,t)}function l(e,t){l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return l(e,t)}var u=100;var d=function(y){i(e,y);function e(e,t){var r;r=y.call(this,e,t,"[audio-stream-controller]")||this;r.videoBuffer=null;r.videoTrackCC=-1;r.waitingVideoCC=-1;r.audioSwitch=false;r.trackId=-1;r.waitingData=null;r.mainDetails=null;r.bufferFlushed=false;r.cachedTrackLoadedData=null;r._registerListeners();return r}var t=e.prototype;t.onHandlerDestroying=function e(){this._unregisterListeners();this.mainDetails=null};t._registerListeners=function e(){var t=this.hls;t.on(S["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.on(S["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.on(S["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.on(S["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.on(S["Events"].AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this);t.on(S["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);t.on(S["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);t.on(S["Events"].ERROR,this.onError,this);t.on(S["Events"].BUFFER_RESET,this.onBufferReset,this);t.on(S["Events"].BUFFER_CREATED,this.onBufferCreated,this);t.on(S["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);t.on(S["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);t.on(S["Events"].FRAG_BUFFERED,this.onFragBuffered,this)};t._unregisterListeners=function e(){var t=this.hls;t.off(S["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.off(S["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.off(S["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(S["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.off(S["Events"].AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this);t.off(S["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);t.off(S["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);t.off(S["Events"].ERROR,this.onError,this);t.off(S["Events"].BUFFER_RESET,this.onBufferReset,this);t.off(S["Events"].BUFFER_CREATED,this.onBufferCreated,this);t.off(S["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);t.off(S["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);t.off(S["Events"].FRAG_BUFFERED,this.onFragBuffered,this)};t.onInitPtsFound=function e(t,r){var i=r.frag,n=r.id,a=r.initPTS;if(n==="main"){var s=i.cc;this.initPTS[i.cc]=a;this.log("InitPTS for cc: "+s+" found from main: "+a);this.videoTrackCC=s;if(this.state===E["State"].WAITING_INIT_PTS){this.tick()}}};t.startLoad=function e(t){if(!this.levels){this.startPosition=t;this.state=E["State"].STOPPED;return}var r=this.lastCurrentTime;this.stopLoad();this.setInterval(u);this.fragLoadError=0;if(r>0&&t===-1){this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3));t=r;this.state=E["State"].IDLE}else{this.loadedmetadata=false;this.state=E["State"].WAITING_TRACK}this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t;this.tick()};t.doTick=function e(){switch(this.state){case E["State"].IDLE:this.doTickIdle();break;case E["State"].WAITING_TRACK:{var t;var r=this.levels,i=this.trackId;var n=r===null||r===void 0?void 0:(t=r[i])===null||t===void 0?void 0:t.details;if(n){if(this.waitForCdnTuneIn(n)){break}this.state=E["State"].WAITING_INIT_PTS}break}case E["State"].FRAG_LOADING_WAITING_RETRY:{var a;var s=performance.now();var o=this.retryDate;if(!o||s>=o||(a=this.media)!==null&&a!==void 0&&a.seeking){this.log("RetryDate reached, switch back to IDLE state");this.state=E["State"].IDLE}break}case E["State"].WAITING_INIT_PTS:{var l=this.waitingData;if(l){var u=l.frag,c=l.part,d=l.cache,f=l.complete;if(this.initPTS[u.cc]!==undefined){this.waitingData=null;this.waitingVideoCC=-1;this.state=E["State"].FRAG_LOADING;var h=d.flush();var v={frag:u,part:c,payload:h,networkDetails:null};this._handleFragmentLoadProgress(v);if(f){y.prototype._handleFragmentLoadComplete.call(this,v)}}else if(this.videoTrackCC!==this.waitingVideoCC){this.log("Waiting fragment cc ("+u.cc+") cancelled because video is at cc "+this.videoTrackCC);this.clearWaitingFragment()}else{var g=this.getLoadPosition();var p=b["BufferHelper"].bufferInfo(this.mediaBuffer,g,this.config.maxBufferHole);var m=Object(T["fragmentWithinToleranceTest"])(p.end,this.config.maxFragLookUpTolerance,u);if(m<0){this.log("Waiting fragment cc ("+u.cc+") @ "+u.start+" cancelled because another fragment at "+p.end+" is needed");this.clearWaitingFragment()}}}else{this.state=E["State"].IDLE}}}this.onTickEnd()};t.clearWaitingFragment=function e(){var t=this.waitingData;if(t){this.fragmentTracker.removeFragment(t.frag);this.waitingData=null;this.waitingVideoCC=-1;this.state=E["State"].IDLE}};t.resetLoadingState=function e(){this.clearWaitingFragment();y.prototype.resetLoadingState.call(this)};t.onTickEnd=function e(){var t=this.media;if(!t||!t.readyState){return}var r=this.mediaBuffer?this.mediaBuffer:t;var i=r.buffered;if(!this.loadedmetadata&&i.length){this.loadedmetadata=true}this.lastCurrentTime=t.currentTime};t.doTickIdle=function e(){var t,r;var i=this.hls,n=this.levels,a=this.media,s=this.trackId;var o=i.config;if(!n||!n[s]){return}if(!a&&(this.startFragRequested||!o.startFragPrefetch)){return}var l=n[s];var u=l.details;if(!u||u.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(u)){this.state=E["State"].WAITING_TRACK;return}if(this.bufferFlushed){this.bufferFlushed=false;this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,A["ElementaryStreamTypes"].AUDIO,k["PlaylistLevelType"].AUDIO)}var c=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,k["PlaylistLevelType"].AUDIO);if(c===null){return}var d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,k["PlaylistLevelType"].MAIN);var f=c.len;var h=this.getMaxBufferLength(d===null||d===void 0?void 0:d.len);var v=this.audioSwitch;if(f>=h&&!v){return}if(!v&&this._streamEnded(c,u)){i.trigger(S["Events"].BUFFER_EOS,{type:"audio"});this.state=E["State"].ENDED;return}var g=u.fragments;var p=g[0].start;var m=c.end;if(v){var y=this.getLoadPosition();m=y;if(u.PTSKnown&&y<p){if(c.end>p||c.nextStart){this.log("Alt audio track ahead of main track, seek to start of alt audio track");a.currentTime=p+.05}}}if(d&&m>d.end+u.targetduration){return}if((!d||!d.len)&&c.len){return}var b=this.getNextFragment(m,u);if(!b){this.bufferFlushed=true;return}if(((t=b.decryptdata)===null||t===void 0?void 0:t.keyFormat)==="identity"&&!((r=b.decryptdata)!==null&&r!==void 0&&r.key)){this.loadKey(b,u)}else{this.loadFragment(b,u,m)}};t.getMaxBufferLength=function e(t){var r=y.prototype.getMaxBufferLength.call(this);if(!t){return r}return Math.max(r,t)};t.onMediaDetaching=function e(){this.videoBuffer=null;y.prototype.onMediaDetaching.call(this)};t.onAudioTracksUpdated=function e(t,r){var i=r.audioTracks;this.resetTransmuxer();this.levels=i.map(function(e){return new n["Level"](e)})};t.onAudioTrackSwitching=function e(t,r){var i=!!r.url;this.trackId=r.id;var n=this.fragCurrent;if(n!==null&&n!==void 0&&n.loader){n.loader.abort()}this.fragCurrent=null;this.clearWaitingFragment();if(!i){this.resetTransmuxer()}else{this.setInterval(u)}if(i){this.audioSwitch=true;this.state=E["State"].IDLE}else{this.state=E["State"].STOPPED}this.tick()};t.onManifestLoading=function e(){this.mainDetails=null;this.fragmentTracker.removeAllFragments();this.startPosition=this.lastCurrentTime=0;this.bufferFlushed=false};t.onLevelLoaded=function e(t,r){this.mainDetails=r.details;if(this.cachedTrackLoadedData!==null){this.hls.trigger(S["Events"].AUDIO_TRACK_LOADED,this.cachedTrackLoadedData);this.cachedTrackLoadedData=null}};t.onAudioTrackLoaded=function e(t,r){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=r;return}var n=this.levels;var a=r.details,s=r.id;if(!n){this.warn("Audio tracks were reset while loading level "+s);return}this.log("Track "+s+" loaded ["+a.startSN+","+a.endSN+"],duration:"+a.totalduration);var o=n[s];var l=0;if(a.live||(i=o.details)!==null&&i!==void 0&&i.live){var u=this.mainDetails;if(!a.fragments[0]){a.deltaUpdateFailed=true}if(a.deltaUpdateFailed||!u){return}if(!o.details&&a.hasProgramDateTime&&u.hasProgramDateTime){Object(c["alignMediaPlaylistByPDT"])(a,u);l=a.fragments[0].start}else{l=this.alignPlaylists(a,o.details)}}o.details=a;this.levelLastLoaded=s;if(!this.startFragRequested&&(this.mainDetails||!a.live)){this.setStartPosition(o.details,l)}if(this.state===E["State"].WAITING_TRACK&&!this.waitForCdnTuneIn(a)){this.state=E["State"].IDLE}this.tick()};t._handleFragmentLoadProgress=function e(t){var r;var i=t.frag,n=t.part,a=t.payload;var s=this.config,o=this.trackId,l=this.levels;if(!l){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var u=l[o];console.assert(u,"Audio track is defined on fragment load progress");var c=u.details;console.assert(c,"Audio track details are defined on fragment load progress");var d=s.defaultAudioCodec||u.audioCodec||"mp4a.40.2";var f=this.transmuxer;if(!f){f=this.transmuxer=new D["default"](this.hls,k["PlaylistLevelType"].AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))}var h=this.initPTS[i.cc];var v=(r=i.initSegment)===null||r===void 0?void 0:r.data;if(h!==undefined){var g=false;var p=n?n.index:-1;var m=p!==-1;var y=new w["ChunkMetadata"](i.level,i.sn,i.stats.chunkCount,a.byteLength,p,m);f.push(a,v,d,"",i,n,c.totalduration,g,y,h)}else{this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+o);var b=this.waitingData=this.waitingData||{frag:i,part:n,cache:new L["default"],complete:false},T=b.cache;T.push(new Uint8Array(a));this.waitingVideoCC=this.videoTrackCC;this.state=E["State"].WAITING_INIT_PTS}};t._handleFragmentLoadComplete=function e(t){if(this.waitingData){this.waitingData.complete=true;return}y.prototype._handleFragmentLoadComplete.call(this,t)};t.onBufferReset=function e(){this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=false};t.onBufferCreated=function e(t,r){var i=r.tracks.audio;if(i){this.mediaBuffer=i.buffer}if(r.tracks.video){this.videoBuffer=r.tracks.video.buffer}};t.onFragBuffered=function e(t,r){var i=r.frag,n=r.part;if(i.type!==k["PlaylistLevelType"].AUDIO){return}if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}if(i.sn!=="initSegment"){this.fragPrevious=i;if(this.audioSwitch){this.audioSwitch=false;this.hls.trigger(S["Events"].AUDIO_TRACK_SWITCHED,{id:this.trackId})}}this.fragBufferedComplete(i,n)};t.onError=function e(t,r){switch(r.details){case o["ErrorDetails"].FRAG_LOAD_ERROR:case o["ErrorDetails"].FRAG_LOAD_TIMEOUT:case o["ErrorDetails"].KEY_LOAD_ERROR:case o["ErrorDetails"].KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(k["PlaylistLevelType"].AUDIO,r);break;case o["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR:case o["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT:if(this.state!==E["State"].ERROR&&this.state!==E["State"].STOPPED){this.state=r.fatal?E["State"].ERROR:E["State"].IDLE;this.warn(r.details+" while loading frag, switching to "+this.state+" state")}break;case o["ErrorDetails"].BUFFER_FULL_ERROR:if(r.parent==="audio"&&(this.state===E["State"].PARSING||this.state===E["State"].PARSED)){var i=true;var n=this.getFwdBufferInfo(this.mediaBuffer,k["PlaylistLevelType"].AUDIO);if(n&&n.len>.5){i=!this.reduceMaxBufferLength(n.len)}if(i){this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer");this.fragCurrent=null;y.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")}this.resetLoadingState()}break;default:break}};t.onBufferFlushed=function e(t,r){var i=r.type;if(i===A["ElementaryStreamTypes"].AUDIO){this.bufferFlushed=true}};t._handleTransmuxComplete=function e(t){var r;var i="audio";var n=this.hls;var a=t.remuxResult,s=t.chunkMeta;var o=this.getCurrentContext(s);if(!o){this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered.");this.resetLiveStartWhenNotLoaded(s.level);return}var l=o.frag,u=o.part,c=o.level.details;var d=a.audio,f=a.text,h=a.id3,v=a.initSegment;if(this.fragContextChanged(l)||!c){return}this.state=E["State"].PARSING;if(this.audioSwitch&&d){this.completeAudioSwitch()}if(v!==null&&v!==void 0&&v.tracks){this._bufferInitSegment(v.tracks,l,s);n.trigger(S["Events"].FRAG_PARSING_INIT_SEGMENT,{frag:l,id:i,tracks:v.tracks})}if(d){var g=d.startPTS,p=d.endPTS,m=d.startDTS,y=d.endDTS;if(u){u.elementaryStreams[A["ElementaryStreamTypes"].AUDIO]={startPTS:g,endPTS:p,startDTS:m,endDTS:y}}l.setElementaryStreamInfo(A["ElementaryStreamTypes"].AUDIO,g,p,m,y);this.bufferFragmentData(d,l,u,s)}if(h!==null&&h!==void 0&&(r=h.samples)!==null&&r!==void 0&&r.length){var b=C({id:i,frag:l,details:c},h);n.trigger(S["Events"].FRAG_PARSING_METADATA,b)}if(f){var T=C({id:i,frag:l,details:c},f);n.trigger(S["Events"].FRAG_PARSING_USERDATA,T)}};t._bufferInitSegment=function e(t,r,i){if(this.state!==E["State"].PARSING){return}if(t.video){delete t.video}var n=t.audio;if(!n){return}n.levelCodec=n.codec;n.id="audio";this.log("Init audio buffer, container:"+n.container+", codecs[parsed]=["+n.codec+"]");this.hls.trigger(S["Events"].BUFFER_CODECS,t);var a=n.initSegment;if(a!==null&&a!==void 0&&a.byteLength){var s={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:a};this.hls.trigger(S["Events"].BUFFER_APPENDING,s)}this.tick()};t.loadFragment=function e(t,r,i){var n=this.fragmentTracker.getState(t);this.fragCurrent=t;if(this.audioSwitch||n===s["FragmentState"].NOT_LOADED||n===s["FragmentState"].PARTIAL){if(t.sn==="initSegment"){this._loadInitSegment(t)}else if(r.live&&!Object(a["isFiniteNumber"])(this.initPTS[t.cc])){this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId);this.state=E["State"].WAITING_INIT_PTS}else{this.startFragRequested=true;y.prototype.loadFragment.call(this,t,r,i)}}};t.completeAudioSwitch=function e(){var t=this.hls,r=this.media,i=this.trackId;if(r){this.log("Switching audio track : flushing all audio");y.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")}this.audioSwitch=false;t.trigger(S["Events"].AUDIO_TRACK_SWITCHED,{id:i})};return e}(E["default"]);t["default"]=d},"./src/controller/audio-track-controller.ts":function(e,t,r){"use strict";r.r(t);var f=r("./src/events.ts");var n=r("./src/errors.ts");var i=r("./src/controller/base-playlist-controller.ts");var a=r("./src/types/loader.ts");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function o(e,t,r){if(t)s(e.prototype,t);if(r)s(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function l(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;u(e,t)}function u(e,t){u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return u(e,t)}var c=function(i){l(e,i);function e(e){var t;t=i.call(this,e,"[audio-track-controller]")||this;t.tracks=[];t.groupId=null;t.tracksInGroup=[];t.trackId=-1;t.trackName="";t.selectDefaultTrack=true;t.registerListeners();return t}var t=e.prototype;t.registerListeners=function e(){var t=this.hls;t.on(f["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.on(f["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.on(f["Events"].LEVEL_LOADING,this.onLevelLoading,this);t.on(f["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);t.on(f["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);t.on(f["Events"].ERROR,this.onError,this)};t.unregisterListeners=function e(){var t=this.hls;t.off(f["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(f["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.off(f["Events"].LEVEL_LOADING,this.onLevelLoading,this);t.off(f["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);t.off(f["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);t.off(f["Events"].ERROR,this.onError,this)};t.destroy=function e(){this.unregisterListeners();this.tracks.length=0;this.tracksInGroup.length=0;i.prototype.destroy.call(this)};t.onManifestLoading=function e(){this.tracks=[];this.groupId=null;this.tracksInGroup=[];this.trackId=-1;this.trackName="";this.selectDefaultTrack=true};t.onManifestParsed=function e(t,r){this.tracks=r.audioTracks||[]};t.onAudioTrackLoaded=function e(t,r){var i=r.id,n=r.details;var a=this.tracksInGroup[i];if(!a){this.warn("Invalid audio track id "+i);return}var s=a.details;a.details=r.details;this.log("audioTrack "+i+" loaded ["+n.startSN+"-"+n.endSN+"]");if(i===this.trackId){this.retryCount=0;this.playlistLoaded(i,r,s)}};t.onLevelLoading=function e(t,r){this.switchLevel(r.level)};t.onLevelSwitching=function e(t,r){this.switchLevel(r.level)};t.switchLevel=function e(t){var r=this.hls.levels[t];if(!(r!==null&&r!==void 0&&r.audioGroupIds)){return}var i=r.audioGroupIds[r.urlId];if(this.groupId!==i){this.groupId=i;var n=this.tracks.filter(function(e){return!i||e.groupId===i});if(this.selectDefaultTrack&&!n.some(function(e){return e.default})){this.selectDefaultTrack=false}this.tracksInGroup=n;var a={audioTracks:n};this.log("Updating audio tracks, "+n.length+' track(s) found in "'+i+'" group-id');this.hls.trigger(f["Events"].AUDIO_TRACKS_UPDATED,a);this.selectInitialTrack()}};t.onError=function e(t,r){i.prototype.onError.call(this,t,r);if(r.fatal||!r.context){return}if(r.context.type===a["PlaylistContextType"].AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId){this.retryLoadingOrFail(r)}};t.setAudioTrack=function e(t){var r=this.tracksInGroup;if(t<0||t>=r.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var i=r[this.trackId];this.log("Now switching to audio-track index "+t);var n=r[t];var a=n.id,s=n.groupId,o=s===void 0?"":s,l=n.name,u=n.type,c=n.url;this.trackId=t;this.trackName=l;this.selectDefaultTrack=false;this.hls.trigger(f["Events"].AUDIO_TRACK_SWITCHING,{id:a,groupId:o,name:l,type:u,url:c});if(n.details&&!n.details.live){return}var d=this.switchParams(n.url,i===null||i===void 0?void 0:i.details);this.loadPlaylist(d)};t.selectInitialTrack=function e(){var t=this.tracksInGroup;console.assert(t.length,"Initial audio track should be selected when tracks are known");var r=this.trackName;var i=this.findTrackId(r)||this.findTrackId();if(i!==-1){this.setAudioTrack(i)}else{this.warn("No track found for running audio group-ID: "+this.groupId);this.hls.trigger(f["Events"].ERROR,{type:n["ErrorTypes"].MEDIA_ERROR,details:n["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR,fatal:true})}};t.findTrackId=function e(t){var r=this.tracksInGroup;for(var i=0;i<r.length;i++){var n=r[i];if(!this.selectDefaultTrack||n.default){if(!t||t===n.name){return n.id}}}return-1};t.loadPlaylist=function e(t){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var i=r.id;var n=r.groupId;var a=r.url;if(t){try{a=t.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}}this.log("loading audio-track playlist for id: "+i);this.clearTimer();this.hls.trigger(f["Events"].AUDIO_TRACK_LOADING,{url:a,id:i,groupId:n,deliveryDirectives:t||null})}};o(e,[{key:"audioTracks",get:function e(){return this.tracksInGroup}},{key:"audioTrack",get:function e(){return this.trackId},set:function e(t){this.selectDefaultTrack=false;this.setAudioTrack(t)}}]);return e}(i["default"]);t["default"]=c},"./src/controller/base-playlist-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return a});var c=r("./src/polyfills/number.ts");var d=r("./src/types/level.ts");var A=r("./src/controller/level-helper.ts");var i=r("./src/utils/logger.ts");var n=r("./src/errors.ts");var a=function(){function e(e,t){this.hls=void 0;this.timer=-1;this.canLoad=false;this.retryCount=0;this.log=void 0;this.warn=void 0;this.log=i["logger"].log.bind(i["logger"],t+":");this.warn=i["logger"].warn.bind(i["logger"],t+":");this.hls=e}var t=e.prototype;t.destroy=function e(){this.clearTimer();this.hls=this.log=this.warn=null};t.onError=function e(t,r){if(r.fatal&&r.type===n["ErrorTypes"].NETWORK_ERROR){this.clearTimer()}};t.clearTimer=function e(){clearTimeout(this.timer);this.timer=-1};t.startLoad=function e(){this.canLoad=true;this.retryCount=0;this.loadPlaylist()};t.stopLoad=function e(){this.canLoad=false;this.clearTimer()};t.switchParams=function e(t,r){var i=r===null||r===void 0?void 0:r.renditionReports;if(i){for(var n=0;n<i.length;n++){var a=i[n];var s=""+a.URI;if(s===t.slice(-s.length)){var o=parseInt(a["LAST-MSN"]);var l=parseInt(a["LAST-PART"]);if(r&&this.hls.config.lowLatencyMode){var u=Math.min(r.age-r.partTarget,r.targetduration);if(l!==undefined&&u>r.partTarget){l+=1}}if(Object(c["isFiniteNumber"])(o)){return new d["HlsUrlParameters"](o,Object(c["isFiniteNumber"])(l)?l:undefined,d["HlsSkip"].No)}}}}};t.loadPlaylist=function e(t){};t.shouldLoadTrack=function e(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)};t.playlistLoaded=function e(t,r,i){var n=this;var a=r.details,s=r.stats;var o=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;a.advancedDateTime=Date.now()-o;if(a.live||i!==null&&i!==void 0&&i.live){a.reloaded(i);if(i){this.log("live playlist "+t+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED"))}if(i&&a.fragments.length>0){Object(A["mergeDetails"])(i,a)}if(!this.canLoad||!a.live){return}var l;var u=undefined;var c=undefined;if(a.canBlockReload&&a.endSN&&a.advanced){var d=this.hls.config.lowLatencyMode;var f=a.lastPartSn;var h=a.endSN;var v=a.lastPartIndex;var g=v!==-1;var p=f===h;var m=d?0:v;if(g){u=p?h+1:f;c=p?m:v+1}else{u=h+1}var y=a.age;var b=y+a.ageHeader;var T=Math.min(b-a.partTarget,a.targetduration*1.5);if(T>0){if(i&&T>i.tuneInGoal){this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+T+" with playlist age: "+a.age);T=0}else{var E=Math.floor(T/a.targetduration);u+=E;if(c!==undefined){var S=Math.round(T%a.targetduration/a.partTarget);c+=S}this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+y.toFixed(2)+"s goal: "+T+" skip sn "+E+" to part "+c)}a.tuneInGoal=T}l=this.getDeliveryDirectives(a,r.deliveryDirectives,u,c);if(d||!p){this.loadPlaylist(l);return}}else{l=this.getDeliveryDirectives(a,r.deliveryDirectives,u,c)}var k=Object(A["computeReloadInterval"])(a,s);if(u!==undefined&&a.canBlockReload){k-=a.partTarget||1}this.log("reload live playlist "+t+" in "+Math.round(k)+" ms");this.timer=self.setTimeout(function(){return n.loadPlaylist(l)},k)}else{this.clearTimer()}};t.getDeliveryDirectives=function e(t,r,i,n){var a=Object(d["getSkipValue"])(t,i);if(r!==null&&r!==void 0&&r.skip&&t.deltaUpdateFailed){i=r.msn;n=r.part;a=d["HlsSkip"].No}return new d["HlsUrlParameters"](i,n,a)};t.retryLoadingOrFail=function e(t){var r=this;var i=this.hls.config;var n=this.retryCount<i.levelLoadingMaxRetry;if(n){var a;this.retryCount++;if(t.details.indexOf("LoadTimeOut")>-1&&(a=t.context)!==null&&a!==void 0&&a.deliveryDirectives){this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"');this.loadPlaylist()}else{var s=Math.min(Math.pow(2,this.retryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return r.loadPlaylist()},s);this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+t.details+'"')}}else{this.warn('cannot recover from error "'+t.details+'"');this.clearTimer();t.fatal=true}return n};return e}()},"./src/controller/base-stream-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"State",function(){return A});r.d(t,"default",function(){return L});var f=r("./src/polyfills/number.ts");var i=r("./src/task-loop.ts");var p=r("./src/controller/fragment-tracker.ts");var h=r("./src/utils/buffer-helper.ts");var o=r("./src/utils/logger.ts");var v=r("./src/events.ts");var a=r("./src/errors.ts");var l=r("./src/types/transmuxer.ts");var u=r("./src/utils/mp4-tools.ts");var g=r("./src/utils/discontinuities.ts");var m=r("./src/controller/fragment-finders.ts");var c=r("./src/controller/level-helper.ts");var s=r("./src/loader/fragment-loader.ts");var d=r("./src/crypt/decrypter.ts");var y=r("./src/utils/time-ranges.ts");var b=r("./src/types/loader.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function T(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function E(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function S(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;k(e,t)}function k(e,t){k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return k(e,t)}var A={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var L=function(n){S(e,n);function e(e,t,r){var i;i=n.call(this)||this;i.hls=void 0;i.fragPrevious=null;i.fragCurrent=null;i.fragmentTracker=void 0;i.transmuxer=null;i._state=A.STOPPED;i.media=void 0;i.mediaBuffer=void 0;i.config=void 0;i.bitrateTest=false;i.lastCurrentTime=0;i.nextLoadPosition=0;i.startPosition=0;i.loadedmetadata=false;i.fragLoadError=0;i.retryDate=0;i.levels=null;i.fragmentLoader=void 0;i.levelLastLoaded=null;i.startFragRequested=false;i.decrypter=void 0;i.initPTS=[];i.onvseeking=null;i.onvended=null;i.logPrefix="";i.log=void 0;i.warn=void 0;i.logPrefix=r;i.log=o["logger"].log.bind(o["logger"],r+":");i.warn=o["logger"].warn.bind(o["logger"],r+":");i.hls=e;i.fragmentLoader=new s["default"](e.config);i.fragmentTracker=t;i.config=e.config;i.decrypter=new d["default"](e,e.config);e.on(v["Events"].KEY_LOADED,i.onKeyLoaded,E(i));return i}var t=e.prototype;t.doTick=function e(){this.onTickEnd()};t.onTickEnd=function e(){};t.startLoad=function e(t){};t.stopLoad=function e(){this.fragmentLoader.abort();var t=this.fragCurrent;if(t){this.fragmentTracker.removeFragment(t)}this.resetTransmuxer();this.fragCurrent=null;this.fragPrevious=null;this.clearInterval();this.clearNextTick();this.state=A.STOPPED};t._streamEnded=function e(t,r){var i=this.fragCurrent,n=this.fragmentTracker;if(!r.live&&i&&i.sn>=r.endSN&&!t.nextStart){var a=r.partList;if(a!==null&&a!==void 0&&a.length){var s=a[a.length-1];var o=h["BufferHelper"].isBuffered(this.media,s.start+s.duration/2);return o}var l=n.getState(i);return l===p["FragmentState"].PARTIAL||l===p["FragmentState"].OK}return false};t.onMediaAttached=function e(t,r){var i=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);i.addEventListener("seeking",this.onvseeking);i.addEventListener("ended",this.onvended);var n=this.config;if(this.levels&&n.autoStartLoad&&this.state===A.STOPPED){this.startLoad(n.startPosition)}};t.onMediaDetaching=function e(){var t=this.media;if(t!==null&&t!==void 0&&t.ended){this.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}if(t){t.removeEventListener("seeking",this.onvseeking);t.removeEventListener("ended",this.onvended);this.onvseeking=this.onvended=null}this.media=this.mediaBuffer=null;this.loadedmetadata=false;this.fragmentTracker.removeAllFragments();this.stopLoad()};t.onMediaSeeking=function e(){var t=this.config,r=this.fragCurrent,i=this.media,n=this.mediaBuffer,a=this.state;var s=i?i.currentTime:0;var o=h["BufferHelper"].bufferInfo(n||i,s,t.maxBufferHole);this.log("media seeking to "+(Object(f["isFiniteNumber"])(s)?s.toFixed(3):s)+", state: "+a);if(a===A.ENDED){this.resetLoadingState()}else if(r&&!o.len){var l=t.maxFragLookUpTolerance;var u=r.start-l;var c=r.start+r.duration+l;var d=s>c;if(s<u||d){if(d&&r.loader){this.log("seeking outside of buffer while fragment load in progress, cancel fragment load");r.loader.abort()}this.resetLoadingState()}}if(i){this.lastCurrentTime=s}if(!this.loadedmetadata&&!o.len){this.nextLoadPosition=this.startPosition=s}this.tickImmediate()};t.onMediaEnded=function e(){this.startPosition=this.lastCurrentTime=0};t.onKeyLoaded=function e(t,r){if(this.state!==A.KEY_LOADING||r.frag!==this.fragCurrent||!this.levels){return}this.state=A.IDLE;var i=this.levels[r.frag.level].details;if(i){this.loadFragment(r.frag,i,r.frag.start)}};t.onHandlerDestroying=function e(){this.stopLoad();n.prototype.onHandlerDestroying.call(this)};t.onHandlerDestroyed=function e(){this.state=A.STOPPED;this.hls.off(v["Events"].KEY_LOADED,this.onKeyLoaded,this);if(this.fragmentLoader){this.fragmentLoader.destroy()}if(this.decrypter){this.decrypter.destroy()}this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null;n.prototype.onHandlerDestroyed.call(this)};t.loadKey=function e(t,r){this.log("Loading key for "+t.sn+" of ["+r.startSN+"-"+r.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level);this.state=A.KEY_LOADING;this.fragCurrent=t;this.hls.trigger(v["Events"].KEY_LOADING,{frag:t})};t.loadFragment=function e(t,r,i){this._loadFragForPlayback(t,r,i)};t._loadFragForPlayback=function e(r,t,i){var n=this;var a=function e(t){if(n.fragContextChanged(r)){n.warn("Fragment "+r.sn+(t.part?" p: "+t.part.index:"")+" of level "+r.level+" was dropped during download.");n.fragmentTracker.removeFragment(r);return}r.stats.chunkCount++;n._handleFragmentLoadProgress(t)};this._doFragLoad(r,t,i,a).then(function(e){if(!e){return}n.fragLoadError=0;var t=n.state;if(n.fragContextChanged(r)){if(t===A.FRAG_LOADING||!n.fragCurrent&&t===A.PARSING){n.fragmentTracker.removeFragment(r);n.state=A.IDLE}return}if("payload"in e){n.log("Loaded fragment "+r.sn+" of level "+r.level);n.hls.trigger(v["Events"].FRAG_LOADED,e)}n._handleFragmentLoadComplete(e)}).catch(function(e){if(n.state===A.STOPPED){return}n.warn(e);n.resetFragmentLoading(r)})};t.flushMainBuffer=function e(t,r,i){if(i===void 0){i=null}if(!(t-r)){return}var n={startOffset:t,endOffset:r,type:i};this.fragLoadError=0;this.hls.trigger(v["Events"].BUFFER_FLUSHING,n)};t._loadInitSegment=function e(s){var o=this;this._doFragLoad(s).then(function(e){if(!e||o.fragContextChanged(s)||!o.levels){throw new Error("init load aborted")}return e}).then(function(r){var i=o.hls;var e=r.payload;var t=s.decryptdata;if(e&&e.byteLength>0&&t&&t.key&&t.iv&&t.method==="AES-128"){var n=self.performance.now();return o.decrypter.webCryptoDecrypt(new Uint8Array(e),t.key.buffer,t.iv.buffer).then(function(e){var t=self.performance.now();i.trigger(v["Events"].FRAG_DECRYPTED,{frag:s,payload:e,stats:{tstart:n,tdecrypt:t}});r.payload=e;return r})}return r}).then(function(e){var t=o.fragCurrent,r=o.hls,i=o.levels;if(!i){throw new Error("init load aborted, missing levels")}var n=i[s.level].details;console.assert(n,"Level details are defined when init segment is loaded");var a=s.stats;o.state=A.IDLE;o.fragLoadError=0;s.data=new Uint8Array(e.payload);a.parsing.start=a.buffering.start=self.performance.now();a.parsing.end=a.buffering.end=self.performance.now();if(e.frag===t){r.trigger(v["Events"].FRAG_BUFFERED,{stats:a,frag:t,part:null,id:s.type})}o.tick()}).catch(function(e){o.warn(e);o.resetFragmentLoading(s)})};t.fragContextChanged=function e(t){var r=this.fragCurrent;return!t||!r||t.level!==r.level||t.sn!==r.sn||t.urlId!==r.urlId};t.fragBufferedComplete=function e(t,r){var i=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(r?" part: "+r.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level+" "+y["default"].toString(h["BufferHelper"].getBuffered(i)));this.state=A.IDLE;this.tick()};t._handleFragmentLoadComplete=function e(t){var r=this.transmuxer;if(!r){return}var i=t.frag,n=t.part,a=t.partsLoaded;var s=!a||a.length===0||a.some(function(e){return!e});var o=new l["ChunkMetadata"](i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!s);r.flush(o)};t._handleFragmentLoadProgress=function e(t){};t._doFragLoad=function e(t,r,i,n){var a=this;if(i===void 0){i=null}if(!this.levels){throw new Error("frag load aborted, missing levels")}i=Math.max(t.start,i||0);if(this.config.lowLatencyMode&&r){var s=r.partList;if(s&&n){if(i>t.end&&r.fragmentHint){t=r.fragmentHint}var o=this.getNextPart(s,t,i);if(o>-1){var l=s[o];this.log("Loading part sn: "+t.sn+" p: "+l.index+" cc: "+t.cc+" of playlist ["+r.startSN+"-"+r.endSN+"] parts [0-"+o+"-"+(s.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3)));this.nextLoadPosition=l.start+l.duration;this.state=A.FRAG_LOADING;this.hls.trigger(v["Events"].FRAG_LOADING,{frag:t,part:s[o],targetBufferTime:i});return this.doFragPartsLoad(t,s,o,n).catch(function(e){return a.handleFragLoadError(e)})}else if(!t.url||this.loadedEndOfParts(s,i)){return Promise.resolve(null)}}}this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(r?"of ["+r.startSN+"-"+r.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3)));if(Object(f["isFiniteNumber"])(t.sn)&&!this.bitrateTest){this.nextLoadPosition=t.start+t.duration}this.state=A.FRAG_LOADING;this.hls.trigger(v["Events"].FRAG_LOADING,{frag:t,targetBufferTime:i});return this.fragmentLoader.load(t,n).catch(function(e){return a.handleFragLoadError(e)})};t.doFragPartsLoad=function e(l,u,r,c){var d=this;return new Promise(function(s,e){var o=[];var t=function i(n){var a=u[n];d.fragmentLoader.loadPart(l,a,c).then(function(e){o[a.index]=e;var t=e.part;d.hls.trigger(v["Events"].FRAG_LOADED,e);var r=u[n+1];if(r&&r.fragment===l){i(n+1)}else{return s({frag:l,part:t,partsLoaded:o})}}).catch(e)};t(r)})};t.handleFragLoadError=function e(t){var r=t.data;if(r&&r.details===a["ErrorDetails"].INTERNAL_ABORTED){this.handleFragLoadAborted(r.frag,r.part)}else{this.hls.trigger(v["Events"].ERROR,r)}return null};t._handleTransmuxerFlush=function e(t){var r=this.getCurrentContext(t);if(!r||this.state!==A.PARSING){if(!this.fragCurrent){this.state=A.IDLE}return}var i=r.frag,n=r.part,a=r.level;var s=self.performance.now();i.stats.parsing.end=s;if(n){n.stats.parsing.end=s}this.updateLevelTiming(i,n,a,t.partial)};t.getCurrentContext=function e(t){var r=this.levels;var i=t.level,n=t.sn,a=t.part;if(!r||!r[i]){this.warn("Levels object was unset while buffering fragment "+n+" of level "+i+". The current chunk will not be buffered.");return null}var s=r[i];var o=a>-1?Object(c["getPartWith"])(s,n,a):null;var l=o?o.fragment:Object(c["getFragmentWithSN"])(s,n,this.fragCurrent);if(!l){return null}return{frag:l,part:o,level:s}};t.bufferFragmentData=function e(t,r,i,n){if(!t||this.state!==A.PARSING){return}var a=t.data1,s=t.data2;var o=a;if(a&&s){o=Object(u["appendUint8Array"])(a,s)}if(!o||!o.length){return}var l={type:t.type,frag:r,part:i,chunkMeta:n,parent:r.type,data:o};this.hls.trigger(v["Events"].BUFFER_APPENDING,l);if(t.dropped&&t.independent&&!i){this.flushBufferGap(r)}};t.flushBufferGap=function e(t){var r=this.media;if(!r){return}if(!h["BufferHelper"].isBuffered(r,r.currentTime)){this.flushMainBuffer(0,t.start);return}var i=r.currentTime;var n=h["BufferHelper"].bufferInfo(r,i,0);var a=t.duration;var s=Math.min(this.config.maxFragLookUpTolerance*2,a*.25);var o=Math.max(Math.min(t.start-s,n.end-s),i+s);if(t.start-o>s){this.flushMainBuffer(o,t.start)}};t.getFwdBufferInfo=function e(t,r){var i=this.config;var n=this.getLoadPosition();if(!Object(f["isFiniteNumber"])(n)){return null}var a=h["BufferHelper"].bufferInfo(t,n,i.maxBufferHole);if(a.len===0&&a.nextStart!==undefined){var s=this.fragmentTracker.getBufferedFrag(n,r);if(s&&a.nextStart<s.end){return h["BufferHelper"].bufferInfo(t,n,Math.max(a.nextStart,i.maxBufferHole))}}return a};t.getMaxBufferLength=function e(t){var r=this.config;var i;if(t){i=Math.max(8*r.maxBufferSize/t,r.maxBufferLength)}else{i=r.maxBufferLength}return Math.min(i,r.maxMaxBufferLength)};t.reduceMaxBufferLength=function e(t){var r=this.config;var i=t||r.maxBufferLength;if(r.maxMaxBufferLength>=i){r.maxMaxBufferLength/=2;this.warn("Reduce max buffer length to "+r.maxMaxBufferLength+"s");return true}return false};t.getNextFragment=function e(t,r){var i=r.fragments;var n=i.length;if(!n){return null}var a=this.config;var s=i[0].start;var o;if(r.live){var l=a.initialLiveManifestSize;if(n<l){this.warn("Not enough fragments to start playback (have: "+n+", need: "+l+")");return null}if(!r.PTSKnown&&!this.startFragRequested&&this.startPosition===-1){o=this.getInitialLiveFragment(r,i);this.startPosition=o?this.hls.liveSyncPosition||o.start:t}}else if(t<=s){o=i[0]}if(!o){var u=a.lowLatencyMode?r.partEnd:r.fragmentEnd;o=this.getFragmentAtPosition(t,u,r)}return this.mapToInitFragWhenRequired(o)};t.mapToInitFragWhenRequired=function e(t){if(t!==null&&t!==void 0&&t.initSegment&&!(t!==null&&t!==void 0&&t.initSegment.data)&&!this.bitrateTest){return t.initSegment}return t};t.getNextPart=function e(t,r,i){var n=-1;var a=false;var s=true;for(var o=0,l=t.length;o<l;o++){var u=t[o];s=s&&!u.independent;if(n>-1&&i<u.start){break}var c=u.loaded;if(!c&&(a||u.independent||s)&&u.fragment===r){n=o}a=c}return n};t.loadedEndOfParts=function e(t,r){var i=t[t.length-1];return i&&r>i.start&&i.loaded};t.getInitialLiveFragment=function e(t,r){var i=this.fragPrevious;var n=null;if(i){if(t.hasProgramDateTime){this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime);n=Object(m["findFragmentByPDT"])(r,i.endProgramDateTime,this.config.maxFragLookUpTolerance)}if(!n){var a=i.sn+1;if(a>=t.startSN&&a<=t.endSN){var s=r[a-t.startSN];if(i.cc===s.cc){n=s;this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn)}}if(!n){n=Object(m["findFragWithCC"])(r,i.cc);if(n){this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn)}}}}else{var o=this.hls.liveSyncPosition;if(o!==null){n=this.getFragmentAtPosition(o,this.bitrateTest?t.fragmentEnd:t.edge,t)}}return n};t.getFragmentAtPosition=function e(t,r,i){var n=this.config,a=this.fragPrevious;var s=i.fragments,o=i.endSN;var l=i.fragmentHint;var u=n.maxFragLookUpTolerance;var c=!!(n.lowLatencyMode&&i.partList&&l);if(c&&l&&!this.bitrateTest){s=s.concat(l);o=l.sn}var d;if(t<r){var f=t>r-u?0:u;d=Object(m["findFragmentByPTS"])(a,s,t,f)}else{d=s[s.length-1]}if(d){var h=d.sn-i.startSN;var v=a&&d.level===a.level;var g=s[h+1];if(a&&d.sn===a.sn&&!c){if(v){if(d.sn<o&&this.fragmentTracker.getState(g)!==p["FragmentState"].OK){this.log("SN "+d.sn+" just loaded, load next one: "+g.sn);d=g}else{d=null}}}}return d};t.synchronizeToLiveEdge=function e(t){var r=this.config,i=this.media;if(!i){return}var n=this.hls.liveSyncPosition;var a=i.currentTime;var s=t.fragments[0].start;var o=t.edge;var l=a>=s-r.maxFragLookUpTolerance&&a<=o;if(n!==null&&i.duration>n&&(a<n||!l)){var u=r.liveMaxLatencyDuration!==undefined?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*t.targetduration;if(!l&&i.readyState<4||a<o-u){if(!this.loadedmetadata){this.nextLoadPosition=n}if(i.readyState){this.warn("Playback: "+a.toFixed(3)+" is located too far from the end of live sliding playlist: "+o+", reset currentTime to : "+n.toFixed(3));i.currentTime=n}}}};t.alignPlaylists=function e(t,r){var i=this.levels,n=this.levelLastLoaded,a=this.fragPrevious;var s=n!==null?i[n]:null;var o=t.fragments.length;if(!o){this.warn("No fragments in live playlist");return 0}var l=t.fragments[0].start;var u=!r;var c=t.alignedSliding&&Object(f["isFiniteNumber"])(l);if(u||!c&&!l){Object(g["alignStream"])(a,s,t);var d=t.fragments[0].start;this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+t.startSN+" prev-sn: "+(a?a.sn:"na")+" fragments: "+o);return d}return l};t.waitForCdnTuneIn=function e(t){var r=3;return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*r)};t.setStartPosition=function e(t,r){var i=this.startPosition;if(i<r){i=-1}if(i===-1||this.lastCurrentTime===-1){var n=t.startTimeOffset;if(Object(f["isFiniteNumber"])(n)){i=r+n;if(n<0){i+=t.totalduration}i=Math.min(Math.max(r,i),r+t.totalduration);this.log("Start time offset "+n+" found in playlist, adjust startPosition to "+i);this.startPosition=i}else if(t.live){i=this.hls.liveSyncPosition||r}else{this.startPosition=i=0}this.lastCurrentTime=i}this.nextLoadPosition=i};t.getLoadPosition=function e(){var t=this.media;var r=0;if(this.loadedmetadata&&t){r=t.currentTime}else if(this.nextLoadPosition){r=this.nextLoadPosition}return r};t.handleFragLoadAborted=function e(t,r){if(this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted){this.warn("Fragment "+t.sn+(r?" part"+r.index:"")+" of level "+t.level+" was aborted");this.resetFragmentLoading(t)}};t.resetFragmentLoading=function e(t){if(!this.fragCurrent||!this.fragContextChanged(t)){this.state=A.IDLE}};t.onFragmentOrKeyLoadError=function e(t,r){if(r.fatal){return}var i=r.frag;if(!i||i.type!==t){return}var n=this.fragCurrent;console.assert(n&&i.sn===n.sn&&i.level===n.level&&i.urlId===n.urlId,"Frag load error must match current frag to retry");var a=this.config;if(this.fragLoadError+1<=a.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(i.level)){return}var s=Math.min(Math.pow(2,this.fragLoadError)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);this.warn("Fragment "+i.sn+" of "+t+" "+i.level+" failed to load, retrying in "+s+"ms");this.retryDate=self.performance.now()+s;this.fragLoadError++;this.state=A.FRAG_LOADING_WAITING_RETRY}else if(r.levelRetry){if(t===b["PlaylistLevelType"].AUDIO){this.fragCurrent=null}this.fragLoadError=0;this.state=A.IDLE}else{o["logger"].error(r.details+" reaches max retry, redispatch as fatal ...");r.fatal=true;this.hls.stopLoad();this.state=A.ERROR}};t.afterBufferFlushed=function e(t,r,i){if(!t){return}var n=h["BufferHelper"].getBuffered(t);this.fragmentTracker.detectEvictedFragments(r,n,i);if(this.state===A.ENDED){this.resetLoadingState()}};t.resetLoadingState=function e(){this.fragCurrent=null;this.fragPrevious=null;this.state=A.IDLE};t.resetLiveStartWhenNotLoaded=function e(t){if(!this.loadedmetadata){this.startFragRequested=false;var r=this.levels?this.levels[t].details:null;if(r!==null&&r!==void 0&&r.live){this.startPosition=-1;this.setStartPosition(r,0);this.resetLoadingState();return true}this.nextLoadPosition=this.startPosition}return false};t.updateLevelTiming=function e(a,t,s,o){var l=this;var u=s.details;console.assert(!!u,"level.details must be defined");var r=Object.keys(a.elementaryStreams).reduce(function(e,t){var r=a.elementaryStreams[t];if(r){var i=r.endPTS-r.startPTS;if(i<=0){l.warn("Could not parse fragment "+a.sn+" "+t+" duration reliably ("+i+")");return e||false}var n=o?0:Object(c["updateFragPTSDTS"])(u,a,r.startPTS,r.endPTS,r.startDTS,r.endDTS);l.hls.trigger(v["Events"].LEVEL_PTS_UPDATED,{details:u,level:s,drift:n,type:t,frag:a,start:r.startPTS,end:r.endPTS});return true}return e},false);if(!r){this.warn("Found no media in fragment "+a.sn+" of level "+s.id+" resetting transmuxer to fallback to playlist timing");this.resetTransmuxer()}this.state=A.PARSED;this.hls.trigger(v["Events"].FRAG_PARSED,{frag:a,part:t})};t.resetTransmuxer=function e(){if(this.transmuxer){this.transmuxer.destroy();this.transmuxer=null}};T(e,[{key:"state",get:function e(){return this._state},set:function e(t){var r=this._state;if(r!==t){this._state=t;this.log(r+"->"+t)}}}]);return e}(i["default"])},"./src/controller/buffer-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return s});var h=r("./src/polyfills/number.ts");var b=r("./src/events.ts");var T=r("./src/utils/logger.ts");var E=r("./src/errors.ts");var S=r("./src/utils/buffer-helper.ts");var i=r("./src/utils/mediasource-helper.ts");var u=r("./src/loader/fragment.ts");var n=r("./src/controller/buffer-operation-queue.ts");var a=Object(i["getMediaSource"])();var v=/([ha]vc.)(?:\.[^.,]+)+/;var s=function(){function e(e){var i=this;this.details=null;this._objectUrl=null;this.operationQueue=void 0;this.listeners=void 0;this.hls=void 0;this.bufferCodecEventsExpected=0;this._bufferCodecEventsTotal=0;this.media=null;this.mediaSource=null;this.appendError=0;this.tracks={};this.pendingTracks={};this.sourceBuffer=void 0;this._onMediaSourceOpen=function(){var e=i.hls,t=i.media,r=i.mediaSource;T["logger"].log("[buffer-controller]: Media source opened");if(t){i.updateMediaElementDuration();e.trigger(b["Events"].MEDIA_ATTACHED,{media:t})}if(r){r.removeEventListener("sourceopen",i._onMediaSourceOpen)}i.checkPendingTracks()};this._onMediaSourceClose=function(){T["logger"].log("[buffer-controller]: Media source closed")};this._onMediaSourceEnded=function(){T["logger"].log("[buffer-controller]: Media source ended")};this.hls=e;this._initSourceBuffer();this.registerListeners()}var t=e.prototype;t.hasSourceTypes=function e(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0};t.destroy=function e(){this.unregisterListeners();this.details=null};t.registerListeners=function e(){var t=this.hls;t.on(b["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);t.on(b["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.on(b["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.on(b["Events"].BUFFER_RESET,this.onBufferReset,this);t.on(b["Events"].BUFFER_APPENDING,this.onBufferAppending,this);t.on(b["Events"].BUFFER_CODECS,this.onBufferCodecs,this);t.on(b["Events"].BUFFER_EOS,this.onBufferEos,this);t.on(b["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);t.on(b["Events"].LEVEL_UPDATED,this.onLevelUpdated,this);t.on(b["Events"].FRAG_PARSED,this.onFragParsed,this);t.on(b["Events"].FRAG_CHANGED,this.onFragChanged,this)};t.unregisterListeners=function e(){var t=this.hls;t.off(b["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);t.off(b["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.off(b["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.off(b["Events"].BUFFER_RESET,this.onBufferReset,this);t.off(b["Events"].BUFFER_APPENDING,this.onBufferAppending,this);t.off(b["Events"].BUFFER_CODECS,this.onBufferCodecs,this);t.off(b["Events"].BUFFER_EOS,this.onBufferEos,this);t.off(b["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);t.off(b["Events"].LEVEL_UPDATED,this.onLevelUpdated,this);t.off(b["Events"].FRAG_PARSED,this.onFragParsed,this);t.off(b["Events"].FRAG_CHANGED,this.onFragChanged,this)};t._initSourceBuffer=function e(){this.sourceBuffer={};this.operationQueue=new n["default"](this.sourceBuffer);this.listeners={audio:[],video:[],audiovideo:[]}};t.onManifestParsed=function e(t,r){var i=2;if(r.audio&&!r.video||!r.altAudio){i=1}this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i;this.details=null;T["logger"].log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")};t.onMediaAttaching=function e(t,r){var i=this.media=r.media;if(i&&a){var n=this.mediaSource=new a;n.addEventListener("sourceopen",this._onMediaSourceOpen);n.addEventListener("sourceended",this._onMediaSourceEnded);n.addEventListener("sourceclose",this._onMediaSourceClose);i.src=self.URL.createObjectURL(n);this._objectUrl=i.src}};t.onMediaDetaching=function e(){var t=this.media,r=this.mediaSource,i=this._objectUrl;if(r){T["logger"].log("[buffer-controller]: media source detaching");if(r.readyState==="open"){try{r.endOfStream()}catch(e){T["logger"].warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}}this.onBufferReset();r.removeEventListener("sourceopen",this._onMediaSourceOpen);r.removeEventListener("sourceended",this._onMediaSourceEnded);r.removeEventListener("sourceclose",this._onMediaSourceClose);if(t){if(i){self.URL.revokeObjectURL(i)}if(t.src===i){t.removeAttribute("src");t.load()}else{T["logger"].warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")}}this.mediaSource=null;this.media=null;this._objectUrl=null;this.bufferCodecEventsExpected=this._bufferCodecEventsTotal;this.pendingTracks={};this.tracks={}}this.hls.trigger(b["Events"].MEDIA_DETACHED,undefined)};t.onBufferReset=function e(){var r=this;this.getSourceBufferTypes().forEach(function(t){var e=r.sourceBuffer[t];try{if(e){r.removeBufferListeners(t);if(r.mediaSource){r.mediaSource.removeSourceBuffer(e)}r.sourceBuffer[t]=undefined}}catch(e){T["logger"].warn("[buffer-controller]: Failed to reset the "+t+" buffer",e)}});this._initSourceBuffer()};t.onBufferCodecs=function e(t,d){var f=this;var h=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(e){if(h){var t=f.tracks[e];if(t&&typeof t.buffer.changeType==="function"){var r=d[e],i=r.id,n=r.codec,a=r.levelCodec,s=r.container,o=r.metadata;var l=(t.levelCodec||t.codec).replace(v,"$1");var u=(a||n).replace(v,"$1");if(l!==u){var c=s+";codecs="+(a||n);f.appendChangeType(e,c);T["logger"].log("[buffer-controller]: switching codec "+l+" to "+u);f.tracks[e]={buffer:t.buffer,codec:n,container:s,levelCodec:a,metadata:o,id:i}}}}else{f.pendingTracks[e]=d[e]}});if(h){return}this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0);if(this.mediaSource&&this.mediaSource.readyState==="open"){this.checkPendingTracks()}};t.appendChangeType=function e(r,i){var n=this;var a=this.operationQueue;var t={execute:function e(){var t=n.sourceBuffer[r];if(t){T["logger"].log("[buffer-controller]: changing "+r+" sourceBuffer type to "+i);t.changeType(i)}a.shiftAndExecuteNext(r)},onStart:function e(){},onComplete:function e(){},onError:function e(t){T["logger"].warn("[buffer-controller]: Failed to change "+r+" SourceBuffer type",t)}};a.append(t,r)};t.onBufferAppending=function e(t,r){var a=this;var i=this.hls,n=this.operationQueue,s=this.tracks;var o=r.data,l=r.type,u=r.frag,c=r.part,d=r.chunkMeta;var f=d.buffering[l];var h=self.performance.now();f.start=h;var v=u.stats.buffering;var g=c?c.stats.buffering:null;if(v.start===0){v.start=h}if(g&&g.start===0){g.start=h}var p=s.audio;var m=l==="audio"&&d.id===1&&(p===null||p===void 0?void 0:p.container)==="audio/mpeg";var y={execute:function e(){f.executeStart=self.performance.now();if(m){var t=a.sourceBuffer[l];if(t){var r=u.start-t.timestampOffset;if(Math.abs(r)>=.1){T["logger"].log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+u.start+" (delta: "+r+") sn: "+u.sn+")");t.timestampOffset=u.start}}}a.appendExecutor(o,l)},onStart:function e(){},onComplete:function e(){var t=self.performance.now();f.executeEnd=f.end=t;if(v.first===0){v.first=t}if(g&&g.first===0){g.first=t}var r=a.sourceBuffer;var i={};for(var n in r){i[n]=S["BufferHelper"].getBuffered(r[n])}a.appendError=0;a.hls.trigger(b["Events"].BUFFER_APPENDED,{type:l,frag:u,part:c,chunkMeta:d,parent:u.type,timeRanges:i})},onError:function e(t){T["logger"].error("[buffer-controller]: Error encountered while trying to append to the "+l+" SourceBuffer",t);var r={type:E["ErrorTypes"].MEDIA_ERROR,parent:u.type,details:E["ErrorDetails"].BUFFER_APPEND_ERROR,err:t,fatal:false};if(t.code===DOMException.QUOTA_EXCEEDED_ERR){r.details=E["ErrorDetails"].BUFFER_FULL_ERROR}else{a.appendError++;r.details=E["ErrorDetails"].BUFFER_APPEND_ERROR;if(a.appendError>i.config.appendErrorMaxRetry){T["logger"].error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");r.fatal=true}}i.trigger(b["Events"].ERROR,r)}};n.append(y,l)};t.onBufferFlushing=function e(t,i){var n=this;var r=this.operationQueue;var a=function e(r){return{execute:n.removeExecutor.bind(n,r,i.startOffset,i.endOffset),onStart:function e(){},onComplete:function e(){n.hls.trigger(b["Events"].BUFFER_FLUSHED,{type:r})},onError:function e(t){T["logger"].warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",t)}}};if(i.type){r.append(a(i.type),i.type)}else{this.getSourceBufferTypes().forEach(function(e){r.append(a(e),e)})}};t.onFragParsed=function e(t,r){var i=this;var n=r.frag,a=r.part;var s=[];var o=a?a.elementaryStreams:n.elementaryStreams;if(o[u["ElementaryStreamTypes"].AUDIOVIDEO]){s.push("audiovideo")}else{if(o[u["ElementaryStreamTypes"].AUDIO]){s.push("audio")}if(o[u["ElementaryStreamTypes"].VIDEO]){s.push("video")}}var l=function e(){var t=self.performance.now();n.stats.buffering.end=t;if(a){a.stats.buffering.end=t}var r=a?a.stats:n.stats;i.hls.trigger(b["Events"].FRAG_BUFFERED,{frag:n,part:a,stats:r,id:n.type})};if(s.length===0){T["logger"].warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn)}this.blockBuffers(l,s)};t.onFragChanged=function e(t,r){this.flushBackBuffer()};t.onBufferEos=function e(t,i){var n=this;var r=this.getSourceBufferTypes().reduce(function(e,t){var r=n.sourceBuffer[t];if(!i.type||i.type===t){if(r&&!r.ended){r.ended=true;T["logger"].log("[buffer-controller]: "+t+" sourceBuffer now EOS")}}return e&&!!(!r||r.ended)},true);if(r){this.blockBuffers(function(){var e=n.mediaSource;if(!e||e.readyState!=="open"){return}e.endOfStream()})}};t.onLevelUpdated=function e(t,r){var i=r.details;if(!i.fragments.length){return}this.details=i;if(this.getSourceBufferTypes().length){this.blockBuffers(this.updateMediaElementDuration.bind(this))}else{this.updateMediaElementDuration()}};t.flushBackBuffer=function e(){var i=this.hls,n=this.details,t=this.media,a=this.sourceBuffer;if(!t||n===null){return}var r=this.getSourceBufferTypes();if(!r.length){return}var s=n.live&&i.config.liveBackBufferLength!==null?i.config.liveBackBufferLength:i.config.backBufferLength;if(!Object(h["isFiniteNumber"])(s)||s<0){return}var o=t.currentTime;var l=n.levelTargetDuration;var u=Math.max(s,l);var c=Math.floor(o/l)*l-u;r.forEach(function(e){var t=a[e];if(t){var r=S["BufferHelper"].getBuffered(t);if(r.length>0&&c>r.start(0)){i.trigger(b["Events"].BACK_BUFFER_REACHED,{bufferEnd:c});if(n.live){i.trigger(b["Events"].LIVE_BACK_BUFFER_REACHED,{bufferEnd:c})}i.trigger(b["Events"].BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:e})}}})};t.updateMediaElementDuration=function e(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open"){return}var t=this.details,r=this.hls,i=this.media,n=this.mediaSource;var a=t.fragments[0].start+t.totalduration;var s=i.duration;var o=Object(h["isFiniteNumber"])(n.duration)?n.duration:0;if(t.live&&r.config.liveDurationInfinity){T["logger"].log("[buffer-controller]: Media Source duration is set to Infinity");n.duration=Infinity;this.updateSeekableRange(t)}else if(a>o&&a>s||!Object(h["isFiniteNumber"])(s)){T["logger"].log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3));n.duration=a}};t.updateSeekableRange=function e(t){var r=this.mediaSource;var i=t.fragments;var n=i.length;if(n&&t.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var a=Math.max(0,i[0].start);var s=Math.max(a,a+t.totalduration);r.setLiveSeekableRange(a,s)}};t.checkPendingTracks=function e(){var t=this.bufferCodecEventsExpected,r=this.operationQueue,i=this.pendingTracks;var n=Object.keys(i).length;if(n&&!t||n===2){this.createSourceBuffers(i);this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length===0){this.hls.trigger(b["Events"].ERROR,{type:E["ErrorTypes"].MEDIA_ERROR,details:E["ErrorDetails"].BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:true,reason:"could not create source buffer for media codec(s)"});return}a.forEach(function(e){r.executeNext(e)})}};t.createSourceBuffers=function e(t){var r=this.sourceBuffer,i=this.mediaSource;if(!i){throw Error("createSourceBuffers called when mediaSource was null")}var n=0;for(var a in t){if(!r[a]){var s=t[a];if(!s){throw Error("source buffer exists for track "+a+", however track does not")}var o=s.levelCodec||s.codec;var l=s.container+";codecs="+o;T["logger"].log("[buffer-controller]: creating sourceBuffer("+l+")");try{var u=r[a]=i.addSourceBuffer(l);var c=a;this.addBufferListener(c,"updatestart",this._onSBUpdateStart);this.addBufferListener(c,"updateend",this._onSBUpdateEnd);this.addBufferListener(c,"error",this._onSBUpdateError);this.tracks[a]={buffer:u,codec:o,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id};n++}catch(e){T["logger"].error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message);this.hls.trigger(b["Events"].ERROR,{type:E["ErrorTypes"].MEDIA_ERROR,details:E["ErrorDetails"].BUFFER_ADD_CODEC_ERROR,fatal:false,error:e,mimeType:l})}}}if(n){this.hls.trigger(b["Events"].BUFFER_CREATED,{tracks:this.tracks})}};t._onSBUpdateStart=function e(t){var r=this.operationQueue;var i=r.current(t);i.onStart()};t._onSBUpdateEnd=function e(t){var r=this.operationQueue;var i=r.current(t);i.onComplete();r.shiftAndExecuteNext(t)};t._onSBUpdateError=function e(t,r){T["logger"].error("[buffer-controller]: "+t+" SourceBuffer error",r);this.hls.trigger(b["Events"].ERROR,{type:E["ErrorTypes"].MEDIA_ERROR,details:E["ErrorDetails"].BUFFER_APPENDING_ERROR,fatal:false});var i=this.operationQueue.current(t);if(i){i.onError(r)}};t.removeExecutor=function e(t,r,i){var n=this.media,a=this.mediaSource,s=this.operationQueue,o=this.sourceBuffer;var l=o[t];if(!n||!a||!l){T["logger"].warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist");s.shiftAndExecuteNext(t);return}var u=Object(h["isFiniteNumber"])(n.duration)?n.duration:Infinity;var c=Object(h["isFiniteNumber"])(a.duration)?a.duration:Infinity;var d=Math.max(0,r);var f=Math.min(i,u,c);if(f>d){T["logger"].log("[buffer-controller]: Removing ["+d+","+f+"] from the "+t+" SourceBuffer");console.assert(!l.updating,t+" sourceBuffer must not be updating");l.remove(d,f)}else{s.shiftAndExecuteNext(t)}};t.appendExecutor=function e(t,r){var i=this.operationQueue,n=this.sourceBuffer;var a=n[r];if(!a){T["logger"].warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist");i.shiftAndExecuteNext(r);return}a.ended=false;console.assert(!a.updating,r+" sourceBuffer must not be updating");a.appendBuffer(t)};t.blockBuffers=function e(t,r){var i=this;if(r===void 0){r=this.getSourceBufferTypes()}if(!r.length){T["logger"].log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist");Promise.resolve().then(t);return}var n=this.operationQueue;var a=r.map(function(e){return n.appendBlocker(e)});Promise.all(a).then(function(){t();r.forEach(function(e){var t=i.sourceBuffer[e];if(!t||!t.updating){n.shiftAndExecuteNext(e)}})})};t.getSourceBufferTypes=function e(){return Object.keys(this.sourceBuffer)};t.addBufferListener=function e(t,r,i){var n=this.sourceBuffer[t];if(!n){return}var a=i.bind(this,t);this.listeners[t].push({event:r,listener:a});n.addEventListener(r,a)};t.removeBufferListeners=function e(t){var r=this.sourceBuffer[t];if(!r){return}this.listeners[t].forEach(function(e){r.removeEventListener(e.event,e.listener)})};return e}()},"./src/controller/buffer-operation-queue.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var o=r("./src/utils/logger.ts");var i=function(){function e(e){this.buffers=void 0;this.queues={video:[],audio:[],audiovideo:[]};this.buffers=e}var t=e.prototype;t.append=function e(t,r){var i=this.queues[r];i.push(t);if(i.length===1&&this.buffers[r]){this.executeNext(r)}};t.insertAbort=function e(t,r){var i=this.queues[r];i.unshift(t);this.executeNext(r)};t.appendBlocker=function e(t){var r;var i=new Promise(function(e){r=e});var n={execute:r,onStart:function e(){},onComplete:function e(){},onError:function e(){}};this.append(n,t);return i};t.executeNext=function e(t){var r=this.buffers,i=this.queues;var n=r[t];var a=i[t];if(a.length){var s=a[0];try{s.execute()}catch(e){o["logger"].warn("[buffer-operation-queue]: Unhandled exception executing the current operation");s.onError(e);if(!n||!n.updating){a.shift();this.executeNext(t)}}}};t.shiftAndExecuteNext=function e(t){this.queues[t].shift();this.executeNext(t)};t.current=function e(t){return this.queues[t][0]};return e}()},"./src/controller/cap-level-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/events.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function s(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var a=function(){function a(e){this.autoLevelCapping=void 0;this.firstLevel=void 0;this.media=void 0;this.restrictedLevels=void 0;this.timer=void 0;this.hls=void 0;this.streamController=void 0;this.clientRect=void 0;this.hls=e;this.autoLevelCapping=Number.POSITIVE_INFINITY;this.firstLevel=-1;this.media=null;this.restrictedLevels=[];this.timer=undefined;this.clientRect=null;this.registerListeners()}var e=a.prototype;e.setStreamController=function e(t){this.streamController=t};e.destroy=function e(){this.unregisterListener();if(this.hls.config.capLevelToPlayerSize){this.stopCapping()}this.media=null;this.clientRect=null;this.hls=this.streamController=null};e.registerListeners=function e(){var t=this.hls;t.on(i["Events"].FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this);t.on(i["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);t.on(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.on(i["Events"].BUFFER_CODECS,this.onBufferCodecs,this);t.on(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this)};e.unregisterListener=function e(){var t=this.hls;t.off(i["Events"].FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this);t.off(i["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);t.off(i["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.off(i["Events"].BUFFER_CODECS,this.onBufferCodecs,this);t.off(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this)};e.onFpsDropLevelCapping=function e(t,r){if(a.isLevelAllowed(r.droppedLevel,this.restrictedLevels)){this.restrictedLevels.push(r.droppedLevel)}};e.onMediaAttaching=function e(t,r){this.media=r.media instanceof HTMLVideoElement?r.media:null};e.onManifestParsed=function e(t,r){var i=this.hls;this.restrictedLevels=[];this.firstLevel=r.firstLevel;if(i.config.capLevelToPlayerSize&&r.video){this.startCapping()}};e.onBufferCodecs=function e(t,r){var i=this.hls;if(i.config.capLevelToPlayerSize&&r.video){this.startCapping()}};e.onMediaDetaching=function e(){this.stopCapping()};e.detectPlayerSize=function e(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var r=this.hls;r.autoLevelCapping=this.getMaxLevel(t.length-1);if(r.autoLevelCapping>this.autoLevelCapping&&this.streamController){this.streamController.nextLevelSwitch()}this.autoLevelCapping=r.autoLevelCapping}}};e.getMaxLevel=function e(r){var i=this;var t=this.hls.levels;if(!t.length){return-1}var n=t.filter(function(e,t){return a.isLevelAllowed(t,i.restrictedLevels)&&t<=r});this.clientRect=null;return a.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)};e.startCapping=function e(){if(this.timer){return}this.autoLevelCapping=Number.POSITIVE_INFINITY;this.hls.firstLevel=this.getMaxLevel(this.firstLevel);self.clearInterval(this.timer);this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3);this.detectPlayerSize()};e.stopCapping=function e(){this.restrictedLevels=[];this.firstLevel=-1;this.autoLevelCapping=Number.POSITIVE_INFINITY;if(this.timer){self.clearInterval(this.timer);this.timer=undefined}};e.getDimensions=function e(){if(this.clientRect){return this.clientRect}var t=this.media;var r={width:0,height:0};if(t){var i=t.getBoundingClientRect();r.width=i.width;r.height=i.height;if(!r.width&&!r.height){r.width=i.right-i.left||t.width||0;r.height=i.bottom-i.top||t.height||0}}this.clientRect=r;return r};a.isLevelAllowed=function e(t,r){if(r===void 0){r=[]}return r.indexOf(t)===-1};a.getMaxLevelByMediaSize=function e(t,r,i){if(!t||!t.length){return-1}var n=function e(t,r){if(!r){return true}return t.width!==r.width||t.height!==r.height};var a=t.length-1;for(var s=0;s<t.length;s+=1){var o=t[s];if((o.width>=r||o.height>=i)&&n(o,t[s+1])){a=s;break}}return a};s(a,[{key:"mediaWidth",get:function e(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function e(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function e(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio){try{t=self.devicePixelRatio}catch(e){}}return t}}]);return a}();t["default"]=a},"./src/controller/cmcd-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return f});var i=r("./src/events.ts");var c=r("./src/types/cmcd.ts");var a=r("./src/utils/buffer-helper.ts");var s=r("./src/utils/logger.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function o(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function p(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=l(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var i=0;return function(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){if(!e)return;if(typeof e==="string")return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}function u(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,i=new Array(t);r<t;r++){i[r]=e[r]}return i}function d(){d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return d.apply(this,arguments)}var f=function(){function h(e){var a=this;this.hls=void 0;this.config=void 0;this.media=void 0;this.sid=void 0;this.cid=void 0;this.useHeaders=false;this.initialized=false;this.starved=false;this.buffering=true;this.audioBuffer=void 0;this.videoBuffer=void 0;this.onWaiting=function(){if(a.initialized){a.starved=true}a.buffering=true};this.onPlaying=function(){if(!a.initialized){a.initialized=true}a.buffering=false};this.applyPlaylistData=function(e){try{a.apply(e,{ot:c["CMCDObjectType"].MANIFEST,su:!a.initialized})}catch(e){s["logger"].warn("Could not generate manifest CMCD data.",e)}};this.applyFragmentData=function(e){try{var t=e.frag;var r=a.hls.levels[t.level];var i=a.getObjectType(t);var n={d:t.duration*1e3,ot:i};if(i===c["CMCDObjectType"].VIDEO||i===c["CMCDObjectType"].AUDIO||i==c["CMCDObjectType"].MUXED){n.br=r.bitrate/1e3;n.tb=a.getTopBandwidth(i)/1e3;n.bl=a.getBufferLength(i)}a.apply(e,n)}catch(e){s["logger"].warn("Could not generate segment CMCD data.",e)}};this.hls=e;var t=this.config=e.config;var r=t.cmcd;if(r!=null){t.pLoader=this.createPlaylistLoader();t.fLoader=this.createFragmentLoader();this.sid=r.sessionId||h.uuid();this.cid=r.contentId;this.useHeaders=r.useHeaders===true;this.registerListeners()}}var e=h.prototype;e.registerListeners=function e(){var t=this.hls;t.on(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.on(i["Events"].MEDIA_DETACHED,this.onMediaDetached,this);t.on(i["Events"].BUFFER_CREATED,this.onBufferCreated,this)};e.unregisterListeners=function e(){var t=this.hls;t.off(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.off(i["Events"].MEDIA_DETACHED,this.onMediaDetached,this);t.off(i["Events"].BUFFER_CREATED,this.onBufferCreated,this);this.onMediaDetached()};e.destroy=function e(){this.unregisterListeners();this.hls=this.config=this.audioBuffer=this.videoBuffer=null};e.onMediaAttached=function e(t,r){this.media=r.media;this.media.addEventListener("waiting",this.onWaiting);this.media.addEventListener("playing",this.onPlaying)};e.onMediaDetached=function e(){if(!this.media){return}this.media.removeEventListener("waiting",this.onWaiting);this.media.removeEventListener("playing",this.onPlaying);this.media=null};e.onBufferCreated=function e(t,r){var i,n;this.audioBuffer=(i=r.tracks.audio)===null||i===void 0?void 0:i.buffer;this.videoBuffer=(n=r.tracks.video)===null||n===void 0?void 0:n.buffer};e.createData=function e(){var t;return{v:c["CMCDVersion"],sf:c["CMCDStreamingFormat"].HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)===null||t===void 0?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}};e.apply=function e(t,r){if(r===void 0){r={}}d(r,this.createData());var i=r.ot===c["CMCDObjectType"].INIT||r.ot===c["CMCDObjectType"].VIDEO||r.ot===c["CMCDObjectType"].MUXED;if(this.starved&&i){r.bs=true;r.su=true;this.starved=false}if(r.su==null){r.su=this.buffering}if(this.useHeaders){var n=h.toHeaders(r);if(!Object.keys(n).length){return}if(!t.headers){t.headers={}}d(t.headers,n)}else{var a=h.toQuery(r);if(!a){return}t.url=h.appendQueryToUri(t.url,a)}};e.getObjectType=function e(t){var r=t.type;if(r==="subtitle"){return c["CMCDObjectType"].TIMED_TEXT}if(t.sn==="initSegment"){return c["CMCDObjectType"].INIT}if(r==="audio"){return c["CMCDObjectType"].AUDIO}if(r==="main"){if(!this.hls.audioTracks.length){return c["CMCDObjectType"].MUXED}return c["CMCDObjectType"].VIDEO}return undefined};e.getTopBandwidth=function e(t){var r=0;var i;var n=this.hls;if(t===c["CMCDObjectType"].AUDIO){i=n.audioTracks}else{var a=n.maxAutoLevel;var s=a>-1?a+1:n.levels.length;i=n.levels.slice(0,s)}for(var o=p(i),l;!(l=o()).done;){var u=l.value;if(u.bitrate>r){r=u.bitrate}}return r>0?r:NaN};e.getBufferLength=function e(t){var r=this.hls.media;var i=t===c["CMCDObjectType"].AUDIO?this.audioBuffer:this.videoBuffer;if(!i||!r){return NaN}var n=a["BufferHelper"].bufferInfo(i,r.currentTime,this.config.maxBufferHole);return n.len*1e3};e.createPlaylistLoader=function e(){var t=this.config.pLoader;var n=this.applyPlaylistData;var r=t||this.config.loader;return function(){function e(e){this.loader=void 0;this.loader=new r(e)}var t=e.prototype;t.destroy=function e(){this.loader.destroy()};t.abort=function e(){this.loader.abort()};t.load=function e(t,r,i){n(t);this.loader.load(t,r,i)};o(e,[{key:"stats",get:function e(){return this.loader.stats}},{key:"context",get:function e(){return this.loader.context}}]);return e}()};e.createFragmentLoader=function e(){var t=this.config.fLoader;var n=this.applyFragmentData;var r=t||this.config.loader;return function(){function e(e){this.loader=void 0;this.loader=new r(e)}var t=e.prototype;t.destroy=function e(){this.loader.destroy()};t.abort=function e(){this.loader.abort()};t.load=function e(t,r,i){n(t);this.loader.load(t,r,i)};o(e,[{key:"stats",get:function e(){return this.loader.stats}},{key:"context",get:function e(){return this.loader.context}}]);return e}()};h.uuid=function e(){var t=URL.createObjectURL(new Blob);var e=t.toString();URL.revokeObjectURL(t);return e.slice(e.lastIndexOf("/")+1)};h.serialize=function e(t){var r=[];var i=function e(t){return!Number.isNaN(t)&&t!=null&&t!==""&&t!==false};var n=function e(t){return Math.round(t)};var a=function e(t){return n(t/100)*100};var s=function e(t){return encodeURIComponent(t)};var o={br:n,d:n,bl:a,dl:a,mtp:a,nor:s,rtp:a,tb:n};var l=Object.keys(t||{}).sort();for(var u=p(l),c;!(c=u()).done;){var d=c.value;var f=t[d];if(!i(f)){continue}if(d==="v"&&f===1){continue}if(d=="pr"&&f===1){continue}var h=o[d];if(h){f=h(f)}var v=typeof f;var g=void 0;if(d==="ot"||d==="sf"||d==="st"){g=d+"="+f}else if(v==="boolean"){g=d}else if(v==="number"){g=d+"="+f}else{g=d+"="+JSON.stringify(f)}r.push(g)}return r.join(",")};h.toHeaders=function e(t){var r=Object.keys(t);var i={};var n=["Object","Request","Session","Status"];var a=[{},{},{},{}];var s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(var o=0,l=r;o<l.length;o++){var u=l[o];var c=s[u]!=null?s[u]:1;a[c][u]=t[u]}for(var d=0;d<a.length;d++){var f=h.serialize(a[d]);if(f){i["CMCD-"+n[d]]=f}}return i};h.toQuery=function e(t){return"CMCD="+encodeURIComponent(h.serialize(t))};h.appendQueryToUri=function e(t,r){if(!r){return t}var i=t.includes("?")?"&":"?";return""+t+i+r};return h}()},"./src/controller/eme-controller.ts":function(e,t,r){"use strict";r.r(t);var l=r("./src/events.ts");var u=r("./src/errors.ts");var c=r("./src/utils/logger.ts");var a=r("./src/utils/mediakeys-helper.ts");function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function n(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var d=3;var s=function e(t,r,i){var n={audioCapabilities:[],videoCapabilities:[]};t.forEach(function(e){n.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:i.audioRobustness||""})});r.forEach(function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:i.videoRobustness||""})});return[n]};var o=function e(t,r,i,n){switch(t){case a["KeySystems"].WIDEVINE:return s(r,i,n);default:throw new Error("Unknown key-system: "+t)}};var f=function(){function e(e){this.hls=void 0;this._widevineLicenseUrl=void 0;this._licenseXhrSetup=void 0;this._licenseResponseCallback=void 0;this._emeEnabled=void 0;this._requestMediaKeySystemAccess=void 0;this._drmSystemOptions=void 0;this._config=void 0;this._mediaKeysList=[];this._media=null;this._hasSetMediaKeys=false;this._requestLicenseFailureCount=0;this.mediaKeysPromise=null;this._onMediaEncrypted=this.onMediaEncrypted.bind(this);this.hls=e;this._config=e.config;this._widevineLicenseUrl=this._config.widevineLicenseUrl;this._licenseXhrSetup=this._config.licenseXhrSetup;this._licenseResponseCallback=this._config.licenseResponseCallback;this._emeEnabled=this._config.emeEnabled;this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc;this._drmSystemOptions=this._config.drmSystemOptions;this._registerListeners()}var t=e.prototype;t.destroy=function e(){this._unregisterListeners();this.hls=this._onMediaEncrypted=null;this._requestMediaKeySystemAccess=null};t._registerListeners=function e(){this.hls.on(l["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.on(l["Events"].MEDIA_DETACHED,this.onMediaDetached,this);this.hls.on(l["Events"].MANIFEST_PARSED,this.onManifestParsed,this)};t._unregisterListeners=function e(){this.hls.off(l["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.off(l["Events"].MEDIA_DETACHED,this.onMediaDetached,this);this.hls.off(l["Events"].MANIFEST_PARSED,this.onManifestParsed,this)};t.getLicenseServerUrl=function e(t){switch(t){case a["KeySystems"].WIDEVINE:if(!this._widevineLicenseUrl){break}return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')};t._attemptKeySystemAccess=function e(t,r,i){var n=this;var a=o(t,r,i,this._drmSystemOptions);c["logger"].log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(t,a);this.mediaKeysPromise=s.then(function(e){return n._onMediaKeySystemAccessObtained(t,e)});s.catch(function(e){c["logger"].error('Failed to obtain key-system "'+t+'" access:',e)})};t._onMediaKeySystemAccessObtained=function e(t,r){var i=this;c["logger"].log('Access for key-system "'+t+'" obtained');var n={mediaKeysSessionInitialized:false,mediaKeySystemAccess:r,mediaKeySystemDomain:t};this._mediaKeysList.push(n);var a=Promise.resolve().then(function(){return r.createMediaKeys()}).then(function(e){n.mediaKeys=e;c["logger"].log('Media-keys created for key-system "'+t+'"');i._onMediaKeysCreated();return e});a.catch(function(e){c["logger"].error("Failed to create media-keys:",e)});return a};t._onMediaKeysCreated=function e(){var t=this;this._mediaKeysList.forEach(function(e){if(!e.mediaKeysSession){e.mediaKeysSession=e.mediaKeys.createSession();t._onNewMediaKeySession(e.mediaKeysSession)}})};t._onNewMediaKeySession=function e(t){var r=this;c["logger"].log("New key-system session "+t.sessionId);t.addEventListener("message",function(e){r._onKeySessionMessage(t,e.message)},false)};t._onKeySessionMessage=function e(t,r){c["logger"].log("Got EME message event, creating license request");this._requestLicense(r,function(e){c["logger"].log("Received license data (length: "+(e?e.byteLength:e)+"), updating key-session");t.update(e).catch(function(e){c["logger"].warn("Updating key-session failed: "+e)})})};t.onMediaEncrypted=function e(r){var i=this;c["logger"].log('Media is encrypted using "'+r.initDataType+'" init data type');if(!this.mediaKeysPromise){c["logger"].error("Fatal: Media is encrypted but no CDM access or no keys have been requested");this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_NO_KEYS,fatal:true});return}var t=function e(t){if(!i._media){return}i._attemptSetMediaKeys(t);i._generateRequestWithPreferredKeySession(r.initDataType,r.initData)};this.mediaKeysPromise.then(t).catch(t)};t._attemptSetMediaKeys=function e(t){if(!this._media){throw new Error("Attempted to set mediaKeys without first attaching a media element")}if(!this._hasSetMediaKeys){var r=this._mediaKeysList[0];if(!r||!r.mediaKeys){c["logger"].error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet");this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_NO_KEYS,fatal:true});return}c["logger"].log("Setting keys for encrypted media");this._media.setMediaKeys(r.mediaKeys);this._hasSetMediaKeys=true}};t._generateRequestWithPreferredKeySession=function e(t,r){var i=this;var n=this._mediaKeysList[0];if(!n){c["logger"].error("Fatal: Media is encrypted but not any key-system access has been obtained yet");this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:true});return}if(n.mediaKeysSessionInitialized){c["logger"].warn("Key-Session already initialized but requested again");return}var a=n.mediaKeysSession;if(!a){c["logger"].error("Fatal: Media is encrypted but no key-session existing");this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:true});return}if(!r){c["logger"].warn("Fatal: initData required for generating a key session is null");this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_NO_INIT_DATA,fatal:true});return}c["logger"].log('Generating key-session request for "'+t+'" init data type');n.mediaKeysSessionInitialized=true;a.generateRequest(t,r).then(function(){c["logger"].debug("Key-session generation succeeded")}).catch(function(e){c["logger"].error("Error generating key-session request:",e);i.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:false})})};t._createLicenseXhr=function e(t,r,i){var n=new XMLHttpRequest;n.responseType="arraybuffer";n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,t,r,i);var a=this._licenseXhrSetup;if(a){try{a.call(this.hls,n,t);a=undefined}catch(e){c["logger"].error(e)}}try{if(!n.readyState){n.open("POST",t,true)}if(a){a.call(this.hls,n,t)}}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return n};t._onLicenseRequestReadyStageChange=function e(t,r,i,n){switch(t.readyState){case 4:if(t.status===200){this._requestLicenseFailureCount=0;c["logger"].log("License request succeeded");var a=t.response;var s=this._licenseResponseCallback;if(s){try{a=s.call(this.hls,t,r)}catch(e){c["logger"].error(e)}}n(a)}else{c["logger"].error("License Request XHR failed ("+r+"). Status: "+t.status+" ("+t.statusText+")");this._requestLicenseFailureCount++;if(this._requestLicenseFailureCount>d){this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:true});return}var o=d-this._requestLicenseFailureCount+1;c["logger"].warn("Retrying license request, "+o+" attempts left");this._requestLicense(i,n)}break}};t._generateLicenseRequestChallenge=function e(t,r){switch(t.mediaKeySystemDomain){case a["KeySystems"].WIDEVINE:return r}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)};t._requestLicense=function e(t,r){c["logger"].log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i){c["logger"].error("Fatal error: Media is encrypted but no key-system access has been obtained yet");this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:true});return}try{var n=this.getLicenseServerUrl(i.mediaKeySystemDomain);var a=this._createLicenseXhr(n,t,r);c["logger"].log("Sending license request to URL: "+n);var s=this._generateLicenseRequestChallenge(i,t);a.send(s)}catch(e){c["logger"].error("Failure requesting DRM license: "+e);this.hls.trigger(l["Events"].ERROR,{type:u["ErrorTypes"].KEY_SYSTEM_ERROR,details:u["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:true})}};t.onMediaAttached=function e(t,r){if(!this._emeEnabled){return}var i=r.media;this._media=i;i.addEventListener("encrypted",this._onMediaEncrypted)};t.onMediaDetached=function e(){var t=this._media;var r=this._mediaKeysList;if(!t){return}t.removeEventListener("encrypted",this._onMediaEncrypted);this._media=null;this._mediaKeysList=[];Promise.all(r.map(function(e){if(e.mediaKeysSession){return e.mediaKeysSession.close().catch(function(){})}})).then(function(){return t.setMediaKeys(null)}).catch(function(){})};t.onManifestParsed=function e(t,r){if(!this._emeEnabled){return}var i=r.levels.map(function(e){return e.audioCodec}).filter(function(e){return!!e});var n=r.levels.map(function(e){return e.videoCodec}).filter(function(e){return!!e});this._attemptKeySystemAccess(a["KeySystems"].WIDEVINE,i,n)};n(e,[{key:"requestMediaKeySystemAccess",get:function e(){if(!this._requestMediaKeySystemAccess){throw new Error("No requestMediaKeySystemAccess function configured")}return this._requestMediaKeySystemAccess}}]);return e}();t["default"]=f},"./src/controller/fps-controller.ts":function(e,t,r){"use strict";r.r(t);var d=r("./src/events.ts");var f=r("./src/utils/logger.ts");var i=function(){function e(e){this.hls=void 0;this.isVideoPlaybackQualityAvailable=false;this.timer=void 0;this.media=null;this.lastTime=void 0;this.lastDroppedFrames=0;this.lastDecodedFrames=0;this.streamController=void 0;this.hls=e;this.registerListeners()}var t=e.prototype;t.setStreamController=function e(t){this.streamController=t};t.registerListeners=function e(){this.hls.on(d["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this)};t.unregisterListeners=function e(){this.hls.off(d["Events"].MEDIA_ATTACHING,this.onMediaAttaching)};t.destroy=function e(){if(this.timer){clearInterval(this.timer)}this.unregisterListeners();this.isVideoPlaybackQualityAvailable=false;this.media=null};t.onMediaAttaching=function e(t,r){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=r.media instanceof self.HTMLVideoElement?r.media:null;this.media=n;if(n&&typeof n.getVideoPlaybackQuality==="function"){this.isVideoPlaybackQualityAvailable=true}self.clearInterval(this.timer);this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}};t.checkFPS=function e(t,r,i){var n=performance.now();if(r){if(this.lastTime){var a=n-this.lastTime;var s=i-this.lastDroppedFrames;var o=r-this.lastDecodedFrames;var l=1e3*s/a;var u=this.hls;u.trigger(d["Events"].FPS_DROP,{currentDropped:s,currentDecoded:o,totalDroppedFrames:i});if(l>0){if(s>u.config.fpsDroppedMonitoringThreshold*o){var c=u.currentLevel;f["logger"].warn("drop FPS ratio greater than max allowed value for currentLevel: "+c);if(c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)){c=c-1;u.trigger(d["Events"].FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel});u.autoLevelCapping=c;this.streamController.nextLevelSwitch()}}}}this.lastTime=n;this.lastDroppedFrames=i;this.lastDecodedFrames=r}};t.checkFPSInterval=function e(){var t=this.media;if(t){if(this.isVideoPlaybackQualityAvailable){var r=t.getVideoPlaybackQuality();this.checkFPS(t,r.totalVideoFrames,r.droppedVideoFrames)}else{this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}};return e}();t["default"]=i},"./src/controller/fragment-finders.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"findFragmentByPDT",function(){return i});r.d(t,"findFragmentByPTS",function(){return n});r.d(t,"fragmentWithinToleranceTest",function(){return l});r.d(t,"pdtWithinToleranceTest",function(){return u});r.d(t,"findFragWithCC",function(){return a});var o=r("./src/polyfills/number.ts");var s=r("./src/utils/binary-search.ts");function i(e,t,r){if(t===null||!Array.isArray(e)||!e.length||!Object(o["isFiniteNumber"])(t)){return null}var i=e[0].programDateTime;if(t<(i||0)){return null}var n=e[e.length-1].endProgramDateTime;if(t>=(n||0)){return null}r=r||0;for(var a=0;a<e.length;++a){var s=e[a];if(u(t,r,s)){return s}}return null}function n(e,t,r,i){if(r===void 0){r=0}if(i===void 0){i=0}var n=null;if(e){n=t[e.sn-t[0].sn+1]||null}else if(r===0&&t[0].start===0){n=t[0]}if(n&&l(r,i,n)===0){return n}var a=s["default"].search(t,l.bind(null,r,i));if(a){return a}return n}function l(e,t,r){if(e===void 0){e=0}if(t===void 0){t=0}var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));if(r.start+r.duration-i<=e){return 1}else if(r.start-i>e&&r.start){return-1}return 0}function u(e,t,r){var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0))*1e3;var n=r.endProgramDateTime||0;return n-i>e}function a(e,t){return s["default"].search(e,function(e){if(e.cc<t){return 1}else if(e.cc>t){return-1}else{return 0}})}},"./src/controller/fragment-tracker.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"FragmentState",function(){return n});r.d(t,"FragmentTracker",function(){return a});var i=r("./src/events.ts");var l=r("./src/types/loader.ts");var n;(function(e){e["NOT_LOADED"]="NOT_LOADED";e["APPENDING"]="APPENDING";e["PARTIAL"]="PARTIAL";e["OK"]="OK"})(n||(n={}));var a=function(){function e(e){this.activeFragment=null;this.activeParts=null;this.fragments=Object.create(null);this.timeRanges=Object.create(null);this.bufferPadding=.2;this.hls=void 0;this.hls=e;this._registerListeners()}var t=e.prototype;t._registerListeners=function e(){var t=this.hls;t.on(i["Events"].BUFFER_APPENDED,this.onBufferAppended,this);t.on(i["Events"].FRAG_BUFFERED,this.onFragBuffered,this);t.on(i["Events"].FRAG_LOADED,this.onFragLoaded,this)};t._unregisterListeners=function e(){var t=this.hls;t.off(i["Events"].BUFFER_APPENDED,this.onBufferAppended,this);t.off(i["Events"].FRAG_BUFFERED,this.onFragBuffered,this);t.off(i["Events"].FRAG_LOADED,this.onFragLoaded,this)};t.destroy=function e(){this._unregisterListeners();this.fragments=this.timeRanges=null};t.getAppendedFrag=function e(t,r){if(r===l["PlaylistLevelType"].MAIN){var i=this.activeFragment,n=this.activeParts;if(!i){return null}if(n){for(var a=n.length;a--;){var s=n[a];var o=s?s.end:i.appendedPTS;if(s.start<=t&&o!==undefined&&t<=o){if(a>9){this.activeParts=n.slice(a-9)}return s}}}else if(i.start<=t&&i.appendedPTS!==undefined&&t<=i.appendedPTS){return i}}return this.getBufferedFrag(t,r)};t.getBufferedFrag=function e(t,r){var i=this.fragments;var n=Object.keys(i);for(var a=n.length;a--;){var s=i[n[a]];if((s===null||s===void 0?void 0:s.body.type)===r&&s.buffered){var o=s.body;if(o.start<=t&&t<=o.end){return o}}}return null};t.detectEvictedFragments=function e(i,n,a){var s=this;Object.keys(this.fragments).forEach(function(e){var r=s.fragments[e];if(!r){return}if(!r.buffered){if(r.body.type===a){s.removeFragment(r.body)}return}var t=r.range[i];if(!t){return}t.time.some(function(e){var t=!s.isTimeBuffered(e.startPTS,e.endPTS,n);if(t){s.removeFragment(r.body)}return t})})};t.detectPartialFragments=function e(t){var n=this;var a=this.timeRanges;var s=t.frag,o=t.part;if(!a||s.sn==="initSegment"){return}var r=u(s);var l=this.fragments[r];if(!l){return}Object.keys(a).forEach(function(e){var t=s.elementaryStreams[e];if(!t){return}var r=a[e];var i=o!==null||t.partial===true;l.range[e]=n.getBufferedTimes(s,o,i,r)});l.loaded=null;if(Object.keys(l.range).length){l.buffered=true}else{this.removeFragment(l.body)}};t.fragBuffered=function e(t){var r=u(t);var i=this.fragments[r];if(i){i.loaded=null;i.buffered=true}};t.getBufferedTimes=function e(t,r,i,n){var a={time:[],partial:i};var s=r?r.start:t.start;var o=r?r.end:t.end;var l=t.minEndPTS||o;var u=t.maxStartPTS||s;for(var c=0;c<n.length;c++){var d=n.start(c)-this.bufferPadding;var f=n.end(c)+this.bufferPadding;if(u>=d&&l<=f){a.time.push({startPTS:Math.max(s,n.start(c)),endPTS:Math.min(o,n.end(c))});break}else if(s<f&&o>d){a.partial=true;a.time.push({startPTS:Math.max(s,n.start(c)),endPTS:Math.min(o,n.end(c))})}else if(o<=d){break}}return a};t.getPartialFragment=function e(r){var i=null;var n;var a;var s;var o=0;var l=this.bufferPadding,u=this.fragments;Object.keys(u).forEach(function(e){var t=u[e];if(!t){return}if(c(t)){a=t.body.start-l;s=t.body.end+l;if(r>=a&&r<=s){n=Math.min(r-a,s-r);if(o<=n){i=t.body;o=n}}}});return i};t.getState=function e(t){var r=u(t);var i=this.fragments[r];if(i){if(!i.buffered){return n.APPENDING}else if(c(i)){return n.PARTIAL}else{return n.OK}}return n.NOT_LOADED};t.isTimeBuffered=function e(t,r,i){var n;var a;for(var s=0;s<i.length;s++){n=i.start(s)-this.bufferPadding;a=i.end(s)+this.bufferPadding;if(t>=n&&r<=a){return true}if(r<=n){return false}}return false};t.onFragLoaded=function e(t,r){var i=r.frag,n=r.part;if(i.sn==="initSegment"||i.bitrateTest||n){return}var a=u(i);this.fragments[a]={body:i,loaded:r,buffered:false,range:Object.create(null)}};t.onBufferAppended=function e(t,r){var i=this;var n=r.frag,a=r.part,s=r.timeRanges;if(n.type===l["PlaylistLevelType"].MAIN){this.activeFragment=n;if(a){var o=this.activeParts;if(!o){this.activeParts=o=[]}o.push(a)}else{this.activeParts=null}}this.timeRanges=s;Object.keys(s).forEach(function(e){var t=s[e];i.detectEvictedFragments(e,t);if(!a){for(var r=0;r<t.length;r++){n.appendedPTS=Math.max(t.end(r),n.appendedPTS||0)}}})};t.onFragBuffered=function e(t,r){this.detectPartialFragments(r)};t.hasFragment=function e(t){var r=u(t);return!!this.fragments[r]};t.removeFragmentsInRange=function e(i,n,a){var s=this;Object.keys(this.fragments).forEach(function(e){var t=s.fragments[e];if(!t){return}if(t.buffered){var r=t.body;if(r.type===a&&r.start<n&&r.end>i){s.removeFragment(r)}}})};t.removeFragment=function e(t){var r=u(t);t.stats.loaded=0;t.clearElementaryStreamInfo();delete this.fragments[r]};t.removeAllFragments=function e(){this.fragments=Object.create(null);this.activeFragment=null;this.activeParts=null};return e}();function c(e){var t,r;return e.buffered&&(((t=e.range.video)===null||t===void 0?void 0:t.partial)||((r=e.range.audio)===null||r===void 0?void 0:r.partial))}function u(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./src/controller/gap-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"STALL_MINIMUM_DURATION_MS",function(){return D});r.d(t,"MAX_START_GAP_JUMP",function(){return w});r.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return h});r.d(t,"SKIP_BUFFER_RANGE_START",function(){return v});r.d(t,"default",function(){return i});var A=r("./src/utils/buffer-helper.ts");var d=r("./src/errors.ts");var f=r("./src/events.ts");var L=r("./src/utils/logger.ts");var D=250;var w=2;var h=.1;var v=.05;var i=function(){function e(e,t,r,i){this.config=void 0;this.media=null;this.fragmentTracker=void 0;this.hls=void 0;this.nudgeRetry=0;this.stallReported=false;this.stalled=null;this.moved=false;this.seeking=false;this.config=e;this.media=t;this.fragmentTracker=r;this.hls=i}var t=e.prototype;t.destroy=function e(){this.media=null;this.hls=this.fragmentTracker=null};t.poll=function e(t,r){var i=this.config,n=this.media,a=this.stalled;if(n===null){return}var s=n.currentTime,o=n.seeking;var l=this.seeking&&!o;var u=!this.seeking&&o;this.seeking=o;if(s!==t){this.moved=true;if(a!==null){if(this.stallReported){var c=self.performance.now()-a;L["logger"].warn("playback not stuck anymore @"+s+", after "+Math.round(c)+"ms");this.stallReported=false}this.stalled=null;this.nudgeRetry=0}return}if(u||l){this.stalled=null}if(n.paused&&!o||n.ended||n.playbackRate===0||!A["BufferHelper"].getBuffered(n).length){return}var d=A["BufferHelper"].bufferInfo(n,s,0);var f=d.len>0;var h=d.nextStart||0;if(!f&&!h){return}if(o){var v=d.len>w;var g=!h||r&&r.start<=s||h-s>w&&!this.fragmentTracker.getPartialFragment(s);if(v||g){return}this.moved=false}if(!this.moved&&this.stalled!==null){var p;var m=Math.max(h,d.start||0)-s;var y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null;var b=y===null||y===void 0?void 0:(p=y.details)===null||p===void 0?void 0:p.live;var T=b?y.details.targetduration*2:w;if(m>0&&m<=T){this._trySkipBufferHole(null);return}}var E=self.performance.now();if(a===null){this.stalled=E;return}var S=E-a;if(!o&&S>=D){this._reportStall(d);if(!this.media){return}}var k=A["BufferHelper"].bufferInfo(n,s,i.maxBufferHole);this._tryFixBufferStall(k,S)};t._tryFixBufferStall=function e(t,r){var i=this.config,n=this.fragmentTracker,a=this.media;if(a===null){return}var s=a.currentTime;var o=n.getPartialFragment(s);if(o){var l=this._trySkipBufferHole(o);if(l||!this.media){return}}if(t.len>i.maxBufferHole&&r>i.highBufferWatchdogPeriod*1e3){L["logger"].warn("Trying to nudge playhead over buffer-hole");this.stalled=null;this._tryNudgeBuffer()}};t._reportStall=function e(t){var r=this.hls,i=this.media,n=this.stallReported;if(!n&&i){this.stallReported=true;L["logger"].warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(t)+")");r.trigger(f["Events"].ERROR,{type:d["ErrorTypes"].MEDIA_ERROR,details:d["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:false,buffer:t.len})}};t._trySkipBufferHole=function e(t){var r=this.config,i=this.hls,n=this.media;if(n===null){return 0}var a=n.currentTime;var s=0;var o=A["BufferHelper"].getBuffered(n);for(var l=0;l<o.length;l++){var u=o.start(l);if(a+r.maxBufferHole>=s&&a<u){var c=Math.max(u+v,n.currentTime+h);L["logger"].warn("skipping hole, adjusting currentTime from "+a+" to "+c);this.moved=true;this.stalled=null;n.currentTime=c;if(t){i.trigger(f["Events"].ERROR,{type:d["ErrorTypes"].MEDIA_ERROR,details:d["ErrorDetails"].BUFFER_SEEK_OVER_HOLE,fatal:false,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+c,frag:t})}return c}s=o.end(l)}return 0};t._tryNudgeBuffer=function e(){var t=this.config,r=this.hls,i=this.media,n=this.nudgeRetry;if(i===null){return}var a=i.currentTime;this.nudgeRetry++;if(n<t.nudgeMaxRetry){var s=a+(n+1)*t.nudgeOffset;L["logger"].warn("Nudging 'currentTime' from "+a+" to "+s);i.currentTime=s;r.trigger(f["Events"].ERROR,{type:d["ErrorTypes"].MEDIA_ERROR,details:d["ErrorDetails"].BUFFER_NUDGE_ON_STALL,fatal:false})}else{L["logger"].error("Playhead still not moving while enough data buffered @"+a+" after "+t.nudgeMaxRetry+" nudges");r.trigger(f["Events"].ERROR,{type:d["ErrorTypes"].MEDIA_ERROR,details:d["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:true})}};return e}()},"./src/controller/id3-track-controller.ts":function(e,t,r){"use strict";r.r(t);var d=r("./src/polyfills/number.ts");var i=r("./src/events.ts");var f=r("./src/utils/texttrack-utils.ts");var S=r("./src/demux/id3.ts");var k=r("./src/loader/date-range.ts");var A=r("./src/types/demuxer.ts");var L=.25;function D(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function w(e,t){return e.getTime()/1e3-t}function C(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var n=function(){function e(e){this.hls=void 0;this.id3Track=null;this.media=null;this.dateRangeCuesAppended={};this.hls=e;this._registerListeners()}var t=e.prototype;t.destroy=function e(){this._unregisterListeners();this.id3Track=null;this.media=null;this.dateRangeCuesAppended={};this.hls=null};t._registerListeners=function e(){var t=this.hls;t.on(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.on(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.on(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.on(i["Events"].FRAG_PARSING_METADATA,this.onFragParsingMetadata,this);t.on(i["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);t.on(i["Events"].LEVEL_UPDATED,this.onLevelUpdated,this)};t._unregisterListeners=function e(){var t=this.hls;t.off(i["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.off(i["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.off(i["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(i["Events"].FRAG_PARSING_METADATA,this.onFragParsingMetadata,this);t.off(i["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);t.off(i["Events"].LEVEL_UPDATED,this.onLevelUpdated,this)};t.onMediaAttached=function e(t,r){this.media=r.media};t.onMediaDetaching=function e(){if(!this.id3Track){return}Object(f["clearCurrentCues"])(this.id3Track);this.id3Track=null;this.media=null;this.dateRangeCuesAppended={}};t.onManifestLoading=function e(){this.dateRangeCuesAppended={}};t.createTrack=function e(t){var r=this.getID3Track(t.textTracks);r.mode="hidden";return r};t.getID3Track=function e(t){if(!this.media){return}for(var r=0;r<t.length;r++){var i=t[r];if(i.kind==="metadata"&&i.label==="id3"){Object(f["sendAddTrackEvent"])(i,this.media);return i}}return this.media.addTextTrack("metadata","id3")};t.onFragParsingMetadata=function e(t,r){if(!this.media){return}var i=this.hls.config,n=i.enableEmsgMetadataCues,a=i.enableID3MetadataCues;if(!n&&!a){return}var s=r.frag,o=r.samples,l=r.details;if(!this.id3Track){this.id3Track=this.createTrack(this.media)}var u=l.edge||s.end;var c=D();var d=false;var f={};for(var h=0;h<o.length;h++){var v=o[h].type;if(v===A["MetadataSchema"].emsg&&!n||!a){continue}var g=S["getID3Frames"](o[h].data);if(g){var p=o[h].pts;var m=u;var y=m-p;if(y<=0){m=p+L}for(var b=0;b<g.length;b++){var T=g[b];if(!S["isTimeStampFrame"](T)){var E=new c(p,m,"");E.value=T;if(v){E.type=v}this.id3Track.addCue(E);f[T.key]=null;d=true}}}}if(d){this.updateId3CueEnds(f)}};t.updateId3CueEnds=function e(t){var r;var i=(r=this.id3Track)===null||r===void 0?void 0:r.cues;if(i){for(var n=i.length;n--;){var a;var s=i[n];var o=(a=s.value)===null||a===void 0?void 0:a.key;if(o&&o in t){var l=t[o];if(l&&s.endTime!==l){s.endTime=l}t[o]=s.startTime}}}};t.onBufferFlushing=function e(t,r){var i=r.startOffset,n=r.endOffset,a=r.type;var s=this.id3Track,o=this.hls;if(!o){return}var l=o.config,u=l.enableEmsgMetadataCues,c=l.enableID3MetadataCues;if(s&&(u||c)){var d;if(a==="audio"){d=function e(t){return t.type===A["MetadataSchema"].audioId3&&c}}else if(a==="video"){d=function e(t){return t.type===A["MetadataSchema"].emsg&&u}}else{d=function e(t){return t.type===A["MetadataSchema"].audioId3&&c||t.type===A["MetadataSchema"].emsg&&u}}Object(f["removeCuesInRange"])(s,i,n,d)}};t.onLevelUpdated=function e(t,r){var p=this;var i=r.details;if(!this.media||!i.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues){return}var m=this.dateRangeCuesAppended,n=this.id3Track;var y=i.dateRanges;var b=Object.keys(y);if(n){var a=Object.keys(m).filter(function(e){return!b.includes(e)});var s=function e(t){var r=a[t];Object.keys(m[r].cues).forEach(function(e){n.removeCue(m[r].cues[e])});delete m[r]};for(var o=a.length;o--;){s(o)}}var l=i.fragments[i.fragments.length-1];if(b.length===0||!Object(d["isFiniteNumber"])(l===null||l===void 0?void 0:l.programDateTime)){return}if(!this.id3Track){this.id3Track=this.createTrack(this.media)}var T=l.programDateTime/1e3-l.start;var E=i.edge||l.end;var S=D();var u=function e(t){var r=b[t];var i=y[r];var n=m[r];var a=(n===null||n===void 0?void 0:n.cues)||{};var s=(n===null||n===void 0?void 0:n.durationKnown)||false;var o=w(i.startDate,T);var l=E;var u=i.endDate;if(u){l=w(u,T);s=true}else if(i.endOnNext&&!s){var c=b.reduce(function(e,t){var r=y[t];if(r.class===i.class&&r.id!==t&&r.startDate>i.startDate){e.push(r)}return e},[]).sort(function(e,t){return e.startDate.getTime()-t.startDate.getTime()})[0];if(c){l=w(c.startDate,T);s=true}}var d=Object.keys(i.attr);for(var f=0;f<d.length;f++){var h=d[f];if(h===k["DateRangeAttribute"].ID||h===k["DateRangeAttribute"].CLASS||h===k["DateRangeAttribute"].START_DATE||h===k["DateRangeAttribute"].DURATION||h===k["DateRangeAttribute"].END_DATE||h===k["DateRangeAttribute"].END_ON_NEXT){continue}var v=a[h];if(v){if(s&&!n.durationKnown){v.endTime=l}}else{var g=i.attr[h];v=new S(o,l,"");if(h===k["DateRangeAttribute"].SCTE35_OUT||h===k["DateRangeAttribute"].SCTE35_IN){g=C(g)}v.value={key:h,data:g};v.type=A["MetadataSchema"].dateRange;p.id3Track.addCue(v);a[h]=v}}m[r]={cues:a,dateRange:i,durationKnown:s}};for(var c=0;c<b.length;c++){u(c)}};return e}();t["default"]=n},"./src/controller/latency-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return l});var i=r("./src/errors.ts");var n=r("./src/events.ts");var a=r("./src/utils/logger.ts");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function o(e,t,r){if(t)s(e.prototype,t);if(r)s(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var l=function(){function e(e){var t=this;this.hls=void 0;this.config=void 0;this.media=null;this.levelDetails=null;this.currentTime=0;this.stallCount=0;this._latency=null;this.timeupdateHandler=function(){return t.timeupdate()};this.hls=e;this.config=e.config;this.registerListeners()}var t=e.prototype;t.destroy=function e(){this.unregisterListeners();this.onMediaDetaching();this.levelDetails=null;this.hls=this.timeupdateHandler=null};t.registerListeners=function e(){this.hls.on(n["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.on(n["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);this.hls.on(n["Events"].MANIFEST_LOADING,this.onManifestLoading,this);this.hls.on(n["Events"].LEVEL_UPDATED,this.onLevelUpdated,this);this.hls.on(n["Events"].ERROR,this.onError,this)};t.unregisterListeners=function e(){this.hls.off(n["Events"].MEDIA_ATTACHED,this.onMediaAttached);this.hls.off(n["Events"].MEDIA_DETACHING,this.onMediaDetaching);this.hls.off(n["Events"].MANIFEST_LOADING,this.onManifestLoading);this.hls.off(n["Events"].LEVEL_UPDATED,this.onLevelUpdated);this.hls.off(n["Events"].ERROR,this.onError)};t.onMediaAttached=function e(t,r){this.media=r.media;this.media.addEventListener("timeupdate",this.timeupdateHandler)};t.onMediaDetaching=function e(){if(this.media){this.media.removeEventListener("timeupdate",this.timeupdateHandler);this.media=null}};t.onManifestLoading=function e(){this.levelDetails=null;this._latency=null;this.stallCount=0};t.onLevelUpdated=function e(t,r){var i=r.details;this.levelDetails=i;if(i.advanced){this.timeupdate()}if(!i.live&&this.media){this.media.removeEventListener("timeupdate",this.timeupdateHandler)}};t.onError=function e(t,r){if(r.details!==i["ErrorDetails"].BUFFER_STALLED_ERROR){return}this.stallCount++;a["logger"].warn("[playback-rate-controller]: Stall detected, adjusting target latency")};t.timeupdate=function e(){var t=this.media,r=this.levelDetails;if(!t||!r){return}this.currentTime=t.currentTime;var i=this.computeLatency();if(i===null){return}this._latency=i;var n=this.config,a=n.lowLatencyMode,s=n.maxLiveSyncPlaybackRate;if(!a||s===1){return}var o=this.targetLatency;if(o===null){return}var l=i-o;var u=Math.min(this.maxLatency,o+r.targetduration);var c=l<u;if(r.live&&c&&l>.05&&this.forwardBufferLength>1){var d=Math.min(2,Math.max(1,s));var f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20;t.playbackRate=Math.min(d,Math.max(1,f))}else if(t.playbackRate!==1&&t.playbackRate!==0){t.playbackRate=1}};t.estimateLiveEdge=function e(){var t=this.levelDetails;if(t===null){return null}return t.edge+t.age};t.computeLatency=function e(){var t=this.estimateLiveEdge();if(t===null){return null}return t-this.currentTime};o(e,[{key:"latency",get:function e(){return this._latency||0}},{key:"maxLatency",get:function e(){var t=this.config,r=this.levelDetails;if(t.liveMaxLatencyDuration!==undefined){return t.liveMaxLatencyDuration}return r?t.liveMaxLatencyDurationCount*r.targetduration:0}},{key:"targetLatency",get:function e(){var t=this.levelDetails;if(t===null){return null}var r=t.holdBack,i=t.partHoldBack,n=t.targetduration;var a=this.config,s=a.liveSyncDuration,o=a.liveSyncDurationCount,l=a.lowLatencyMode;var u=this.hls.userConfig;var c=l?i||r:r;if(u.liveSyncDuration||u.liveSyncDurationCount||c===0){c=s!==undefined?s:o*n}var d=n;var f=1;return c+Math.min(this.stallCount*f,d)}},{key:"liveSyncPosition",get:function e(){var t=this.estimateLiveEdge();var r=this.targetLatency;var i=this.levelDetails;if(t===null||r===null||i===null){return null}var n=i.edge;var a=t-r-this.edgeStalled;var s=n-i.totalduration;var o=n-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(s,a),o)}},{key:"drift",get:function e(){var t=this.levelDetails;if(t===null){return 1}return t.drift}},{key:"edgeStalled",get:function e(){var t=this.levelDetails;if(t===null){return 0}var r=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-r,0)}},{key:"forwardBufferLength",get:function e(){var t=this.media,r=this.levelDetails;if(!t||!r){return 0}var i=t.buffered.length;return(i?t.buffered.end(i-1):r.edge)-this.currentTime}}]);return e}()},"./src/controller/level-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return l});var g=r("./src/types/level.ts");var p=r("./src/events.ts");var m=r("./src/errors.ts");var y=r("./src/utils/codecs.ts");var b=r("./src/controller/level-helper.ts");var i=r("./src/controller/base-playlist-controller.ts");var c=r("./src/types/loader.ts");function d(){d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return d.apply(this,arguments)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function a(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;o(e,t)}function o(e,t){o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return o(e,t)}var T=/chrome|firefox/.test(navigator.userAgent.toLowerCase());var l=function(u){s(e,u);function e(e){var t;t=u.call(this,e,"[level-controller]")||this;t._levels=[];t._firstLevel=-1;t._startLevel=void 0;t.currentLevelIndex=-1;t.manualLevelIndex=-1;t.onParsedComplete=void 0;t._registerListeners();return t}var t=e.prototype;t._registerListeners=function e(){var t=this.hls;t.on(p["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);t.on(p["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.on(p["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);t.on(p["Events"].FRAG_LOADED,this.onFragLoaded,this);t.on(p["Events"].ERROR,this.onError,this)};t._unregisterListeners=function e(){var t=this.hls;t.off(p["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);t.off(p["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.off(p["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);t.off(p["Events"].FRAG_LOADED,this.onFragLoaded,this);t.off(p["Events"].ERROR,this.onError,this)};t.destroy=function e(){this._unregisterListeners();this.manualLevelIndex=-1;this._levels.length=0;u.prototype.destroy.call(this)};t.startLoad=function e(){var t=this._levels;t.forEach(function(e){e.loadError=0});u.prototype.startLoad.call(this)};t.onManifestLoaded=function e(t,r){var i=[];var n=[];var a=[];var s;var o={};var l;var u=false;var c=false;var d=false;r.levels.forEach(function(e){var t=e.attrs;u=u||!!(e.width&&e.height);c=c||!!e.videoCodec;d=d||!!e.audioCodec;if(T&&e.audioCodec&&e.audioCodec.indexOf("mp4a.40.34")!==-1){e.audioCodec=undefined}var r=e.bitrate+"-"+e.attrs.RESOLUTION+"-"+e.attrs.CODECS;l=o[r];if(!l){l=new g["Level"](e);o[r]=l;i.push(l)}else{l.url.push(e.url)}if(t){if(t.AUDIO){Object(b["addGroupId"])(l,"audio",t.AUDIO)}if(t.SUBTITLES){Object(b["addGroupId"])(l,"text",t.SUBTITLES)}}});if((u||c)&&d){i=i.filter(function(e){var t=e.videoCodec,r=e.width,i=e.height;return!!t||!!(r&&i)})}i=i.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||Object(y["isCodecSupportedInMp4"])(t,"audio"))&&(!r||Object(y["isCodecSupportedInMp4"])(r,"video"))});if(r.audioTracks){n=r.audioTracks.filter(function(e){return!e.audioCodec||Object(y["isCodecSupportedInMp4"])(e.audioCodec,"audio")});Object(b["assignTrackIdsByGroup"])(n)}if(r.subtitles){a=r.subtitles;Object(b["assignTrackIdsByGroup"])(a)}if(i.length>0){s=i[0].bitrate;i.sort(function(e,t){return e.bitrate-t.bitrate});this._levels=i;for(var f=0;f<i.length;f++){if(i[f].bitrate===s){this._firstLevel=f;this.log("manifest loaded, "+i.length+" level(s) found, first bitrate: "+s);break}}var h=d&&!c;var v={levels:i,audioTracks:n,subtitleTracks:a,firstLevel:this._firstLevel,stats:r.stats,audio:d,video:c,altAudio:!h&&n.some(function(e){return!!e.url})};this.hls.trigger(p["Events"].MANIFEST_PARSED,v);if(this.hls.config.autoStartLoad||this.hls.forceStartLoad){this.hls.startLoad(this.hls.config.startPosition)}}else{this.hls.trigger(p["Events"].ERROR,{type:m["ErrorTypes"].MEDIA_ERROR,details:m["ErrorDetails"].MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:true,url:r.url,reason:"no level with compatible codecs found in manifest"})}};t.onError=function e(t,r){u.prototype.onError.call(this,t,r);if(r.fatal){return}var i=r.context;var n=this._levels[this.currentLevelIndex];if(i&&(i.type===c["PlaylistContextType"].AUDIO_TRACK&&n.audioGroupIds&&i.groupId===n.audioGroupIds[n.urlId]||i.type===c["PlaylistContextType"].SUBTITLE_TRACK&&n.textGroupIds&&i.groupId===n.textGroupIds[n.urlId])){this.redundantFailover(this.currentLevelIndex);return}var a=false;var s=true;var o;switch(r.details){case m["ErrorDetails"].FRAG_LOAD_ERROR:case m["ErrorDetails"].FRAG_LOAD_TIMEOUT:case m["ErrorDetails"].KEY_LOAD_ERROR:case m["ErrorDetails"].KEY_LOAD_TIMEOUT:if(r.frag){var l=this._levels[r.frag.level];if(l){l.fragmentError++;if(l.fragmentError>this.hls.config.fragLoadingMaxRetry){o=r.frag.level}}else{o=r.frag.level}}break;case m["ErrorDetails"].LEVEL_LOAD_ERROR:case m["ErrorDetails"].LEVEL_LOAD_TIMEOUT:if(i){if(i.deliveryDirectives){s=false}o=i.level}a=true;break;case m["ErrorDetails"].REMUX_ALLOC_ERROR:o=r.level;a=true;break}if(o!==undefined){this.recoverLevel(r,o,a,s)}};t.recoverLevel=function e(t,r,i,n){var a=t.details;var s=this._levels[r];s.loadError++;if(i){var o=this.retryLoadingOrFail(t);if(o){t.levelRetry=true}else{this.currentLevelIndex=-1;return}}if(n){var l=s.url.length;if(l>1&&s.loadError<l){t.levelRetry=true;this.redundantFailover(r)}else if(this.manualLevelIndex===-1){var u=r===0?this._levels.length-1:r-1;if(this.currentLevelIndex!==u&&this._levels[u].loadError===0){this.warn(a+": switch to "+u);t.levelRetry=true;this.hls.nextAutoLevel=u}}}};t.redundantFailover=function e(t){var r=this._levels[t];var i=r.url.length;if(i>1){var n=(r.urlId+1)%i;this.warn("Switching to redundant URL-id "+n);this._levels.forEach(function(e){e.urlId=n});this.level=t}};t.onFragLoaded=function e(t,r){var i=r.frag;if(i!==undefined&&i.type===c["PlaylistLevelType"].MAIN){var n=this._levels[i.level];if(n!==undefined){n.fragmentError=0;n.loadError=0}}};t.onLevelLoaded=function e(t,r){var i;var n=r.level,a=r.details;var s=this._levels[n];if(!s){var o;this.warn("Invalid level index "+n);if((o=r.deliveryDirectives)!==null&&o!==void 0&&o.skip){a.deltaUpdateFailed=true}return}if(n===this.currentLevelIndex){if(s.fragmentError===0){s.loadError=0;this.retryCount=0}this.playlistLoaded(n,r,s.details)}else if((i=r.deliveryDirectives)!==null&&i!==void 0&&i.skip){a.deltaUpdateFailed=true}};t.onAudioTrackSwitched=function e(t,r){var i=this.hls.levels[this.currentLevelIndex];if(!i){return}if(i.audioGroupIds){var n=-1;var a=this.hls.audioTracks[r.id].groupId;for(var s=0;s<i.audioGroupIds.length;s++){if(i.audioGroupIds[s]===a){n=s;break}}if(n!==i.urlId){i.urlId=n;this.startLoad()}}};t.loadPlaylist=function e(t){var r=this.currentLevelIndex;var i=this._levels[r];if(this.canLoad&&i&&i.url.length>0){var n=i.urlId;var a=i.url[n];if(t){try{a=t.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}}this.log("Attempt loading level index "+r+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+n+" "+a);this.clearTimer();this.hls.trigger(p["Events"].LEVEL_LOADING,{url:a,level:r,id:n,deliveryDirectives:t||null})}};t.removeLevel=function e(r,i){var n=function e(t,r){return r!==i};var t=this._levels.filter(function(e,t){if(t!==r){return true}if(e.url.length>1&&i!==undefined){e.url=e.url.filter(n);if(e.audioGroupIds){e.audioGroupIds=e.audioGroupIds.filter(n)}if(e.textGroupIds){e.textGroupIds=e.textGroupIds.filter(n)}e.urlId=0;return true}return false}).map(function(e,t){var r=e.details;if(r!==null&&r!==void 0&&r.fragments){r.fragments.forEach(function(e){e.level=t})}return e});this._levels=t;this.hls.trigger(p["Events"].LEVELS_UPDATED,{levels:t})};a(e,[{key:"levels",get:function e(){if(this._levels.length===0){return null}return this._levels}},{key:"level",get:function e(){return this.currentLevelIndex},set:function e(t){var r;var i=this._levels;if(i.length===0){return}if(this.currentLevelIndex===t&&(r=i[t])!==null&&r!==void 0&&r.details){return}if(t<0||t>=i.length){var n=t<0;this.hls.trigger(p["Events"].ERROR,{type:m["ErrorTypes"].OTHER_ERROR,details:m["ErrorDetails"].LEVEL_SWITCH_ERROR,level:t,fatal:n,reason:"invalid level idx"});if(n){return}t=Math.min(t,i.length-1)}this.clearTimer();var a=this.currentLevelIndex;var s=i[a];var o=i[t];this.log("switching to level "+t+" from "+a);this.currentLevelIndex=t;var l=d({},o,{level:t,maxBitrate:o.maxBitrate,uri:o.uri,urlId:o.urlId});delete l._urlId;this.hls.trigger(p["Events"].LEVEL_SWITCHING,l);var u=o.details;if(!u||u.live){var c=this.switchParams(o.uri,s===null||s===void 0?void 0:s.details);this.loadPlaylist(c)}}},{key:"manualLevel",get:function e(){return this.manualLevelIndex},set:function e(t){this.manualLevelIndex=t;if(this._startLevel===undefined){this._startLevel=t}if(t!==-1){this.level=t}}},{key:"firstLevel",get:function e(){return this._firstLevel},set:function e(t){this._firstLevel=t}},{key:"startLevel",get:function e(){if(this._startLevel===undefined){var t=this.hls.config.startLevel;if(t!==undefined){return t}else{return this._firstLevel}}else{return this._startLevel}},set:function e(t){this._startLevel=t}},{key:"nextLoadLevel",get:function e(){if(this.manualLevelIndex!==-1){return this.manualLevelIndex}else{return this.hls.nextAutoLevel}},set:function e(t){this.level=t;if(this.manualLevelIndex===-1){this.hls.nextAutoLevel=t}}}]);return e}(i["default"])},"./src/controller/level-helper.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"addGroupId",function(){return i});r.d(t,"assignTrackIdsByGroup",function(){return s});r.d(t,"updatePTS",function(){return o});r.d(t,"updateFragPTSDTS",function(){return v});r.d(t,"mergeDetails",function(){return l});r.d(t,"mapPartIntersection",function(){return p});r.d(t,"mapFragmentIntersection",function(){return T});r.d(t,"adjustSliding",function(){return E});r.d(t,"addSliding",function(){return u});r.d(t,"computeReloadInterval",function(){return c});r.d(t,"getFragmentWithSN",function(){return d});r.d(t,"getPartWith",function(){return f});var m=r("./src/polyfills/number.ts");var y=r("./src/utils/logger.ts");var n=r("./src/loader/date-range.ts");function a(){a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return a.apply(this,arguments)}function i(e,t,r){switch(t){case"audio":if(!e.audioGroupIds){e.audioGroupIds=[]}e.audioGroupIds.push(r);break;case"text":if(!e.textGroupIds){e.textGroupIds=[]}e.textGroupIds.push(r);break}}function s(e){var r={};e.forEach(function(e){var t=e.groupId||"";e.id=r[t]=r[t]||0;r[t]++})}function o(e,t,r){var i=e[t];var n=e[r];b(i,n)}function b(e,t){var r=t.startPTS;if(Object(m["isFiniteNumber"])(r)){var i=0;var n;if(t.sn>e.sn){i=r-e.start;n=e}else{i=e.start-r;n=t}if(n.duration!==i){n.duration=i}}else if(t.sn>e.sn){var a=e.cc===t.cc;if(a&&e.minEndPTS){t.start=e.start+(e.minEndPTS-e.start)}else{t.start=e.start+e.duration}}else{t.start=Math.max(e.start-t.duration,0)}}function v(e,t,r,i,n,a){var s=i-r;if(s<=0){y["logger"].warn("Fragment should have a positive duration",t);i=r+t.duration;a=n+t.duration}var o=r;var l=i;var u=t.startPTS;var c=t.endPTS;if(Object(m["isFiniteNumber"])(u)){var d=Math.abs(u-r);if(!Object(m["isFiniteNumber"])(t.deltaPTS)){t.deltaPTS=d}else{t.deltaPTS=Math.max(d,t.deltaPTS)}o=Math.max(r,u);r=Math.min(r,u);n=Math.min(n,t.startDTS);l=Math.min(i,c);i=Math.max(i,c);a=Math.max(a,t.endDTS)}t.duration=i-r;var f=r-t.start;t.appendedPTS=i;t.start=t.startPTS=r;t.maxStartPTS=o;t.startDTS=n;t.endPTS=i;t.minEndPTS=l;t.endDTS=a;var h=t.sn;if(!e||h<e.startSN||h>e.endSN){return 0}var v;var g=h-e.startSN;var p=e.fragments;p[g]=t;for(v=g;v>0;v--){b(p[v],p[v-1])}for(v=g;v<p.length-1;v++){b(p[v],p[v+1])}if(e.fragmentHint){b(p[p.length-1],e.fragmentHint)}e.PTSKnown=e.alignedSliding=true;return f}function l(e,r){var i=null;var t=e.fragments;for(var n=t.length-1;n>=0;n--){var a=t[n].initSegment;if(a){i=a;break}}if(e.fragmentHint){delete e.fragmentHint.endPTS}var s=0;var o;T(e,r,function(e,t){if(e.relurl){s=e.cc-t.cc}if(Object(m["isFiniteNumber"])(e.startPTS)&&Object(m["isFiniteNumber"])(e.endPTS)){t.start=t.startPTS=e.startPTS;t.startDTS=e.startDTS;t.appendedPTS=e.appendedPTS;t.maxStartPTS=e.maxStartPTS;t.endPTS=e.endPTS;t.endDTS=e.endDTS;t.minEndPTS=e.minEndPTS;t.duration=e.endPTS-e.startPTS;if(t.duration){o=t}r.PTSKnown=r.alignedSliding=true}t.elementaryStreams=e.elementaryStreams;t.loader=e.loader;t.stats=e.stats;t.urlId=e.urlId;if(e.initSegment){t.initSegment=e.initSegment;i=e.initSegment}});if(i){var l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;l.forEach(function(e){var t;if(!e.initSegment||e.initSegment.relurl===((t=i)===null||t===void 0?void 0:t.relurl)){e.initSegment=i}})}if(r.skippedSegments){r.deltaUpdateFailed=r.fragments.some(function(e){return!e});if(r.deltaUpdateFailed){y["logger"].warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=r.skippedSegments;u--;){r.fragments.shift()}r.startSN=r.fragments[0].sn;r.startCC=r.fragments[0].cc}else if(r.canSkipDateRanges){r.dateRanges=g(e.dateRanges,r.dateRanges,r.recentlyRemovedDateranges)}}var c=r.fragments;if(s){y["logger"].warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<c.length;d++){c[d].cc+=s}}if(r.skippedSegments){r.startCC=r.fragments[0].cc}p(e.partList,r.partList,function(e,t){t.elementaryStreams=e.elementaryStreams;t.stats=e.stats});if(o){v(r,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS)}else{E(e,r)}if(c.length){r.totalduration=r.edge-c[0].start}r.driftStartTime=e.driftStartTime;r.driftStart=e.driftStart;var f=r.advancedDateTime;if(r.advanced&&f){var h=r.edge;if(!r.driftStart){r.driftStartTime=f;r.driftStart=h}r.driftEndTime=f;r.driftEnd=h}else{r.driftEndTime=e.driftEndTime;r.driftEnd=e.driftEnd;r.advancedDateTime=e.advancedDateTime}}function g(e,r,t){var i=a({},e);if(t){t.forEach(function(e){delete i[e]})}Object.keys(r).forEach(function(e){var t=new n["DateRange"](r[e].attr,i[e]);if(t.isValid){i[e]=t}else{y["logger"].warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[e].attr)+'"')}});return i}function p(e,t,r){if(e&&t){var i=0;for(var n=0,a=e.length;n<=a;n++){var s=e[n];var o=t[n+i];if(s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn){r(s,o)}else{i--}}}}function T(e,t,r){var i=t.skippedSegments;var n=Math.max(e.startSN,t.startSN)-t.startSN;var a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN;var s=t.startSN-e.startSN;var o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;var l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(var u=n;u<=a;u++){var c=l[s+u];var d=o[u];if(i&&!d&&u<i){d=t.fragments[u]=c}if(c&&d){r(c,d)}}}function E(e,t){var r=t.startSN+t.skippedSegments-e.startSN;var i=e.fragments;if(r<0||r>=i.length){return}u(t,i[r].start)}function u(e,t){if(t){var r=e.fragments;for(var i=e.skippedSegments;i<r.length;i++){r[i].start+=t}if(e.fragmentHint){e.fragmentHint.start+=t}}}function c(e,t){var r=1e3*e.levelTargetDuration;var i=r/2;var n=e.age;var a=n>0&&n<r*3;var s=t.loading.end-t.loading.start;var o;var l=e.availabilityDelay;if(e.updated===false){if(a){var u=333*e.misses;o=Math.max(Math.min(i,s*2),u);e.availabilityDelay=(e.availabilityDelay||0)+o}else{o=i}}else if(a){l=Math.min(l||r/2,n);e.availabilityDelay=l;o=l+r-n}else{o=r-s}return Math.round(o)}function d(e,t,r){if(!e||!e.details){return null}var i=e.details;var n=i.fragments[t-i.startSN];if(n){return n}n=i.fragmentHint;if(n&&n.sn===t){return n}if(t<i.startSN&&r&&r.sn===t){return r}return null}function f(e,t,r){if(!e||!e.details){return null}var i=e.details.partList;if(i){for(var n=i.length;n--;){var a=i[n];if(a.index===r&&a.fragment.sn===t){return a}}}return null}},"./src/controller/stream-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return f});var O=r("./src/polyfills/number.ts");var P=r("./src/controller/base-stream-controller.ts");var o=r("./src/is-supported.ts");var x=r("./src/events.ts");var l=r("./src/utils/buffer-helper.ts");var S=r("./src/controller/fragment-tracker.ts");var k=r("./src/types/loader.ts");var M=r("./src/loader/fragment.ts");var y=r("./src/demux/transmuxer-interface.ts");var b=r("./src/types/transmuxer.ts");var n=r("./src/controller/gap-controller.ts");var a=r("./src/errors.ts");function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function u(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function c(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;s(e,t)}function s(e,t){s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return s(e,t)}var d=100;var f=function(s){c(e,s);function e(e,t){var r;r=s.call(this,e,t,"[stream-controller]")||this;r.audioCodecSwap=false;r.gapController=null;r.level=-1;r._forceStartLoad=false;r.altAudio=false;r.audioOnly=false;r.fragPlaying=null;r.onvplaying=null;r.onvseeked=null;r.fragLastKbps=0;r.couldBacktrack=false;r.backtrackFragment=null;r.audioCodecSwitch=false;r.videoBuffer=null;r._registerListeners();return r}var t=e.prototype;t._registerListeners=function e(){var t=this.hls;t.on(x["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.on(x["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.on(x["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.on(x["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.on(x["Events"].LEVEL_LOADING,this.onLevelLoading,this);t.on(x["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.on(x["Events"].FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this);t.on(x["Events"].ERROR,this.onError,this);t.on(x["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);t.on(x["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);t.on(x["Events"].BUFFER_CREATED,this.onBufferCreated,this);t.on(x["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);t.on(x["Events"].LEVELS_UPDATED,this.onLevelsUpdated,this);t.on(x["Events"].FRAG_BUFFERED,this.onFragBuffered,this)};t._unregisterListeners=function e(){var t=this.hls;t.off(x["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.off(x["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.off(x["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(x["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.off(x["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.off(x["Events"].FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this);t.off(x["Events"].ERROR,this.onError,this);t.off(x["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);t.off(x["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);t.off(x["Events"].BUFFER_CREATED,this.onBufferCreated,this);t.off(x["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);t.off(x["Events"].LEVELS_UPDATED,this.onLevelsUpdated,this);t.off(x["Events"].FRAG_BUFFERED,this.onFragBuffered,this)};t.onHandlerDestroying=function e(){this._unregisterListeners();this.onMediaDetaching()};t.startLoad=function e(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;this.stopLoad();this.setInterval(d);this.level=-1;this.fragLoadError=0;if(!this.startFragRequested){var n=i.startLevel;if(n===-1){if(i.config.testBandwidth){n=0;this.bitrateTest=true}else{n=i.nextAutoLevel}}this.level=i.nextLoadLevel=n;this.loadedmetadata=false}if(r>0&&t===-1){this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3));t=r}this.state=P["State"].IDLE;this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t;this.tick()}else{this._forceStartLoad=true;this.state=P["State"].STOPPED}};t.stopLoad=function e(){this._forceStartLoad=false;s.prototype.stopLoad.call(this)};t.doTick=function e(){switch(this.state){case P["State"].IDLE:this.doTickIdle();break;case P["State"].WAITING_LEVEL:{var t;var r=this.levels,i=this.level;var n=r===null||r===void 0?void 0:(t=r[i])===null||t===void 0?void 0:t.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n)){break}this.state=P["State"].IDLE;break}break}case P["State"].FRAG_LOADING_WAITING_RETRY:{var a;var s=self.performance.now();var o=this.retryDate;if(!o||s>=o||(a=this.media)!==null&&a!==void 0&&a.seeking){this.log("retryDate reached, switch back to IDLE state");this.state=P["State"].IDLE}}break;default:break}this.onTickEnd()};t.onTickEnd=function e(){s.prototype.onTickEnd.call(this);this.checkBuffer();this.checkFragmentChanged()};t.doTickIdle=function e(){var t,r;var i=this.hls,n=this.levelLastLoaded,a=this.levels,s=this.media;var o=i.config,l=i.nextLoadLevel;if(n===null||!s&&(this.startFragRequested||!o.startFragPrefetch)){return}if(this.altAudio&&this.audioOnly){return}if(!a||!a[l]){return}var u=a[l];this.level=i.nextLoadLevel=l;var c=u.details;if(!c||this.state===P["State"].WAITING_LEVEL||c.live&&this.levelLastLoaded!==l){this.state=P["State"].WAITING_LEVEL;return}var d=this.getMainFwdBufferInfo();if(d===null){return}var f=d.len;var h=this.getMaxBufferLength(u.maxBitrate);if(f>=h){return}if(this._streamEnded(d,c)){var v={};if(this.altAudio){v.type="video"}this.hls.trigger(x["Events"].BUFFER_EOS,v);this.state=P["State"].ENDED;return}if(this.backtrackFragment&&this.backtrackFragment.start>d.end){this.backtrackFragment=null}var g=this.backtrackFragment?this.backtrackFragment.start:d.end;var p=this.getNextFragment(g,c);if(this.couldBacktrack&&!this.fragPrevious&&p&&p.sn!=="initSegment"&&this.fragmentTracker.getState(p)!==S["FragmentState"].OK){var m;var y=((m=this.backtrackFragment)!=null?m:p).sn;var b=y-c.startSN;var T=c.fragments[b-1];if(T&&p.cc===T.cc){p=T;this.fragmentTracker.removeFragment(T)}}else if(this.backtrackFragment&&d.len){this.backtrackFragment=null}if(p&&this.fragmentTracker.getState(p)===S["FragmentState"].OK&&this.nextLoadPosition>g){var E=this.audioOnly&&!this.altAudio?M["ElementaryStreamTypes"].AUDIO:M["ElementaryStreamTypes"].VIDEO;this.afterBufferFlushed(s,E,k["PlaylistLevelType"].MAIN);p=this.getNextFragment(this.nextLoadPosition,c)}if(!p){return}if(p.initSegment&&!p.initSegment.data&&!this.bitrateTest){p=p.initSegment}if(((t=p.decryptdata)===null||t===void 0?void 0:t.keyFormat)==="identity"&&!((r=p.decryptdata)!==null&&r!==void 0&&r.key)){this.loadKey(p,c)}else{this.loadFragment(p,c,g)}};t.loadFragment=function e(t,r,i){var n;var a=this.fragmentTracker.getState(t);this.fragCurrent=t;if(a===S["FragmentState"].NOT_LOADED||a===S["FragmentState"].PARTIAL){if(t.sn==="initSegment"){this._loadInitSegment(t)}else if(this.bitrateTest){t.bitrateTest=true;this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered");this._loadBitrateTestFrag(t)}else{this.startFragRequested=true;s.prototype.loadFragment.call(this,t,r,i)}}else if(a===S["FragmentState"].APPENDING){if(this.reduceMaxBufferLength(t.duration)){this.fragmentTracker.removeFragment(t)}}else if(((n=this.media)===null||n===void 0?void 0:n.buffered.length)===0){this.fragmentTracker.removeAllFragments()}};t.getAppendedFrag=function e(t){var r=this.fragmentTracker.getAppendedFrag(t,k["PlaylistLevelType"].MAIN);if(r&&"fragment"in r){return r.fragment}return r};t.getBufferedFrag=function e(t){return this.fragmentTracker.getBufferedFrag(t,k["PlaylistLevelType"].MAIN)};t.followingBufferedFrag=function e(t){if(t){return this.getBufferedFrag(t.end+.5)}return null};t.immediateLevelSwitch=function e(){this.abortCurrentFrag();this.flushMainBuffer(0,Number.POSITIVE_INFINITY)};t.nextLevelSwitch=function e(){var t=this.levels,r=this.media;if(r!==null&&r!==void 0&&r.readyState){var i;var n=this.getAppendedFrag(r.currentTime);if(n&&n.start>1){this.flushMainBuffer(0,n.start-1)}if(!r.paused&&t){var a=this.hls.nextLoadLevel;var s=t[a];var o=this.fragLastKbps;if(o&&this.fragCurrent){i=this.fragCurrent.duration*s.maxBitrate/(1e3*o)+1}else{i=0}}else{i=0}var l=this.getBufferedFrag(r.currentTime+i);if(l){var u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();var c=u.maxStartPTS?u.maxStartPTS:u.start;var d=u.duration;var f=Math.max(l.end,c+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*.5),d*.75));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}};t.abortCurrentFrag=function e(){var t=this.fragCurrent;this.fragCurrent=null;this.backtrackFragment=null;if(t!==null&&t!==void 0&&t.loader){t.loader.abort()}switch(this.state){case P["State"].KEY_LOADING:case P["State"].FRAG_LOADING:case P["State"].FRAG_LOADING_WAITING_RETRY:case P["State"].PARSING:case P["State"].PARSED:this.state=P["State"].IDLE;break}this.nextLoadPosition=this.getLoadPosition()};t.flushMainBuffer=function e(t,r){s.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)};t.onMediaAttached=function e(t,r){s.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);i.addEventListener("playing",this.onvplaying);i.addEventListener("seeked",this.onvseeked);this.gapController=new n["default"](this.config,i,this.fragmentTracker,this.hls)};t.onMediaDetaching=function e(){var t=this.media;if(t){t.removeEventListener("playing",this.onvplaying);t.removeEventListener("seeked",this.onvseeked);this.onvplaying=this.onvseeked=null;this.videoBuffer=null}this.fragPlaying=null;if(this.gapController){this.gapController.destroy();this.gapController=null}s.prototype.onMediaDetaching.call(this)};t.onMediaPlaying=function e(){this.tick()};t.onMediaSeeked=function e(){var t=this.media;var r=t?t.currentTime:null;if(Object(O["isFiniteNumber"])(r)){this.log("Media seeked to "+r.toFixed(3))}this.tick()};t.onManifestLoading=function e(){this.log("Trigger BUFFER_RESET");this.hls.trigger(x["Events"].BUFFER_RESET,undefined);this.fragmentTracker.removeAllFragments();this.couldBacktrack=false;this.startPosition=this.lastCurrentTime=0;this.fragPlaying=null;this.backtrackFragment=null};t.onManifestParsed=function e(t,r){var i=false;var n=false;var a;r.levels.forEach(function(e){a=e.audioCodec;if(a){if(a.indexOf("mp4a.40.2")!==-1){i=true}if(a.indexOf("mp4a.40.5")!==-1){n=true}}});this.audioCodecSwitch=i&&n&&!Object(o["changeTypeSupported"])();if(this.audioCodecSwitch){this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC")}this.levels=r.levels;this.startFragRequested=false};t.onLevelLoading=function e(t,r){var i=this.levels;if(!i||this.state!==P["State"].IDLE){return}var n=i[r.level];if(!n.details||n.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(n.details)){this.state=P["State"].WAITING_LEVEL}};t.onLevelLoaded=function e(t,r){var i;var n=this.levels;var a=r.level;var s=r.details;var o=s.totalduration;if(!n){this.warn("Levels were reset while loading level "+a);return}this.log("Level "+a+" loaded ["+s.startSN+","+s.endSN+"], cc ["+s.startCC+", "+s.endCC+"] duration:"+o);var l=this.fragCurrent;if(l&&(this.state===P["State"].FRAG_LOADING||this.state===P["State"].FRAG_LOADING_WAITING_RETRY)){if(l.level!==r.level&&l.loader){this.state=P["State"].IDLE;this.backtrackFragment=null;l.loader.abort()}}var u=n[a];var c=0;if(s.live||(i=u.details)!==null&&i!==void 0&&i.live){if(!s.fragments[0]){s.deltaUpdateFailed=true}if(s.deltaUpdateFailed){return}c=this.alignPlaylists(s,u.details)}u.details=s;this.levelLastLoaded=a;this.hls.trigger(x["Events"].LEVEL_UPDATED,{details:s,level:a});if(this.state===P["State"].WAITING_LEVEL){if(this.waitForCdnTuneIn(s)){return}this.state=P["State"].IDLE}if(!this.startFragRequested){this.setStartPosition(s,c)}else if(s.live){this.synchronizeToLiveEdge(s)}this.tick()};t._handleFragmentLoadProgress=function e(t){var r;var i=t.frag,n=t.part,a=t.payload;var s=this.levels;if(!s){this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var o=s[i.level];var l=o.details;if(!l){this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset");return}var u=o.videoCodec;var c=l.PTSKnown||!l.live;var d=(r=i.initSegment)===null||r===void 0?void 0:r.data;var f=this._getAudioCodec(o);var h=this.transmuxer=this.transmuxer||new y["default"](this.hls,k["PlaylistLevelType"].MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this));var v=n?n.index:-1;var g=v!==-1;var p=new b["ChunkMetadata"](i.level,i.sn,i.stats.chunkCount,a.byteLength,v,g);var m=this.initPTS[i.cc];h.push(a,d,f,u,i,n,l.totalduration,c,p,m)};t.onAudioTrackSwitching=function e(t,r){var i=this.altAudio;var n=!!r.url;var a=r.id;if(!n){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading");this.mediaBuffer=this.media;var s=this.fragCurrent;if(s!==null&&s!==void 0&&s.loader){this.log("Switching to main audio track, cancel main fragment load");s.loader.abort()}this.resetTransmuxer();this.resetLoadingState()}else if(this.audioOnly){this.resetTransmuxer()}var o=this.hls;if(i){o.trigger(x["Events"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}o.trigger(x["Events"].AUDIO_TRACK_SWITCHED,{id:a})}};t.onAudioTrackSwitched=function e(t,r){var i=r.id;var n=!!this.hls.audioTracks[i].url;if(n){var a=this.videoBuffer;if(a&&this.mediaBuffer!==a){this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading");this.mediaBuffer=a}}this.altAudio=n;this.tick()};t.onBufferCreated=function e(t,r){var i=r.tracks;var n;var a;var s=false;for(var o in i){var l=i[o];if(l.id==="main"){a=o;n=l;if(o==="video"){var u=i[o];if(u){this.videoBuffer=u.buffer}}}else{s=true}}if(s&&n){this.log("Alternate track found, use "+a+".buffered to schedule main fragment loading");this.mediaBuffer=n.buffer}else{this.mediaBuffer=this.media}};t.onFragBuffered=function e(t,r){var i=r.frag,n=r.part;if(i&&i.type!==k["PlaylistLevelType"].MAIN){return}if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state);if(this.state===P["State"].PARSED){this.state=P["State"].IDLE}return}var a=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first));if(i.sn!=="initSegment"){this.fragPrevious=i}this.fragBufferedComplete(i,n)};t.onError=function e(t,r){switch(r.details){case a["ErrorDetails"].FRAG_LOAD_ERROR:case a["ErrorDetails"].FRAG_LOAD_TIMEOUT:case a["ErrorDetails"].KEY_LOAD_ERROR:case a["ErrorDetails"].KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(k["PlaylistLevelType"].MAIN,r);break;case a["ErrorDetails"].LEVEL_LOAD_ERROR:case a["ErrorDetails"].LEVEL_LOAD_TIMEOUT:if(this.state!==P["State"].ERROR){if(r.fatal){this.warn(""+r.details);this.state=P["State"].ERROR}else{if(!r.levelRetry&&this.state===P["State"].WAITING_LEVEL){this.state=P["State"].IDLE}}}break;case a["ErrorDetails"].BUFFER_FULL_ERROR:if(r.parent==="main"&&(this.state===P["State"].PARSING||this.state===P["State"].PARSED)){var i=true;var n=this.getFwdBufferInfo(this.media,k["PlaylistLevelType"].MAIN);if(n&&n.len>.5){i=!this.reduceMaxBufferLength(n.len)}if(i){this.warn("buffer full error also media.currentTime is not buffered, flush main");this.immediateLevelSwitch()}this.resetLoadingState()}break;default:break}};t.checkBuffer=function e(){var t=this.media,r=this.gapController;if(!t||!r||!t.readyState){return}var i=l["BufferHelper"].getBuffered(t);if(!this.loadedmetadata&&i.length){this.loadedmetadata=true;this.seekToStartPos()}else{var n=this.state!==P["State"].IDLE?this.fragCurrent:null;r.poll(this.lastCurrentTime,n)}this.lastCurrentTime=t.currentTime};t.onFragLoadEmergencyAborted=function e(){this.state=P["State"].IDLE;if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition}this.tickImmediate()};t.onBufferFlushed=function e(t,r){var i=r.type;if(i!==M["ElementaryStreamTypes"].AUDIO||this.audioOnly&&!this.altAudio){var n=(i===M["ElementaryStreamTypes"].VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,i,k["PlaylistLevelType"].MAIN)}};t.onLevelsUpdated=function e(t,r){this.levels=r.levels};t.swapAudioCodec=function e(){this.audioCodecSwap=!this.audioCodecSwap};t.seekToStartPos=function e(){var t=this.media;var r=t.currentTime;var i=this.startPosition;if(i>=0&&r<i){if(t.seeking){this.log("could not seek to "+i+", already seeking at "+r);return}var n=l["BufferHelper"].getBuffered(t);var a=n.length?n.start(0):0;var s=a-i;if(s>0&&(s<this.config.maxBufferHole||s<this.config.maxFragLookUpTolerance)){this.log("adjusting start position by "+s+" to match buffer start");i+=s;this.startPosition=i}this.log("seek to target start position "+i+" from current time "+r);t.currentTime=i}};t._getAudioCodec=function e(t){var r=this.config.defaultAudioCodec||t.audioCodec;if(this.audioCodecSwap&&r){this.log("Swapping audio codec");if(r.indexOf("mp4a.40.5")!==-1){r="mp4a.40.2"}else{r="mp4a.40.5"}}return r};t._loadBitrateTestFrag=function e(i){var n=this;this._doFragLoad(i).then(function(e){var t=n.hls;if(!e||t.nextLoadLevel||n.fragContextChanged(i)){return}n.fragLoadError=0;n.state=P["State"].IDLE;n.startFragRequested=false;n.bitrateTest=false;var r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now();t.trigger(x["Events"].FRAG_LOADED,e)})};t._handleTransmuxComplete=function e(t){var r;var i="main";var n=this.hls;var a=t.remuxResult,s=t.chunkMeta;var o=this.getCurrentContext(s);if(!o){this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered.");this.resetLiveStartWhenNotLoaded(s.level);return}var l=o.frag,u=o.part,c=o.level;var d=a.video,f=a.text,h=a.id3,v=a.initSegment;var g=c.details;var p=this.altAudio?undefined:a.audio;if(this.fragContextChanged(l)){return}this.state=P["State"].PARSING;if(v){if(v.tracks){this._bufferInitSegment(c,v.tracks,l,s);n.trigger(x["Events"].FRAG_PARSING_INIT_SEGMENT,{frag:l,id:i,tracks:v.tracks})}var m=v.initPTS;var y=v.timescale;if(Object(O["isFiniteNumber"])(m)){this.initPTS[l.cc]=m;n.trigger(x["Events"].INIT_PTS_FOUND,{frag:l,id:i,initPTS:m,timescale:y})}}if(d&&a.independent!==false){if(g){var b=d.startPTS,T=d.endPTS,E=d.startDTS,S=d.endDTS;if(u){u.elementaryStreams[d.type]={startPTS:b,endPTS:T,startDTS:E,endDTS:S}}else{if(d.firstKeyFrame&&d.independent){this.couldBacktrack=true}if(d.dropped&&d.independent){var k=this.getMainFwdBufferInfo();var A=(k?k.end:this.getLoadPosition())+this.config.maxBufferHole;var L=d.firstKeyFramePTS?d.firstKeyFramePTS:b;if(A<L-this.config.maxBufferHole){this.backtrack(l);return}l.setElementaryStreamInfo(d.type,l.start,T,l.start,S,true)}}l.setElementaryStreamInfo(d.type,b,T,E,S);if(this.backtrackFragment){this.backtrackFragment=l}this.bufferFragmentData(d,l,u,s)}}else if(a.independent===false){this.backtrack(l);return}if(p){var D=p.startPTS,w=p.endPTS,C=p.startDTS,R=p.endDTS;if(u){u.elementaryStreams[M["ElementaryStreamTypes"].AUDIO]={startPTS:D,endPTS:w,startDTS:C,endDTS:R}}l.setElementaryStreamInfo(M["ElementaryStreamTypes"].AUDIO,D,w,C,R);this.bufferFragmentData(p,l,u,s)}if(g&&h!==null&&h!==void 0&&(r=h.samples)!==null&&r!==void 0&&r.length){var I={id:i,frag:l,details:g,samples:h.samples};n.trigger(x["Events"].FRAG_PARSING_METADATA,I)}if(g&&f){var _={id:i,frag:l,details:g,samples:f.samples};n.trigger(x["Events"].FRAG_PARSING_USERDATA,_)}};t._bufferInitSegment=function e(t,i,n,a){var s=this;if(this.state!==P["State"].PARSING){return}this.audioOnly=!!i.audio&&!i.video;if(this.altAudio&&!this.audioOnly){delete i.audio}var r=i.audio,o=i.video,l=i.audiovideo;if(r){var u=t.audioCodec;var c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){if(u){if(u.indexOf("mp4a.40.5")!==-1){u="mp4a.40.2"}else{u="mp4a.40.5"}}if(r.metadata.channelCount!==1&&c.indexOf("firefox")===-1){u="mp4a.40.5"}}if(c.indexOf("android")!==-1&&r.container!=="audio/mpeg"){u="mp4a.40.2";this.log("Android: force audio codec to "+u)}if(t.audioCodec&&t.audioCodec!==u){this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+u+'"')}r.levelCodec=u;r.id="main";this.log("Init audio buffer, container:"+r.container+", codecs[selected/level/parsed]=["+(u||"")+"/"+(t.audioCodec||"")+"/"+r.codec+"]")}if(o){o.levelCodec=t.videoCodec;o.id="main";this.log("Init video buffer, container:"+o.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+o.codec+"]")}if(l){this.log("Init audiovideo buffer, container:"+l.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+l.codec+"]")}this.hls.trigger(x["Events"].BUFFER_CODECS,i);Object.keys(i).forEach(function(e){var t=i[e];var r=t.initSegment;if(r!==null&&r!==void 0&&r.byteLength){s.hls.trigger(x["Events"].BUFFER_APPENDING,{type:e,data:r,frag:n,part:null,chunkMeta:a,parent:n.type})}});this.tick()};t.getMainFwdBufferInfo=function e(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,k["PlaylistLevelType"].MAIN)};t.backtrack=function e(t){this.couldBacktrack=true;this.backtrackFragment=t;this.resetTransmuxer();this.flushBufferGap(t);this.fragmentTracker.removeFragment(t);this.fragPrevious=null;this.nextLoadPosition=t.start;this.state=P["State"].IDLE};t.checkFragmentChanged=function e(){var t=this.media;var r=null;if(t&&t.readyState>1&&t.seeking===false){var i=t.currentTime;if(l["BufferHelper"].isBuffered(t,i)){r=this.getAppendedFrag(i)}else if(l["BufferHelper"].isBuffered(t,i+.1)){r=this.getAppendedFrag(i+.1)}if(r){this.backtrackFragment=null;var n=this.fragPlaying;var a=r.level;if(!n||r.sn!==n.sn||n.level!==a||r.urlId!==n.urlId){this.hls.trigger(x["Events"].FRAG_CHANGED,{frag:r});if(!n||n.level!==a){this.hls.trigger(x["Events"].LEVEL_SWITCHED,{level:a})}this.fragPlaying=r}}}};u(e,[{key:"nextLevel",get:function e(){var t=this.nextBufferedFrag;if(t){return t.level}return-1}},{key:"currentFrag",get:function e(){var t=this.media;if(t){return this.fragPlaying||this.getAppendedFrag(t.currentTime)}return null}},{key:"currentProgramDateTime",get:function e(){var t=this.media;if(t){var r=t.currentTime;var i=this.currentFrag;if(i&&Object(O["isFiniteNumber"])(r)&&Object(O["isFiniteNumber"])(i.programDateTime)){var n=i.programDateTime+(r-i.start)*1e3;return new Date(n)}}return null}},{key:"currentLevel",get:function e(){var t=this.currentFrag;if(t){return t.level}return-1}},{key:"nextBufferedFrag",get:function e(){var t=this.currentFrag;if(t){return this.followingBufferedFrag(t)}return null}},{key:"forceStartLoad",get:function e(){return this._forceStartLoad}}]);return e}(P["default"])},"./src/controller/subtitle-stream-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"SubtitleStreamController",function(){return d});var o=r("./src/events.ts");var m=r("./src/utils/buffer-helper.ts");var y=r("./src/controller/fragment-finders.ts");var h=r("./src/utils/discontinuities.ts");var v=r("./src/controller/level-helper.ts");var b=r("./src/controller/fragment-tracker.ts");var T=r("./src/controller/base-stream-controller.ts");var c=r("./src/types/loader.ts");var a=r("./src/types/level.ts");function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function s(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function l(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;n(e,t)}function n(e,t){n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return n(e,t)}var u=500;var d=function(n){l(e,n);function e(e,t){var r;r=n.call(this,e,t,"[subtitle-stream-controller]")||this;r.levels=[];r.currentTrackId=-1;r.tracksBuffered=[];r.mainDetails=null;r._registerListeners();return r}var t=e.prototype;t.onHandlerDestroying=function e(){this._unregisterListeners();this.mainDetails=null};t._registerListeners=function e(){var t=this.hls;t.on(o["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.on(o["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.on(o["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.on(o["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.on(o["Events"].ERROR,this.onError,this);t.on(o["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);t.on(o["Events"].SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this);t.on(o["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);t.on(o["Events"].SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this);t.on(o["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)};t._unregisterListeners=function e(){var t=this.hls;t.off(o["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.off(o["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.off(o["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(o["Events"].LEVEL_LOADED,this.onLevelLoaded,this);t.off(o["Events"].ERROR,this.onError,this);t.off(o["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);t.off(o["Events"].SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this);t.off(o["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);t.off(o["Events"].SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this);t.off(o["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)};t.startLoad=function e(){this.stopLoad();this.state=T["State"].IDLE;this.setInterval(u);this.tick()};t.onManifestLoading=function e(){this.mainDetails=null;this.fragmentTracker.removeAllFragments()};t.onLevelLoaded=function e(t,r){this.mainDetails=r.details};t.onSubtitleFragProcessed=function e(t,r){var i=r.frag,n=r.success;this.fragPrevious=i;this.state=T["State"].IDLE;if(!n){return}var a=this.tracksBuffered[this.currentTrackId];if(!a){return}var s;var o=i.start;for(var l=0;l<a.length;l++){if(o>=a[l].start&&o<=a[l].end){s=a[l];break}}var u=i.start+i.duration;if(s){s.end=u}else{s={start:o,end:u};a.push(s)}this.fragmentTracker.fragBuffered(i)};t.onBufferFlushing=function e(t,r){var i=r.startOffset,n=r.endOffset;if(i===0&&n!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,s=this.levels;if(!s.length||!s[a]||!s[a].details){return}var o=s[a].details;var l=o.targetduration;var u=n-l;if(u<=0){return}r.endOffsetSubtitles=Math.max(0,u);this.tracksBuffered.forEach(function(e){for(var t=0;t<e.length;){if(e[t].end<=u){e.shift();continue}else if(e[t].start<u){e[t].start=u}else{break}t++}});this.fragmentTracker.removeFragmentsInRange(i,u,c["PlaylistLevelType"].SUBTITLE)}};t.onError=function e(t,r){var i;var n=r.frag;if(!n||n.type!==c["PlaylistLevelType"].SUBTITLE){return}if((i=this.fragCurrent)!==null&&i!==void 0&&i.loader){this.fragCurrent.loader.abort()}this.state=T["State"].IDLE};t.onSubtitleTracksUpdated=function e(t,r){var i=this;var n=r.subtitleTracks;this.tracksBuffered=[];this.levels=n.map(function(e){return new a["Level"](e)});this.fragmentTracker.removeAllFragments();this.fragPrevious=null;this.levels.forEach(function(e){i.tracksBuffered[e.id]=[]});this.mediaBuffer=null};t.onSubtitleTrackSwitch=function e(t,r){this.currentTrackId=r.id;if(!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var i=this.levels[this.currentTrackId];if(i!==null&&i!==void 0&&i.details){this.mediaBuffer=this.mediaBufferTimeRanges}else{this.mediaBuffer=null}if(i){this.setInterval(u)}};t.onSubtitleTrackLoaded=function e(t,r){var i;var n=r.details,a=r.id;var s=this.currentTrackId,o=this.levels;if(!o.length){return}var l=o[s];if(a>=o.length||a!==s||!l){return}this.mediaBuffer=this.mediaBufferTimeRanges;if(n.live||(i=l.details)!==null&&i!==void 0&&i.live){var u=this.mainDetails;if(n.deltaUpdateFailed||!u){return}var c=u.fragments[0];if(!l.details){if(n.hasProgramDateTime&&u.hasProgramDateTime){Object(h["alignMediaPlaylistByPDT"])(n,u)}else if(c){Object(v["addSliding"])(n,c.start)}}else{var d=this.alignPlaylists(n,l.details);if(d===0&&c){Object(v["addSliding"])(n,c.start)}}}l.details=n;this.levelLastLoaded=a;this.tick();if(n.live&&!this.fragCurrent&&this.media&&this.state===T["State"].IDLE){var f=Object(y["findFragmentByPTS"])(null,n.fragments,this.media.currentTime,0);if(!f){this.warn("Subtitle playlist not aligned with playback");l.details=undefined}}};t._handleFragmentLoadComplete=function e(t){var r=t.frag,i=t.payload;var n=r.decryptdata;var a=this.hls;if(this.fragContextChanged(r)){return}if(i&&i.byteLength>0&&n&&n.key&&n.iv&&n.method==="AES-128"){var s=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer).then(function(e){var t=performance.now();a.trigger(o["Events"].FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:s,tdecrypt:t}})})}};t.doTick=function e(){if(!this.media){this.state=T["State"].IDLE;return}if(this.state===T["State"].IDLE){var t=this.currentTrackId,r=this.levels;if(!r.length||!r[t]||!r[t].details){return}var i=r[t].details;var n=i.targetduration;var a=this.config,s=this.media;var o=m["BufferHelper"].bufferedInfo(this.mediaBufferTimeRanges,s.currentTime-n,a.maxBufferHole);var l=o.end,u=o.len;var c=this.getMaxBufferLength()+n;if(u>c){return}console.assert(i,"Subtitle track details are defined on idle subtitle stream controller tick");var d=i.fragments;var f=d.length;var h=i.edge;var v;var g=this.fragPrevious;if(l<h){var p=a.maxFragLookUpTolerance;v=Object(y["findFragmentByPTS"])(g,d,Math.max(d[0].start,l),p);if(!v&&g&&g.start<d[0].start){v=d[0]}}else{v=d[f-1]}v=this.mapToInitFragWhenRequired(v);if(!v){return}if(v.encrypted){this.loadKey(v,i)}else if(this.fragmentTracker.getState(v)===b["FragmentState"].NOT_LOADED){this.loadFragment(v,i,l)}}};t.loadFragment=function e(t,r,i){this.fragCurrent=t;if(t.sn==="initSegment"){this._loadInitSegment(t)}else{n.prototype.loadFragment.call(this,t,r,i)}};s(e,[{key:"mediaBufferTimeRanges",get:function e(){return this.tracksBuffered[this.currentTrackId]||[]}}]);return e}(T["default"])},"./src/controller/subtitle-track-controller.ts":function(e,t,r){"use strict";r.r(t);var h=r("./src/events.ts");var n=r("./src/utils/texttrack-utils.ts");var i=r("./src/controller/base-playlist-controller.ts");var a=r("./src/types/loader.ts");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function o(e,t,r){if(t)s(e.prototype,t);if(r)s(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function l(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;u(e,t)}function u(e,t){u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return u(e,t)}var c=function(i){l(e,i);function e(e){var t;t=i.call(this,e,"[subtitle-track-controller]")||this;t.media=null;t.tracks=[];t.groupId=null;t.tracksInGroup=[];t.trackId=-1;t.selectDefaultTrack=true;t.queuedDefaultTrack=-1;t.trackChangeListener=function(){return t.onTextTracksChanged()};t.asyncPollTrackChange=function(){return t.pollTrackChange(0)};t.useTextTrackPolling=false;t.subtitlePollingInterval=-1;t._subtitleDisplay=true;t.registerListeners();return t}var t=e.prototype;t.destroy=function e(){this.unregisterListeners();this.tracks.length=0;this.tracksInGroup.length=0;this.trackChangeListener=this.asyncPollTrackChange=null;i.prototype.destroy.call(this)};t.registerListeners=function e(){var t=this.hls;t.on(h["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.on(h["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.on(h["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.on(h["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.on(h["Events"].LEVEL_LOADING,this.onLevelLoading,this);t.on(h["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);t.on(h["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);t.on(h["Events"].ERROR,this.onError,this)};t.unregisterListeners=function e(){var t=this.hls;t.off(h["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);t.off(h["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.off(h["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(h["Events"].MANIFEST_PARSED,this.onManifestParsed,this);t.off(h["Events"].LEVEL_LOADING,this.onLevelLoading,this);t.off(h["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);t.off(h["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);t.off(h["Events"].ERROR,this.onError,this)};t.onMediaAttached=function e(t,r){this.media=r.media;if(!this.media){return}if(this.queuedDefaultTrack>-1){this.subtitleTrack=this.queuedDefaultTrack;this.queuedDefaultTrack=-1}this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks);if(this.useTextTrackPolling){this.pollTrackChange(500)}else{this.media.textTracks.addEventListener("change",this.asyncPollTrackChange)}};t.pollTrackChange=function e(t){self.clearInterval(this.subtitlePollingInterval);this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)};t.onMediaDetaching=function e(){if(!this.media){return}self.clearInterval(this.subtitlePollingInterval);if(!this.useTextTrackPolling){this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange)}if(this.trackId>-1){this.queuedDefaultTrack=this.trackId}var t=d(this.media.textTracks);t.forEach(function(e){Object(n["clearCurrentCues"])(e)});this.subtitleTrack=-1;this.media=null};t.onManifestLoading=function e(){this.tracks=[];this.groupId=null;this.tracksInGroup=[];this.trackId=-1;this.selectDefaultTrack=true};t.onManifestParsed=function e(t,r){this.tracks=r.subtitleTracks};t.onSubtitleTrackLoaded=function e(t,r){var i=r.id,n=r.details;var a=this.trackId;var s=this.tracksInGroup[a];if(!s){this.warn("Invalid subtitle track id "+i);return}var o=s.details;s.details=r.details;this.log("subtitle track "+i+" loaded ["+n.startSN+"-"+n.endSN+"]");if(i===this.trackId){this.retryCount=0;this.playlistLoaded(i,r,o)}};t.onLevelLoading=function e(t,r){this.switchLevel(r.level)};t.onLevelSwitching=function e(t,r){this.switchLevel(r.level)};t.switchLevel=function e(t){var r=this.hls.levels[t];if(!(r!==null&&r!==void 0&&r.textGroupIds)){return}var i=r.textGroupIds[r.urlId];if(this.groupId!==i){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:undefined;var a=this.tracks.filter(function(e){return!i||e.groupId===i});this.tracksInGroup=a;var s=this.findTrackId(n===null||n===void 0?void 0:n.name)||this.findTrackId();this.groupId=i;var o={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+i+'" group-id');this.hls.trigger(h["Events"].SUBTITLE_TRACKS_UPDATED,o);if(s!==-1){this.setSubtitleTrack(s,n)}}};t.findTrackId=function e(t){var r=this.tracksInGroup;for(var i=0;i<r.length;i++){var n=r[i];if(!this.selectDefaultTrack||n.default){if(!t||t===n.name){return n.id}}}return-1};t.onError=function e(t,r){i.prototype.onError.call(this,t,r);if(r.fatal||!r.context){return}if(r.context.type===a["PlaylistContextType"].SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId){this.retryLoadingOrFail(r)}};t.loadPlaylist=function e(t){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var i=r.id;var n=r.groupId;var a=r.url;if(t){try{a=t.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}}this.log("Loading subtitle playlist for id "+i);this.hls.trigger(h["Events"].SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:n,deliveryDirectives:t||null})}};t.toggleTrackModes=function e(t){var r=this;var i=this.media,n=this.trackId;if(!i){return}var a=d(i.textTracks);var s=a.filter(function(e){return e.groupId===r.groupId});if(t===-1){[].slice.call(a).forEach(function(e){e.mode="disabled"})}else{var o=s[n];if(o){o.mode="disabled"}}var l=s[t];if(l){l.mode=this.subtitleDisplay?"showing":"hidden"}};t.setSubtitleTrack=function e(t,r){var i;var n=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t){this.toggleTrackModes(t)}if(this.trackId===t&&(t===-1||(i=n[t])!==null&&i!==void 0&&i.details)||t<-1||t>=n.length){return}this.clearTimer();var a=n[t];this.log("Switching to subtitle track "+t);this.trackId=t;if(a){var s=a.id,o=a.groupId,l=o===void 0?"":o,u=a.name,c=a.type,d=a.url;this.hls.trigger(h["Events"].SUBTITLE_TRACK_SWITCH,{id:s,groupId:l,name:u,type:c,url:d});var f=this.switchParams(a.url,r===null||r===void 0?void 0:r.details);this.loadPlaylist(f)}else{this.hls.trigger(h["Events"].SUBTITLE_TRACK_SWITCH,{id:t})}};t.onTextTracksChanged=function e(){if(!this.useTextTrackPolling){self.clearInterval(this.subtitlePollingInterval)}if(!this.media||!this.hls.config.renderTextTracksNatively){return}var t=-1;var r=d(this.media.textTracks);for(var i=0;i<r.length;i++){if(r[i].mode==="hidden"){t=i}else if(r[i].mode==="showing"){t=i;break}}if(this.subtitleTrack!==t){this.subtitleTrack=t}};o(e,[{key:"subtitleDisplay",get:function e(){return this._subtitleDisplay},set:function e(t){this._subtitleDisplay=t;if(this.trackId>-1){this.toggleTrackModes(this.trackId)}}},{key:"subtitleTracks",get:function e(){return this.tracksInGroup}},{key:"subtitleTrack",get:function e(){return this.trackId},set:function e(t){this.selectDefaultTrack=false;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:undefined;this.setSubtitleTrack(t,r)}}]);return e}(i["default"]);function d(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];if(i.kind==="subtitles"&&i.label){t.push(e[r])}}return t}t["default"]=c},"./src/controller/timeline-controller.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"TimelineController",function(){return i});var d=r("./src/polyfills/number.ts");var f=r("./src/events.ts");var a=r("./src/utils/cea-608-parser.ts");var s=r("./src/utils/output-filter.ts");var l=r("./src/utils/webvtt-parser.ts");var c=r("./src/utils/texttrack-utils.ts");var h=r("./src/utils/imsc1-ttml-parser.ts");var u=r("./src/utils/mp4-tools.ts");var v=r("./src/types/loader.ts");var g=r("./src/utils/logger.ts");var i=function(){function e(e){this.hls=void 0;this.media=null;this.config=void 0;this.enabled=true;this.Cues=void 0;this.textTracks=[];this.tracks=[];this.initPTS=[];this.timescale=[];this.unparsedVttFrags=[];this.captionsTracks={};this.nonNativeCaptionsTracks={};this.cea608Parser1=void 0;this.cea608Parser2=void 0;this.lastSn=-1;this.lastPartIndex=-1;this.prevCC=-1;this.vttCCs=o();this.captionsProperties=void 0;this.hls=e;this.config=e.config;this.Cues=e.config.cueHandler;this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}};if(this.config.enableCEA708Captions){var t=new s["default"](this,"textTrack1");var r=new s["default"](this,"textTrack2");var i=new s["default"](this,"textTrack3");var n=new s["default"](this,"textTrack4");this.cea608Parser1=new a["default"](1,t,r);this.cea608Parser2=new a["default"](3,i,n)}e.on(f["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);e.on(f["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);e.on(f["Events"].MANIFEST_LOADING,this.onManifestLoading,this);e.on(f["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);e.on(f["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);e.on(f["Events"].FRAG_LOADING,this.onFragLoading,this);e.on(f["Events"].FRAG_LOADED,this.onFragLoaded,this);e.on(f["Events"].FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this);e.on(f["Events"].FRAG_DECRYPTED,this.onFragDecrypted,this);e.on(f["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);e.on(f["Events"].SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this);e.on(f["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;t.destroy=function e(){var t=this.hls;t.off(f["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);t.off(f["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);t.off(f["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(f["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);t.off(f["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);t.off(f["Events"].FRAG_LOADING,this.onFragLoading,this);t.off(f["Events"].FRAG_LOADED,this.onFragLoaded,this);t.off(f["Events"].FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this);t.off(f["Events"].FRAG_DECRYPTED,this.onFragDecrypted,this);t.off(f["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);t.off(f["Events"].SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this);t.off(f["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null};t.addCues=function e(t,r,i,n,a){var s=false;for(var o=a.length;o--;){var l=a[o];var u=m(l[0],l[1],r,i);if(u>=0){l[0]=Math.min(l[0],r);l[1]=Math.max(l[1],i);s=true;if(u/(i-r)>.5){return}}}if(!s){a.push([r,i])}if(this.config.renderTextTracksNatively){var c=this.captionsTracks[t];this.Cues.newCue(c,r,i,n)}else{var d=this.Cues.newCue(null,r,i,n);this.hls.trigger(f["Events"].CUES_PARSED,{type:"captions",cues:d,track:t})}};t.onInitPtsFound=function e(t,r){var i=this;var n=r.frag,a=r.id,s=r.initPTS,o=r.timescale;var l=this.unparsedVttFrags;if(a==="main"){this.initPTS[n.cc]=s;this.timescale[n.cc]=o}if(l.length){this.unparsedVttFrags=[];l.forEach(function(e){i.onFragLoaded(f["Events"].FRAG_LOADED,e)})}};t.getExistingTrack=function e(t){var r=this.media;if(r){for(var i=0;i<r.textTracks.length;i++){var n=r.textTracks[i];if(n[t]){return n}}}return null};t.createCaptionsTrack=function e(t){if(this.config.renderTextTracksNatively){this.createNativeTrack(t)}else{this.createNonNativeTrack(t)}};t.createNativeTrack=function e(t){if(this.captionsTracks[t]){return}var r=this.captionsProperties,i=this.captionsTracks,n=this.media;var a=r[t],s=a.label,o=a.languageCode;var l=this.getExistingTrack(t);if(!l){var u=this.createTextTrack("captions",s,o);if(u){u[t]=true;i[t]=u}}else{i[t]=l;Object(c["clearCurrentCues"])(i[t]);Object(c["sendAddTrackEvent"])(i[t],n)}};t.createNonNativeTrack=function e(t){if(this.nonNativeCaptionsTracks[t]){return}var r=this.captionsProperties[t];if(!r){return}var i=r.label;var n={_id:t,label:i,kind:"captions",default:r.media?!!r.media.default:false,closedCaptions:r.media};this.nonNativeCaptionsTracks[t]=n;this.hls.trigger(f["Events"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})};t.createTextTrack=function e(t,r,i){var n=this.media;if(!n){return}return n.addTextTrack(t,r,i)};t.onMediaAttaching=function e(t,r){this.media=r.media;this._cleanTracks()};t.onMediaDetaching=function e(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){Object(c["clearCurrentCues"])(t[e]);delete t[e]});this.nonNativeCaptionsTracks={}};t.onManifestLoading=function e(){this.lastSn=-1;this.lastPartIndex=-1;this.prevCC=-1;this.vttCCs=o();this._cleanTracks();this.tracks=[];this.captionsTracks={};this.nonNativeCaptionsTracks={};this.textTracks=[];this.unparsedVttFrags=this.unparsedVttFrags||[];this.initPTS=[];this.timescale=[];if(this.cea608Parser1&&this.cea608Parser2){this.cea608Parser1.reset();this.cea608Parser2.reset()}};t._cleanTracks=function e(){var t=this.media;if(!t){return}var r=t.textTracks;if(r){for(var i=0;i<r.length;i++){Object(c["clearCurrentCues"])(r[i])}}};t.onSubtitleTracksUpdated=function e(t,r){var s=this;this.textTracks=[];var i=r.subtitleTracks||[];var n=i.some(function(e){return e.textCodec===h["IMSC1_CODEC"]});if(this.config.enableWebVTT||n&&this.config.enableIMSC1){var a=this.tracks&&i&&this.tracks.length===i.length;this.tracks=i||[];if(this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var r;if(t<o.length){var i=null;for(var n=0;n<o.length;n++){if(p(o[n],e)){i=o[n];break}}if(i){r=i}}if(r){Object(c["clearCurrentCues"])(r)}else{var a=s._captionsOrSubtitlesFromCharacteristics(e);r=s.createTextTrack(a,e.name,e.lang);if(r){r.mode="disabled"}}if(r){r.groupId=e.groupId;s.textTracks.push(r)}})}else if(!a&&this.tracks&&this.tracks.length){var l=this.tracks.map(function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}});this.hls.trigger(f["Events"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}};t._captionsOrSubtitlesFromCharacteristics=function e(t){var r;if((r=t.attrs)!==null&&r!==void 0&&r.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS);var n=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(i&&n){return"captions"}}return"subtitles"};t.onManifestLoaded=function e(t,r){var n=this;if(this.config.enableCEA708Captions&&r.captions){r.captions.forEach(function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t){return}var r="textTrack"+t[1];var i=n.captionsProperties[r];if(!i){return}i.label=e.name;if(e.lang){i.languageCode=e.lang}i.media=e})}};t.onFragLoading=function e(t,r){var i=this.cea608Parser1,n=this.cea608Parser2,a=this.lastSn,s=this.lastPartIndex;if(!this.enabled||!(i&&n)){return}if(r.frag.type===v["PlaylistLevelType"].MAIN){var o,l;var u=r.frag.sn;var c=(o=r===null||r===void 0?void 0:(l=r.part)===null||l===void 0?void 0:l.index)!=null?o:-1;if(!(u===a+1||u===a&&c===s+1)){i.reset();n.reset()}this.lastSn=u;this.lastPartIndex=c}};t.onFragLoaded=function e(t,r){var i=r.frag,n=r.payload;var a=this.initPTS,s=this.unparsedVttFrags;if(i.type===v["PlaylistLevelType"].SUBTITLE){if(n.byteLength){if(!Object(d["isFiniteNumber"])(a[i.cc])){s.push(r);if(a.length){this.hls.trigger(f["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:i,error:new Error("Missing initial subtitle PTS")})}return}var o=i.decryptdata;var l="stats"in r;if(o==null||o.key==null||o.method!=="AES-128"||l){var u=this.tracks[i.level];var c=this.vttCCs;if(!c[i.cc]){c[i.cc]={start:i.start,prevCC:this.prevCC,new:true};this.prevCC=i.cc}if(u&&u.textCodec===h["IMSC1_CODEC"]){this._parseIMSC1(i,n)}else{this._parseVTTs(i,n,c)}}}else{this.hls.trigger(f["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:i,error:new Error("Empty subtitle payload")})}}};t._parseIMSC1=function e(t,r){var i=this;var n=this.hls;Object(h["parseIMSC1"])(r,this.initPTS[t.cc],this.timescale[t.cc],function(e){i._appendCues(e,t.level);n.trigger(f["Events"].SUBTITLE_FRAG_PROCESSED,{success:true,frag:t})},function(e){g["logger"].log("Failed to parse IMSC1: "+e);n.trigger(f["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:t,error:e})})};t._parseVTTs=function e(t,r,i){var n,a=this;var s=this.hls;var o=(n=t.initSegment)!==null&&n!==void 0&&n.data?Object(u["appendUint8Array"])(t.initSegment.data,new Uint8Array(r)):r;Object(l["parseWebVTT"])(o,this.initPTS[t.cc],this.timescale[t.cc],i,t.cc,t.start,function(e){a._appendCues(e,t.level);s.trigger(f["Events"].SUBTITLE_FRAG_PROCESSED,{success:true,frag:t})},function(e){a._fallbackToIMSC1(t,r);g["logger"].log("Failed to parse VTT cue: "+e);s.trigger(f["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:t,error:e})})};t._fallbackToIMSC1=function e(t,r){var i=this;var n=this.tracks[t.level];if(!n.textCodec){Object(h["parseIMSC1"])(r,this.initPTS[t.cc],this.timescale[t.cc],function(){n.textCodec=h["IMSC1_CODEC"];i._parseIMSC1(t,r)},function(){n.textCodec="wvtt"})}};t._appendCues=function e(t,r){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[r];if(!n||n.mode==="disabled"){return}t.forEach(function(e){return Object(c["addCueToTrack"])(n,e)})}else{var a=this.tracks[r];if(!a){return}var s=a.default?"default":"subtitles"+r;i.trigger(f["Events"].CUES_PARSED,{type:"subtitles",cues:t,track:s})}};t.onFragDecrypted=function e(t,r){var i=r.frag;if(i.type===v["PlaylistLevelType"].SUBTITLE){if(!Object(d["isFiniteNumber"])(this.initPTS[i.cc])){this.unparsedVttFrags.push(r);return}this.onFragLoaded(f["Events"].FRAG_LOADED,r)}};t.onSubtitleTracksCleared=function e(){this.tracks=[];this.captionsTracks={}};t.onFragParsingUserdata=function e(t,r){var i=this.cea608Parser1,n=this.cea608Parser2;if(!this.enabled||!(i&&n)){return}for(var a=0;a<r.samples.length;a++){var s=r.samples[a].bytes;if(s){var o=this.extractCea608Data(s);i.addData(r.samples[a].pts,o[0]);n.addData(r.samples[a].pts,o[1])}}};t.onBufferFlushing=function e(t,r){var i=r.startOffset,n=r.endOffset,a=r.endOffsetSubtitles,s=r.type;var o=this.media;if(!o||o.currentTime<n){return}if(!s||s==="video"){var l=this.captionsTracks;Object.keys(l).forEach(function(e){return Object(c["removeCuesInRange"])(l[e],i,n)})}if(this.config.renderTextTracksNatively){if(i===0&&a!==undefined){var u=this.textTracks;Object.keys(u).forEach(function(e){return Object(c["removeCuesInRange"])(u[e],i,a)})}}};t.extractCea608Data=function e(t){var r=[[],[]];var i=t[0]&31;var n=2;for(var a=0;a<i;a++){var s=t[n++];var o=127&t[n++];var l=127&t[n++];if(o===0&&l===0){continue}var u=(4&s)!==0;if(u){var c=3&s;if(0===c||1===c){r[c].push(o);r[c].push(l)}}}return r};return e}();function p(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function m(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}function o(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:false}}}},"./src/crypt/aes-crypto.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var i=function(){function e(e,t){this.subtle=void 0;this.aesIV=void 0;this.subtle=e;this.aesIV=t}var t=e.prototype;t.decrypt=function e(t,r){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,t)};return e}()},"./src/crypt/aes-decryptor.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"removePadding",function(){return n});r.d(t,"default",function(){return a});var i=r("./src/utils/typed-array.ts");function n(e){var t=e.byteLength;var r=t&&new DataView(e.buffer).getUint8(t-1);if(r){return Object(i["sliceUint8"])(e,0,t-r)}return e}var a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.ksRows=0;this.keySize=0;this.keySchedule=void 0;this.invKeySchedule=void 0;this.initTable()}var t=e.prototype;t.uint8ArrayToUint32Array_=function e(t){var r=new DataView(t);var i=new Uint32Array(4);for(var n=0;n<4;n++){i[n]=r.getUint32(n*4)}return i};t.initTable=function e(){var t=this.sBox;var r=this.invSBox;var i=this.subMix;var n=i[0];var a=i[1];var s=i[2];var o=i[3];var l=this.invSubMix;var u=l[0];var c=l[1];var d=l[2];var f=l[3];var h=new Uint32Array(256);var v=0;var g=0;var p=0;for(p=0;p<256;p++){if(p<128){h[p]=p<<1}else{h[p]=p<<1^283}}for(p=0;p<256;p++){var m=g^g<<1^g<<2^g<<3^g<<4;m=m>>>8^m&255^99;t[v]=m;r[m]=v;var y=h[v];var b=h[y];var T=h[b];var E=h[m]*257^m*16843008;n[v]=E<<24|E>>>8;a[v]=E<<16|E>>>16;s[v]=E<<8|E>>>24;o[v]=E;E=T*16843009^b*65537^y*257^v*16843008;u[m]=E<<24|E>>>8;c[m]=E<<16|E>>>16;d[m]=E<<8|E>>>24;f[m]=E;if(!v){v=g=1}else{v=y^h[h[h[T^y]]];g^=h[h[g]]}}};t.expandKey=function e(t){var r=this.uint8ArrayToUint32Array_(t);var i=true;var n=0;while(n<r.length&&i){i=r[n]===this.key[n];n++}if(i){return}this.key=r;var a=this.keySize=r.length;if(a!==4&&a!==6&&a!==8){throw new Error("Invalid aes key size="+a)}var s=this.ksRows=(a+6+1)*4;var o;var l;var u=this.keySchedule=new Uint32Array(s);var c=this.invKeySchedule=new Uint32Array(s);var d=this.sBox;var f=this.rcon;var h=this.invSubMix;var v=h[0];var g=h[1];var p=h[2];var m=h[3];var y;var b;for(o=0;o<s;o++){if(o<a){y=u[o]=r[o];continue}b=y;if(o%a===0){b=b<<8|b>>>24;b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255];b^=f[o/a|0]<<24}else if(a>6&&o%a===4){b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255]}u[o]=y=(u[o-a]^b)>>>0}for(l=0;l<s;l++){o=s-l;if(l&3){b=u[o]}else{b=u[o-4]}if(l<4||o<=4){c[l]=b}else{c[l]=v[d[b>>>24]]^g[d[b>>>16&255]]^p[d[b>>>8&255]]^m[d[b&255]]}c[l]=c[l]>>>0}};t.networkToHostOrderSwap=function e(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24};t.decrypt=function e(t,r,i){var n=this.keySize+6;var a=this.invKeySchedule;var s=this.invSBox;var o=this.invSubMix;var l=o[0];var u=o[1];var c=o[2];var d=o[3];var f=this.uint8ArrayToUint32Array_(i);var h=f[0];var v=f[1];var g=f[2];var p=f[3];var m=new Int32Array(t);var y=new Int32Array(m.length);var b,T,E,S;var k,A,L,D;var w,C,R,I;var _,O;var P=this.networkToHostOrderSwap;while(r<m.length){w=P(m[r]);C=P(m[r+1]);R=P(m[r+2]);I=P(m[r+3]);k=w^a[0];A=I^a[1];L=R^a[2];D=C^a[3];_=4;for(O=1;O<n;O++){b=l[k>>>24]^u[A>>16&255]^c[L>>8&255]^d[D&255]^a[_];T=l[A>>>24]^u[L>>16&255]^c[D>>8&255]^d[k&255]^a[_+1];E=l[L>>>24]^u[D>>16&255]^c[k>>8&255]^d[A&255]^a[_+2];S=l[D>>>24]^u[k>>16&255]^c[A>>8&255]^d[L&255]^a[_+3];k=b;A=T;L=E;D=S;_=_+4}b=s[k>>>24]<<24^s[A>>16&255]<<16^s[L>>8&255]<<8^s[D&255]^a[_];T=s[A>>>24]<<24^s[L>>16&255]<<16^s[D>>8&255]<<8^s[k&255]^a[_+1];E=s[L>>>24]<<24^s[D>>16&255]<<16^s[k>>8&255]<<8^s[A&255]^a[_+2];S=s[D>>>24]<<24^s[k>>16&255]<<16^s[A>>8&255]<<8^s[L&255]^a[_+3];y[r]=P(b^h);y[r+1]=P(S^v);y[r+2]=P(E^g);y[r+3]=P(T^p);h=w;v=C;g=R;p=I;r=r+4}return y.buffer};return e}()},"./src/crypt/decrypter.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var s=r("./src/crypt/aes-crypto.ts");var o=r("./src/crypt/fast-aes-key.ts");var c=r("./src/crypt/aes-decryptor.ts");var a=r("./src/utils/logger.ts");var d=r("./src/utils/mp4-tools.ts");var f=r("./src/utils/typed-array.ts");var n=16;var i=function(){function e(e,t,r){var i=r===void 0?{}:r,n=i.removePKCS7Padding,a=n===void 0?true:n;this.logEnabled=true;this.observer=void 0;this.config=void 0;this.removePKCS7Padding=void 0;this.subtle=null;this.softwareDecrypter=null;this.key=null;this.fastAesKey=null;this.remainderData=null;this.currentIV=null;this.currentResult=null;this.observer=e;this.config=t;this.removePKCS7Padding=a;if(a){try{var s=self.crypto;if(s){this.subtle=s.subtle||s.webkitSubtle}}catch(e){}}if(this.subtle===null){this.config.enableSoftwareAES=true}}var t=e.prototype;t.destroy=function e(){this.observer=null};t.isSync=function e(){return this.config.enableSoftwareAES};t.flush=function e(){var t=this.currentResult;if(!t){this.reset();return}var r=new Uint8Array(t);this.reset();if(this.removePKCS7Padding){return Object(c["removePadding"])(r)}return r};t.reset=function e(){this.currentResult=null;this.currentIV=null;this.remainderData=null;if(this.softwareDecrypter){this.softwareDecrypter=null}};t.decrypt=function e(t,r,i,n){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(t),r,i);var a=this.flush();if(a){n(a.buffer)}}else{this.webCryptoDecrypt(new Uint8Array(t),r,i).then(n)}};t.softwareDecrypt=function e(t,r,i){var n=this.currentIV,a=this.currentResult,s=this.remainderData;this.logOnce("JS AES decrypt");if(s){t=Object(d["appendUint8Array"])(s,t);this.remainderData=null}var o=this.getValidChunk(t);if(!o.length){return null}if(n){i=n}var l=this.softwareDecrypter;if(!l){l=this.softwareDecrypter=new c["default"]}l.expandKey(r);var u=a;this.currentResult=l.decrypt(o.buffer,0,i);this.currentIV=Object(f["sliceUint8"])(o,-16).buffer;if(!u){return null}return u};t.webCryptoDecrypt=function e(r,t,i){var n=this;var a=this.subtle;if(this.key!==t||!this.fastAesKey){this.key=t;this.fastAesKey=new o["default"](a,t)}return this.fastAesKey.expandKey().then(function(e){if(!a){return Promise.reject(new Error("web crypto not initialized"))}var t=new s["default"](a,i);return t.decrypt(r.buffer,e)}).catch(function(e){return n.onWebCryptoError(e,r,t,i)})};t.onWebCryptoError=function e(t,r,i,n){a["logger"].warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t);this.config.enableSoftwareAES=true;this.logEnabled=true;return this.softwareDecrypt(r,i,n)};t.getValidChunk=function e(t){var r=t;var i=t.length-t.length%n;if(i!==t.length){r=Object(f["sliceUint8"])(t,0,i);this.remainderData=Object(f["sliceUint8"])(t,i)}return r};t.logOnce=function e(t){if(!this.logEnabled){return}a["logger"].log("[decrypter.ts]: "+t);this.logEnabled=false};return e}()},"./src/crypt/fast-aes-key.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var i=function(){function e(e,t){this.subtle=void 0;this.key=void 0;this.subtle=e;this.key=t}var t=e.prototype;t.expandKey=function e(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},false,["encrypt","decrypt"])};return e}()},"./src/demux/aacdemuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/demux/base-audio-demuxer.ts");var s=r("./src/demux/adts.ts");var o=r("./src/utils/logger.ts");var l=r("./src/demux/id3.ts");function n(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;a(e,t)}function a(e,t){a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return a(e,t)}var u=function(a){n(e,a);function e(e,t){var r;r=a.call(this)||this;r.observer=void 0;r.config=void 0;r.observer=e;r.config=t;return r}var t=e.prototype;t.resetInitSegment=function e(t,r,i,n){a.prototype.resetInitSegment.call(this,t,r,i,n);this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}};e.probe=function e(t){if(!t){return false}var r=l["getID3Data"](t,0)||[];var i=r.length;for(var n=t.length;i<n;i++){if(s["probe"](t,i)){o["logger"].log("ADTS sync word found !");return true}}return false};t.canParse=function e(t,r){return s["canParse"](t,r)};t.appendFrame=function e(t,r,i){s["initTrackConfig"](t,this.observer,r,i,t.manifestCodec);var n=s["appendFrame"](t,r,i,this.basePTS,this.frameIndex);if(n&&n.missing===0){return n}};return e}(i["default"]);u.minProbeByteLength=9;t["default"]=u},"./src/demux/adts.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"getAudioConfig",function(){return s});r.d(t,"isHeaderPattern",function(){return i});r.d(t,"getHeaderLength",function(){return a});r.d(t,"getFullFrameLength",function(){return o});r.d(t,"canGetFrameLength",function(){return n});r.d(t,"isHeader",function(){return l});r.d(t,"canParse",function(){return u});r.d(t,"probe",function(){return c});r.d(t,"initTrackConfig",function(){return d});r.d(t,"getFrameDuration",function(){return p});r.d(t,"parseFrameHeader",function(){return m});r.d(t,"appendFrame",function(){return g});var f=r("./src/utils/logger.ts");var h=r("./src/errors.ts");var v=r("./src/events.ts");function s(e,t,r,i){var n;var a;var s;var o;var l=navigator.userAgent.toLowerCase();var u=i;var c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=((t[r+2]&192)>>>6)+1;var d=(t[r+2]&60)>>>2;if(d>c.length-1){e.trigger(v["Events"].ERROR,{type:h["ErrorTypes"].MEDIA_ERROR,details:h["ErrorDetails"].FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+d});return}s=(t[r+2]&1)<<2;s|=(t[r+3]&192)>>>6;f["logger"].log("manifest codec:"+i+", ADTS type:"+n+", samplingIndex:"+d);if(/firefox/i.test(l)){if(d>=6){n=5;o=new Array(4);a=d-3}else{n=2;o=new Array(2);a=d}}else if(l.indexOf("android")!==-1){n=2;o=new Array(2);a=d}else{n=5;o=new Array(4);if(i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&d>=6){a=d-3}else{if(i&&i.indexOf("mp4a.40.2")!==-1&&(d>=6&&s===1||/vivaldi/i.test(l))||!i&&s===1){n=2;o=new Array(2)}a=d}}o[0]=n<<3;o[0]|=(d&14)>>1;o[1]|=(d&1)<<7;o[1]|=s<<3;if(n===5){o[1]|=(a&14)>>1;o[2]=(a&1)<<7;o[2]|=2<<2;o[3]=0}return{config:o,samplerate:c[d],channelCount:s,codec:"mp4a.40."+n,manifestCodec:u}}function i(e,t){return e[t]===255&&(e[t+1]&246)===240}function a(e,t){return e[t+1]&1?7:9}function o(e,t){return(e[t+3]&3)<<11|e[t+4]<<3|(e[t+5]&224)>>>5}function n(e,t){return t+5<e.length}function l(e,t){return t+1<e.length&&i(e,t)}function u(e,t){return n(e,t)&&i(e,t)&&o(e,t)<=e.length-t}function c(e,t){if(l(e,t)){var r=a(e,t);if(t+r>=e.length){return false}var i=o(e,t);if(i<=r){return false}var n=t+i;return n===e.length||l(e,n)}return false}function d(e,t,r,i,n){if(!e.samplerate){var a=s(t,r,i,n);if(!a){return}e.config=a.config;e.samplerate=a.samplerate;e.channelCount=a.channelCount;e.codec=a.codec;e.manifestCodec=a.manifestCodec;f["logger"].log("parsed codec:"+e.codec+", rate:"+a.samplerate+", channels:"+a.channelCount)}}function p(e){return 1024*9e4/e}function m(e,t){var r=a(e,t);if(t+r<=e.length){var i=o(e,t)-r;if(i>0){return{headerLength:r,frameLength:i}}}}function g(e,t,r,i,n){var a=p(e.samplerate);var s=i+n*a;var o=m(t,r);var l;if(o){var u=o.frameLength,c=o.headerLength;var d=c+u;var f=Math.max(0,r+d-t.length);if(f){l=new Uint8Array(d-c);l.set(t.subarray(r+c,t.length),0)}else{l=t.subarray(r+c,r+d)}var h={unit:l,pts:s};if(!f){e.samples.push(h)}return{sample:h,length:d,missing:f}}var v=t.length-r;l=new Uint8Array(v);l.set(t.subarray(r,t.length),0);var g={unit:l,pts:s};return{sample:g,length:v,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"initPTSFn",function(){return b});var h=r("./src/polyfills/number.ts");var v=r("./src/demux/id3.ts");var g=r("./src/types/demuxer.ts");var p=r("./src/demux/dummy-demuxed-track.ts");var m=r("./src/utils/mp4-tools.ts");var y=r("./src/utils/typed-array.ts");var i=function(){function e(){this._audioTrack=void 0;this._id3Track=void 0;this.frameIndex=0;this.cachedData=null;this.basePTS=null;this.initPTS=null}var t=e.prototype;t.resetInitSegment=function e(t,r,i,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}};t.resetTimeStamp=function e(t){this.initPTS=t;this.resetContiguity()};t.resetContiguity=function e(){this.basePTS=null;this.frameIndex=0};t.canParse=function e(t,r){return false};t.appendFrame=function e(t,r,i){};t.demux=function e(t,r){if(this.cachedData){t=Object(m["appendUint8Array"])(this.cachedData,t);this.cachedData=null}var i=v["getID3Data"](t,0);var n=i?i.length:0;var a;var s;var o=this._audioTrack;var l=this._id3Track;var u=i?v["getTimeStamp"](i):undefined;var c=t.length;if(this.basePTS===null||this.frameIndex===0&&Object(h["isFiniteNumber"])(u)){this.basePTS=b(u,r,this.initPTS)}if(i&&i.length>0){l.samples.push({pts:this.basePTS,dts:this.basePTS,data:i,type:g["MetadataSchema"].audioId3})}s=this.basePTS;while(n<c){if(this.canParse(t,n)){var d=this.appendFrame(o,t,n);if(d){this.frameIndex++;s=d.sample.pts;n+=d.length;a=n}else{n=c}}else if(v["canParse"](t,n)){i=v["getID3Data"](t,n);l.samples.push({pts:s,dts:s,data:i,type:g["MetadataSchema"].audioId3});n+=i.length;a=n}else{n++}if(n===c&&a!==c){var f=Object(y["sliceUint8"])(t,a);if(this.cachedData){this.cachedData=Object(m["appendUint8Array"])(this.cachedData,f)}else{this.cachedData=f}}}return{audioTrack:o,videoTrack:Object(p["dummyTrack"])(),id3Track:l,textTrack:Object(p["dummyTrack"])()}};t.demuxSampleAes=function e(t,r,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))};t.flush=function e(t){var r=this.cachedData;if(r){this.cachedData=null;this.demux(r,0)}return{audioTrack:this._audioTrack,videoTrack:Object(p["dummyTrack"])(),id3Track:this._id3Track,textTrack:Object(p["dummyTrack"])()}};t.destroy=function e(){};return e}();var b=function e(t,r,i){if(Object(h["isFiniteNumber"])(t)){return t*90}return r*9e4+(i||0)};t["default"]=i},"./src/demux/chunk-cache.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var i=function(){function e(){this.chunks=[];this.dataLength=0}var t=e.prototype;t.push=function e(t){this.chunks.push(t);this.dataLength+=t.length};t.flush=function e(){var t=this.chunks,r=this.dataLength;var i;if(!t.length){return new Uint8Array(0)}else if(t.length===1){i=t[0]}else{i=n(t,r)}this.reset();return i};t.reset=function e(){this.chunks.length=0;this.dataLength=0};return e}();function n(e,t){var r=new Uint8Array(t);var i=0;for(var n=0;n<e.length;n++){var a=e[n];r.set(a,i);i+=a.length}return r}},"./src/demux/dummy-demuxed-track.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"dummyTrack",function(){return i});function i(e,t){if(e===void 0){e=""}if(t===void 0){t=9e4}return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(e,t,r){"use strict";r.r(t);var n=r("./src/utils/logger.ts");var i=function(){function e(e){this.data=void 0;this.bytesAvailable=void 0;this.word=void 0;this.bitsAvailable=void 0;this.data=e;this.bytesAvailable=e.byteLength;this.word=0;this.bitsAvailable=0}var t=e.prototype;t.loadWord=function e(){var t=this.data;var r=this.bytesAvailable;var i=t.byteLength-r;var n=new Uint8Array(4);var a=Math.min(4,r);if(a===0){throw new Error("no bytes available")}n.set(t.subarray(i,i+a));this.word=new DataView(n.buffer).getUint32(0);this.bitsAvailable=a*8;this.bytesAvailable-=a};t.skipBits=function e(t){var r;if(this.bitsAvailable>t){this.word<<=t;this.bitsAvailable-=t}else{t-=this.bitsAvailable;r=t>>3;t-=r>>3;this.bytesAvailable-=r;this.loadWord();this.word<<=t;this.bitsAvailable-=t}};t.readBits=function e(t){var r=Math.min(this.bitsAvailable,t);var i=this.word>>>32-r;if(t>32){n["logger"].error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=r;if(this.bitsAvailable>0){this.word<<=r}else if(this.bytesAvailable>0){this.loadWord()}r=t-r;if(r>0&&this.bitsAvailable){return i<<r|this.readBits(r)}else{return i}};t.skipLZ=function e(){var t;for(t=0;t<this.bitsAvailable;++t){if((this.word&2147483648>>>t)!==0){this.word<<=t;this.bitsAvailable-=t;return t}}this.loadWord();return t+this.skipLZ()};t.skipUEG=function e(){this.skipBits(1+this.skipLZ())};t.skipEG=function e(){this.skipBits(1+this.skipLZ())};t.readUEG=function e(){var t=this.skipLZ();return this.readBits(t+1)-1};t.readEG=function e(){var t=this.readUEG();if(1&t){return 1+t>>>1}else{return-1*(t>>>1)}};t.readBoolean=function e(){return this.readBits(1)===1};t.readUByte=function e(){return this.readBits(8)};t.readUShort=function e(){return this.readBits(16)};t.readUInt=function e(){return this.readBits(32)};t.skipScalingList=function e(t){var r=8;var i=8;var n;for(var a=0;a<t;a++){if(i!==0){n=this.readEG();i=(r+n+256)%256}r=i===0?r:i}};t.readSPS=function e(){var t=0;var r=0;var i=0;var n=0;var a;var s;var o;var l=this.readUByte.bind(this);var u=this.readBits.bind(this);var c=this.readUEG.bind(this);var d=this.readBoolean.bind(this);var f=this.skipBits.bind(this);var h=this.skipEG.bind(this);var v=this.skipUEG.bind(this);var g=this.skipScalingList.bind(this);l();var p=l();u(5);f(3);l();v();if(p===100||p===110||p===122||p===244||p===44||p===83||p===86||p===118||p===128){var m=c();if(m===3){f(1)}v();v();f(1);if(d()){s=m!==3?8:12;for(o=0;o<s;o++){if(d()){if(o<6){g(16)}else{g(64)}}}}}v();var y=c();if(y===0){c()}else if(y===1){f(1);h();h();a=c();for(o=0;o<a;o++){h()}}v();f(1);var b=c();var T=c();var E=u(1);if(E===0){f(1)}f(1);if(d()){t=c();r=c();i=c();n=c()}var S=[1,1];if(d()){if(d()){var k=l();switch(k){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:{S=[l()<<8|l(),l()<<8|l()];break}}}}return{width:Math.ceil((b+1)*16-t*2-r*2),height:(2-E)*(T+1)*16-(E?2:4)*(i+n),pixelRatio:S}};t.readSliceType=function e(){this.readUByte();this.readUEG();return this.readUEG()};return e}();t["default"]=i},"./src/demux/id3.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"isHeader",function(){return l});r.d(t,"isFooter",function(){return u});r.d(t,"getID3Data",function(){return i});r.d(t,"canParse",function(){return n});r.d(t,"getTimeStamp",function(){return a});r.d(t,"isTimeStampFrame",function(){return s});r.d(t,"getID3Frames",function(){return o});r.d(t,"decodeFrame",function(){return f});r.d(t,"utf8ArrayToStr",function(){return m});r.d(t,"testables",function(){return y});var l=function e(t,r){if(r+10<=t.length){if(t[r]===73&&t[r+1]===68&&t[r+2]===51){if(t[r+3]<255&&t[r+4]<255){if(t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128){return true}}}}return false};var u=function e(t,r){if(r+10<=t.length){if(t[r]===51&&t[r+1]===68&&t[r+2]===73){if(t[r+3]<255&&t[r+4]<255){if(t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128){return true}}}}return false};var i=function e(t,r){var i=r;var n=0;while(l(t,r)){n+=10;var a=c(t,r+6);n+=a;if(u(t,r+10)){n+=10}r+=n}if(n>0){return t.subarray(i,i+n)}return undefined};var c=function e(t,r){var i=0;i=(t[r]&127)<<21;i|=(t[r+1]&127)<<14;i|=(t[r+2]&127)<<7;i|=t[r+3]&127;return i};var n=function e(t,r){return l(t,r)&&c(t,r+6)+10<=t.length-r};var a=function e(t){var r=o(t);for(var i=0;i<r.length;i++){var n=r[i];if(s(n)){return p(n)}}return undefined};var s=function e(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"};var d=function e(t){var r=String.fromCharCode(t[0],t[1],t[2],t[3]);var i=c(t,4);var n=10;return{type:r,size:i,data:t.subarray(n,n+i)}};var o=function e(t){var r=0;var i=[];while(l(t,r)){var n=c(t,r+6);r+=10;var a=r+n;while(r+8<a){var s=d(t.subarray(r));var o=f(s);if(o){i.push(o)}r+=s.size+10}if(u(t,r)){r+=10}}return i};var f=function e(t){if(t.type==="PRIV"){return h(t)}else if(t.type[0]==="W"){return g(t)}return v(t)};var h=function e(t){if(t.size<2){return undefined}var r=m(t.data,true);var i=new Uint8Array(t.data.subarray(r.length+1));return{key:t.type,info:r,data:i.buffer}};var v=function e(t){if(t.size<2){return undefined}if(t.type==="TXXX"){var r=1;var i=m(t.data.subarray(r),true);r+=i.length+1;var n=m(t.data.subarray(r));return{key:t.type,info:i,data:n}}var a=m(t.data.subarray(1));return{key:t.type,data:a}};var g=function e(t){if(t.type==="WXXX"){if(t.size<2){return undefined}var r=1;var i=m(t.data.subarray(r),true);r+=i.length+1;var n=m(t.data.subarray(r));return{key:t.type,info:i,data:n}}var a=m(t.data);return{key:t.type,data:a}};var p=function e(t){if(t.data.byteLength===8){var r=new Uint8Array(t.data);var i=r[3]&1;var n=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];n/=45;if(i){n+=47721858.84}return Math.round(n)}return undefined};var m=function e(t,r){if(r===void 0){r=false}var i=T();if(i){var n=i.decode(t);if(r){var a=n.indexOf("\0");return a!==-1?n.substring(0,a):n}return n.replace(/\0/g,"")}var s=t.length;var o;var l;var u;var c="";var d=0;while(d<s){o=t[d++];if(o===0&&r){return c}else if(o===0||o===3){continue}switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(o);break;case 12:case 13:l=t[d++];c+=String.fromCharCode((o&31)<<6|l&63);break;case 14:l=t[d++];u=t[d++];c+=String.fromCharCode((o&15)<<12|(l&63)<<6|(u&63)<<0);break;default:}}return c};var y={decodeTextFrame:v};var b;function T(){if(!b&&typeof self.TextDecoder!=="undefined"){b=new self.TextDecoder("utf-8")}return b}},"./src/demux/mp3demuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/demux/base-audio-demuxer.ts");var s=r("./src/demux/id3.ts");var o=r("./src/utils/logger.ts");var l=r("./src/demux/mpegaudio.ts");function n(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;a(e,t)}function a(e,t){a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return a(e,t)}var u=function(a){n(e,a);function e(){return a.apply(this,arguments)||this}var t=e.prototype;t.resetInitSegment=function e(t,r,i,n){a.prototype.resetInitSegment.call(this,t,r,i,n);this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}};e.probe=function e(t){if(!t){return false}var r=s["getID3Data"](t,0)||[];var i=r.length;for(var n=t.length;i<n;i++){if(l["probe"](t,i)){o["logger"].log("MPEG Audio sync word found !");return true}}return false};t.canParse=function e(t,r){return l["canParse"](t,r)};t.appendFrame=function e(t,r,i){if(this.basePTS===null){return}return l["appendFrame"](t,r,i,this.basePTS,this.frameIndex)};return e}(i["default"]);u.minProbeByteLength=4;t["default"]=u},"./src/demux/mp4demuxer.ts":function(e,t,r){"use strict";r.r(t);var s=r("./src/polyfills/number.ts");var o=r("./src/types/demuxer.ts");var m=r("./src/utils/mp4-tools.ts");var y=r("./src/demux/dummy-demuxed-track.ts");var l=/\/emsg[-/]ID3/i;var i=function(){function e(e,t){this.remainderData=null;this.timeOffset=0;this.config=void 0;this.videoTrack=void 0;this.audioTrack=void 0;this.id3Track=void 0;this.txtTrack=void 0;this.config=t}var t=e.prototype;t.resetTimeStamp=function e(){};t.resetInitSegment=function e(t,r,i,n){var a=Object(m["parseInitSegment"])(t);var s=this.videoTrack=Object(y["dummyTrack"])("video",1);var o=this.audioTrack=Object(y["dummyTrack"])("audio",1);var l=this.txtTrack=Object(y["dummyTrack"])("text",1);this.id3Track=Object(y["dummyTrack"])("id3",1);this.timeOffset=0;if(a.video){var u=a.video,c=u.id,d=u.timescale,f=u.codec;s.id=c;s.timescale=l.timescale=d;s.codec=f}if(a.audio){var h=a.audio,v=h.id,g=h.timescale,p=h.codec;o.id=v;o.timescale=g;o.codec=p}l.id=m["RemuxerTrackIdConfig"].text;s.sampleDuration=0;s.duration=o.duration=n};t.resetContiguity=function e(){};e.probe=function e(t){t=t.length>16384?t.subarray(0,16384):t;return Object(m["findBox"])(t,["moof"]).length>0};t.demux=function e(t,r){this.timeOffset=r;var i=t;var n=this.videoTrack;var a=this.txtTrack;if(this.config.progressive){if(this.remainderData){i=Object(m["appendUint8Array"])(this.remainderData,t)}var s=Object(m["segmentValidRange"])(i);this.remainderData=s.remainder;n.samples=s.valid||new Uint8Array}else{n.samples=i}var o=this.extractID3Track(n,r);a.samples=Object(m["parseSamples"])(r,n);return{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}};t.flush=function e(){var t=this.timeOffset;var r=this.videoTrack;var i=this.txtTrack;r.samples=this.remainderData||new Uint8Array;this.remainderData=null;var n=this.extractID3Track(r,this.timeOffset);i.samples=Object(m["parseSamples"])(t,r);return{videoTrack:r,audioTrack:Object(y["dummyTrack"])(),id3Track:n,textTrack:Object(y["dummyTrack"])()}};t.extractID3Track=function e(t,n){var a=this.id3Track;if(t.samples.length){var r=Object(m["findBox"])(t.samples,["emsg"]);if(r){r.forEach(function(e){var t=Object(m["parseEmsg"])(e);if(l.test(t.schemeIdUri)){var r=Object(s["isFiniteNumber"])(t.presentationTime)?t.presentationTime/t.timeScale:n+t.presentationTimeDelta/t.timeScale;var i=t.payload;a.samples.push({data:i,len:i.byteLength,dts:r,pts:r,type:o["MetadataSchema"].emsg})}})}}return a};t.demuxSampleAes=function e(t,r,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))};t.destroy=function e(){};return e}();i.minProbeByteLength=1024;t["default"]=i},"./src/demux/mpegaudio.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"appendFrame",function(){return i});r.d(t,"parseHeader",function(){return u});r.d(t,"isHeaderPattern",function(){return s});r.d(t,"isHeader",function(){return o});r.d(t,"canParse",function(){return n});r.d(t,"probe",function(){return a});var T=null;var E=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160];var S=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];var k=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]];var A=[0,1,1,4];function i(e,t,r,i,n){if(r+24>t.length){return}var a=u(t,r);if(a&&r+a.frameLength<=t.length){var s=a.samplesPerFrame*9e4/a.sampleRate;var o=i+n*s;var l={unit:t.subarray(r,r+a.frameLength),pts:o,dts:o};e.config=[];e.channelCount=a.channelCount;e.samplerate=a.sampleRate;e.samples.push(l);return{sample:l,length:a.frameLength,missing:0}}}function u(e,t){var r=e[t+1]>>3&3;var i=e[t+1]>>1&3;var n=e[t+2]>>4&15;var a=e[t+2]>>2&3;if(r!==1&&n!==0&&n!==15&&a!==3){var s=e[t+2]>>1&1;var o=e[t+3]>>6;var l=r===3?3-i:i===3?3:4;var u=E[l*14+n-1]*1e3;var c=r===3?0:r===2?1:2;var d=S[c*3+a];var f=o===3?1:2;var h=k[r][i];var v=A[i];var g=h*8*v;var p=Math.floor(h*u/d+s)*v;if(T===null){var m=navigator.userAgent||"";var y=m.match(/Chrome\/(\d+)/i);T=y?parseInt(y[1]):0}var b=!!T&&T<=87;if(b&&i===2&&u>=224e3&&o===0){e[t+3]=e[t+3]|128}return{sampleRate:d,channelCount:f,frameLength:p,samplesPerFrame:g}}}function s(e,t){return e[t]===255&&(e[t+1]&224)===224&&(e[t+1]&6)!==0}function o(e,t){return t+1<e.length&&s(e,t)}function n(e,t){var r=4;return s(e,t)&&r<=e.length-t}function a(e,t){if(t+1<e.length&&s(e,t)){var r=4;var i=u(e,t);var n=r;if(i!==null&&i!==void 0&&i.frameLength){n=i.frameLength}var a=t+n;return a===e.length||o(e,a)}return false}},"./src/demux/sample-aes.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/crypt/decrypter.ts");var c=r("./src/demux/tsdemuxer.ts");var n=function(){function e(e,t,r){this.keyData=void 0;this.decrypter=void 0;this.keyData=r;this.decrypter=new i["default"](e,t,{removePKCS7Padding:false})}var t=e.prototype;t.decryptBuffer=function e(t,r){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,r)};t.decryptAacSample=function e(r,i,n,a){var s=r[i].unit;if(s.length<=16){return}var t=s.subarray(16,s.length-s.length%16);var o=t.buffer.slice(t.byteOffset,t.byteOffset+t.length);var l=this;this.decryptBuffer(o,function(e){var t=new Uint8Array(e);s.set(t,16);if(!a){l.decryptAacSamples(r,i+1,n)}})};t.decryptAacSamples=function e(t,r,i){for(;;r++){if(r>=t.length){i();return}if(t[r].unit.length<32){continue}var n=this.decrypter.isSync();this.decryptAacSample(t,r,i,n);if(!n){return}}};t.getAvcEncryptedData=function e(t){var r=Math.floor((t.length-48)/160)*16+16;var i=new Int8Array(r);var n=0;for(var a=32;a<t.length-16;a+=160,n+=16){i.set(t.subarray(a,a+16),n)}return i};t.getAvcDecryptedUnit=function e(t,r){var i=new Uint8Array(r);var n=0;for(var a=32;a<t.length-16;a+=160,n+=16){t.set(i.subarray(n,n+16),a)}return t};t.decryptAvcSample=function e(t,r,i,n,a,s){var o=Object(c["discardEPB"])(a.data);var l=this.getAvcEncryptedData(o);var u=this;this.decryptBuffer(l.buffer,function(e){a.data=u.getAvcDecryptedUnit(o,e);if(!s){u.decryptAvcSamples(t,r,i+1,n)}})};t.decryptAvcSamples=function e(t,r,i,n){if(t instanceof Uint8Array){throw new Error("Cannot decrypt samples of type Uint8Array")}for(;;r++,i=0){if(r>=t.length){n();return}var a=t[r].units;for(;;i++){if(i>=a.length){break}var s=a[i];if(s.data.length<=48||s.type!==1&&s.type!==5){continue}var o=this.decrypter.isSync();this.decryptAvcSample(t,r,i,n,s,o);if(!o){return}}}};return e}();t["default"]=n},"./src/demux/transmuxer-interface.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return s});var c=r("./node_modules/webworkify-webpack/index.js");var i=r.n(c);var d=r("./src/events.ts");var I=r("./src/demux/transmuxer.ts");var _=r("./src/utils/logger.ts");var f=r("./src/errors.ts");var n=r("./src/utils/mediasource-helper.ts");var h=r("./node_modules/eventemitter3/index.js");var a=r.n(h);var v=Object(n["getMediaSource"])()||{isTypeSupported:function e(){return false}};var s=function(){function e(i,t,e,r){var n=this;this.hls=void 0;this.id=void 0;this.observer=void 0;this.frag=null;this.part=null;this.worker=void 0;this.onwmsg=void 0;this.transmuxer=null;this.onTransmuxComplete=void 0;this.onFlush=void 0;this.hls=i;this.id=t;this.onTransmuxComplete=e;this.onFlush=r;var a=i.config;var s=function e(t,r){r=r||{};r.frag=n.frag;r.id=n.id;i.trigger(t,r)};this.observer=new h["EventEmitter"];this.observer.on(d["Events"].FRAG_DECRYPTED,s);this.observer.on(d["Events"].ERROR,s);var o={mp4:v.isTypeSupported("video/mp4"),mpeg:v.isTypeSupported("audio/mpeg"),mp3:v.isTypeSupported('audio/mp4; codecs="mp3"')};var l=navigator.vendor;if(a.enableWorker&&typeof Worker!=="undefined"){_["logger"].log("demuxing in webworker");var u;try{u=this.worker=c("./src/demux/transmuxer-worker.ts");this.onwmsg=this.onWorkerMessage.bind(this);u.addEventListener("message",this.onwmsg);u.onerror=function(e){i.trigger(d["Events"].ERROR,{type:f["ErrorTypes"].OTHER_ERROR,details:f["ErrorDetails"].INTERNAL_EXCEPTION,fatal:true,event:"demuxerWorker",error:new Error(e.message+"  ("+e.filename+":"+e.lineno+")")})};u.postMessage({cmd:"init",typeSupported:o,vendor:l,id:t,config:JSON.stringify(a)})}catch(e){_["logger"].warn("Error in worker:",e);_["logger"].error("Error while initializing DemuxerWorker, fallback to inline");if(u){self.URL.revokeObjectURL(u.objectURL)}this.transmuxer=new I["default"](this.observer,o,a,l,t);this.worker=null}}else{this.transmuxer=new I["default"](this.observer,o,a,l,t)}}var t=e.prototype;t.destroy=function e(){var t=this.worker;if(t){t.removeEventListener("message",this.onwmsg);t.terminate();this.worker=null;this.onwmsg=undefined}else{var r=this.transmuxer;if(r){r.destroy();this.transmuxer=null}}var i=this.observer;if(i){i.removeAllListeners()}this.frag=null;this.observer=null;this.hls=null};t.push=function e(t,r,i,n,a,s,o,l,u,c){var d,f,h=this;u.transmuxing.start=self.performance.now();var v=this.transmuxer,g=this.worker;var p=s?s.start:a.start;var m=a.decryptdata;var y=this.frag;var b=!(y&&a.cc===y.cc);var T=!(y&&u.level===y.level);var E=y?u.sn-y.sn:-1;var S=this.part?u.part-this.part.index:-1;var k=E===0&&u.id>1&&u.id===(y===null||y===void 0?void 0:y.stats.chunkCount);var A=!T&&(E===1||E===0&&(S===1||k&&S<=0));var L=self.performance.now();if(T||E||a.stats.parsing.start===0){a.stats.parsing.start=L}if(s&&(S||!A)){s.stats.parsing.start=L}var D=!(y&&((d=a.initSegment)===null||d===void 0?void 0:d.url)===((f=y.initSegment)===null||f===void 0?void 0:f.url));var w=new I["TransmuxState"](b,A,l,T,p,D);if(!A||b||D){_["logger"].log("[transmuxer-interface, "+a.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+"\n        discontinuity: "+b+"\n        trackSwitch: "+T+"\n        contiguous: "+A+"\n        accurateTimeOffset: "+l+"\n        timeOffset: "+p+"\n        initSegmentChange: "+D);var C=new I["TransmuxConfig"](i,n,r,o,c);this.configureTransmuxer(C)}this.frag=a;this.part=s;if(g){g.postMessage({cmd:"demux",data:t,decryptdata:m,chunkMeta:u,state:w},t instanceof ArrayBuffer?[t]:[])}else if(v){var R=v.push(t,m,u,w);if(Object(I["isPromise"])(R)){R.then(function(e){h.handleTransmuxComplete(e)})}else{this.handleTransmuxComplete(R)}}};t.flush=function e(t){var r=this;t.transmuxing.start=self.performance.now();var i=this.transmuxer,n=this.worker;if(n){n.postMessage({cmd:"flush",chunkMeta:t})}else if(i){var a=i.flush(t);if(Object(I["isPromise"])(a)){a.then(function(e){r.handleFlushResult(e,t)})}else{this.handleFlushResult(a,t)}}};t.handleFlushResult=function e(t,r){var i=this;t.forEach(function(e){i.handleTransmuxComplete(e)});this.onFlush(r)};t.onWorkerMessage=function e(t){var r=t.data;var i=this.hls;switch(r.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(r.data);break}case"flush":{this.onFlush(r.data);break}case"workerLog":if(_["logger"][r.data.logType]){_["logger"][r.data.logType](r.data.message)}break;default:{r.data=r.data||{};r.data.frag=this.frag;r.data.id=this.id;i.trigger(r.event,r.data);break}}};t.configureTransmuxer=function e(t){var r=this.worker,i=this.transmuxer;if(r){r.postMessage({cmd:"configure",config:t})}else if(i){i.configure(t)}};t.handleTransmuxComplete=function e(t){t.chunkMeta.transmuxing.end=self.performance.now();this.onTransmuxComplete(t)};return e}()},"./src/demux/transmuxer-worker.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return s});var c=r("./src/demux/transmuxer.ts");var i=r("./src/events.ts");var d=r("./src/utils/logger.ts");var n=r("./node_modules/eventemitter3/index.js");var a=r.n(n);function s(s){var o=new n["EventEmitter"];var l=function e(t,r){s.postMessage({event:t,data:r})};o.on(i["Events"].FRAG_DECRYPTED,l);o.on(i["Events"].ERROR,l);var u=function e(){var t=function e(r){var t=function e(t){l("workerLog",{logType:r,message:t})};d["logger"][r]=t};for(var r in d["logger"]){t(r)}};s.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":{var r=JSON.parse(t.config);s.transmuxer=new c["default"](o,t.typeSupported,r,t.vendor,t.id);Object(d["enableLogs"])(r.debug);u();l("init",null);break}case"configure":{s.transmuxer.configure(t.config);break}case"demux":{var i=s.transmuxer.push(t.data,t.decryptdata,t.chunkMeta,t.state);if(Object(c["isPromise"])(i)){i.then(function(e){f(s,e)})}else{f(s,i)}break}case"flush":{var n=t.chunkMeta;var a=s.transmuxer.flush(n);if(Object(c["isPromise"])(a)){a.then(function(e){h(s,e,n)})}else{h(s,a,n)}break}default:break}})}function f(e,t){if(l(t.remuxResult)){return false}var r=[];var i=t.remuxResult,n=i.audio,a=i.video;if(n){o(r,n)}if(a){o(r,a)}e.postMessage({event:"transmuxComplete",data:t},r);return true}function o(e,t){if(t.data1){e.push(t.data1.buffer)}if(t.data2){e.push(t.data2.buffer)}}function h(r,e,t){var i=e.reduce(function(e,t){return f(r,t)||e},false);if(!i){r.postMessage({event:"transmuxComplete",data:e[0]})}r.postMessage({event:"flush",data:t})}function l(e){return!e.audio&&!e.video&&!e.text&&!e.id3&&!e.initSegment}},"./src/demux/transmuxer.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return u});r.d(t,"isPromise",function(){return y});r.d(t,"TransmuxConfig",function(){return c});r.d(t,"TransmuxState",function(){return d});var g=r("./src/events.ts");var p=r("./src/errors.ts");var i=r("./src/crypt/decrypter.ts");var n=r("./src/demux/aacdemuxer.ts");var b=r("./src/demux/mp4demuxer.ts");var a=r("./src/demux/tsdemuxer.ts");var s=r("./src/demux/mp3demuxer.ts");var o=r("./src/remux/mp4-remuxer.ts");var T=r("./src/remux/passthrough-remuxer.ts");var l=r("./src/demux/chunk-cache.ts");var I=r("./src/utils/mp4-tools.ts");var E=r("./src/utils/logger.ts");var _;try{_=self.performance.now.bind(self.performance)}catch(e){E["logger"].debug("Unable to use Performance API on this environment");_=self.Date.now}var S=[{demux:a["default"],remux:o["default"]},{demux:b["default"],remux:T["default"]},{demux:n["default"],remux:o["default"]},{demux:s["default"],remux:o["default"]}];var m=1024;S.forEach(function(e){var t=e.demux;m=Math.max(m,t.minProbeByteLength)});var u=function(){function e(e,t,r,i,n){this.observer=void 0;this.typeSupported=void 0;this.config=void 0;this.vendor=void 0;this.id=void 0;this.demuxer=void 0;this.remuxer=void 0;this.decrypter=void 0;this.probe=void 0;this.decryptionPromise=null;this.transmuxConfig=void 0;this.currentTransmuxState=void 0;this.cache=new l["default"];this.observer=e;this.typeSupported=t;this.config=r;this.vendor=i;this.id=n}var t=e.prototype;t.configure=function e(t){this.transmuxConfig=t;if(this.decrypter){this.decrypter.reset()}};t.push=function e(t,r,i,n){var a=this;var s=i.transmuxing;s.executeStart=_();var o=new Uint8Array(t);var l=this.cache,u=this.config,c=this.currentTransmuxState,d=this.transmuxConfig;if(n){this.currentTransmuxState=n}var f=O(o,r);if(f&&f.method==="AES-128"){var h=this.getDecrypter();if(u.enableSoftwareAES){var v=h.softwareDecrypt(o,f.key.buffer,f.iv.buffer);if(!v){s.executeEnd=_();return P(i)}o=new Uint8Array(v)}else{this.decryptionPromise=h.webCryptoDecrypt(o,f.key.buffer,f.iv.buffer).then(function(e){var t=a.push(e,null,i);a.decryptionPromise=null;return t});return this.decryptionPromise}}var g=n||c,p=g.contiguous,m=g.discontinuity,y=g.trackSwitch,b=g.accurateTimeOffset,T=g.timeOffset,E=g.initSegmentChange;var S=d.audioCodec,k=d.videoCodec,A=d.defaultInitPts,L=d.duration,D=d.initSegmentData;if(m||y||E){this.resetInitSegment(D,S,k,L)}if(m||E){this.resetInitialTimestamp(A)}if(!p){this.resetContiguity()}if(this.needsProbing(o,m,y)){if(l.dataLength){var w=l.flush();o=Object(I["appendUint8Array"])(w,o)}this.configureTransmuxer(o,d)}var C=this.transmux(o,f,T,b,i);var R=this.currentTransmuxState;R.contiguous=true;R.discontinuity=false;R.trackSwitch=false;s.executeEnd=_();return C};t.flush=function e(t){var r=this;var i=t.transmuxing;i.executeStart=_();var n=this.decrypter,a=this.cache,s=this.currentTransmuxState,o=this.decryptionPromise;if(o){return o.then(function(){return r.flush(t)})}var l=[];var u=s.timeOffset;if(n){var c=n.flush();if(c){l.push(this.push(c,null,t))}}var d=a.dataLength;a.reset();var f=this.demuxer,h=this.remuxer;if(!f||!h){if(d>=m){this.observer.emit(g["Events"].ERROR,g["Events"].ERROR,{type:p["ErrorTypes"].MEDIA_ERROR,details:p["ErrorDetails"].FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"})}i.executeEnd=_();return[P(t)]}var v=f.flush(u);if(y(v)){return v.then(function(e){r.flushRemux(l,e,t);return l})}this.flushRemux(l,v,t);return l};t.flushRemux=function e(t,r,i){var n=r.audioTrack,a=r.videoTrack,s=r.id3Track,o=r.textTrack;var l=this.currentTransmuxState,u=l.accurateTimeOffset,c=l.timeOffset;E["logger"].log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var d=this.remuxer.remux(n,a,s,o,c,u,true,this.id);t.push({remuxResult:d,chunkMeta:i});i.transmuxing.executeEnd=_()};t.resetInitialTimestamp=function e(t){var r=this.demuxer,i=this.remuxer;if(!r||!i){return}r.resetTimeStamp(t);i.resetTimeStamp(t)};t.resetContiguity=function e(){var t=this.demuxer,r=this.remuxer;if(!t||!r){return}t.resetContiguity();r.resetNextTimestamp()};t.resetInitSegment=function e(t,r,i,n){var a=this.demuxer,s=this.remuxer;if(!a||!s){return}a.resetInitSegment(t,r,i,n);s.resetInitSegment(t,r,i)};t.destroy=function e(){if(this.demuxer){this.demuxer.destroy();this.demuxer=undefined}if(this.remuxer){this.remuxer.destroy();this.remuxer=undefined}};t.transmux=function e(t,r,i,n,a){var s;if(r&&r.method==="SAMPLE-AES"){s=this.transmuxSampleAes(t,r,i,n,a)}else{s=this.transmuxUnencrypted(t,i,n,a)}return s};t.transmuxUnencrypted=function e(t,r,i,n){var a=this.demuxer.demux(t,r,false,!this.config.progressive),s=a.audioTrack,o=a.videoTrack,l=a.id3Track,u=a.textTrack;var c=this.remuxer.remux(s,o,l,u,r,i,false,this.id);return{remuxResult:c,chunkMeta:n}};t.transmuxSampleAes=function e(t,r,i,n,a){var s=this;return this.demuxer.demuxSampleAes(t,r,i).then(function(e){var t=s.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,n,false,s.id);return{remuxResult:t,chunkMeta:a}})};t.configureTransmuxer=function e(t,r){var i=this.config,n=this.observer,a=this.typeSupported,s=this.vendor;var o=r.audioCodec,l=r.defaultInitPts,u=r.duration,c=r.initSegmentData,d=r.videoCodec;var f;for(var h=0,v=S.length;h<v;h++){if(S[h].demux.probe(t)){f=S[h];break}}if(!f){E["logger"].warn("Failed to find demuxer by probing frag, treating as mp4 passthrough");f={demux:b["default"],remux:T["default"]}}var g=this.demuxer;var p=this.remuxer;var m=f.remux;var y=f.demux;if(!p||!(p instanceof m)){this.remuxer=new m(n,i,a,s)}if(!g||!(g instanceof y)){this.demuxer=new y(n,i,a);this.probe=y.probe}this.resetInitSegment(c,o,d,u);this.resetInitialTimestamp(l)};t.needsProbing=function e(t,r,i){return!this.demuxer||!this.remuxer||r||i};t.getDecrypter=function e(){var t=this.decrypter;if(!t){t=this.decrypter=new i["default"](this.observer,this.config)}return t};return e}();function O(e,t){var r=null;if(e.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null){r=t}return r}var P=function e(t){return{remuxResult:{},chunkMeta:t}};function y(e){return"then"in e&&e.then instanceof Function}var c=function e(t,r,i,n,a){this.audioCodec=void 0;this.videoCodec=void 0;this.initSegmentData=void 0;this.duration=void 0;this.defaultInitPts=void 0;this.audioCodec=t;this.videoCodec=r;this.initSegmentData=i;this.duration=n;this.defaultInitPts=a};var d=function e(t,r,i,n,a,s){this.discontinuity=void 0;this.contiguous=void 0;this.accurateTimeOffset=void 0;this.trackSwitch=void 0;this.timeOffset=void 0;this.initSegmentChange=void 0;this.discontinuity=t;this.contiguous=r;this.accurateTimeOffset=i;this.trackSwitch=n;this.timeOffset=a;this.initSegmentChange=s}},"./src/demux/tsdemuxer.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"discardEPB",function(){return S});var y=r("./src/demux/adts.ts");var u=r("./src/demux/mpegaudio.ts");var b=r("./src/demux/exp-golomb.ts");var s=r("./src/demux/sample-aes.ts");var I=r("./src/events.ts");var _=r("./src/utils/mp4-tools.ts");var O=r("./src/utils/logger.ts");var P=r("./src/errors.ts");var n=r("./src/types/demuxer.ts");function a(){a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return a.apply(this,arguments)}var i=function(){function R(e,t,r){this.observer=void 0;this.config=void 0;this.typeSupported=void 0;this.sampleAes=null;this.pmtParsed=false;this.audioCodec=void 0;this.videoCodec=void 0;this._duration=0;this._pmtId=-1;this._avcTrack=void 0;this._audioTrack=void 0;this._id3Track=void 0;this._txtTrack=void 0;this.aacOverFlow=null;this.avcSample=null;this.remainderData=null;this.observer=e;this.config=t;this.typeSupported=r}R.probe=function e(t){var r=R.syncOffset(t);if(r<0){return false}else{if(r){O["logger"].warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?")}return true}};R.syncOffset=function e(t){var r=Math.min(1e3,t.length-3*188);var i=0;while(i<r){if(t[i]===71&&t[i+188]===71&&t[i+2*188]===71){return i}else{i++}}return-1};R.createTrack=function e(t,r){return{container:t==="video"||t==="audio"?"video/mp2t":undefined,type:t,id:_["RemuxerTrackIdConfig"][t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?r:undefined}};var e=R.prototype;e.resetInitSegment=function e(t,r,i,n){this.pmtParsed=false;this._pmtId=-1;this._avcTrack=R.createTrack("video");this._audioTrack=R.createTrack("audio",n);this._id3Track=R.createTrack("id3");this._txtTrack=R.createTrack("text");this._audioTrack.segmentCodec="aac";this.aacOverFlow=null;this.avcSample=null;this.audioCodec=r;this.videoCodec=i;this._duration=n};e.resetTimeStamp=function e(){};e.resetContiguity=function e(){var t=this._audioTrack,r=this._avcTrack,i=this._id3Track;if(t){t.pesData=null}if(r){r.pesData=null}if(i){i.pesData=null}this.aacOverFlow=null};e.demux=function e(t,r,i,n){if(i===void 0){i=false}if(n===void 0){n=false}if(!i){this.sampleAes=null}var a;var s=this._avcTrack;var o=this._audioTrack;var l=this._id3Track;var u=this._txtTrack;var c=s.pid;var d=s.pesData;var f=o.pid;var h=l.pid;var v=o.pesData;var g=l.pesData;var p=false;var m=this.pmtParsed;var y=this._pmtId;var b=t.length;if(this.remainderData){t=Object(_["appendUint8Array"])(this.remainderData,t);b=t.length;this.remainderData=null}if(b<188&&!n){this.remainderData=t;return{audioTrack:o,videoTrack:s,id3Track:l,textTrack:u}}var T=Math.max(0,R.syncOffset(t));b-=(b+T)%188;if(b<t.byteLength&&!n){this.remainderData=new Uint8Array(t.buffer,b,t.buffer.byteLength-b)}var E=0;for(var S=T;S<b;S+=188){if(t[S]===71){var k=!!(t[S+1]&64);var A=((t[S+1]&31)<<8)+t[S+2];var L=(t[S+3]&48)>>4;var D=void 0;if(L>1){D=S+5+t[S+4];if(D===S+188){continue}}else{D=S+4}switch(A){case c:if(k){if(d&&(a=F(d))){this.parseAVCPES(s,u,a,false)}d={data:[],size:0}}if(d){d.data.push(t.subarray(D,S+188));d.size+=S+188-D}break;case f:if(k){if(v&&(a=F(v))){switch(o.segmentCodec){case"aac":this.parseAACPES(o,a);break;case"mp3":this.parseMPEGPES(o,a);break}}v={data:[],size:0}}if(v){v.data.push(t.subarray(D,S+188));v.size+=S+188-D}break;case h:if(k){if(g&&(a=F(g))){this.parseID3PES(l,a)}g={data:[],size:0}}if(g){g.data.push(t.subarray(D,S+188));g.size+=S+188-D}break;case 0:if(k){D+=t[D]+1}y=this._pmtId=x(t,D);break;case y:{if(k){D+=t[D]+1}var w=M(t,D,this.typeSupported,i);c=w.avc;if(c>0){s.pid=c}f=w.audio;if(f>0){o.pid=f;o.segmentCodec=w.segmentCodec}h=w.id3;if(h>0){l.pid=h}if(p&&!m){O["logger"].log("reparse from beginning");p=false;S=T-188}m=this.pmtParsed=true;break}case 17:case 8191:break;default:p=true;break}}else{E++}}if(E>0){this.observer.emit(I["Events"].ERROR,I["Events"].ERROR,{type:P["ErrorTypes"].MEDIA_ERROR,details:P["ErrorDetails"].FRAG_PARSING_ERROR,fatal:false,reason:"Found "+E+" TS packet/s that do not start with 0x47"})}s.pesData=d;o.pesData=v;l.pesData=g;var C={audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};if(n){this.extractRemainingSamples(C)}return C};e.flush=function e(){var t=this.remainderData;this.remainderData=null;var r;if(t){r=this.demux(t,-1,false,true)}else{r={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack}}this.extractRemainingSamples(r);if(this.sampleAes){return this.decrypt(r,this.sampleAes)}return r};e.extractRemainingSamples=function e(t){var r=t.audioTrack,i=t.videoTrack,n=t.id3Track,a=t.textTrack;var s=i.pesData;var o=r.pesData;var l=n.pesData;var u;if(s&&(u=F(s))){this.parseAVCPES(i,a,u,true);i.pesData=null}else{i.pesData=s}if(o&&(u=F(o))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,u);break;case"mp3":this.parseMPEGPES(r,u);break}r.pesData=null}else{if(o!==null&&o!==void 0&&o.size){O["logger"].log("last AAC PES packet truncated,might overlap between fragments")}r.pesData=o}if(l&&(u=F(l))){this.parseID3PES(n,u);n.pesData=null}else{n.pesData=l}};e.demuxSampleAes=function e(t,r,i){var n=this.demux(t,i,true,!this.config.progressive);var a=this.sampleAes=new s["default"](this.observer,this.config,r);return this.decrypt(n,a)};e.decrypt=function e(i,n){return new Promise(function(e){var t=i.audioTrack,r=i.videoTrack;if(t.samples&&t.segmentCodec==="aac"){n.decryptAacSamples(t.samples,0,function(){if(r.samples){n.decryptAvcSamples(r.samples,0,0,function(){e(i)})}else{e(i)}})}else if(r.samples){n.decryptAvcSamples(r.samples,0,0,function(){e(i)})}})};e.destroy=function e(){this._duration=0};e.parseAVCPES=function e(c,d,f,t){var h=this;var r=this.parseAVCNALu(c,f.data);var v=false;var g=this.avcSample;var p;var m=false;f.data=null;if(g&&r.length&&!c.audFound){E(g,c);g=this.avcSample=T(false,f.pts,f.dts,"")}r.forEach(function(e){switch(e.type){case 1:{p=true;if(!g){g=h.avcSample=T(true,f.pts,f.dts,"")}if(v){g.debug+="NDR "}g.frame=true;var t=e.data;if(m&&t.length>4){var r=new b["default"](t).readSliceType();if(r===2||r===4||r===7||r===9){g.key=true}}break}case 5:p=true;if(!g){g=h.avcSample=T(true,f.pts,f.dts,"")}if(v){g.debug+="IDR "}g.key=true;g.frame=true;break;case 6:{p=true;if(v&&g){g.debug+="SEI "}Object(_["parseSEIMessageFromNALu"])(S(e.data),f.pts,d.samples);break}case 7:p=true;m=true;if(v&&g){g.debug+="SPS "}if(!c.sps){var i=new b["default"](e.data);var n=i.readSPS();c.width=n.width;c.height=n.height;c.pixelRatio=n.pixelRatio;c.sps=[e.data];c.duration=h._duration;var a=e.data.subarray(1,4);var s="avc1.";for(var o=0;o<3;o++){var l=a[o].toString(16);if(l.length<2){l="0"+l}s+=l}c.codec=s}break;case 8:p=true;if(v&&g){g.debug+="PPS "}if(!c.pps){c.pps=[e.data]}break;case 9:p=false;c.audFound=true;if(g){E(g,c)}g=h.avcSample=T(false,f.pts,f.dts,v?"AUD ":"");break;case 12:p=true;break;default:p=false;if(g){g.debug+="unknown NAL "+e.type+" "}break}if(g&&p){var u=g.units;u.push(e)}});if(t&&g){E(g,c);this.avcSample=null}};e.getLastNalUnit=function e(t){var r;var i=this.avcSample;var n;if(!i||i.units.length===0){i=t[t.length-1]}if((r=i)!==null&&r!==void 0&&r.units){var a=i.units;n=a[a.length-1]}return n};e.parseAVCNALu=function e(t,r){var i=r.byteLength;var n=t.naluState||0;var a=n;var s=[];var o=0;var l;var u;var c;var d=-1;var f=0;if(n===-1){d=0;f=r[0]&31;n=0;o=1}while(o<i){l=r[o++];if(!n){n=l?0:1;continue}if(n===1){n=l?0:2;continue}if(!l){n=3}else if(l===1){if(d>=0){var h={data:r.subarray(d,o-n-1),type:f};s.push(h)}else{var v=this.getLastNalUnit(t.samples);if(v){if(a&&o<=4-a){if(v.state){v.data=v.data.subarray(0,v.data.byteLength-a)}}u=o-n-1;if(u>0){var g=new Uint8Array(v.data.byteLength+u);g.set(v.data,0);g.set(r.subarray(0,u),v.data.byteLength);v.data=g;v.state=0}}}if(o<i){c=r[o]&31;d=o;f=c;n=0}else{n=-1}}else{n=0}}if(d>=0&&n>=0){var p={data:r.subarray(d,i),type:f,state:n};s.push(p)}if(s.length===0){var m=this.getLastNalUnit(t.samples);if(m){var y=new Uint8Array(m.data.byteLength+r.byteLength);y.set(m.data,0);y.set(r,m.data.byteLength);m.data=y}}t.naluState=n;return s};e.parseAACPES=function e(t,r){var i=0;var n=this.aacOverFlow;var a=r.data;if(n){this.aacOverFlow=null;var s=n.missing;var o=n.sample.unit.byteLength;if(s===-1){var l=new Uint8Array(o+a.byteLength);l.set(n.sample.unit,0);l.set(a,o);a=l}else{var u=o-s;n.sample.unit.set(a.subarray(0,s),u);t.samples.push(n.sample);i=n.missing}}var c;var d;for(c=i,d=a.length;c<d-1;c++){if(y["isHeader"](a,c)){break}}if(c!==i){var f;var h;if(c<d-1){f="AAC PES did not start with ADTS header,offset:"+c;h=false}else{f="no ADTS header found in AAC PES";h=true}O["logger"].warn("parsing error:"+f);this.observer.emit(I["Events"].ERROR,I["Events"].ERROR,{type:P["ErrorTypes"].MEDIA_ERROR,details:P["ErrorDetails"].FRAG_PARSING_ERROR,fatal:h,reason:f});if(h){return}}y["initTrackConfig"](t,this.observer,a,c,this.audioCodec);var v;if(r.pts!==undefined){v=r.pts}else if(n){var g=y["getFrameDuration"](t.samplerate);v=n.sample.pts+g}else{O["logger"].warn("[tsdemuxer]: AAC PES unknown PTS");return}var p=0;var m;while(c<d){m=y["appendFrame"](t,a,c,v,p);c+=m.length;if(!m.missing){p++;for(;c<d-1;c++){if(y["isHeader"](a,c)){break}}}else{this.aacOverFlow=m;break}}};e.parseMPEGPES=function e(t,r){var i=r.data;var n=i.length;var a=0;var s=0;var o=r.pts;if(o===undefined){O["logger"].warn("[tsdemuxer]: MPEG PES unknown PTS");return}while(s<n){if(u["isHeader"](i,s)){var l=u["appendFrame"](t,i,s,o,a);if(l){s+=l.length;a++}else{break}}else{s++}}};e.parseID3PES=function e(t,r){if(r.pts===undefined){O["logger"].warn("[tsdemuxer]: ID3 PES unknown PTS");return}var i=a({},r,{type:this._avcTrack?n["MetadataSchema"].emsg:n["MetadataSchema"].audioId3});t.samples.push(i)};return R}();i.minProbeByteLength=188;function T(e,t,r,i){return{key:e,frame:false,pts:t,dts:r,units:[],debug:i,length:0}}function x(e,t){return(e[t+10]&31)<<8|e[t+11]}function M(e,t,r,i){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"};var a=(e[t+1]&15)<<8|e[t+2];var s=t+3+a-4;var o=(e[t+10]&15)<<8|e[t+11];t+=12+o;while(t<s){var l=(e[t+1]&31)<<8|e[t+2];switch(e[t]){case 207:if(!i){O["logger"].log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:if(n.audio===-1){n.audio=l}break;case 21:if(n.id3===-1){n.id3=l}break;case 219:if(!i){O["logger"].log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:if(n.avc===-1){n.avc=l}break;case 3:case 4:if(r.mpeg!==true&&r.mp3!==true){O["logger"].log("MPEG audio found, not supported in this browser")}else if(n.audio===-1){n.audio=l;n.segmentCodec="mp3"}break;case 36:O["logger"].warn("Unsupported HEVC stream type found");break;default:break}t+=((e[t+3]&15)<<8|e[t+4])+5}return n}function F(e){var t=0;var r;var i;var n;var a;var s;var o=e.data;if(!e||e.size===0){return null}while(o[0].length<19&&o.length>1){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]);l.set(o[1],o[0].length);o[0]=l;o.splice(1,1)}r=o[0];var u=(r[0]<<16)+(r[1]<<8)+r[2];if(u===1){i=(r[4]<<8)+r[5];if(i&&i>e.size-6){return null}var c=r[7];if(c&192){a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2;if(c&64){s=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2;if(a-s>60*9e4){O["logger"].warn(Math.round((a-s)/9e4)+"s delta between PTS and DTS, align them");a=s}}else{s=a}}n=r[8];var d=n+9;if(e.size<=d){return null}e.size-=d;var f=new Uint8Array(e.size);for(var h=0,v=o.length;h<v;h++){r=o[h];var g=r.byteLength;if(d){if(d>g){d-=g;continue}else{r=r.subarray(d);g-=d;d=0}}f.set(r,t);t+=g}if(i){i-=n+3}return{data:f,pts:a,dts:s,len:i}}return null}function E(e,t){if(e.units.length&&e.frame){if(e.pts===undefined){var r=t.samples;var i=r.length;if(i){var n=r[i-1];e.pts=n.pts;e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}if(e.debug.length){O["logger"].log(e.pts+"/"+e.dts+":"+e.debug)}}function S(e){var t=e.byteLength;var r=[];var i=1;while(i<t-2){if(e[i]===0&&e[i+1]===0&&e[i+2]===3){r.push(i+2);i+=2}else{i++}}if(r.length===0){return e}var n=t-r.length;var a=new Uint8Array(n);var s=0;for(i=0;i<n;s++,i++){if(s===r[0]){s++;r.shift()}a[i]=e[s]}return a}t["default"]=i},"./src/errors.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"ErrorTypes",function(){return i});r.d(t,"ErrorDetails",function(){return n});var i;(function(e){e["NETWORK_ERROR"]="networkError";e["MEDIA_ERROR"]="mediaError";e["KEY_SYSTEM_ERROR"]="keySystemError";e["MUX_ERROR"]="muxError";e["OTHER_ERROR"]="otherError"})(i||(i={}));var n;(function(e){e["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys";e["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess";e["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession";e["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed";e["KEY_SYSTEM_NO_INIT_DATA"]="keySystemNoInitData";e["MANIFEST_LOAD_ERROR"]="manifestLoadError";e["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut";e["MANIFEST_PARSING_ERROR"]="manifestParsingError";e["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError";e["LEVEL_EMPTY_ERROR"]="levelEmptyError";e["LEVEL_LOAD_ERROR"]="levelLoadError";e["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut";e["LEVEL_SWITCH_ERROR"]="levelSwitchError";e["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError";e["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut";e["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError";e["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut";e["FRAG_LOAD_ERROR"]="fragLoadError";e["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut";e["FRAG_DECRYPT_ERROR"]="fragDecryptError";e["FRAG_PARSING_ERROR"]="fragParsingError";e["REMUX_ALLOC_ERROR"]="remuxAllocError";e["KEY_LOAD_ERROR"]="keyLoadError";e["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut";e["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError";e["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError";e["BUFFER_APPEND_ERROR"]="bufferAppendError";e["BUFFER_APPENDING_ERROR"]="bufferAppendingError";e["BUFFER_STALLED_ERROR"]="bufferStalledError";e["BUFFER_FULL_ERROR"]="bufferFullError";e["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole";e["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall";e["INTERNAL_EXCEPTION"]="internalException";e["INTERNAL_ABORTED"]="aborted";e["UNKNOWN"]="unknown"})(n||(n={}))},"./src/events.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"Events",function(){return i});var i;(function(e){e["MEDIA_ATTACHING"]="hlsMediaAttaching";e["MEDIA_ATTACHED"]="hlsMediaAttached";e["MEDIA_DETACHING"]="hlsMediaDetaching";e["MEDIA_DETACHED"]="hlsMediaDetached";e["BUFFER_RESET"]="hlsBufferReset";e["BUFFER_CODECS"]="hlsBufferCodecs";e["BUFFER_CREATED"]="hlsBufferCreated";e["BUFFER_APPENDING"]="hlsBufferAppending";e["BUFFER_APPENDED"]="hlsBufferAppended";e["BUFFER_EOS"]="hlsBufferEos";e["BUFFER_FLUSHING"]="hlsBufferFlushing";e["BUFFER_FLUSHED"]="hlsBufferFlushed";e["MANIFEST_LOADING"]="hlsManifestLoading";e["MANIFEST_LOADED"]="hlsManifestLoaded";e["MANIFEST_PARSED"]="hlsManifestParsed";e["LEVEL_SWITCHING"]="hlsLevelSwitching";e["LEVEL_SWITCHED"]="hlsLevelSwitched";e["LEVEL_LOADING"]="hlsLevelLoading";e["LEVEL_LOADED"]="hlsLevelLoaded";e["LEVEL_UPDATED"]="hlsLevelUpdated";e["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated";e["LEVELS_UPDATED"]="hlsLevelsUpdated";e["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated";e["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching";e["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched";e["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading";e["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded";e["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated";e["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared";e["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch";e["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading";e["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded";e["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed";e["CUES_PARSED"]="hlsCuesParsed";e["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound";e["INIT_PTS_FOUND"]="hlsInitPtsFound";e["FRAG_LOADING"]="hlsFragLoading";e["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted";e["FRAG_LOADED"]="hlsFragLoaded";e["FRAG_DECRYPTED"]="hlsFragDecrypted";e["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment";e["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata";e["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata";e["FRAG_PARSED"]="hlsFragParsed";e["FRAG_BUFFERED"]="hlsFragBuffered";e["FRAG_CHANGED"]="hlsFragChanged";e["FPS_DROP"]="hlsFpsDrop";e["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping";e["ERROR"]="hlsError";e["DESTROYING"]="hlsDestroying";e["KEY_LOADING"]="hlsKeyLoading";e["KEY_LOADED"]="hlsKeyLoaded";e["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached";e["BACK_BUFFER_REACHED"]="hlsBackBufferReached"})(i||(i={}))},"./src/hls.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return d});var a=r("./node_modules/url-toolkit/src/url-toolkit.js");var i=r.n(a);var b=r("./src/loader/playlist-loader.ts");var T=r("./src/loader/key-loader.ts");var E=r("./src/controller/id3-track-controller.ts");var S=r("./src/controller/latency-controller.ts");var k=r("./src/controller/level-controller.ts");var A=r("./src/controller/fragment-tracker.ts");var L=r("./src/controller/stream-controller.ts");var n=r("./src/is-supported.ts");var D=r("./src/utils/logger.ts");var w=r("./src/config.ts");var C=r("./node_modules/eventemitter3/index.js");var s=r.n(C);var o=r("./src/events.ts");var l=r("./src/errors.ts");function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function c(e,t,r){if(t)u(e.prototype,t);if(r)u(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var d=function(){y.isSupported=function e(){return Object(n["isSupported"])()};function y(e){if(e===void 0){e={}}this.config=void 0;this.userConfig=void 0;this.coreComponents=void 0;this.networkControllers=void 0;this._emitter=new C["EventEmitter"];this._autoLevelCapping=void 0;this.abrController=void 0;this.bufferController=void 0;this.capLevelController=void 0;this.latencyController=void 0;this.levelController=void 0;this.streamController=void 0;this.audioTrackController=void 0;this.subtitleTrackController=void 0;this.emeController=void 0;this.cmcdController=void 0;this._media=null;this.url=null;var t=this.config=Object(w["mergeConfig"])(y.DefaultConfig,e);this.userConfig=e;Object(D["enableLogs"])(t.debug);this._autoLevelCapping=-1;if(t.progressive){Object(w["enableStreamingMode"])(t)}var r=t.abrController,i=t.bufferController,n=t.capLevelController,a=t.fpsController;var s=this.abrController=new r(this);var o=this.bufferController=new i(this);var l=this.capLevelController=new n(this);var u=new a(this);var c=new b["default"](this);var d=new T["default"](this);var f=new E["default"](this);var h=this.levelController=new k["default"](this);var v=new A["FragmentTracker"](this);var g=this.streamController=new L["default"](this,v);l.setStreamController(g);u.setStreamController(g);var p=[h,g];this.networkControllers=p;var m=[c,d,s,o,l,u,f,v];this.audioTrackController=this.createController(t.audioTrackController,null,p);this.createController(t.audioStreamController,v,p);this.subtitleTrackController=this.createController(t.subtitleTrackController,null,p);this.createController(t.subtitleStreamController,v,p);this.createController(t.timelineController,null,m);this.emeController=this.createController(t.emeController,null,m);this.cmcdController=this.createController(t.cmcdController,null,m);this.latencyController=this.createController(S["default"],null,m);this.coreComponents=m}var e=y.prototype;e.createController=function e(t,r,i){if(t){var n=r?new t(this,r):new t(this);if(i){i.push(n)}return n}return null};e.on=function e(t,r,i){if(i===void 0){i=this}this._emitter.on(t,r,i)};e.once=function e(t,r,i){if(i===void 0){i=this}this._emitter.once(t,r,i)};e.removeAllListeners=function e(t){this._emitter.removeAllListeners(t)};e.off=function e(t,r,i,n){if(i===void 0){i=this}this._emitter.off(t,r,i,n)};e.listeners=function e(t){return this._emitter.listeners(t)};e.emit=function e(t,r,i){return this._emitter.emit(t,r,i)};e.trigger=function e(t,r){if(this.config.debug){return this.emit(t,t,r)}else{try{return this.emit(t,t,r)}catch(e){D["logger"].error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e);this.trigger(o["Events"].ERROR,{type:l["ErrorTypes"].OTHER_ERROR,details:l["ErrorDetails"].INTERNAL_EXCEPTION,fatal:false,event:t,error:e})}}return false};e.listenerCount=function e(t){return this._emitter.listenerCount(t)};e.destroy=function e(){D["logger"].log("destroy");this.trigger(o["Events"].DESTROYING,undefined);this.detachMedia();this.removeAllListeners();this._autoLevelCapping=-1;this.url=null;this.networkControllers.forEach(function(e){return e.destroy()});this.networkControllers.length=0;this.coreComponents.forEach(function(e){return e.destroy()});this.coreComponents.length=0};e.attachMedia=function e(t){D["logger"].log("attachMedia");this._media=t;this.trigger(o["Events"].MEDIA_ATTACHING,{media:t})};e.detachMedia=function e(){D["logger"].log("detachMedia");this.trigger(o["Events"].MEDIA_DETACHING,undefined);this._media=null};e.loadSource=function e(t){this.stopLoad();var r=this.media;var i=this.url;var n=this.url=a["buildAbsoluteURL"](self.location.href,t,{alwaysNormalize:true});D["logger"].log("loadSource:"+n);if(r&&i&&i!==n&&this.bufferController.hasSourceTypes()){this.detachMedia();this.attachMedia(r)}this.trigger(o["Events"].MANIFEST_LOADING,{url:t})};e.startLoad=function e(t){if(t===void 0){t=-1}D["logger"].log("startLoad("+t+")");this.networkControllers.forEach(function(e){e.startLoad(t)})};e.stopLoad=function e(){D["logger"].log("stopLoad");this.networkControllers.forEach(function(e){e.stopLoad()})};e.swapAudioCodec=function e(){D["logger"].log("swapAudioCodec");this.streamController.swapAudioCodec()};e.recoverMediaError=function e(){D["logger"].log("recoverMediaError");var t=this._media;this.detachMedia();if(t){this.attachMedia(t)}};e.removeLevel=function e(t,r){if(r===void 0){r=0}this.levelController.removeLevel(t,r)};c(y,[{key:"levels",get:function e(){var t=this.levelController.levels;return t?t:[]}},{key:"currentLevel",get:function e(){return this.streamController.currentLevel},set:function e(t){D["logger"].log("set currentLevel:"+t);this.loadLevel=t;this.abrController.clearTimer();this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function e(){return this.streamController.nextLevel},set:function e(t){D["logger"].log("set nextLevel:"+t);this.levelController.manualLevel=t;this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function e(){return this.levelController.level},set:function e(t){D["logger"].log("set loadLevel:"+t);this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function e(){return this.levelController.nextLoadLevel},set:function e(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function e(t){D["logger"].log("set firstLevel:"+t);this.levelController.firstLevel=t}},{key:"startLevel",get:function e(){return this.levelController.startLevel},set:function e(t){D["logger"].log("set startLevel:"+t);if(t!==-1){t=Math.max(t,this.minAutoLevel)}this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function e(){return this.config.capLevelToPlayerSize},set:function e(t){var r=!!t;if(r!==this.config.capLevelToPlayerSize){if(r){this.capLevelController.startCapping()}else{this.capLevelController.stopCapping();this.autoLevelCapping=-1;this.streamController.nextLevelSwitch()}this.config.capLevelToPlayerSize=r}}},{key:"autoLevelCapping",get:function e(){return this._autoLevelCapping},set:function e(t){if(this._autoLevelCapping!==t){D["logger"].log("set autoLevelCapping:"+t);this._autoLevelCapping=t}}},{key:"bandwidthEstimate",get:function e(){var t=this.abrController.bwEstimator;if(!t){return NaN}return t.getEstimate()}},{key:"autoLevelEnabled",get:function e(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function e(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function e(){var t=this.levels,r=this.config.minAutoBitrate;if(!t)return 0;var i=t.length;for(var n=0;n<i;n++){if(t[n].maxBitrate>=r){return n}}return 0}},{key:"maxAutoLevel",get:function e(){var t=this.levels,r=this.autoLevelCapping;var i;if(r===-1&&t&&t.length){i=t.length-1}else{i=r}return i}},{key:"nextAutoLevel",get:function e(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function e(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function e(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function e(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function e(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function e(t){var r=this.audioTrackController;if(r){r.audioTrack=t}}},{key:"subtitleTracks",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function e(t){var r=this.subtitleTrackController;if(r){r.subtitleTrack=t}}},{key:"media",get:function e(){return this._media}},{key:"subtitleDisplay",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleDisplay:false},set:function e(t){var r=this.subtitleTrackController;if(r){r.subtitleDisplay=t}}},{key:"lowLatencyMode",get:function e(){return this.config.lowLatencyMode},set:function e(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function e(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function e(){return this.latencyController.latency}},{key:"maxLatency",get:function e(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function e(){return this.latencyController.targetLatency}},{key:"drift",get:function e(){return this.latencyController.drift}},{key:"forceStartLoad",get:function e(){return this.streamController.forceStartLoad}}],[{key:"version",get:function e(){return"1.2.1"}},{key:"Events",get:function e(){return o["Events"]}},{key:"ErrorTypes",get:function e(){return l["ErrorTypes"]}},{key:"ErrorDetails",get:function e(){return l["ErrorDetails"]}},{key:"DefaultConfig",get:function e(){if(!y.defaultConfig){return w["hlsDefaultConfig"]}return y.defaultConfig},set:function e(t){y.defaultConfig=t}}]);return y}();d.defaultConfig=void 0},"./src/is-supported.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"isSupported",function(){return i});r.d(t,"changeTypeSupported",function(){return s});var n=r("./src/utils/mediasource-helper.ts");function a(){return self.SourceBuffer||self.WebKitSourceBuffer}function i(){var e=Object(n["getMediaSource"])();if(!e){return false}var t=a();var r=e&&typeof e.isTypeSupported==="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var i=!t||t.prototype&&typeof t.prototype.appendBuffer==="function"&&typeof t.prototype.remove==="function";return!!r&&!!i}function s(){var e;var t=a();return typeof(t===null||t===void 0?void 0:(e=t.prototype)===null||e===void 0?void 0:e.changeType)==="function"}},"./src/loader/date-range.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"DateRangeAttribute",function(){return u});r.d(t,"DateRange",function(){return c});var a=r("./src/polyfills/number.ts");var s=r("./src/utils/attr-list.ts");var o=r("./src/utils/logger.ts");function l(){l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return l.apply(this,arguments)}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function n(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var u;(function(e){e["ID"]="ID";e["CLASS"]="CLASS";e["START_DATE"]="START-DATE";e["DURATION"]="DURATION";e["END_DATE"]="END-DATE";e["END_ON_NEXT"]="END-ON-NEXT";e["PLANNED_DURATION"]="PLANNED-DURATION";e["SCTE35_OUT"]="SCTE35-OUT";e["SCTE35_IN"]="SCTE35-IN"})(u||(u={}));var c=function(){function e(e,t){this.attr=void 0;this._startDate=void 0;this._endDate=void 0;this._badValueForSameId=void 0;if(t){var r=t.attr;for(var i in r){if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==r[i]){o["logger"].warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+e.ID+'"');this._badValueForSameId=i;break}}e=l(new s["AttrList"]({}),r,e)}this.attr=e;this._startDate=new Date(e[u.START_DATE]);if(u.END_DATE in this.attr){var n=new Date(this.attr[u.END_DATE]);if(Object(a["isFiniteNumber"])(n.getTime())){this._endDate=n}}}n(e,[{key:"id",get:function e(){return this.attr.ID}},{key:"class",get:function e(){return this.attr.CLASS}},{key:"startDate",get:function e(){return this._startDate}},{key:"endDate",get:function e(){if(this._endDate){return this._endDate}var t=this.duration;if(t!==null){return new Date(this._startDate.getTime()+t*1e3)}return null}},{key:"duration",get:function e(){if(u.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(u.DURATION);if(Object(a["isFiniteNumber"])(t)){return t}}else if(this._endDate){return(this._endDate.getTime()-this._startDate.getTime())/1e3}return null}},{key:"plannedDuration",get:function e(){if(u.PLANNED_DURATION in this.attr){return this.attr.decimalFloatingPoint(u.PLANNED_DURATION)}return null}},{key:"endOnNext",get:function e(){return this.attr.bool(u.END_ON_NEXT)}},{key:"isValid",get:function e(){return!!this.id&&!this._badValueForSameId&&Object(a["isFiniteNumber"])(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]);return e}()},"./src/loader/fragment-loader.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return d});r.d(t,"LoadError",function(){return g});var s=r("./src/polyfills/number.ts");var f=r("./src/errors.ts");function i(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;u(e,t)}function n(e){var i=typeof Map==="function"?new Map:undefined;n=function e(t){if(t===null||!l(t))return t;if(typeof t!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof i!=="undefined"){if(i.has(t))return i.get(t);i.set(t,r)}function r(){return a(t,arguments,c(this).constructor)}r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:false,writable:true,configurable:true}});return u(r,t)};return n(e)}function a(e,t,r){if(o()){a=Reflect.construct.bind()}else{a=function e(t,r,i){var n=[null];n.push.apply(n,r);var a=Function.bind.apply(t,n);var s=new a;if(i)u(s,i.prototype);return s}}return a.apply(null,arguments)}function o(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function l(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function u(e,t){u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return u(e,t)}function c(e){c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return c(e)}var h=Math.pow(2,17);var d=function(){function e(e){this.config=void 0;this.loader=null;this.partLoadTimeout=-1;this.config=e}var t=e.prototype;t.destroy=function e(){if(this.loader){this.loader.destroy();this.loader=null}};t.abort=function e(){if(this.loader){this.loader.abort()}};t.load=function e(o,l){var u=this;var t=o.url;if(!t){return Promise.reject(new g({type:f["ErrorTypes"].NETWORK_ERROR,details:f["ErrorDetails"].FRAG_LOAD_ERROR,fatal:false,frag:o,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")))}this.abort();var r=this.config;var i=r.fLoader;var c=r.loader;return new Promise(function(a,n){if(u.loader){u.loader.destroy()}var s=u.loader=o.loader=i?new i(r):new c(r);var e=v(o);var t={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:o.sn==="initSegment"?Infinity:h};o.stats=s.stats;s.load(e,t,{onSuccess:function e(t,r,i,n){u.resetLoader(o,s);a({frag:o,part:null,payload:t.data,networkDetails:n})},onError:function e(t,r,i){u.resetLoader(o,s);n(new g({type:f["ErrorTypes"].NETWORK_ERROR,details:f["ErrorDetails"].FRAG_LOAD_ERROR,fatal:false,frag:o,response:t,networkDetails:i}))},onAbort:function e(t,r,i){u.resetLoader(o,s);n(new g({type:f["ErrorTypes"].NETWORK_ERROR,details:f["ErrorDetails"].INTERNAL_ABORTED,fatal:false,frag:o,networkDetails:i}))},onTimeout:function e(t,r,i){u.resetLoader(o,s);n(new g({type:f["ErrorTypes"].NETWORK_ERROR,details:f["ErrorDetails"].FRAG_LOAD_TIMEOUT,fatal:false,frag:o,networkDetails:i}))},onProgress:function e(t,r,i,n){if(l){l({frag:o,part:null,payload:i,networkDetails:n})}}})})};t.loadPart=function e(l,u,c){var d=this;this.abort();var r=this.config;var i=r.fLoader;var a=r.loader;return new Promise(function(s,n){if(d.loader){d.loader.destroy()}var o=d.loader=l.loader=i?new i(r):new a(r);var e=v(l,u);var t={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:h};u.stats=o.stats;o.load(e,t,{onSuccess:function e(t,r,i,n){d.resetLoader(l,o);d.updateStatsFromPart(l,u);var a={frag:l,part:u,payload:t.data,networkDetails:n};c(a);s(a)},onError:function e(t,r,i){d.resetLoader(l,o);n(new g({type:f["ErrorTypes"].NETWORK_ERROR,details:f["ErrorDetails"].FRAG_LOAD_ERROR,fatal:false,frag:l,part:u,response:t,networkDetails:i}))},onAbort:function e(t,r,i){l.stats.aborted=u.stats.aborted;d.resetLoader(l,o);n(new g({type:f["ErrorTypes"].NETWORK_ERROR,details:f["ErrorDetails"].INTERNAL_ABORTED,fatal:false,frag:l,part:u,networkDetails:i}))},onTimeout:function e(t,r,i){d.resetLoader(l,o);n(new g({type:f["ErrorTypes"].NETWORK_ERROR,details:f["ErrorDetails"].FRAG_LOAD_TIMEOUT,fatal:false,frag:l,part:u,networkDetails:i}))}})})};t.updateStatsFromPart=function e(t,r){var i=t.stats;var n=r.stats;var a=n.total;i.loaded+=n.loaded;if(a){var s=Math.round(t.duration/r.duration);var o=Math.min(Math.round(i.loaded/a),s);var l=s-o;var u=l*Math.round(i.loaded/o);i.total=i.loaded+u}else{i.total=Math.max(i.loaded,i.total)}var c=i.loading;var d=n.loading;if(c.start){c.first+=d.first-d.start}else{c.start=d.start;c.first=d.first}c.end=d.end};t.resetLoader=function e(t,r){t.loader=null;if(this.loader===r){self.clearTimeout(this.partLoadTimeout);this.loader=null}r.destroy()};return e}();function v(e,t){if(t===void 0){t=null}var r=t||e;var i={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0};var n=r.byteRangeStartOffset;var a=r.byteRangeEndOffset;if(Object(s["isFiniteNumber"])(n)&&Object(s["isFiniteNumber"])(a)){i.rangeStart=n;i.rangeEnd=a}return i}var g=function(a){i(e,a);function e(e){var t;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++){i[n-1]=arguments[n]}t=a.call.apply(a,[this].concat(i))||this;t.data=void 0;t.data=e;return t}return e}(n(Error))},"./src/loader/fragment.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"ElementaryStreamTypes",function(){return h});r.d(t,"BaseSegment",function(){return v});r.d(t,"Fragment",function(){return g});r.d(t,"Part",function(){return p});var n=r("./src/polyfills/number.ts");var i=r("./node_modules/url-toolkit/src/url-toolkit.js");var a=r.n(i);var s=r("./src/utils/logger.ts");var o=r("./src/loader/level-key.ts");var l=r("./src/loader/load-stats.ts");function u(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;c(e,t)}function c(e,t){c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return c(e,t)}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function f(e,t,r){if(t)d(e.prototype,t);if(r)d(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var h;(function(e){e["AUDIO"]="audio";e["VIDEO"]="video";e["AUDIOVIDEO"]="audiovideo"})(h||(h={}));var v=function(){function e(e){var t;this._byteRange=null;this._url=null;this.baseurl=void 0;this.relurl=void 0;this.elementaryStreams=(t={},t[h.AUDIO]=null,t[h.VIDEO]=null,t[h.AUDIOVIDEO]=null,t);this.baseurl=e}var t=e.prototype;t.setByteRange=function e(t,r){var i=t.split("@",2);var n=[];if(i.length===1){n[0]=r?r.byteRangeEndOffset:0}else{n[0]=parseInt(i[1])}n[1]=parseInt(i[0])+n[0];this._byteRange=n};f(e,[{key:"byteRange",get:function e(){if(!this._byteRange){return[]}return this._byteRange}},{key:"byteRangeStartOffset",get:function e(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function e(){return this.byteRange[1]}},{key:"url",get:function e(){if(!this._url&&this.baseurl&&this.relurl){this._url=Object(i["buildAbsoluteURL"])(this.baseurl,this.relurl,{alwaysNormalize:true})}return this._url||""},set:function e(t){this._url=t}}]);return e}();var g=function(i){u(e,i);function e(e,t){var r;r=i.call(this,t)||this;r._decryptdata=null;r.rawProgramDateTime=null;r.programDateTime=null;r.tagList=[];r.duration=0;r.sn=0;r.levelkey=void 0;r.type=void 0;r.loader=null;r.level=-1;r.cc=0;r.startPTS=void 0;r.endPTS=void 0;r.appendedPTS=void 0;r.startDTS=void 0;r.endDTS=void 0;r.start=0;r.deltaPTS=void 0;r.maxStartPTS=void 0;r.minEndPTS=void 0;r.stats=new l["LoadStats"];r.urlId=0;r.data=void 0;r.bitrateTest=false;r.title=null;r.initSegment=null;r.type=e;return r}var t=e.prototype;t.createInitializationVector=function e(t){var r=new Uint8Array(16);for(var i=12;i<16;i++){r[i]=t>>8*(15-i)&255}return r};t.setDecryptDataFromLevelKey=function e(t,r){var i=t;if((t===null||t===void 0?void 0:t.method)==="AES-128"&&t.uri&&!t.iv){i=o["LevelKey"].fromURI(t.uri);i.method=t.method;i.iv=this.createInitializationVector(r);i.keyFormat="identity"}return i};t.setElementaryStreamInfo=function e(t,r,i,n,a,s){if(s===void 0){s=false}var o=this.elementaryStreams;var l=o[t];if(!l){o[t]={startPTS:r,endPTS:i,startDTS:n,endDTS:a,partial:s};return}l.startPTS=Math.min(l.startPTS,r);l.endPTS=Math.max(l.endPTS,i);l.startDTS=Math.min(l.startDTS,n);l.endDTS=Math.max(l.endDTS,a)};t.clearElementaryStreamInfo=function e(){var t=this.elementaryStreams;t[h.AUDIO]=null;t[h.VIDEO]=null;t[h.AUDIOVIDEO]=null};f(e,[{key:"decryptdata",get:function e(){if(!this.levelkey&&!this._decryptdata){return null}if(!this._decryptdata&&this.levelkey){var t=this.sn;if(typeof t!=="number"){if(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv){s["logger"].warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue')}t=0}this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"end",get:function e(){return this.start+this.duration}},{key:"endProgramDateTime",get:function e(){if(this.programDateTime===null){return null}if(!Object(n["isFiniteNumber"])(this.programDateTime)){return null}var t=!Object(n["isFiniteNumber"])(this.duration)?0:this.duration;return this.programDateTime+t*1e3}},{key:"encrypted",get:function e(){var t;if((t=this.decryptdata)!==null&&t!==void 0&&t.keyFormat&&this.decryptdata.uri){return true}return false}}]);return e}(v);var p=function(o){u(e,o);function e(e,t,r,i,n){var a;a=o.call(this,r)||this;a.fragOffset=0;a.duration=0;a.gap=false;a.independent=false;a.relurl=void 0;a.fragment=void 0;a.index=void 0;a.stats=new l["LoadStats"];a.duration=e.decimalFloatingPoint("DURATION");a.gap=e.bool("GAP");a.independent=e.bool("INDEPENDENT");a.relurl=e.enumeratedString("URI");a.fragment=t;a.index=i;var s=e.enumeratedString("BYTERANGE");if(s){a.setByteRange(s,n)}if(n){a.fragOffset=n.fragOffset+n.duration}return a}f(e,[{key:"start",get:function e(){return this.fragment.start+this.fragOffset}},{key:"end",get:function e(){return this.start+this.duration}},{key:"loaded",get:function e(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]);return e}(v)},"./src/loader/key-loader.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var h=r("./src/events.ts");var a=r("./src/errors.ts");var v=r("./src/utils/logger.ts");var i=function(){function e(e){this.hls=void 0;this.loaders={};this.decryptkey=null;this.decrypturl=null;this.hls=e;this._registerListeners()}var t=e.prototype;t._registerListeners=function e(){this.hls.on(h["Events"].KEY_LOADING,this.onKeyLoading,this)};t._unregisterListeners=function e(){this.hls.off(h["Events"].KEY_LOADING,this.onKeyLoading)};t.destroy=function e(){this._unregisterListeners();for(var t in this.loaders){var r=this.loaders[t];if(r){r.destroy()}}this.loaders={}};t.onKeyLoading=function e(t,r){var i=r.frag;var n=i.type;var a=this.loaders[n];if(!i.decryptdata){v["logger"].warn("Missing decryption data on fragment in onKeyLoading");return}var s=i.decryptdata.uri;if(s!==this.decrypturl||this.decryptkey===null){var o=this.hls.config;if(a){v["logger"].warn("abort previous key loader for type:"+n);a.abort()}if(!s){v["logger"].warn("key uri is falsy");return}var l=o.loader;var u=i.loader=this.loaders[n]=new l(o);this.decrypturl=s;this.decryptkey=null;var c={url:s,frag:i,responseType:"arraybuffer"};var d={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:0};var f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(c,d,f)}else if(this.decryptkey){i.decryptdata.key=this.decryptkey;this.hls.trigger(h["Events"].KEY_LOADED,{frag:i})}};t.loadsuccess=function e(t,r,i){var n=i.frag;if(!n.decryptdata){v["logger"].error("after key load, decryptdata unset");return}this.decryptkey=n.decryptdata.key=new Uint8Array(t.data);n.loader=null;delete this.loaders[n.type];this.hls.trigger(h["Events"].KEY_LOADED,{frag:n})};t.loaderror=function e(t,r){var i=r.frag;var n=i.loader;if(n){n.abort()}delete this.loaders[i.type];this.hls.trigger(h["Events"].ERROR,{type:a["ErrorTypes"].NETWORK_ERROR,details:a["ErrorDetails"].KEY_LOAD_ERROR,fatal:false,frag:i,response:t})};t.loadtimeout=function e(t,r){var i=r.frag;var n=i.loader;if(n){n.abort()}delete this.loaders[i.type];this.hls.trigger(h["Events"].ERROR,{type:a["ErrorTypes"].NETWORK_ERROR,details:a["ErrorDetails"].KEY_LOAD_TIMEOUT,fatal:false,frag:i})};return e}()},"./src/loader/level-details.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"LevelDetails",function(){return o});var i=r("./src/polyfills/number.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function a(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var s=10;var o=function(){function e(e){this.PTSKnown=false;this.alignedSliding=false;this.averagetargetduration=void 0;this.endCC=0;this.endSN=0;this.fragments=void 0;this.fragmentHint=void 0;this.partList=null;this.dateRanges=void 0;this.live=true;this.ageHeader=0;this.advancedDateTime=void 0;this.updated=true;this.advanced=true;this.availabilityDelay=void 0;this.misses=0;this.needSidxRanges=false;this.startCC=0;this.startSN=0;this.startTimeOffset=null;this.targetduration=0;this.totalduration=0;this.type=null;this.url=void 0;this.m3u8="";this.version=null;this.canBlockReload=false;this.canSkipUntil=0;this.canSkipDateRanges=false;this.skippedSegments=0;this.recentlyRemovedDateranges=void 0;this.partHoldBack=0;this.holdBack=0;this.partTarget=0;this.preloadHint=void 0;this.renditionReports=void 0;this.tuneInGoal=0;this.deltaUpdateFailed=void 0;this.driftStartTime=0;this.driftEndTime=0;this.driftStart=0;this.driftEnd=0;this.fragments=[];this.dateRanges={};this.url=e}var t=e.prototype;t.reloaded=function e(t){if(!t){this.advanced=true;this.updated=true;return}var r=this.lastPartSn-t.lastPartSn;var i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!r;this.advanced=this.endSN>t.endSN||r>0||r===0&&i>0;if(this.updated||this.advanced){this.misses=Math.floor(t.misses*.6)}else{this.misses=t.misses+1}this.availabilityDelay=t.availabilityDelay};a(e,[{key:"hasProgramDateTime",get:function e(){if(this.fragments.length){return Object(i["isFiniteNumber"])(this.fragments[this.fragments.length-1].programDateTime)}return false}},{key:"levelTargetDuration",get:function e(){return this.averagetargetduration||this.targetduration||s}},{key:"drift",get:function e(){var t=this.driftEndTime-this.driftStartTime;if(t>0){var r=this.driftEnd-this.driftStart;return r*1e3/t}return 1}},{key:"edge",get:function e(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function e(){var t;if((t=this.partList)!==null&&t!==void 0&&t.length){return this.partList[this.partList.length-1].end}return this.fragmentEnd}},{key:"fragmentEnd",get:function e(){var t;if((t=this.fragments)!==null&&t!==void 0&&t.length){return this.fragments[this.fragments.length-1].end}return 0}},{key:"age",get:function e(){if(this.advancedDateTime){return Math.max(Date.now()-this.advancedDateTime,0)/1e3}return 0}},{key:"lastPartIndex",get:function e(){var t;if((t=this.partList)!==null&&t!==void 0&&t.length){return this.partList[this.partList.length-1].index}return-1}},{key:"lastPartSn",get:function e(){var t;if((t=this.partList)!==null&&t!==void 0&&t.length){return this.partList[this.partList.length-1].fragment.sn}return this.endSN}}]);return e}()},"./src/loader/level-key.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"LevelKey",function(){return o});var n=r("./node_modules/url-toolkit/src/url-toolkit.js");var i=r.n(n);function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function s(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var o=function(){i.fromURL=function e(t,r){return new i(t,r)};i.fromURI=function e(t){return new i(t)};function i(e,t){this._uri=null;this.method=null;this.keyFormat=null;this.keyFormatVersions=null;this.keyID=null;this.key=null;this.iv=null;if(t){this._uri=Object(n["buildAbsoluteURL"])(e,t,{alwaysNormalize:true})}else{this._uri=e}}s(i,[{key:"uri",get:function e(){return this._uri}}]);return i}()},"./src/loader/load-stats.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"LoadStats",function(){return i});var i=function e(){this.aborted=false;this.loaded=0;this.retry=0;this.total=0;this.chunkCount=0;this.bwEstimate=0;this.loading={start:0,first:0,end:0};this.parsing={start:0,end:0};this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return o});var ie=r("./src/polyfills/number.ts");var i=r("./node_modules/url-toolkit/src/url-toolkit.js");var n=r.n(i);var ne=r("./src/loader/date-range.ts");var ae=r("./src/loader/fragment.ts");var se=r("./src/loader/level-details.ts");var oe=r("./src/loader/level-key.ts");var le=r("./src/utils/attr-list.ts");var ue=r("./src/utils/logger.ts");var a=r("./src/utils/codecs.ts");var f=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g;var h=/#EXT-X-MEDIA:(.*)/g;var ce=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g");var de=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));var s=/\.(mp4|m4s|m4v|m4a)$/i;function fe(e){var t,r;return s.test((t=(r=i["parseURL"](e))===null||r===void 0?void 0:r.path)!=null?t:"")}var o=function(){function d(){}d.findGroup=function e(t,r){for(var i=0;i<t.length;i++){var n=t[i];if(n.id===r){return n}}};d.convertAVC1ToAVCOTI=function e(t){var r=t.split(".");if(r.length>2){var i=r.shift()+".";i+=parseInt(r.shift()).toString(16);i+=("000"+parseInt(r.shift()).toString(16)).slice(-4);return i}return t};d.resolve=function e(t,r){return i["buildAbsoluteURL"](r,t,{alwaysNormalize:true})};d.parseMasterPlaylist=function e(t,r){var i=[];var n={};var a=false;f.lastIndex=0;var s;while((s=f.exec(t))!=null){if(s[1]){var o=new le["AttrList"](s[1]);var l={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:d.resolve(s[2],r)};var u=o.decimalResolution("RESOLUTION");if(u){l.width=u.width;l.height=u.height}v((o.CODECS||"").split(/[ ,]+/).filter(function(e){return e}),l);if(l.videoCodec&&l.videoCodec.indexOf("avc1")!==-1){l.videoCodec=d.convertAVC1ToAVCOTI(l.videoCodec)}i.push(l)}else if(s[3]){var c=new le["AttrList"](s[3]);if(c["DATA-ID"]){a=true;n[c["DATA-ID"]]=c}}}return{levels:i,sessionData:a?n:null}};d.parseMasterPlaylistMedia=function e(t,r,i,n){if(n===void 0){n=[]}var a;var s=[];var o=0;h.lastIndex=0;while((a=h.exec(t))!==null){var l=new le["AttrList"](a[1]);if(l.TYPE===i){var u={attrs:l,bitrate:0,id:o++,groupId:l["GROUP-ID"],instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE||"",type:i,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:l.LANGUAGE,url:l.URI?d.resolve(l.URI,r):""};if(n.length){var c=d.findGroup(n,u.groupId)||n[0];g(u,c,"audioCodec");g(u,c,"textCodec")}s.push(u)}}return s};d.parseLevelPlaylist=function F(e,t,r,i,N){var n=new se["LevelDetails"](t);var a=n.fragments;var s=null;var o=0;var l=0;var u=0;var c=0;var d=null;var f=new ae["Fragment"](i,t);var h;var v;var g;var p=-1;var m=false;ce.lastIndex=0;n.m3u8=e;while((h=ce.exec(e))!==null){if(m){m=false;f=new ae["Fragment"](i,t);f.start=u;f.sn=o;f.cc=c;f.level=r;if(s){f.initSegment=s;f.rawProgramDateTime=s.rawProgramDateTime;s.rawProgramDateTime=null}}var y=h[1];if(y){f.duration=parseFloat(y);var b=(" "+h[2]).slice(1);f.title=b||null;f.tagList.push(b?["INF",y,b]:["INF",y])}else if(h[3]){if(Object(ie["isFiniteNumber"])(f.duration)){f.start=u;if(g){f.levelkey=g}f.sn=o;f.level=r;f.cc=c;f.urlId=N;a.push(f);f.relurl=(" "+h[3]).slice(1);ve(f,d);d=f;u+=f.duration;o++;l=0;m=true}}else if(h[4]){var T=(" "+h[4]).slice(1);if(d){f.setByteRange(T,d)}else{f.setByteRange(T)}}else if(h[5]){f.rawProgramDateTime=(" "+h[5]).slice(1);f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]);if(p===-1){p=a.length}}else{h=h[0].match(de);if(!h){ue["logger"].warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<h.length;v++){if(typeof h[v]!=="undefined"){break}}var E=(" "+h[v]).slice(1);var S=(" "+h[v+1]).slice(1);var k=h[v+2]?(" "+h[v+2]).slice(1):"";switch(E){case"PLAYLIST-TYPE":n.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":o=n.startSN=parseInt(S);break;case"SKIP":{var A=new le["AttrList"](S);var L=A.decimalInteger("SKIPPED-SEGMENTS");if(Object(ie["isFiniteNumber"])(L)){n.skippedSegments=L;for(var U=L;U--;){a.unshift(null)}o+=L}var D=A.enumeratedString("RECENTLY-REMOVED-DATERANGES");if(D){n.recentlyRemovedDateranges=D.split("\t")}break}case"TARGETDURATION":n.targetduration=parseFloat(S);break;case"VERSION":n.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":n.live=false;break;case"#":if(S||k){f.tagList.push(k?[S,k]:[S])}break;case"DISCONTINUITY":c++;f.tagList.push(["DIS"]);break;case"GAP":f.tagList.push([E]);break;case"BITRATE":f.tagList.push([E,S]);break;case"DATERANGE":{var B=new le["AttrList"](S);var w=new ne["DateRange"](B,n.dateRanges[B.ID]);if(w.isValid||n.skippedSegments){n.dateRanges[w.id]=w}else{ue["logger"].warn('Ignoring invalid DATERANGE tag: "'+S+'"')}f.tagList.push(["EXT-X-DATERANGE",S]);break}case"DISCONTINUITY-SEQUENCE":c=parseInt(S);break;case"KEY":{var j;var C=new le["AttrList"](S);var R=C.enumeratedString("METHOD");var G=C.URI;var H=C.hexadecimalInteger("IV");var K=C.enumeratedString("KEYFORMATVERSIONS");var V=C.enumeratedString("KEYID");var I=(j=C.enumeratedString("KEYFORMAT"))!=null?j:"identity";var W=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(W.indexOf(I)>-1){ue["logger"].warn("Keyformat "+I+" is not supported from the manifest");continue}else if(I!=="identity"){continue}if(R){g=oe["LevelKey"].fromURL(t,G);if(G&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(R)>=0){g.method=R;g.keyFormat=I;if(V){g.keyID=V}if(K){g.keyFormatVersions=K}g.iv=H}}break}case"START":{var q=new le["AttrList"](S);var Y=q.decimalFloatingPoint("TIME-OFFSET");if(Object(ie["isFiniteNumber"])(Y)){n.startTimeOffset=Y}break}case"MAP":{var $=new le["AttrList"](S);if(f.duration){var z=new ae["Fragment"](i,t);ge(z,$,r,g);s=z;f.initSegment=s;if(s.rawProgramDateTime&&!f.rawProgramDateTime){f.rawProgramDateTime=s.rawProgramDateTime}}else{ge(f,$,r,g);s=f;m=true}break}case"SERVER-CONTROL":{var _=new le["AttrList"](S);n.canBlockReload=_.bool("CAN-BLOCK-RELOAD");n.canSkipUntil=_.optionalFloat("CAN-SKIP-UNTIL",0);n.canSkipDateRanges=n.canSkipUntil>0&&_.bool("CAN-SKIP-DATERANGES");n.partHoldBack=_.optionalFloat("PART-HOLD-BACK",0);n.holdBack=_.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var X=new le["AttrList"](S);n.partTarget=X.decimalFloatingPoint("PART-TARGET");break}case"PART":{var O=n.partList;if(!O){O=n.partList=[]}var Q=l>0?O[O.length-1]:undefined;var J=l++;var Z=new ae["Part"](new le["AttrList"](S),f,t,J,Q);O.push(Z);f.duration+=Z.duration;break}case"PRELOAD-HINT":{var ee=new le["AttrList"](S);n.preloadHint=ee;break}case"RENDITION-REPORT":{var te=new le["AttrList"](S);n.renditionReports=n.renditionReports||[];n.renditionReports.push(te);break}default:ue["logger"].warn("line parsed but not handled: "+h);break}}}if(d&&!d.relurl){a.pop();u-=d.duration;if(n.partList){n.fragmentHint=d}}else if(n.partList){ve(f,d);f.cc=c;n.fragmentHint=f}var P=a.length;var x=a[0];var M=a[P-1];u+=n.skippedSegments*n.targetduration;if(u>0&&P&&M){n.averagetargetduration=u/P;var re=M.sn;n.endSN=re!=="initSegment"?re:0;if(x){n.startCC=x.cc;if(!x.initSegment){if(n.fragments.every(function(e){return e.relurl&&fe(e.relurl)})){ue["logger"].warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX");f=new ae["Fragment"](i,t);f.relurl=M.relurl;f.level=r;f.sn="initSegment";x.initSegment=f;n.needSidxRanges=true}}}}else{n.endSN=0;n.startCC=0}if(n.fragmentHint){u+=n.fragmentHint.duration}n.totalduration=u;n.endCC=c;if(p>0){he(a,p)}return n};return d}();function v(i,n){["video","audio","text"].forEach(function(t){var r=i.filter(function(e){return Object(a["isCodecType"])(e,t)});if(r.length){var e=r.filter(function(e){return e.lastIndexOf("avc1",0)===0||e.lastIndexOf("mp4a",0)===0});n[t+"Codec"]=e.length>0?e[0]:r[0];i=i.filter(function(e){return r.indexOf(e)===-1})}});n.unknownCodecs=i}function g(e,t,r){var i=t[r];if(i){e[r]=i}}function he(e,t){var r=e[t];for(var i=t;i--;){var n=e[i];if(!n){return}n.programDateTime=r.programDateTime-n.duration*1e3;r=n}}function ve(e,t){if(e.rawProgramDateTime){e.programDateTime=Date.parse(e.rawProgramDateTime)}else if(t!==null&&t!==void 0&&t.programDateTime){e.programDateTime=t.endProgramDateTime}if(!Object(ie["isFiniteNumber"])(e.programDateTime)){e.programDateTime=null;e.rawProgramDateTime=null}}function ge(e,t,r,i){e.relurl=t.URI;if(t.BYTERANGE){e.setByteRange(t.BYTERANGE)}e.level=r;e.sn="initSegment";if(i){e.levelkey=i}e.initSegment=null}},"./src/loader/playlist-loader.ts":function(e,t,r){"use strict";r.r(t);var m=r("./src/polyfills/number.ts");var y=r("./src/events.ts");var b=r("./src/errors.ts");var T=r("./src/utils/logger.ts");var l=r("./src/utils/mp4-tools.ts");var E=r("./src/loader/m3u8-parser.ts");var S=r("./src/types/loader.ts");var k=r("./src/utils/attr-list.ts");function A(e){var t=e.type;switch(t){case S["PlaylistContextType"].AUDIO_TRACK:return S["PlaylistLevelType"].AUDIO;case S["PlaylistContextType"].SUBTITLE_TRACK:return S["PlaylistLevelType"].SUBTITLE;default:return S["PlaylistLevelType"].MAIN}}function L(e,t){var r=e.url;if(r===undefined||r.indexOf("data:")===0){r=t.url}return r}var i=function(){function e(e){this.hls=void 0;this.loaders=Object.create(null);this.hls=e;this.registerListeners()}var t=e.prototype;t.registerListeners=function e(){var t=this.hls;t.on(y["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.on(y["Events"].LEVEL_LOADING,this.onLevelLoading,this);t.on(y["Events"].AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this);t.on(y["Events"].SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)};t.unregisterListeners=function e(){var t=this.hls;t.off(y["Events"].MANIFEST_LOADING,this.onManifestLoading,this);t.off(y["Events"].LEVEL_LOADING,this.onLevelLoading,this);t.off(y["Events"].AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this);t.off(y["Events"].SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)};t.createInternalLoader=function e(t){var r=this.hls.config;var i=r.pLoader;var n=r.loader;var a=i||n;var s=new a(r);t.loader=s;this.loaders[t.type]=s;return s};t.getInternalLoader=function e(t){return this.loaders[t.type]};t.resetInternalLoader=function e(t){if(this.loaders[t]){delete this.loaders[t]}};t.destroyInternalLoaders=function e(){for(var t in this.loaders){var r=this.loaders[t];if(r){r.destroy()}this.resetInternalLoader(t)}};t.destroy=function e(){this.unregisterListeners();this.destroyInternalLoaders()};t.onManifestLoading=function e(t,r){var i=r.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:S["PlaylistContextType"].MANIFEST,url:i,deliveryDirectives:null})};t.onLevelLoading=function e(t,r){var i=r.id,n=r.level,a=r.url,s=r.deliveryDirectives;this.load({id:i,groupId:null,level:n,responseType:"text",type:S["PlaylistContextType"].LEVEL,url:a,deliveryDirectives:s})};t.onAudioTrackLoading=function e(t,r){var i=r.id,n=r.groupId,a=r.url,s=r.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:S["PlaylistContextType"].AUDIO_TRACK,url:a,deliveryDirectives:s})};t.onSubtitleTrackLoading=function e(t,r){var i=r.id,n=r.groupId,a=r.url,s=r.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:S["PlaylistContextType"].SUBTITLE_TRACK,url:a,deliveryDirectives:s})};t.load=function e(t){var r;var i=this.hls.config;var n=this.getInternalLoader(t);if(n){var a=n.context;if(a&&a.url===t.url){T["logger"].trace("[playlist-loader]: playlist request ongoing");return}T["logger"].log("[playlist-loader]: aborting previous loader for type: "+t.type);n.abort()}var s;var o;var l;var u;switch(t.type){case S["PlaylistContextType"].MANIFEST:s=i.manifestLoadingMaxRetry;o=i.manifestLoadingTimeOut;l=i.manifestLoadingRetryDelay;u=i.manifestLoadingMaxRetryTimeout;break;case S["PlaylistContextType"].LEVEL:case S["PlaylistContextType"].AUDIO_TRACK:case S["PlaylistContextType"].SUBTITLE_TRACK:s=0;o=i.levelLoadingTimeOut;break;default:s=i.levelLoadingMaxRetry;o=i.levelLoadingTimeOut;l=i.levelLoadingRetryDelay;u=i.levelLoadingMaxRetryTimeout;break}n=this.createInternalLoader(t);if((r=t.deliveryDirectives)!==null&&r!==void 0&&r.part){var c;if(t.type===S["PlaylistContextType"].LEVEL&&t.level!==null){c=this.hls.levels[t.level].details}else if(t.type===S["PlaylistContextType"].AUDIO_TRACK&&t.id!==null){c=this.hls.audioTracks[t.id].details}else if(t.type===S["PlaylistContextType"].SUBTITLE_TRACK&&t.id!==null){c=this.hls.subtitleTracks[t.id].details}if(c){var d=c.partTarget;var f=c.targetduration;if(d&&f){o=Math.min(Math.max(d*3,f*.8)*1e3,o)}}}var h={timeout:o,maxRetry:s,retryDelay:l,maxRetryDelay:u,highWaterMark:0};var v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};n.load(t,h,v)};t.loadsuccess=function e(t,r,i,n){if(n===void 0){n=null}if(i.isSidxRequest){this.handleSidxRequest(t,i);this.handlePlaylistLoaded(t,r,i,n);return}this.resetInternalLoader(i.type);var a=t.data;if(a.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,i,"no EXTM3U delimiter",n);return}r.parsing.start=performance.now();if(a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0){this.handleTrackOrLevelPlaylist(t,r,i,n)}else{this.handleMasterPlaylist(t,r,i,n)}};t.loaderror=function e(t,r,i){if(i===void 0){i=null}this.handleNetworkError(r,i,false,t)};t.loadtimeout=function e(t,r,i){if(i===void 0){i=null}this.handleNetworkError(r,i,true)};t.handleMasterPlaylist=function e(t,r,i,n){var a=this.hls;var s=t.data;var o=L(t,i);var l=E["default"].parseMasterPlaylist(s,o),u=l.levels,c=l.sessionData;if(!u.length){this.handleManifestParsingError(t,i,"no level found in manifest",n);return}var d=u.map(function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}});var f=u.map(function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}});var h=E["default"].parseMasterPlaylistMedia(s,o,"AUDIO",d);var v=E["default"].parseMasterPlaylistMedia(s,o,"SUBTITLES",f);var g=E["default"].parseMasterPlaylistMedia(s,o,"CLOSED-CAPTIONS");if(h.length){var p=h.some(function(e){return!e.url});if(!p&&u[0].audioCodec&&!u[0].attrs.AUDIO){T["logger"].log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one");h.unshift({type:"main",name:"main",default:false,autoselect:false,forced:false,id:-1,attrs:new k["AttrList"]({}),bitrate:0,url:""})}}a.trigger(y["Events"].MANIFEST_LOADED,{levels:u,audioTracks:h,subtitles:v,captions:g,url:o,stats:r,networkDetails:n,sessionData:c})};t.handleTrackOrLevelPlaylist=function e(t,r,i,n){var a=this.hls;var s=i.id,o=i.level,l=i.type;var u=L(t,i);var c=Object(m["isFiniteNumber"])(s)?s:0;var d=Object(m["isFiniteNumber"])(o)?o:c;var f=A(i);var h=E["default"].parseLevelPlaylist(t.data,u,d,f,c);if(!h.fragments.length){a.trigger(y["Events"].ERROR,{type:b["ErrorTypes"].NETWORK_ERROR,details:b["ErrorDetails"].LEVEL_EMPTY_ERROR,fatal:false,url:u,reason:"no fragments found in level",level:typeof i.level==="number"?i.level:undefined});return}if(l===S["PlaylistContextType"].MANIFEST){var v={attrs:new k["AttrList"]({}),bitrate:0,details:h,name:"",url:u};a.trigger(y["Events"].MANIFEST_LOADED,{levels:[v],audioTracks:[],url:u,stats:r,networkDetails:n,sessionData:null})}r.parsing.end=performance.now();if(h.needSidxRanges){var g;var p=(g=h.fragments[0].initSegment)===null||g===void 0?void 0:g.url;this.load({url:p,isSidxRequest:true,type:l,level:o,levelDetails:h,id:s,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}i.levelDetails=h;this.handlePlaylistLoaded(t,r,i,n)};t.handleSidxRequest=function e(t,r){var s=new Uint8Array(t.data);var i=Object(l["findBox"])(s,["sidx"])[0];if(!i){return}var n=Object(l["parseSegmentIndex"])(i);if(!n){return}var a=n.references;var o=r.levelDetails;a.forEach(function(e,t){var r=e.info;var i=o.fragments[t];if(i.byteRange.length===0){i.setByteRange(String(1+r.end-r.start)+"@"+String(r.start))}if(i.initSegment){var n=Object(l["findBox"])(s,["moov"])[0];var a=n?n.length:null;i.initSegment.setByteRange(String(a)+"@0")}})};t.handleManifestParsingError=function e(t,r,i,n){this.hls.trigger(y["Events"].ERROR,{type:b["ErrorTypes"].NETWORK_ERROR,details:b["ErrorDetails"].MANIFEST_PARSING_ERROR,fatal:r.type===S["PlaylistContextType"].MANIFEST,url:t.url,reason:i,response:t,context:r,networkDetails:n})};t.handleNetworkError=function e(t,r,i,n){if(i===void 0){i=false}T["logger"].warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var a=b["ErrorDetails"].UNKNOWN;var s=false;var o=this.getInternalLoader(t);switch(t.type){case S["PlaylistContextType"].MANIFEST:a=i?b["ErrorDetails"].MANIFEST_LOAD_TIMEOUT:b["ErrorDetails"].MANIFEST_LOAD_ERROR;s=true;break;case S["PlaylistContextType"].LEVEL:a=i?b["ErrorDetails"].LEVEL_LOAD_TIMEOUT:b["ErrorDetails"].LEVEL_LOAD_ERROR;s=false;break;case S["PlaylistContextType"].AUDIO_TRACK:a=i?b["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT:b["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR;s=false;break;case S["PlaylistContextType"].SUBTITLE_TRACK:a=i?b["ErrorDetails"].SUBTITLE_TRACK_LOAD_TIMEOUT:b["ErrorDetails"].SUBTITLE_LOAD_ERROR;s=false;break}if(o){this.resetInternalLoader(t.type)}var l={type:b["ErrorTypes"].NETWORK_ERROR,details:a,fatal:s,url:t.url,loader:o,context:t,networkDetails:r};if(n){l.response=n}this.hls.trigger(y["Events"].ERROR,l)};t.handlePlaylistLoaded=function e(t,r,i,n){var a=i.type,s=i.level,o=i.id,l=i.groupId,u=i.loader,c=i.levelDetails,d=i.deliveryDirectives;if(!(c!==null&&c!==void 0&&c.targetduration)){this.handleManifestParsingError(t,i,"invalid target duration",n);return}if(!u){return}if(c.live){if(u.getCacheAge){c.ageHeader=u.getCacheAge()||0}if(!u.getCacheAge||isNaN(c.ageHeader)){c.ageHeader=0}}switch(a){case S["PlaylistContextType"].MANIFEST:case S["PlaylistContextType"].LEVEL:this.hls.trigger(y["Events"].LEVEL_LOADED,{details:c,level:s||0,id:o||0,stats:r,networkDetails:n,deliveryDirectives:d});break;case S["PlaylistContextType"].AUDIO_TRACK:this.hls.trigger(y["Events"].AUDIO_TRACK_LOADED,{details:c,id:o||0,groupId:l||"",stats:r,networkDetails:n,deliveryDirectives:d});break;case S["PlaylistContextType"].SUBTITLE_TRACK:this.hls.trigger(y["Events"].SUBTITLE_TRACK_LOADED,{details:c,id:o||0,groupId:l||"",stats:r,networkDetails:n,deliveryDirectives:d});break}};return e}();t["default"]=i},"./src/polyfills/number.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"isFiniteNumber",function(){return i});r.d(t,"MAX_SAFE_INTEGER",function(){return n});var i=Number.isFinite||function(e){return typeof e==="number"&&isFinite(e)};var n=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(e,t,r){"use strict";r.r(t);var i=function(){function e(){}e.getSilentFrame=function e(t,r){switch(t){case"mp4a.40.2":if(r===1){return new Uint8Array([0,200,0,128,35,128])}else if(r===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else if(r===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else if(r===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else if(r===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else if(r===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}break;default:if(r===1){return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(r===2){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}else if(r===3){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}break}return undefined};return e}();t["default"]=i},"./src/remux/mp4-generator.ts":function(e,t,r){"use strict";r.r(t);var l=Math.pow(2,32)-1;var i=function(){function h(){}h.init=function e(){h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in h.types){if(h.types.hasOwnProperty(t)){h.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]}}var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);h.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);var a=new Uint8Array([0,0,0,0,0,0,0,0]);h.STTS=h.STSC=h.STCO=a;h.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);h.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);h.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);h.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]);var o=new Uint8Array([97,118,99,49]);var l=new Uint8Array([0,0,0,1]);h.FTYP=h.box(h.types.ftyp,s,l,s,o);h.DINF=h.box(h.types.dinf,h.box(h.types.dref,n))};h.box=function e(t){var r=8;for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++){n[a-1]=arguments[a]}var s=n.length;var o=s;while(s--){r+=n[s].byteLength}var l=new Uint8Array(r);l[0]=r>>24&255;l[1]=r>>16&255;l[2]=r>>8&255;l[3]=r&255;l.set(t,4);for(s=0,r=8;s<o;s++){l.set(n[s],r);r+=n[s].byteLength}return l};h.hdlr=function e(t){return h.box(h.types.hdlr,h.HDLR_TYPES[t])};h.mdat=function e(t){return h.box(h.types.mdat,t)};h.mdhd=function e(t,r){r*=t;var i=Math.floor(r/(l+1));var n=Math.floor(r%(l+1));return h.box(h.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))};h.mdia=function e(t){return h.box(h.types.mdia,h.mdhd(t.timescale,t.duration),h.hdlr(t.type),h.minf(t))};h.mfhd=function e(t){return h.box(h.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))};h.minf=function e(t){if(t.type==="audio"){return h.box(h.types.minf,h.box(h.types.smhd,h.SMHD),h.DINF,h.stbl(t))}else{return h.box(h.types.minf,h.box(h.types.vmhd,h.VMHD),h.DINF,h.stbl(t))}};h.moof=function e(t,r,i){return h.box(h.types.moof,h.mfhd(t),h.traf(i,r))};h.moov=function e(t){var r=t.length;var i=[];while(r--){i[r]=h.trak(t[r])}return h.box.apply(null,[h.types.moov,h.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(h.mvex(t)))};h.mvex=function e(t){var r=t.length;var i=[];while(r--){i[r]=h.trex(t[r])}return h.box.apply(null,[h.types.mvex].concat(i))};h.mvhd=function e(t,r){r*=t;var i=Math.floor(r/(l+1));var n=Math.floor(r%(l+1));var a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return h.box(h.types.mvhd,a)};h.sdtp=function e(t){var r=t.samples||[];var i=new Uint8Array(4+r.length);var n;var a;for(n=0;n<r.length;n++){a=r[n].flags;i[n+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return h.box(h.types.sdtp,i)};h.stbl=function e(t){return h.box(h.types.stbl,h.stsd(t),h.box(h.types.stts,h.STTS),h.box(h.types.stsc,h.STSC),h.box(h.types.stsz,h.STSZ),h.box(h.types.stco,h.STCO))};h.avc1=function e(t){var r=[];var i=[];var n;var a;var s;for(n=0;n<t.sps.length;n++){a=t.sps[n];s=a.byteLength;r.push(s>>>8&255);r.push(s&255);r=r.concat(Array.prototype.slice.call(a))}for(n=0;n<t.pps.length;n++){a=t.pps[n];s=a.byteLength;i.push(s>>>8&255);i.push(s&255);i=i.concat(Array.prototype.slice.call(a))}var o=h.box(h.types.avcC,new Uint8Array([1,r[3],r[4],r[5],252|3,224|t.sps.length].concat(r).concat([t.pps.length]).concat(i)));var l=t.width;var u=t.height;var c=t.pixelRatio[0];var d=t.pixelRatio[1];return h.box(h.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,h.box(h.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),h.box(h.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))};h.esds=function e(t){var r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))};h.mp4a=function e(t){var r=t.samplerate;return h.box(h.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,r&255,0,0]),h.box(h.types.esds,h.esds(t)))};h.mp3=function e(t){var r=t.samplerate;return h.box(h.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,r&255,0,0]))};h.stsd=function e(t){if(t.type==="audio"){if(t.segmentCodec==="mp3"&&t.codec==="mp3"){return h.box(h.types.stsd,h.STSD,h.mp3(t))}return h.box(h.types.stsd,h.STSD,h.mp4a(t))}else{return h.box(h.types.stsd,h.STSD,h.avc1(t))}};h.tkhd=function e(t){var r=t.id;var i=t.duration*t.timescale;var n=t.width;var a=t.height;var s=Math.floor(i/(l+1));var o=Math.floor(i%(l+1));return h.box(h.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,a>>8&255,a&255,0,0]))};h.traf=function e(t,r){var i=h.sdtp(t);var n=t.id;var a=Math.floor(r/(l+1));var s=Math.floor(r%(l+1));return h.box(h.types.traf,h.box(h.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),h.box(h.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,s>>24,s>>16&255,s>>8&255,s&255])),h.trun(t,i.length+16+20+8+16+8+8),i)};h.trak=function e(t){t.duration=t.duration||4294967295;return h.box(h.types.trak,h.tkhd(t),h.mdia(t))};h.trex=function e(t){var r=t.id;return h.box(h.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))};h.trun=function e(t,r){var i=t.samples||[];var n=i.length;var a=12+16*n;var s=new Uint8Array(a);var o;var l;var u;var c;var d;var f;r+=8+a;s.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0);for(o=0;o<n;o++){l=i[o];u=l.duration;c=l.size;d=l.flags;f=l.cts;s.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o)}return h.box(h.types.trun,s)};h.initSegment=function e(t){if(!h.types){h.init()}var r=h.moov(t);var i=new Uint8Array(h.FTYP.byteLength+r.byteLength);i.set(h.FTYP);i.set(r,h.FTYP.byteLength);return i};return h}();i.types=void 0;i.HDLR_TYPES=void 0;i.STTS=void 0;i.STSC=void 0;i.STCO=void 0;i.STSZ=void 0;i.VMHD=void 0;i.SMHD=void 0;i.STSD=void 0;i.FTYP=void 0;i.DINF=void 0;t["default"]=i},"./src/remux/mp4-remuxer.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});r.d(t,"normalizePts",function(){return me});r.d(t,"flushTextTrackMetadataCueSamples",function(){return P});r.d(t,"flushTextTrackUserdataCueSamples",function(){return x});var g=r("./src/polyfills/number.ts");var X=r("./src/remux/aac-helper.ts");var ue=r("./src/remux/mp4-generator.ts");var ce=r("./src/events.ts");var de=r("./src/errors.ts");var fe=r("./src/utils/logger.ts");var _=r("./src/types/loader.ts");var he=r("./src/utils/timescale-conversion.ts");function ve(){ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return ve.apply(this,arguments)}var Q=10*1e3;var J=1024;var Z=1152;var ge=null;var o=null;var pe=false;var i=function(){function e(e,t,r,i){if(i===void 0){i=""}this.observer=void 0;this.config=void 0;this.typeSupported=void 0;this.ISGenerated=false;this._initPTS=void 0;this._initDTS=void 0;this.nextAvcDts=null;this.nextAudioPts=null;this.videoSampleDuration=null;this.isAudioContiguous=false;this.isVideoContiguous=false;this.observer=e;this.config=t;this.typeSupported=r;this.ISGenerated=false;if(ge===null){var n=navigator.userAgent||"";var a=n.match(/Chrome\/(\d+)/i);ge=a?parseInt(a[1]):0}if(o===null){var s=navigator.userAgent.match(/Safari\/(\d+)/i);o=s?parseInt(s[1]):0}pe=!(!!ge&&ge>=75||!!o&&o>=600)}var t=e.prototype;t.destroy=function e(){};t.resetTimeStamp=function e(t){fe["logger"].log("[mp4-remuxer]: initPTS & initDTS reset");this._initPTS=this._initDTS=t};t.resetNextTimestamp=function e(){fe["logger"].log("[mp4-remuxer]: reset next timestamp");this.isVideoContiguous=false;this.isAudioContiguous=false};t.resetInitSegment=function e(){fe["logger"].log("[mp4-remuxer]: ISGenerated flag reset");this.ISGenerated=false};t.getVideoStartPts=function e(t){var i=false;var r=t.reduce(function(e,t){var r=t.pts-e;if(r<-4294967296){i=true;return me(e,t.pts)}else if(r>0){return e}else{return t.pts}},t[0].pts);if(i){fe["logger"].debug("PTS rollover detected")}return r};t.remux=function e(t,r,i,n,a,s,o,l){var u;var c;var d;var f;var h;var v;var g=a;var p=a;var m=t.pid>-1;var y=r.pid>-1;var b=r.samples.length;var T=t.samples.length>0;var E=o&&b>0||b>1;var S=(!m||T)&&(!y||E)||this.ISGenerated||o;if(S){if(!this.ISGenerated){d=this.generateIS(t,r,a)}var k=this.isVideoContiguous;var A=-1;var L;if(E){A=O(r.samples);if(!k&&this.config.forceKeyFrameOnDiscontinuity){v=true;if(A>0){fe["logger"].warn("[mp4-remuxer]: Dropped "+A+" out of "+b+" video samples due to a missing keyframe");var D=this.getVideoStartPts(r.samples);r.samples=r.samples.slice(A);r.dropped+=A;p+=(r.samples[0].pts-D)/r.inputTimeScale;L=p}else if(A===-1){fe["logger"].warn("[mp4-remuxer]: No keyframe found out of "+b+" video samples");v=false}}}if(this.ISGenerated){if(T&&E){var w=this.getVideoStartPts(r.samples);var C=me(t.samples[0].pts,w)-w;var R=C/r.inputTimeScale;g+=Math.max(0,R);p+=Math.max(0,-R)}if(T){if(!t.samplerate){fe["logger"].warn("[mp4-remuxer]: regenerate InitSegment as audio detected");d=this.generateIS(t,r,a)}c=this.remuxAudio(t,g,this.isAudioContiguous,s,y||E||l===_["PlaylistLevelType"].AUDIO?p:undefined);if(E){var I=c?c.endPTS-c.startPTS:0;if(!r.inputTimeScale){fe["logger"].warn("[mp4-remuxer]: regenerate InitSegment as video detected");d=this.generateIS(t,r,a)}u=this.remuxVideo(r,p,k,I)}}else if(E){u=this.remuxVideo(r,p,k,0)}if(u){u.firstKeyFrame=A;u.independent=A!==-1;u.firstKeyFramePTS=L}}}if(this.ISGenerated){if(i.samples.length){h=P(i,a,this._initPTS,this._initDTS)}if(n.samples.length){f=x(n,a,this._initPTS)}}return{audio:c,video:u,initSegment:d,independent:v,text:f,id3:h}};t.generateIS=function e(t,r,i){var n=t.samples;var a=r.samples;var s=this.typeSupported;var o={};var l=!Object(g["isFiniteNumber"])(this._initPTS);var u="audio/mp4";var c;var d;var f;if(l){c=d=Infinity}if(t.config&&n.length){t.timescale=t.samplerate;switch(t.segmentCodec){case"mp3":if(s.mpeg){u="audio/mpeg";t.codec=""}else if(s.mp3){t.codec="mp3"}break}o.audio={id:"audio",container:u,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&s.mpeg?new Uint8Array(0):ue["default"].initSegment([t]),metadata:{channelCount:t.channelCount}};if(l){f=t.inputTimeScale;c=d=n[0].pts-Math.round(f*i)}}if(r.sps&&r.pps&&a.length){r.timescale=r.inputTimeScale;o.video={id:"main",container:"video/mp4",codec:r.codec,initSegment:ue["default"].initSegment([r]),metadata:{width:r.width,height:r.height}};if(l){f=r.inputTimeScale;var h=this.getVideoStartPts(a);var v=Math.round(f*i);d=Math.min(d,me(a[0].dts,h)-v);c=Math.min(c,h-v)}}if(Object.keys(o).length){this.ISGenerated=true;if(l){this._initPTS=c;this._initDTS=d}return{tracks:o,initPTS:c,timescale:f}}};t.remuxVideo=function F(e,N,t,r){var i=e.inputTimeScale;var n=e.samples;var a=[];var s=n.length;var o=this._initPTS;var l=this.nextAvcDts;var u=8;var c=this.videoSampleDuration;var d;var f;var h=Number.POSITIVE_INFINITY;var v=Number.NEGATIVE_INFINITY;var g=0;var p=false;if(!t||l===null){var U=N*i;var B=n[0].pts-me(n[0].dts,n[0].pts);l=U-B}for(var m=0;m<s;m++){var y=n[m];y.pts=me(y.pts-o,l);y.dts=me(y.dts-o,l);if(y.dts>y.pts){var j=9e4*.2;g=Math.max(Math.min(g,y.pts-y.dts),-1*j)}if(y.dts<n[m>0?m-1:m].dts){p=true}}if(p){n.sort(function(e,t){var r=e.dts-t.dts;var i=e.pts-t.pts;return r||i})}d=n[0].dts;f=n[n.length-1].dts;var G=f-d;var b=G?Math.round(G/(s-1)):c||e.inputTimeScale/30;if(g<0){if(g<b*-2){fe["logger"].warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(he["toMsFromMpegTsClock"])(-b,true)+" ms");var T=g;for(var E=0;E<s;E++){n[E].dts=T=Math.max(T,n[E].pts-b);n[E].pts=Math.max(T,n[E].pts)}}else{fe["logger"].warn("PTS < DTS detected in video samples, shifting DTS by "+Object(he["toMsFromMpegTsClock"])(g,true)+" ms to overcome this issue");for(var S=0;S<s;S++){n[S].dts=n[S].dts+g}}d=n[0].dts}if(t){var k=d-l;var H=k>b;var K=k<-1;if(H||K){if(H){fe["logger"].warn("AVC: "+Object(he["toMsFromMpegTsClock"])(k,true)+" ms ("+k+"dts) hole between fragments detected, filling it")}else{fe["logger"].warn("AVC: "+Object(he["toMsFromMpegTsClock"])(-k,true)+" ms ("+k+"dts) overlapping between fragments detected")}d=l;var V=n[0].pts-k;n[0].dts=d;n[0].pts=V;fe["logger"].log("Video: First PTS/DTS adjusted: "+Object(he["toMsFromMpegTsClock"])(V,true)+"/"+Object(he["toMsFromMpegTsClock"])(d,true)+", delta: "+Object(he["toMsFromMpegTsClock"])(k,true)+" ms")}}if(pe){d=Math.max(0,d)}var W=0;var q=0;for(var A=0;A<s;A++){var L=n[A];var Y=L.units;var $=Y.length;var D=0;for(var w=0;w<$;w++){D+=Y[w].data.length}q+=D;W+=$;L.length=D;L.dts=Math.max(L.dts,d);L.pts=Math.max(L.pts,L.dts,0);h=Math.min(L.pts,h);v=Math.max(L.pts,v)}f=n[s-1].dts;var C=q+4*W+8;var R;try{R=new Uint8Array(C)}catch(e){this.observer.emit(ce["Events"].ERROR,ce["Events"].ERROR,{type:de["ErrorTypes"].MUX_ERROR,details:de["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:false,bytes:C,reason:"fail allocating video mdat "+C});return}var z=new DataView(R.buffer);z.setUint32(0,C);R.set(ue["default"].types.mdat,4);var X=false;for(var I=0;I<s;I++){var _=n[I];var Q=_.units;var J=0;for(var O=0,Z=Q.length;O<Z;O++){var ee=Q[O];var te=ee.data;var P=ee.data.byteLength;z.setUint32(u,P);u+=4;R.set(te,u);u+=P;J+=4+P}if(I<s-1){c=n[I+1].dts-_.dts}else{var re=this.config;var x=I>0?_.dts-n[I-1].dts:b;if(re.stretchShortVideoTrack&&this.nextAudioPts!==null){var ie=Math.floor(re.maxBufferHole*i);var M=(r?h+r*i:this.nextAudioPts)-_.pts;if(M>ie){c=M-x;if(c<0){c=x}else{X=true}fe["logger"].log("[mp4-remuxer]: It is approximately "+M/90+" ms to the next segment; using duration "+c/90+" ms for the last video frame.")}else{c=x}}else{c=x}}var ne=Math.round(_.pts-_.dts);a.push(new ye(_.key,c,J,ne))}if(a.length&&ge&&ge<70){var ae=a[0].flags;ae.dependsOn=2;ae.isNonSync=0}console.assert(c!==null,"mp4SampleDuration must be computed");c=X||!c?b:c;this.nextAvcDts=l=f+c;this.videoSampleDuration=c;this.isVideoContiguous=true;var se=ue["default"].moof(e.sequenceNumber++,d,ve({},e,{samples:a}));var oe="video";var le={data1:se,data2:R,startPTS:h/i,endPTS:(v+c)/i,startDTS:d/i,endDTS:l/i,type:oe,hasAudio:false,hasVideo:true,nb:a.length,dropped:e.dropped};e.samples=[];e.dropped=0;console.assert(R.length,"MDAT length must not be zero");return le};t.remuxAudio=function F(e,N,t,r,i){var n=e.inputTimeScale;var U=e.samplerate?e.samplerate:n;var a=n/U;var s=e.segmentCodec==="aac"?J:Z;var o=s*a;var l=this._initPTS;var u=e.segmentCodec==="mp3"&&this.typeSupported.mpeg;var c=[];var d=i!==undefined;var f=e.samples;var h=u?0:8;var v=this.nextAudioPts||-1;var g=N*n;this.isAudioContiguous=t=t||f.length&&v>0&&(r&&Math.abs(g-v)<9e3||Math.abs(me(f[0].pts-l,g)-v)<20*o);f.forEach(function(e){e.pts=me(e.pts-l,g)});if(!t||v<0){f=f.filter(function(e){return e.pts>=0});if(!f.length){return}if(i===0){v=0}else if(r&&!d){v=Math.max(0,g)}else{v=f[0].pts}}if(e.segmentCodec==="aac"){var p=this.config.maxAudioFramesDrift;for(var m=0,y=v;m<f.length;m++){var b=f[m];var T=b.pts;var E=T-y;var B=Math.abs(1e3*E/n);if(E<=-p*o&&d){if(m===0){fe["logger"].warn("Audio frame @ "+(T/n).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*E/n)+" ms.");this.nextAudioPts=v=y=T}}else if(E>=p*o&&B<Q&&d){var S=Math.round(E/o);y=T-S*o;if(y<0){S--;y+=o}if(m===0){this.nextAudioPts=v=y}fe["logger"].warn("[mp4-remuxer]: Injecting "+S+" audio frame @ "+(y/n).toFixed(3)+"s due to "+Math.round(1e3*E/n)+" ms gap.");for(var k=0;k<S;k++){var j=Math.max(y,0);var A=X["default"].getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(!A){fe["logger"].log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead.");A=b.unit.subarray()}f.splice(m,0,{unit:A,pts:j});y+=o;m++}}b.pts=y;y+=o}}var L=null;var D=null;var w;var C=0;var R=f.length;while(R--){C+=f[R].unit.byteLength}for(var I=0,G=f.length;I<G;I++){var _=f[I];var O=_.unit;var P=_.pts;if(D!==null){var H=c[I-1];H.duration=Math.round((P-D)/a)}else{if(t&&e.segmentCodec==="aac"){P=v}L=P;if(C>0){C+=h;try{w=new Uint8Array(C)}catch(e){this.observer.emit(ce["Events"].ERROR,ce["Events"].ERROR,{type:de["ErrorTypes"].MUX_ERROR,details:de["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:false,bytes:C,reason:"fail allocating audio mdat "+C});return}if(!u){var K=new DataView(w.buffer);K.setUint32(0,C);w.set(ue["default"].types.mdat,4)}}else{return}}w.set(O,h);var x=O.byteLength;h+=x;c.push(new ye(true,s,x,0));D=P}var M=c.length;if(!M){return}var V=c[c.length-1];this.nextAudioPts=v=D+a*V.duration;var W=u?new Uint8Array(0):ue["default"].moof(e.sequenceNumber++,L/a,ve({},e,{samples:c}));e.samples=[];var q=L/n;var Y=v/n;var $="audio";var z={data1:W,data2:w,startPTS:q,endPTS:Y,startDTS:q,endDTS:Y,type:$,hasAudio:true,hasVideo:false,nb:M};this.isAudioContiguous=true;console.assert(w.length,"MDAT length must not be zero");return z};t.remuxEmptyAudio=function e(t,r,i,n){var a=t.inputTimeScale;var s=t.samplerate?t.samplerate:a;var o=a/s;var l=this.nextAudioPts;var u=(l!==null?l:n.startDTS*a)+this._initDTS;var c=n.endDTS*a+this._initDTS;var d=o*J;var f=Math.ceil((c-u)/d);var h=X["default"].getSilentFrame(t.manifestCodec||t.codec,t.channelCount);fe["logger"].warn("[mp4-remuxer]: remux empty Audio");if(!h){fe["logger"].trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}var v=[];for(var g=0;g<f;g++){var p=u+g*d;v.push({unit:h,pts:p,dts:p})}t.samples=v;return this.remuxAudio(t,r,i,false)};return e}();function me(e,t){var r;if(t===null){return e}if(t<e){r=-8589934592}else{r=8589934592}while(Math.abs(e-t)>4294967296){e+=r}return e}function O(e){for(var t=0;t<e.length;t++){if(e[t].key){return t}}return-1}function P(e,t,r,i){var n=e.samples.length;if(!n){return}var a=e.inputTimeScale;for(var s=0;s<n;s++){var o=e.samples[s];o.pts=me(o.pts-r,t*a)/a;o.dts=me(o.dts-i,t*a)/a}var l=e.samples;e.samples=[];return{samples:l}}function x(e,t,r){var i=e.samples.length;if(!i){return}var n=e.inputTimeScale;for(var a=0;a<i;a++){var s=e.samples[a];s.pts=me(s.pts-r,t*n)/n}e.samples.sort(function(e,t){return e.pts-t.pts});var o=e.samples;e.samples=[];return{samples:o}}var ye=function e(t,r,i,n){this.size=void 0;this.duration=void 0;this.cts=void 0;this.flags=void 0;this.duration=r;this.size=i;this.cts=n;this.flags=new a(t)};var a=function e(t){this.isLeading=0;this.isDependedOn=0;this.hasRedundancy=0;this.degradPrio=0;this.dependsOn=1;this.isNonSync=1;this.dependsOn=t?2:1;this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":function(e,t,r){"use strict";r.r(t);var E=r("./src/polyfills/number.ts");var S=r("./src/remux/mp4-remuxer.ts");var k=r("./src/utils/mp4-tools.ts");var s=r("./src/loader/fragment.ts");var A=r("./src/utils/logger.ts");var i=function(){function e(){this.emitInitSegment=false;this.audioCodec=void 0;this.videoCodec=void 0;this.initData=void 0;this.initPTS=void 0;this.initTracks=void 0;this.lastEndDTS=null}var t=e.prototype;t.destroy=function e(){};t.resetTimeStamp=function e(t){this.initPTS=t;this.lastEndDTS=null};t.resetNextTimestamp=function e(){this.lastEndDTS=null};t.resetInitSegment=function e(t,r,i){this.audioCodec=r;this.videoCodec=i;this.generateInitSegment(t);this.emitInitSegment=true};t.generateInitSegment=function e(t){var r=this.audioCodec,i=this.videoCodec;if(!t||!t.byteLength){this.initTracks=undefined;this.initData=undefined;return}var n=this.initData=Object(k["parseInitSegment"])(t);if(!r){r=o(n.audio,s["ElementaryStreamTypes"].AUDIO)}if(!i){i=o(n.video,s["ElementaryStreamTypes"].VIDEO)}var a={};if(n.audio&&n.video){a.audiovideo={container:"video/mp4",codec:r+","+i,initSegment:t,id:"main"}}else if(n.audio){a.audio={container:"audio/mp4",codec:r,initSegment:t,id:"audio"}}else if(n.video){a.video={container:"video/mp4",codec:i,initSegment:t,id:"main"}}else{A["logger"].warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes.")}this.initTracks=a};t.remux=function e(t,r,i,n,a){var s;var o=this.initPTS,l=this.lastEndDTS;var u={audio:undefined,video:undefined,text:n,id3:i,initSegment:undefined};if(!Object(E["isFiniteNumber"])(l)){l=this.lastEndDTS=a||0}var c=r.samples;if(!c||!c.length){return u}var d={initPTS:undefined,timescale:1};var f=this.initData;if(!f||!f.length){this.generateInitSegment(c);f=this.initData}if(!f||!f.length){A["logger"].warn("[passthrough-remuxer.ts]: Failed to generate initSegment.");return u}if(this.emitInitSegment){d.tracks=this.initTracks;this.emitInitSegment=false}if(!Object(E["isFiniteNumber"])(o)){this.initPTS=d.initPTS=o=L(f,c,l)}var h=Object(k["getDuration"])(c,f);var v=l;var g=h+v;Object(k["offsetStartDTS"])(f,c,o);if(h>0){this.lastEndDTS=g}else{A["logger"].warn("Duration parsed from mp4 should be greater than zero");this.resetNextTimestamp()}var p=!!f.audio;var m=!!f.video;var y="";if(p){y+="audio"}if(m){y+="video"}var b={data1:c,startPTS:v,startDTS:v,endPTS:g,endDTS:g,type:y,hasAudio:p,hasVideo:m,nb:1,dropped:0};u.audio=b.type==="audio"?b:undefined;u.video=b.type!=="audio"?b:undefined;u.initSegment=d;var T=(s=this.initPTS)!=null?s:0;u.id3=Object(S["flushTextTrackMetadataCueSamples"])(i,a,T,T);if(n.samples.length){u.text=Object(S["flushTextTrackUserdataCueSamples"])(n,a,T)}return u};return e}();var L=function e(t,r,i){return Object(k["getStartDTS"])(t,r)-i};function o(e,t){var r=e===null||e===void 0?void 0:e.codec;if(r&&r.length>4){return r}if(r==="hvc1"||r==="hev1"){return"hvc1.1.c.L120.90"}if(r==="av01"){return"av01.0.04M.08"}if(r==="avc1"||t===s["ElementaryStreamTypes"].VIDEO){return"avc1.42e01e"}return"mp4a.40.5"}t["default"]=i},"./src/task-loop.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var i=function(){function e(){this._boundTick=void 0;this._tickTimer=null;this._tickInterval=null;this._tickCallCount=0;this._boundTick=this.tick.bind(this)}var t=e.prototype;t.destroy=function e(){this.onHandlerDestroying();this.onHandlerDestroyed()};t.onHandlerDestroying=function e(){this.clearNextTick();this.clearInterval()};t.onHandlerDestroyed=function e(){};t.hasInterval=function e(){return!!this._tickInterval};t.hasNextTick=function e(){return!!this._tickTimer};t.setInterval=function e(t){if(!this._tickInterval){this._tickInterval=self.setInterval(this._boundTick,t);return true}return false};t.clearInterval=function e(){if(this._tickInterval){self.clearInterval(this._tickInterval);this._tickInterval=null;return true}return false};t.clearNextTick=function e(){if(this._tickTimer){self.clearTimeout(this._tickTimer);this._tickTimer=null;return true}return false};t.tick=function e(){this._tickCallCount++;if(this._tickCallCount===1){this.doTick();if(this._tickCallCount>1){this.tickImmediate()}this._tickCallCount=0}};t.tickImmediate=function e(){this.clearNextTick();this._tickTimer=self.setTimeout(this._boundTick,0)};t.doTick=function e(){};return e}()},"./src/types/cmcd.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"CMCDVersion",function(){return i});r.d(t,"CMCDObjectType",function(){return n});r.d(t,"CMCDStreamingFormat",function(){return a});r.d(t,"CMCDStreamType",function(){return s});var i=1;var n;(function(e){e["MANIFEST"]="m";e["AUDIO"]="a";e["VIDEO"]="v";e["MUXED"]="av";e["INIT"]="i";e["CAPTION"]="c";e["TIMED_TEXT"]="tt";e["KEY"]="k";e["OTHER"]="o"})(n||(n={}));var a;(function(e){e["DASH"]="d";e["HLS"]="h";e["SMOOTH"]="s";e["OTHER"]="o"})(a||(a={}));var s;(function(e){e["VOD"]="v";e["LIVE"]="l"})(s||(s={}))},"./src/types/demuxer.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"MetadataSchema",function(){return i});var i;(function(e){e["audioId3"]="org.id3";e["dateRange"]="com.apple.quicktime.HLS";e["emsg"]="https://aomedia.org/emsg/ID3"})(i||(i={}))},"./src/types/level.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"HlsSkip",function(){return s});r.d(t,"getSkipValue",function(){return a});r.d(t,"HlsUrlParameters",function(){return o});r.d(t,"Level",function(){return l});function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function n(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var s;(function(e){e["No"]="";e["Yes"]="YES";e["v2"]="v2"})(s||(s={}));function a(e,t){var r=e.canSkipUntil,i=e.canSkipDateRanges,n=e.endSN;var a=t!==undefined?t-n:0;if(r&&a<r){if(i){return s.v2}return s.Yes}return s.No}var o=function(){function e(e,t,r){this.msn=void 0;this.part=void 0;this.skip=void 0;this.msn=e;this.part=t;this.skip=r}var t=e.prototype;t.addDirectives=function e(t){var r=new self.URL(t);if(this.msn!==undefined){r.searchParams.set("_HLS_msn",this.msn.toString())}if(this.part!==undefined){r.searchParams.set("_HLS_part",this.part.toString())}if(this.skip){r.searchParams.set("_HLS_skip",this.skip)}return r.toString()};return e}();var l=function(){function e(e){this.attrs=void 0;this.audioCodec=void 0;this.bitrate=void 0;this.codecSet=void 0;this.height=void 0;this.id=void 0;this.name=void 0;this.videoCodec=void 0;this.width=void 0;this.unknownCodecs=void 0;this.audioGroupIds=void 0;this.details=void 0;this.fragmentError=0;this.loadError=0;this.loaded=void 0;this.realBitrate=0;this.textGroupIds=void 0;this.url=void 0;this._urlId=0;this.url=[e.url];this.attrs=e.attrs;this.bitrate=e.bitrate;if(e.details){this.details=e.details}this.id=e.id||0;this.name=e.name;this.width=e.width||0;this.height=e.height||0;this.audioCodec=e.audioCodec;this.videoCodec=e.videoCodec;this.unknownCodecs=e.unknownCodecs;this.codecSet=[e.videoCodec,e.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}n(e,[{key:"maxBitrate",get:function e(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function e(){return this.url[this._urlId]||""}},{key:"urlId",get:function e(){return this._urlId},set:function e(t){var r=t%this.url.length;if(this._urlId!==r){this.details=undefined;this._urlId=r}}}]);return e}()},"./src/types/loader.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"PlaylistContextType",function(){return i});r.d(t,"PlaylistLevelType",function(){return n});var i;(function(e){e["MANIFEST"]="manifest";e["LEVEL"]="level";e["AUDIO_TRACK"]="audioTrack";e["SUBTITLE_TRACK"]="subtitleTrack"})(i||(i={}));var n;(function(e){e["MAIN"]="main";e["AUDIO"]="audio";e["SUBTITLE"]="subtitle"})(n||(n={}))},"./src/types/transmuxer.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"ChunkMetadata",function(){return i});var i=function e(t,r,i,n,a,s){if(n===void 0){n=0}if(a===void 0){a=-1}if(s===void 0){s=false}this.level=void 0;this.sn=void 0;this.part=void 0;this.id=void 0;this.size=void 0;this.partial=void 0;this.transmuxing=o();this.buffering={audio:o(),video:o(),audiovideo:o()};this.level=t;this.sn=r;this.id=i;this.size=n;this.part=a;this.partial=s};function o(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"AttrList",function(){return n});var i=/^(\d+)x(\d+)$/;var s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;var n=function(){function r(e){if(typeof e==="string"){e=r.parseAttrList(e)}for(var t in e){if(e.hasOwnProperty(t)){this[t]=e[t]}}}var e=r.prototype;e.decimalInteger=function e(t){var r=parseInt(this[t],10);if(r>Number.MAX_SAFE_INTEGER){return Infinity}return r};e.hexadecimalInteger=function e(t){if(this[t]){var r=(this[t]||"0x").slice(2);r=(r.length&1?"0":"")+r;var i=new Uint8Array(r.length/2);for(var n=0;n<r.length/2;n++){i[n]=parseInt(r.slice(n*2,n*2+2),16)}return i}else{return null}};e.hexadecimalIntegerAsNumber=function e(t){var r=parseInt(this[t],16);if(r>Number.MAX_SAFE_INTEGER){return Infinity}return r};e.decimalFloatingPoint=function e(t){return parseFloat(this[t])};e.optionalFloat=function e(t,r){var i=this[t];return i?parseFloat(i):r};e.enumeratedString=function e(t){return this[t]};e.bool=function e(t){return this[t]==="YES"};e.decimalResolution=function e(t){var r=i.exec(this[t]);if(r===null){return undefined}return{width:parseInt(r[1],10),height:parseInt(r[2],10)}};r.parseAttrList=function e(t){var r;var i={};var n='"';s.lastIndex=0;while((r=s.exec(t))!==null){var a=r[2];if(a.indexOf(n)===0&&a.lastIndexOf(n)===a.length-1){a=a.slice(1,-1)}i[r[1]]=a}return i};return r}()},"./src/utils/binary-search.ts":function(e,t,r){"use strict";r.r(t);var i={search:function e(t,r){var i=0;var n=t.length-1;var a=null;var s=null;while(i<=n){a=(i+n)/2|0;s=t[a];var o=r(s);if(o>0){i=a+1}else if(o<0){n=a-1}else{return s}}return null}};t["default"]=i},"./src/utils/buffer-helper.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"BufferHelper",function(){return a});var i=r("./src/utils/logger.ts");var n={length:0,start:function e(){return 0},end:function e(){return 0}};var a=function(){function o(){}o.isBuffered=function e(t,r){try{if(t){var i=o.getBuffered(t);for(var n=0;n<i.length;n++){if(r>=i.start(n)&&r<=i.end(n)){return true}}}}catch(e){}return false};o.bufferInfo=function e(t,r,i){try{if(t){var n=o.getBuffered(t);var a=[];var s;for(s=0;s<n.length;s++){a.push({start:n.start(s),end:n.end(s)})}return this.bufferedInfo(a,r,i)}}catch(e){}return{len:0,start:r,end:r,nextStart:undefined}};o.bufferedInfo=function e(t,r,i){r=Math.max(0,r);t.sort(function(e,t){var r=e.start-t.start;if(r){return r}else{return t.end-e.end}});var n=[];if(i){for(var a=0;a<t.length;a++){var s=n.length;if(s){var o=n[s-1].end;if(t[a].start-o<i){if(t[a].end>o){n[s-1].end=t[a].end}}else{n.push(t[a])}}else{n.push(t[a])}}}else{n=t}var l=0;var u;var c=r;var d=r;for(var f=0;f<n.length;f++){var h=n[f].start;var v=n[f].end;if(r+i>=h&&r<v){c=h;d=v;l=d-r}else if(r+i<h){u=h;break}}return{len:l,start:c||0,end:d||0,nextStart:u}};o.getBuffered=function e(t){try{return t.buffered}catch(e){i["logger"].log("failed to get media.buffered",e);return n}};return o}()},"./src/utils/cea-608-parser.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"Row",function(){return y});r.d(t,"CaptionScreen",function(){return b});var i=r("./src/utils/logger.ts");var n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499};var l=function e(t){var r=t;if(n.hasOwnProperty(t)){r=n[t]}return String.fromCharCode(r)};var h=15;var a=100;var u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14};var c={17:2,18:4,21:6,22:8,23:10,19:13,20:15};var d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14};var f={25:2,26:4,29:6,30:8,31:10,27:13,28:15};var v=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];var g;(function(e){e[e["ERROR"]=0]="ERROR";e[e["TEXT"]=1]="TEXT";e[e["WARNING"]=2]="WARNING";e[e["INFO"]=2]="INFO";e[e["DEBUG"]=3]="DEBUG";e[e["DATA"]=3]="DATA"})(g||(g={}));var s=function(){function e(){this.time=null;this.verboseLevel=g.ERROR}var t=e.prototype;t.log=function e(t,r){if(this.verboseLevel>=t){i["logger"].log(this.time+" ["+t+"] "+r)}};return e}();var p=function e(t){var r=[];for(var i=0;i<t.length;i++){r.push(t[i].toString(16))}return r};var o=function(){function e(e,t,r,i,n){this.foreground=void 0;this.underline=void 0;this.italics=void 0;this.background=void 0;this.flash=void 0;this.foreground=e||"white";this.underline=t||false;this.italics=r||false;this.background=i||"black";this.flash=n||false}var t=e.prototype;t.reset=function e(){this.foreground="white";this.underline=false;this.italics=false;this.background="black";this.flash=false};t.setStyles=function e(t){var r=["foreground","underline","italics","background","flash"];for(var i=0;i<r.length;i++){var n=r[i];if(t.hasOwnProperty(n)){this[n]=t[n]}}};t.isDefault=function e(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash};t.equals=function e(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash};t.copy=function e(t){this.foreground=t.foreground;this.underline=t.underline;this.italics=t.italics;this.background=t.background;this.flash=t.flash};t.toString=function e(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash};return e}();var m=function(){function e(e,t,r,i,n,a){this.uchar=void 0;this.penState=void 0;this.uchar=e||" ";this.penState=new o(t,r,i,n,a)}var t=e.prototype;t.reset=function e(){this.uchar=" ";this.penState.reset()};t.setChar=function e(t,r){this.uchar=t;this.penState.copy(r)};t.setPenState=function e(t){this.penState.copy(t)};t.equals=function e(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)};t.copy=function e(t){this.uchar=t.uchar;this.penState.copy(t.penState)};t.isEmpty=function e(){return this.uchar===" "&&this.penState.isDefault()};return e}();var y=function(){function e(e){this.chars=void 0;this.pos=void 0;this.currPenState=void 0;this.cueStartTime=void 0;this.logger=void 0;this.chars=[];for(var t=0;t<a;t++){this.chars.push(new m)}this.logger=e;this.pos=0;this.currPenState=new o}var t=e.prototype;t.equals=function e(t){var r=true;for(var i=0;i<a;i++){if(!this.chars[i].equals(t.chars[i])){r=false;break}}return r};t.copy=function e(t){for(var r=0;r<a;r++){this.chars[r].copy(t.chars[r])}};t.isEmpty=function e(){var t=true;for(var r=0;r<a;r++){if(!this.chars[r].isEmpty()){t=false;break}}return t};t.setCursor=function e(t){if(this.pos!==t){this.pos=t}if(this.pos<0){this.logger.log(g.DEBUG,"Negative cursor position "+this.pos);this.pos=0}else if(this.pos>a){this.logger.log(g.DEBUG,"Too large cursor position "+this.pos);this.pos=a}};t.moveCursor=function e(t){var r=this.pos+t;if(t>1){for(var i=this.pos+1;i<r+1;i++){this.chars[i].setPenState(this.currPenState)}}this.setCursor(r)};t.backSpace=function e(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",this.currPenState)};t.insertChar=function e(t){if(t>=144){this.backSpace()}var r=l(t);if(this.pos>=a){this.logger.log(g.ERROR,"Cannot insert "+t.toString(16)+" ("+r+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(r,this.currPenState);this.moveCursor(1)};t.clearFromPos=function e(t){var r;for(r=t;r<a;r++){this.chars[r].reset()}};t.clear=function e(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()};t.clearToEndOfRow=function e(){this.clearFromPos(this.pos)};t.getTextString=function e(){var t=[];var r=true;for(var i=0;i<a;i++){var n=this.chars[i].uchar;if(n!==" "){r=false}t.push(n)}if(r){return""}else{return t.join("")}};t.setPenStyles=function e(t){this.currPenState.setStyles(t);var r=this.chars[this.pos];r.setPenState(this.currPenState)};return e}();var b=function(){function e(e){this.rows=void 0;this.currRow=void 0;this.nrRollUpRows=void 0;this.lastOutputScreen=void 0;this.logger=void 0;this.rows=[];for(var t=0;t<h;t++){this.rows.push(new y(e))}this.logger=e;this.currRow=h-1;this.nrRollUpRows=null;this.lastOutputScreen=null;this.reset()}var t=e.prototype;t.reset=function e(){for(var t=0;t<h;t++){this.rows[t].clear()}this.currRow=h-1};t.equals=function e(t){var r=true;for(var i=0;i<h;i++){if(!this.rows[i].equals(t.rows[i])){r=false;break}}return r};t.copy=function e(t){for(var r=0;r<h;r++){this.rows[r].copy(t.rows[r])}};t.isEmpty=function e(){var t=true;for(var r=0;r<h;r++){if(!this.rows[r].isEmpty()){t=false;break}}return t};t.backSpace=function e(){var t=this.rows[this.currRow];t.backSpace()};t.clearToEndOfRow=function e(){var t=this.rows[this.currRow];t.clearToEndOfRow()};t.insertChar=function e(t){var r=this.rows[this.currRow];r.insertChar(t)};t.setPen=function e(t){var r=this.rows[this.currRow];r.setPenStyles(t)};t.moveCursor=function e(t){var r=this.rows[this.currRow];r.moveCursor(t)};t.setCursor=function e(t){this.logger.log(g.INFO,"setCursor: "+t);var r=this.rows[this.currRow];r.setCursor(t)};t.setPAC=function e(t){this.logger.log(g.INFO,"pacData = "+JSON.stringify(t));var r=t.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1){r=this.nrRollUpRows-1}if(this.nrRollUpRows&&this.currRow!==r){for(var i=0;i<h;i++){this.rows[i].clear()}var n=this.currRow+1-this.nrRollUpRows;var a=this.lastOutputScreen;if(a){var s=a.rows[n].cueStartTime;var o=this.logger.time;if(s&&o!==null&&s<o){for(var l=0;l<this.nrRollUpRows;l++){this.rows[r-this.nrRollUpRows+l+1].copy(a.rows[n+l])}}}}this.currRow=r;var u=this.rows[this.currRow];if(t.indent!==null){var c=t.indent;var d=Math.max(c-1,0);u.setCursor(t.indent);t.color=u.chars[d].penState.foreground}var f={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:false};this.setPen(f)};t.setBkgData=function e(t){this.logger.log(g.INFO,"bkgData = "+JSON.stringify(t));this.backSpace();this.setPen(t);this.insertChar(32)};t.setRollUpRows=function e(t){this.nrRollUpRows=t};t.rollUp=function e(){if(this.nrRollUpRows===null){this.logger.log(g.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(g.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows;var r=this.rows.splice(t,1)[0];r.clear();this.rows.splice(this.currRow,0,r);this.logger.log(g.INFO,"Rolling up")};t.getDisplayText=function e(t){t=t||false;var r=[];var i="";var n=-1;for(var a=0;a<h;a++){var s=this.rows[a].getTextString();if(s){n=a+1;if(t){r.push("Row "+n+": '"+s+"'")}else{r.push(s.trim())}}}if(r.length>0){if(t){i="["+r.join(" | ")+"]"}else{i=r.join("\n")}}return i};t.getTextAndFormat=function e(){return this.rows};return e}();var T=function(){function e(e,t,r){this.chNr=void 0;this.outputFilter=void 0;this.mode=void 0;this.verbose=void 0;this.displayedMemory=void 0;this.nonDisplayedMemory=void 0;this.lastOutputScreen=void 0;this.currRollUpRow=void 0;this.writeScreen=void 0;this.cueStartTime=void 0;this.logger=void 0;this.chNr=e;this.outputFilter=t;this.mode=null;this.verbose=0;this.displayedMemory=new b(r);this.nonDisplayedMemory=new b(r);this.lastOutputScreen=new b(r);this.currRollUpRow=this.displayedMemory.rows[h-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null;this.logger=r}var t=e.prototype;t.reset=function e(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.outputFilter.reset();this.currRollUpRow=this.displayedMemory.rows[h-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null};t.getHandler=function e(){return this.outputFilter};t.setHandler=function e(t){this.outputFilter=t};t.setPAC=function e(t){this.writeScreen.setPAC(t)};t.setBkgData=function e(t){this.writeScreen.setBkgData(t)};t.setMode=function e(t){if(t===this.mode){return}this.mode=t;this.logger.log(g.INFO,"MODE="+t);if(this.mode==="MODE_POP-ON"){this.writeScreen=this.nonDisplayedMemory}else{this.writeScreen=this.displayedMemory;this.writeScreen.reset()}if(this.mode!=="MODE_ROLL-UP"){this.displayedMemory.nrRollUpRows=null;this.nonDisplayedMemory.nrRollUpRows=null}this.mode=t};t.insertChars=function e(t){for(var r=0;r<t.length;r++){this.writeScreen.insertChar(t[r])}var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(g.INFO,i+": "+this.writeScreen.getDisplayText(true));if(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP"){this.logger.log(g.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(true));this.outputDataUpdate()}};t.ccRCL=function e(){this.logger.log(g.INFO,"RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")};t.ccBS=function e(){this.logger.log(g.INFO,"BS - BackSpace");if(this.mode==="MODE_TEXT"){return}this.writeScreen.backSpace();if(this.writeScreen===this.displayedMemory){this.outputDataUpdate()}};t.ccAOF=function e(){};t.ccAON=function e(){};t.ccDER=function e(){this.logger.log(g.INFO,"DER- Delete to End of Row");this.writeScreen.clearToEndOfRow();this.outputDataUpdate()};t.ccRU=function e(t){this.logger.log(g.INFO,"RU("+t+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(t)};t.ccFON=function e(){this.logger.log(g.INFO,"FON - Flash On");this.writeScreen.setPen({flash:true})};t.ccRDC=function e(){this.logger.log(g.INFO,"RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")};t.ccTR=function e(){this.logger.log(g.INFO,"TR");this.setMode("MODE_TEXT")};t.ccRTD=function e(){this.logger.log(g.INFO,"RTD");this.setMode("MODE_TEXT")};t.ccEDM=function e(){this.logger.log(g.INFO,"EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate(true)};t.ccCR=function e(){this.logger.log(g.INFO,"CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate(true)};t.ccENM=function e(){this.logger.log(g.INFO,"ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()};t.ccEOC=function e(){this.logger.log(g.INFO,"EOC - End Of Caption");if(this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.nonDisplayedMemory=t;this.writeScreen=this.nonDisplayedMemory;this.logger.log(g.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(true)};t.ccTO=function e(t){this.logger.log(g.INFO,"TO("+t+") - Tab Offset");this.writeScreen.moveCursor(t)};t.ccMIDROW=function e(t){var r={flash:false};r.underline=t%2===1;r.italics=t>=46;if(!r.italics){var i=Math.floor(t/2)-16;var n=["white","green","blue","cyan","red","yellow","magenta"];r.foreground=n[i]}else{r.foreground="white"}this.logger.log(g.INFO,"MIDROW: "+JSON.stringify(r));this.writeScreen.setPen(r)};t.outputDataUpdate=function e(t){if(t===void 0){t=false}var r=this.logger.time;if(r===null){return}if(this.outputFilter){if(this.cueStartTime===null&&!this.displayedMemory.isEmpty()){this.cueStartTime=r}else{if(!this.displayedMemory.equals(this.lastOutputScreen)){this.outputFilter.newCue(this.cueStartTime,r,this.lastOutputScreen);if(t&&this.outputFilter.dispatchCue){this.outputFilter.dispatchCue()}this.cueStartTime=this.displayedMemory.isEmpty()?null:r}}this.lastOutputScreen.copy(this.displayedMemory)}};t.cueSplitAtTime=function e(t){if(this.outputFilter){if(!this.displayedMemory.isEmpty()){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory)}this.cueStartTime=t}}};return e}();var E=function(){function e(e,t,r){this.channels=void 0;this.currentChannel=0;this.cmdHistory=void 0;this.logger=void 0;var i=new s;this.channels=[null,new T(e,t,i),new T(e+1,r,i)];this.cmdHistory=A();this.logger=i}var t=e.prototype;t.getHandler=function e(t){return this.channels[t].getHandler()};t.setHandler=function e(t,r){this.channels[t].setHandler(r)};t.addData=function e(t,r){var i;var n;var a;var s=false;this.logger.time=t;for(var o=0;o<r.length;o+=2){n=r[o]&127;a=r[o+1]&127;if(n===0&&a===0){continue}else{this.logger.log(g.DATA,"["+p([r[o],r[o+1]])+"] -> ("+p([n,a])+")")}i=this.parseCmd(n,a);if(!i){i=this.parseMidrow(n,a)}if(!i){i=this.parsePAC(n,a)}if(!i){i=this.parseBackgroundAttributes(n,a)}if(!i){s=this.parseChars(n,a);if(s){var l=this.currentChannel;if(l&&l>0){var u=this.channels[l];u.insertChars(s)}else{this.logger.log(g.WARNING,"No channel found yet. TEXT-MODE?")}}}if(!i&&!s){this.logger.log(g.WARNING,"Couldn't parse cleaned data "+p([n,a])+" orig: "+p([r[o],r[o+1]]))}}};t.parseCmd=function e(t,r){var i=this.cmdHistory;var n=(t===20||t===28||t===21||t===29)&&r>=32&&r<=47;var a=(t===23||t===31)&&r>=33&&r<=35;if(!(n||a)){return false}if(k(t,r,i)){S(null,null,i);this.logger.log(g.DEBUG,"Repeated command ("+p([t,r])+") is dropped");return true}var s=t===20||t===21||t===23?1:2;var o=this.channels[s];if(t===20||t===21||t===28||t===29){if(r===32){o.ccRCL()}else if(r===33){o.ccBS()}else if(r===34){o.ccAOF()}else if(r===35){o.ccAON()}else if(r===36){o.ccDER()}else if(r===37){o.ccRU(2)}else if(r===38){o.ccRU(3)}else if(r===39){o.ccRU(4)}else if(r===40){o.ccFON()}else if(r===41){o.ccRDC()}else if(r===42){o.ccTR()}else if(r===43){o.ccRTD()}else if(r===44){o.ccEDM()}else if(r===45){o.ccCR()}else if(r===46){o.ccENM()}else if(r===47){o.ccEOC()}}else{o.ccTO(r-32)}S(t,r,i);this.currentChannel=s;return true};t.parseMidrow=function e(t,r){var i=0;if((t===17||t===25)&&r>=32&&r<=47){if(t===17){i=1}else{i=2}if(i!==this.currentChannel){this.logger.log(g.ERROR,"Mismatch channel in midrow parsing");return false}var n=this.channels[i];if(!n){return false}n.ccMIDROW(r);this.logger.log(g.DEBUG,"MIDROW ("+p([t,r])+")");return true}return false};t.parsePAC=function e(t,r){var i;var n=this.cmdHistory;var a=(t>=17&&t<=23||t>=25&&t<=31)&&r>=64&&r<=127;var s=(t===16||t===24)&&r>=64&&r<=95;if(!(a||s)){return false}if(k(t,r,n)){S(null,null,n);return true}var o=t<=23?1:2;if(r>=64&&r<=95){i=o===1?u[t]:d[t]}else{i=o===1?c[t]:f[t]}var l=this.channels[o];if(!l){return false}l.setPAC(this.interpretPAC(i,r));S(t,r,n);this.currentChannel=o;return true};t.interpretPAC=function e(t,r){var i;var n={color:null,italics:false,indent:null,underline:false,row:t};if(r>95){i=r-96}else{i=r-64}n.underline=(i&1)===1;if(i<=13){n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]}else if(i<=15){n.italics=true;n.color="white"}else{n.indent=Math.floor((i-16)/2)*4}return n};t.parseChars=function e(t,r){var i;var n=null;var a=null;if(t>=25){i=2;a=t-8}else{i=1;a=t}if(a>=17&&a<=19){var s;if(a===17){s=r+80}else if(a===18){s=r+112}else{s=r+144}this.logger.log(g.INFO,"Special char '"+l(s)+"' in channel "+i);n=[s]}else if(t>=32&&t<=127){n=r===0?[t]:[t,r]}if(n){var o=p(n);this.logger.log(g.DEBUG,"Char codes =  "+o.join(","));S(t,r,this.cmdHistory)}return n};t.parseBackgroundAttributes=function e(t,r){var i=(t===16||t===24)&&r>=32&&r<=47;var n=(t===23||t===31)&&r>=45&&r<=47;if(!(i||n)){return false}var a;var s={};if(t===16||t===24){a=Math.floor((r-32)/2);s.background=v[a];if(r%2===1){s.background=s.background+"_semi"}}else if(r===45){s.background="transparent"}else{s.foreground="black";if(r===47){s.underline=true}}var o=t<=23?1:2;var l=this.channels[o];l.setBkgData(s);S(t,r,this.cmdHistory);return true};t.reset=function e(){for(var t=0;t<Object.keys(this.channels).length;t++){var r=this.channels[t];if(r){r.reset()}}this.cmdHistory=A()};t.cueSplitAtTime=function e(t){for(var r=0;r<this.channels.length;r++){var i=this.channels[r];if(i){i.cueSplitAtTime(t)}}};return e}();function S(e,t,r){r.a=e;r.b=t}function k(e,t,r){return r.a===e&&r.b===t}function A(){return{a:null,b:null}}t["default"]=E},"./src/utils/codecs.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"isCodecType",function(){return n});r.d(t,"isCodecSupportedInMp4",function(){return a});var i={audio:{a3ds:true,"ac-3":true,"ac-4":true,alac:true,alaw:true,dra1:true,"dts+":true,"dts-":true,dtsc:true,dtse:true,dtsh:true,"ec-3":true,enca:true,g719:true,g726:true,m4ae:true,mha1:true,mha2:true,mhm1:true,mhm2:true,mlpa:true,mp4a:true,"raw ":true,Opus:true,samr:true,sawb:true,sawp:true,sevc:true,sqcp:true,ssmv:true,twos:true,ulaw:true},video:{avc1:true,avc2:true,avc3:true,avc4:true,avcp:true,av01:true,drac:true,dvav:true,dvhe:true,encv:true,hev1:true,hvc1:true,mjp2:true,mp4v:true,mvc1:true,mvc2:true,mvc3:true,mvc4:true,resv:true,rv60:true,s263:true,svc1:true,svc2:true,"vc-1":true,vp08:true,vp09:true},text:{stpp:true,wvtt:true}};function n(e,t){var r=i[t];return!!r&&r[e.slice(0,4)]===true}function a(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.ts":function(e,t,r){"use strict";r.r(t);var p=r("./src/utils/vttparser.ts");var m=r("./src/utils/webvtt-parser.ts");var y=r("./src/utils/texttrack-utils.ts");var b=/\s/;var i={newCue:function e(t,r,i,n){var a=[];var s;var o;var l;var u;var c;var d=self.VTTCue||self.TextTrackCue;for(var f=0;f<n.rows.length;f++){s=n.rows[f];l=true;u=0;c="";if(!s.isEmpty()){for(var h=0;h<s.chars.length;h++){if(b.test(s.chars[h].uchar)&&l){u++}else{c+=s.chars[h].uchar;l=false}}s.cueStartTime=r;if(r===i){i+=1e-4}if(u>=16){u--}else{u++}var v=Object(p["fixLineBreaks"])(c.trim());var g=Object(m["generateCueId"])(r,i,v);if(!t||!t.cues||!t.cues.getCueById(g)){o=new d(r,i,v);o.id=g;o.line=f+1;o.align="left";o.position=10+Math.min(80,Math.floor(u*8/32)*10);a.push(o)}}}if(t&&a.length){a.sort(function(e,t){if(e.line==="auto"||t.line==="auto"){return 0}if(e.line>8&&t.line>8){return t.line-e.line}return e.line-t.line});a.forEach(function(e){return Object(y["addCueToTrack"])(t,e)})}return a}};t["default"]=i},"./src/utils/discontinuities.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"findFirstFragWithCC",function(){return o});r.d(t,"shouldAlignOnDiscontinuities",function(){return n});r.d(t,"findDiscontinuousReferenceFrag",function(){return l});r.d(t,"adjustSlidingStart",function(){return c});r.d(t,"alignStream",function(){return d});r.d(t,"alignPDT",function(){return h});r.d(t,"alignFragmentByPDTDelta",function(){return v});r.d(t,"alignMediaPlaylistByPDT",function(){return g});var a=r("./src/polyfills/number.ts");var s=r("./src/utils/logger.ts");var i=r("./src/controller/level-helper.ts");function o(e,t){var r=null;for(var i=0,n=e.length;i<n;i++){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}function n(e,t,r){if(t.details){if(r.endCC>r.startCC||e&&e.cc<r.startCC){return true}}return false}function l(e,t){var r=e.fragments;var i=t.fragments;if(!i.length||!r.length){s["logger"].log("No fragments to align");return}var n=o(r,i[0].cc);if(!n||n&&!n.startPTS){s["logger"].log("No frag in previous level to align on");return}return n}function u(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r;e.endPTS=r+e.duration}}function c(e,t){var r=t.fragments;for(var i=0,n=r.length;i<n;i++){u(r[i],e)}if(t.fragmentHint){u(t.fragmentHint,e)}t.alignedSliding=true}function d(e,t,r){if(!t){return}f(e,r,t);if(!r.alignedSliding&&t.details){h(r,t.details)}if(!r.alignedSliding&&t.details&&!r.skippedSegments){Object(i["adjustSliding"])(t.details,r)}}function f(e,t,r){if(n(e,r,t)){var i=l(r.details,t);if(i&&Object(a["isFiniteNumber"])(i.start)){s["logger"].log("Adjusting PTS using last level due to CC increase within current level "+t.url);c(i.start,t)}}}function h(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime){return}var r=t.fragments[0].programDateTime;var i=e.fragments[0].programDateTime;var n=(i-r)/1e3+t.fragments[0].start;if(n&&Object(a["isFiniteNumber"])(n)){s["logger"].log("Adjusting PTS using programDateTime delta "+(i-r)+"ms, sliding:"+n.toFixed(3)+" "+e.url+" ");c(n,e)}}function v(e,t){var r=e.programDateTime;if(!r)return;var i=(r-t)/1e3;e.start=e.startPTS=i;e.endPTS=i+e.duration}function g(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime){return}var r=t.fragments[0].programDateTime;var i=t.fragments[0].start;var n=r-i*1e3;e.fragments.forEach(function(e){v(e,n)});if(e.fragmentHint){v(e.fragmentHint,n)}e.alignedSliding=true}},"./src/utils/ewma-bandwidth-estimator.ts":function(e,t,r){"use strict";r.r(t);var a=r("./src/utils/ewma.ts");var i=function(){function e(e,t,r){this.defaultEstimate_=void 0;this.minWeight_=void 0;this.minDelayMs_=void 0;this.slow_=void 0;this.fast_=void 0;this.defaultEstimate_=r;this.minWeight_=.001;this.minDelayMs_=50;this.slow_=new a["default"](e);this.fast_=new a["default"](t)}var t=e.prototype;t.update=function e(t,r){var i=this.slow_,n=this.fast_;if(this.slow_.halfLife!==t){this.slow_=new a["default"](t,i.getEstimate(),i.getTotalWeight())}if(this.fast_.halfLife!==r){this.fast_=new a["default"](r,n.getEstimate(),n.getTotalWeight())}};t.sample=function e(t,r){t=Math.max(t,this.minDelayMs_);var i=8*r;var n=t/1e3;var a=i/n;this.fast_.sample(n,a);this.slow_.sample(n,a)};t.canEstimate=function e(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_};t.getEstimate=function e(){if(this.canEstimate()){return Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}else{return this.defaultEstimate_}};t.destroy=function e(){};return e}();t["default"]=i},"./src/utils/ewma.ts":function(e,t,r){"use strict";r.r(t);var i=function(){function e(e,t,r){if(t===void 0){t=0}if(r===void 0){r=0}this.halfLife=void 0;this.alpha_=void 0;this.estimate_=void 0;this.totalWeight_=void 0;this.halfLife=e;this.alpha_=e?Math.exp(Math.log(.5)/e):0;this.estimate_=t;this.totalWeight_=r}var t=e.prototype;t.sample=function e(t,r){var i=Math.pow(this.alpha_,t);this.estimate_=r*(1-i)+i*this.estimate_;this.totalWeight_+=t};t.getTotalWeight=function e(){return this.totalWeight_};t.getEstimate=function e(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t){return this.estimate_/t}}return this.estimate_};return e}();t["default"]=i},"./src/utils/fetch-loader.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"fetchSupported",function(){return v});var d=r("./src/polyfills/number.ts");var i=r("./src/loader/load-stats.ts");var c=r("./src/demux/chunk-cache.ts");function a(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;u(e,t)}function n(e){var i=typeof Map==="function"?new Map:undefined;n=function e(t){if(t===null||!l(t))return t;if(typeof t!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof i!=="undefined"){if(i.has(t))return i.get(t);i.set(t,r)}function r(){return s(t,arguments,f(this).constructor)}r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:false,writable:true,configurable:true}});return u(r,t)};return n(e)}function s(e,t,r){if(o()){s=Reflect.construct.bind()}else{s=function e(t,r,i){var n=[null];n.push.apply(n,r);var a=Function.bind.apply(t,n);var s=new a;if(i)u(s,i.prototype);return s}}return s.apply(null,arguments)}function o(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function l(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function u(e,t){u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return u(e,t)}function f(e){f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return f(e)}function h(){h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return h.apply(this,arguments)}function v(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request){try{new self.ReadableStream({});return true}catch(e){}}return false}var g=function(){function e(e){this.fetchSetup=void 0;this.requestTimeout=void 0;this.request=void 0;this.response=void 0;this.controller=void 0;this.context=void 0;this.config=null;this.callbacks=null;this.stats=void 0;this.loader=null;this.fetchSetup=e.fetchSetup||m;this.controller=new self.AbortController;this.stats=new i["LoadStats"]}var t=e.prototype;t.destroy=function e(){this.loader=this.callbacks=null;this.abortInternal()};t.abortInternal=function e(){var t=this.response;if(!t||!t.ok){this.stats.aborted=true;this.controller.abort()}};t.abort=function e(){var t;this.abortInternal();if((t=this.callbacks)!==null&&t!==void 0&&t.onAbort){this.callbacks.onAbort(this.stats,this.context,this.response)}};t.load=function e(i,n,a){var s=this;var o=this.stats;if(o.loading.start){throw new Error("Loader can only be used once.")}o.loading.start=self.performance.now();var t=p(i,this.controller.signal);var l=a.onProgress;var u=i.responseType==="arraybuffer";var c=u?"byteLength":"length";this.context=i;this.config=n;this.callbacks=a;this.request=this.fetchSetup(i,t);self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(function(){s.abortInternal();a.onTimeout(o,i,s.response)},n.timeout);self.fetch(this.request).then(function(e){s.response=s.loader=e;if(!e.ok){var t=e.status,r=e.statusText;throw new y(r||"fetch, bad network response",t,e)}o.loading.first=Math.max(self.performance.now(),o.loading.start);o.total=parseInt(e.headers.get("Content-Length")||"0");if(l&&Object(d["isFiniteNumber"])(n.highWaterMark)){return s.loadProgressively(e,o,i,n.highWaterMark,l)}if(u){return e.arrayBuffer()}return e.text()}).then(function(e){var t=s.response;self.clearTimeout(s.requestTimeout);o.loading.end=Math.max(self.performance.now(),o.loading.first);o.loaded=o.total=e[c];var r={url:t.url,data:e};if(l&&!Object(d["isFiniteNumber"])(n.highWaterMark)){l(o,i,e,t)}a.onSuccess(r,o,i,t)}).catch(function(e){self.clearTimeout(s.requestTimeout);if(o.aborted){return}var t=!e?0:e.code||0;var r=!e?null:e.message;a.onError({code:t,text:r},i,e?e.details:null)})};t.getCacheAge=function e(){var t=null;if(this.response){var r=this.response.headers.get("age");t=r?parseFloat(r):null}return t};t.loadProgressively=function e(n,a,s,o,l){if(o===void 0){o=0}var u=new c["default"];var t=n.body.getReader();var r=function i(){return t.read().then(function(e){if(e.done){if(u.dataLength){l(a,s,u.flush(),n)}return Promise.resolve(new ArrayBuffer(0))}var t=e.value;var r=t.length;a.loaded+=r;if(r<o||u.dataLength){u.push(t);if(u.dataLength>=o){l(a,s,u.flush(),n)}}else{l(a,s,t,n)}return i()}).catch(function(){return Promise.reject()})};return r()};return e}();function p(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(h({},e.headers))};if(e.rangeEnd){r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1))}return r}function m(e,t){return new self.Request(e.url,t)}var y=function(n){a(e,n);function e(e,t,r){var i;i=n.call(this,e)||this;i.code=void 0;i.details=void 0;i.code=t;i.details=r;return i}return e}(n(Error));t["default"]=g},"./src/utils/imsc1-ttml-parser.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"IMSC1_CODEC",function(){return n});r.d(t,"parseIMSC1",function(){return o});var l=r("./src/utils/mp4-tools.ts");var i=r("./src/utils/vttparser.ts");var p=r("./src/utils/vttcue.ts");var u=r("./src/demux/id3.ts");var c=r("./src/utils/timescale-conversion.ts");var m=r("./src/utils/webvtt-parser.ts");function y(){y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e};return y.apply(this,arguments)}var n="stpp.ttml.im1t";var a=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/;var s=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/;var b={left:"start",center:"center",right:"end",start:"start",end:"end"};function o(e,t,r,i,n){var a=Object(l["findBox"])(new Uint8Array(e),["mdat"]);if(a.length===0){n(new Error("Could not parse IMSC1 mdat"));return}var s=a.map(function(e){return Object(u["utf8ArrayToStr"])(e)});var o=Object(c["toTimescaleFromScale"])(t,1,r);try{s.forEach(function(e){return i(d(e,o))})}catch(e){n(e)}}function d(e,d){var t=new DOMParser;var r=t.parseFromString(e,"text/xml");var i=r.getElementsByTagName("tt")[0];if(!i){throw new Error("Invalid ttml")}var n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0};var f=Object.keys(n).reduce(function(e,t){e[t]=i.getAttribute("ttp:"+t)||n[t];return e},{});var h=i.getAttribute("xml:space")!=="preserve";var v=E(T(i,"styling","style"));var g=E(T(i,"layout","region"));var a=T(i,"body","[begin]");return[].map.call(a,function(e){var t=S(e,h);if(!t||!e.hasAttribute("begin")){return null}var r=L(e.getAttribute("begin"),f);var i=L(e.getAttribute("dur"),f);var n=L(e.getAttribute("end"),f);if(r===null){throw A(e)}if(n===null){if(i===null){throw A(e)}n=r+i}var a=new p["default"](r-d,n-d,t);a.id=Object(m["generateCueId"])(a.startTime,a.endTime,a.text);var s=g[e.getAttribute("region")];var o=v[e.getAttribute("style")];a.position=10;a.size=80;var l=k(s,o,v);var u=l.textAlign;if(u){var c=b[u];if(c){a.lineAlign=c}a.align=u}y(a,l);return a}).filter(function(e){return e!==null})}function T(e,t,r){var i=e.getElementsByTagName(t)[0];if(i){return[].slice.call(i.querySelectorAll(r))}return[]}function E(e){return e.reduce(function(e,t){var r=t.getAttribute("xml:id");if(r){e[r]=t}return e},{})}function S(e,n){return[].slice.call(e.childNodes).reduce(function(e,t,r){var i;if(t.nodeName==="br"&&r){return e+"\n"}if((i=t.childNodes)!==null&&i!==void 0&&i.length){return S(t,n)}else if(n){return e+t.textContent.trim().replace(/\s+/g," ")}return e+t.textContent},"")}function k(i,n,e){var a="http://www.w3.org/ns/ttml#styling";var s=null;var t=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];var r=i!==null&&i!==void 0&&i.hasAttribute("style")?i.getAttribute("style"):null;if(r&&e.hasOwnProperty(r)){s=e[r]}return t.reduce(function(e,t){var r=f(n,a,t)||f(i,a,t)||f(s,a,t);if(r){e[t]=r}return e},{})}function f(e,t,r){if(!e){return null}return e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function A(e){return new Error("Could not parse ttml timestamp "+e)}function L(e,t){if(!e){return null}var r=Object(i["parseTimeStamp"])(e);if(r===null){if(a.test(e)){r=h(e,t)}else if(s.test(e)){r=v(e,t)}}return r}function h(e,t){var r=a.exec(e);var i=(r[4]|0)+(r[5]|0)/t.subFrameRate;return(r[1]|0)*3600+(r[2]|0)*60+(r[3]|0)+i/t.frameRate}function v(e,t){var r=s.exec(e);var i=Number(r[1]);var n=r[2];switch(n){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}},"./src/utils/logger.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"enableLogs",function(){return l});r.d(t,"logger",function(){return u});var i=function e(){};var n={trace:i,debug:i,log:i,warn:i,info:i,error:i};var a=n;function s(e){var t=self.console[e];if(t){return t.bind(self.console,"["+e+"] >")}return i}function o(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++){r[i-1]=arguments[i]}r.forEach(function(e){a[e]=t[e]?t[e].bind(t):s(e)})}function l(e){if(self.console&&e===true||typeof e==="object"){o(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=n}}else{a=n}}var u=a},"./src/utils/mediakeys-helper.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"KeySystems",function(){return i});r.d(t,"requestMediaKeySystemAccess",function(){return n});var i;(function(e){e["WIDEVINE"]="com.widevine.alpha";e["PLAYREADY"]="com.microsoft.playready"})(i||(i={}));var n=function(){if(typeof self!=="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess){return self.navigator.requestMediaKeySystemAccess.bind(self.navigator)}else{return null}}()},"./src/utils/mediasource-helper.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"getMediaSource",function(){return i});function i(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"RemuxerTrackIdConfig",function(){return i});r.d(t,"bin2str",function(){return m});r.d(t,"readUint16",function(){return w});r.d(t,"readUint32",function(){return _});r.d(t,"readSint32",function(){return O});r.d(t,"writeUint32",function(){return l});r.d(t,"findBox",function(){return P});r.d(t,"parseSegmentIndex",function(){return S});r.d(t,"parseInitSegment",function(){return a});r.d(t,"getStartDTS",function(){return s});r.d(t,"getDuration",function(){return c});r.d(t,"computeRawDurationFromSamples",function(){return k});r.d(t,"offsetStartDTS",function(){return d});r.d(t,"segmentValidRange",function(){return f});r.d(t,"appendUint8Array",function(){return h});r.d(t,"parseSamples",function(){return v});r.d(t,"parseSEIMessageFromNALu",function(){return M});r.d(t,"parseEmsg",function(){return p});var n=r("./src/utils/typed-array.ts");var I=r("./src/loader/fragment.ts");var D=r("./src/demux/id3.ts");var o=Math.pow(2,32)-1;var u=[].push;var i={video:1,audio:2,id3:3,text:4};function m(e){return String.fromCharCode.apply(null,e)}function w(e,t){var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function _(e,t){var r=O(e,t);return r<0?4294967296+r:r}function O(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function l(e,t,r){e[t]=r>>24;e[t+1]=r>>16&255;e[t+2]=r>>8&255;e[t+3]=r&255}function P(e,t){var r=[];if(!t.length){return r}var i=e.byteLength;for(var n=0;n<i;){var a=_(e,n);var s=m(e.subarray(n+4,n+8));var o=a>1?n+a:i;if(s===t[0]){if(t.length===1){r.push(e.subarray(n+8,o))}else{var l=P(e.subarray(n+8,o),t.slice(1));if(l.length){u.apply(r,l)}}}n=o}return r}function S(e){var t=[];var r=e[0];var i=8;var n=_(e,i);i+=4;var a=0;var s=0;if(r===0){i+=8}else{i+=16}i+=2;var o=e.length+s;var l=w(e,i);i+=2;for(var u=0;u<l;u++){var c=i;var d=_(e,c);c+=4;var f=d&2147483647;var h=(d&2147483648)>>>31;if(h===1){console.warn("SIDX has hierarchical references (not supported)");return null}var v=_(e,c);c+=4;t.push({referenceSize:f,subsegmentDuration:v,info:{duration:v/n,start:o,end:o+f-1}});o+=f;c+=4;i=c}return{earliestPresentationTime:a,timescale:n,version:r,referencesCount:l,references:t}}function a(e){var i=[];var t=P(e,["moov","trak"]);for(var r=0;r<t.length;r++){var n=t[r];var a=P(n,["tkhd"])[0];if(a){var s=a[0];var o=s===0?12:20;var l=_(a,o);var u=P(n,["mdia","mdhd"])[0];if(u){s=u[0];o=s===0?12:20;var c=_(u,o);var d=P(n,["mdia","hdlr"])[0];if(d){var f=m(d.subarray(8,12));var h={soun:I["ElementaryStreamTypes"].AUDIO,vide:I["ElementaryStreamTypes"].VIDEO}[f];if(h){var v=P(n,["mdia","minf","stbl","stsd"])[0];var g=void 0;if(v){g=m(v.subarray(12,16))}i[l]={timescale:c,type:h};i[h]={timescale:c,id:l,codec:g}}}}}}var p=P(e,["moov","mvex","trex"]);p.forEach(function(e){var t=_(e,4);var r=i[t];if(r){r.default={duration:_(e,12),flags:_(e,20)}}});return i}function s(u,e){return P(e,["moof","traf"]).reduce(function(e,t){var o=P(t,["tfdt"])[0];var l=o[0];var r=P(t,["tfhd"]).reduce(function(e,t){var r=_(t,4);var i=u[r];if(i){var n=_(o,4);if(l===1){n*=Math.pow(2,32);n+=_(o,8)}var a=i.timescale||9e4;var s=n/a;if(isFinite(s)&&(e===null||s<e)){return s}}return e},null);if(r!==null&&isFinite(r)&&(e===null||r<e)){return r}return e},null)||0}function c(e,t){var r=0;var i=0;var n=0;var a=P(e,["moof","traf"]);for(var s=0;s<a.length;s++){var o=a[s];var l=P(o,["tfhd"])[0];var u=_(l,4);var c=t[u];if(!c){continue}var d=c.default;var f=_(l,0)|(d===null||d===void 0?void 0:d.flags);var h=d===null||d===void 0?void 0:d.duration;if(f&8){if(f&2){h=_(l,12)}else{h=_(l,8)}}var v=c.timescale||9e4;var g=P(o,["trun"]);for(var p=0;p<g.length;p++){r=k(g[p]);if(!r&&h){var m=_(g[p],4);r=h*m}if(c.type===I["ElementaryStreamTypes"].VIDEO){i+=r/v}else if(c.type===I["ElementaryStreamTypes"].AUDIO){n+=r/v}}}if(i===0&&n===0){var y=0;var b=P(e,["sidx"]);for(var T=0;T<b.length;T++){var E=S(b[T]);if(E!==null&&E!==void 0&&E.references){y+=E.references.reduce(function(e,t){return e+t.info.duration||0},0)}}return y}if(i){return i}return n}function k(e){var t=_(e,0);var r=8;if(t&1){r+=4}if(t&4){r+=4}var i=0;var n=_(e,4);for(var a=0;a<n;a++){if(t&256){var s=_(e,r);i+=s;r+=4}if(t&512){r+=4}if(t&1024){r+=4}if(t&2048){r+=4}}return i}function d(n,e,s){P(e,["moof","traf"]).forEach(function(i){P(i,["tfhd"]).forEach(function(e){var t=_(e,4);var r=n[t];if(!r){return}var a=r.timescale||9e4;P(i,["tfdt"]).forEach(function(e){var t=e[0];var r=_(e,4);if(t===0){r-=s*a;r=Math.max(r,0);l(e,4,r)}else{r*=Math.pow(2,32);r+=_(e,8);r-=s*a;r=Math.max(r,0);var i=Math.floor(r/(o+1));var n=Math.floor(r%(o+1));l(e,4,i);l(e,8,n)}})})})}function f(e){var t={valid:null,remainder:null};var r=P(e,["moof"]);if(!r){return t}else if(r.length<2){t.remainder=e;return t}var i=r[r.length-1];t.valid=Object(n["sliceUint8"])(e,0,i.byteOffset-8);t.remainder=Object(n["sliceUint8"])(e,i.byteOffset-8);return t}function h(e,t){var r=new Uint8Array(e.length+t.length);r.set(e);r.set(t,e.length);return r}function v(A,L){var D=[];var w=L.samples;var C=L.timescale;var c=L.id;var R=false;var e=P(w,["moof"]);e.map(function(e){var k=e.byteOffset-8;var t=P(e,["traf"]);t.map(function(u){var e=P(u,["tfdt"]).map(function(e){var t=e[0];var r=_(e,4);if(t===1){r*=Math.pow(2,32);r+=_(e,8)}return r/C})[0];if(e!==undefined){A=e}return P(u,["tfhd"]).map(function(e){var t=_(e,4);var r=_(e,0)&16777215;var i=(r&1)!==0;var n=(r&2)!==0;var a=(r&8)!==0;var E=0;var s=(r&16)!==0;var S=0;var o=(r&32)!==0;var l=8;if(t===c){if(i){l+=8}if(n){l+=4}if(a){E=_(e,l);l+=4}if(s){S=_(e,l);l+=4}if(o){l+=4}if(L.type==="video"){R=g(L.codec)}P(u,["trun"]).map(function(e){var t=e[0];var r=_(e,0)&16777215;var i=(r&1)!==0;var n=0;var a=(r&4)!==0;var s=(r&256)!==0;var o=0;var l=(r&512)!==0;var u=0;var c=(r&1024)!==0;var d=(r&2048)!==0;var f=0;var h=_(e,4);var v=8;if(i){n=_(e,v);v+=4}if(a){v+=4}var g=n+k;for(var p=0;p<h;p++){if(s){o=_(e,v);v+=4}else{o=E}if(l){u=_(e,v);v+=4}else{u=S}if(c){v+=4}if(d){if(t===0){f=_(e,v)}else{f=O(e,v)}v+=4}if(L.type===I["ElementaryStreamTypes"].VIDEO){var m=0;while(m<u){var y=_(w,g);g+=4;var b=w[g]&31;if(x(R,b)){var T=w.subarray(g,g+y);M(T,A+f/C,D)}g+=y;m+=y+4}}A+=o/C}})}})})});return D}function g(e){if(!e){return false}var t=e.indexOf(".");var r=t<0?e:e.substring(0,t);return r==="hvc1"||r==="hev1"||r==="dvh1"||r==="dvhe"}function x(e,t){return e?t===39||t===40:t===6}function M(e,t,r){var i=C(e);var n=0;n++;var a=0;var s=0;var o=false;var l=0;while(n<i.length){a=0;do{if(n>=i.length){break}l=i[n++];a+=l}while(l===255);s=0;do{if(n>=i.length){break}l=i[n++];s+=l}while(l===255);var u=i.length-n;if(!o&&a===4&&n<i.length){o=true;var c=i[n++];if(c===181){var d=w(i,n);n+=2;if(d===49){var f=_(i,n);n+=4;if(f===1195456820){var h=i[n++];if(h===3){var v=i[n++];var g=31&v;var p=64&v;var m=p?2+g*3:0;var y=new Uint8Array(m);if(p){y[0]=v;for(var b=1;b<m;b++){y[b]=i[n++]}}r.push({type:h,payloadType:a,pts:t,bytes:y})}}}}}else if(a===5&&s<u){o=true;if(s>16){var T=[];for(var E=0;E<16;E++){var S=i[n++].toString(16);T.push(S.length==1?"0"+S:S);if(E===3||E===5||E===7||E===9){T.push("-")}}var k=s-16;var A=new Uint8Array(k);for(var L=0;L<k;L++){A[L]=i[n++]}r.push({payloadType:a,pts:t,uuid:T.join(""),userData:Object(D["utf8ArrayToStr"])(A),userDataBytes:A})}}else if(s<u){n+=s}else if(s>u){break}}}function C(e){var t=e.byteLength;var r=[];var i=1;while(i<t-2){if(e[i]===0&&e[i+1]===0&&e[i+2]===3){r.push(i+2);i+=2}else{i++}}if(r.length===0){return e}var n=t-r.length;var a=new Uint8Array(n);var s=0;for(i=0;i<n;s++,i++){if(s===r[0]){s++;r.shift()}a[i]=e[s]}return a}function p(e){var t=e[0];var r="";var i="";var n=0;var a=0;var s=0;var o=0;var l=0;var u=0;if(t===0){while(m(e.subarray(u,u+1))!=="\0"){r+=m(e.subarray(u,u+1));u+=1}r+=m(e.subarray(u,u+1));u+=1;while(m(e.subarray(u,u+1))!=="\0"){i+=m(e.subarray(u,u+1));u+=1}i+=m(e.subarray(u,u+1));u+=1;n=_(e,12);a=_(e,16);o=_(e,20);l=_(e,24);u=28}else if(t===1){u+=4;n=_(e,u);u+=4;var c=_(e,u);u+=4;var d=_(e,u);u+=4;s=Math.pow(2,32)*c+d;if(!Number.isSafeInteger(s)){s=Number.MAX_SAFE_INTEGER;console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")}o=_(e,u);u+=4;l=_(e,u);u+=4;while(m(e.subarray(u,u+1))!=="\0"){r+=m(e.subarray(u,u+1));u+=1}r+=m(e.subarray(u,u+1));u+=1;while(m(e.subarray(u,u+1))!=="\0"){i+=m(e.subarray(u,u+1));u+=1}i+=m(e.subarray(u,u+1));u+=1}var f=e.subarray(u,e.byteLength);return{schemeIdUri:r,value:i,timeScale:n,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:f}}},"./src/utils/output-filter.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"default",function(){return i});var i=function(){function e(e,t){this.timelineController=void 0;this.cueRanges=[];this.trackName=void 0;this.startTime=null;this.endTime=null;this.screen=null;this.timelineController=e;this.trackName=t}var t=e.prototype;t.dispatchCue=function e(){if(this.startTime===null){return}this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges);this.startTime=null};t.newCue=function e(t,r,i){if(this.startTime===null||this.startTime>t){this.startTime=t}this.endTime=r;this.screen=i;this.timelineController.createCaptionsTrack(this.trackName)};t.reset=function e(){this.cueRanges=[];this.startTime=null};return e}()},"./src/utils/texttrack-utils.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"sendAddTrackEvent",function(){return i});r.d(t,"addCueToTrack",function(){return a});r.d(t,"clearCurrentCues",function(){return s});r.d(t,"removeCuesInRange",function(){return o});r.d(t,"getCuesInRange",function(){return u});var n=r("./src/utils/logger.ts");function i(e,t){var r;try{r=new Event("addtrack")}catch(e){r=document.createEvent("Event");r.initEvent("addtrack",false,false)}r.track=e;t.dispatchEvent(r)}function a(t,r){var e=t.mode;if(e==="disabled"){t.mode="hidden"}if(t.cues&&!t.cues.getCueById(r.id)){try{t.addCue(r);if(!t.cues.getCueById(r.id)){throw new Error("addCue is failed for: "+r)}}catch(e){n["logger"].debug("[texttrack-utils]: "+e);var i=new self.TextTrackCue(r.startTime,r.endTime,r.text);i.id=r.id;t.addCue(i)}}if(e==="disabled"){t.mode=e}}function s(e){var t=e.mode;if(t==="disabled"){e.mode="hidden"}if(e.cues){for(var r=e.cues.length;r--;){e.removeCue(e.cues[r])}}if(t==="disabled"){e.mode=t}}function o(e,t,r,i){var n=e.mode;if(n==="disabled"){e.mode="hidden"}if(e.cues&&e.cues.length>0){var a=u(e.cues,t,r);for(var s=0;s<a.length;s++){if(!i||i(a[s])){e.removeCue(a[s])}}}if(n==="disabled"){e.mode=n}}function l(e,t){if(t<e[0].startTime){return 0}var r=e.length-1;if(t>e[r].endTime){return-1}var i=0;var n=r;while(i<=n){var a=Math.floor((n+i)/2);if(t<e[a].startTime){n=a-1}else if(t>e[a].startTime&&i<r){i=a+1}else{return a}}return e[i].startTime-t<t-e[n].startTime?i:n}function u(e,t,r){var i=[];var n=l(e,t);if(n>-1){for(var a=n,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=r){i.push(o)}else if(o.startTime>r){return i}}}return i}},"./src/utils/time-ranges.ts":function(e,t,r){"use strict";r.r(t);var i={toString:function e(t){var r="";var i=t.length;for(var n=0;n<i;n++){r+="["+t.start(n).toFixed(3)+","+t.end(n).toFixed(3)+"]"}return r}};t["default"]=i},"./src/utils/timescale-conversion.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"toTimescaleFromBase",function(){return n});r.d(t,"toTimescaleFromScale",function(){return a});r.d(t,"toMsFromMpegTsClock",function(){return s});r.d(t,"toMpegTsClockFromTimescale",function(){return o});var i=9e4;function n(e,t,r,i){if(r===void 0){r=1}if(i===void 0){i=false}var n=e*t*r;return i?Math.round(n):n}function a(e,t,r,i){if(r===void 0){r=1}if(i===void 0){i=false}return n(e,t,1/r,i)}function s(e,t){if(t===void 0){t=false}return n(e,1e3,1/i,t)}function o(e,t){if(t===void 0){t=1}return n(e,i,1/t)}},"./src/utils/typed-array.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"sliceUint8",function(){return i});function i(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}},"./src/utils/vttcue.ts":function(e,t,r){"use strict";r.r(t);t["default"]=function(){if(typeof self!=="undefined"&&self.VTTCue){return self.VTTCue}var t=["","lr","rl"];var r=["start","middle","end","left","right"];function i(e,t){if(typeof t!=="string"){return false}if(!Array.isArray(e)){return false}var r=t.toLowerCase();if(~e.indexOf(r)){return r}return false}function b(e){return i(t,e)}function T(e){return i(r,e)}function E(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++){r[i-1]=arguments[i]}var n=1;for(;n<arguments.length;n++){var a=arguments[n];for(var s in a){e[s]=a[s]}}return e}function e(e,t,r){var i=this;var n={enumerable:true};i.hasBeenReset=false;var a="";var s=false;var o=e;var l=t;var u=r;var c=null;var d="";var f=true;var h="auto";var v="start";var g=50;var p="middle";var m=50;var y="middle";Object.defineProperty(i,"id",E({},n,{get:function e(){return a},set:function e(t){a=""+t}}));Object.defineProperty(i,"pauseOnExit",E({},n,{get:function e(){return s},set:function e(t){s=!!t}}));Object.defineProperty(i,"startTime",E({},n,{get:function e(){return o},set:function e(t){if(typeof t!=="number"){throw new TypeError("Start time must be set to a number.")}o=t;this.hasBeenReset=true}}));Object.defineProperty(i,"endTime",E({},n,{get:function e(){return l},set:function e(t){if(typeof t!=="number"){throw new TypeError("End time must be set to a number.")}l=t;this.hasBeenReset=true}}));Object.defineProperty(i,"text",E({},n,{get:function e(){return u},set:function e(t){u=""+t;this.hasBeenReset=true}}));Object.defineProperty(i,"region",E({},n,{get:function e(){return c},set:function e(t){c=t;this.hasBeenReset=true}}));Object.defineProperty(i,"vertical",E({},n,{get:function e(){return d},set:function e(t){var r=b(t);if(r===false){throw new SyntaxError("An invalid or illegal string was specified.")}d=r;this.hasBeenReset=true}}));Object.defineProperty(i,"snapToLines",E({},n,{get:function e(){return f},set:function e(t){f=!!t;this.hasBeenReset=true}}));Object.defineProperty(i,"line",E({},n,{get:function e(){return h},set:function e(t){if(typeof t!=="number"&&t!=="auto"){throw new SyntaxError("An invalid number or illegal string was specified.")}h=t;this.hasBeenReset=true}}));Object.defineProperty(i,"lineAlign",E({},n,{get:function e(){return v},set:function e(t){var r=T(t);if(!r){throw new SyntaxError("An invalid or illegal string was specified.")}v=r;this.hasBeenReset=true}}));Object.defineProperty(i,"position",E({},n,{get:function e(){return g},set:function e(t){if(t<0||t>100){throw new Error("Position must be between 0 and 100.")}g=t;this.hasBeenReset=true}}));Object.defineProperty(i,"positionAlign",E({},n,{get:function e(){return p},set:function e(t){var r=T(t);if(!r){throw new SyntaxError("An invalid or illegal string was specified.")}p=r;this.hasBeenReset=true}}));Object.defineProperty(i,"size",E({},n,{get:function e(){return m},set:function e(t){if(t<0||t>100){throw new Error("Size must be between 0 and 100.")}m=t;this.hasBeenReset=true}}));Object.defineProperty(i,"align",E({},n,{get:function e(){return y},set:function e(t){var r=T(t);if(!r){throw new SyntaxError("An invalid or illegal string was specified.")}y=r;this.hasBeenReset=true}}));i.displayState=undefined}e.prototype.getCueAsHTML=function(){var e=self.WebVTT;return e.convertCueToDOMTree(self,this.text)};return e}()},"./src/utils/vttparser.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"parseTimeStamp",function(){return o});r.d(t,"fixLineBreaks",function(){return v});r.d(t,"VTTParser",function(){return n});var u=r("./src/utils/vttcue.ts");var i=function(){function e(){}var t=e.prototype;t.decode=function e(t,r){if(!t){return""}if(typeof t!=="string"){throw new Error("Error - expected string data.")}return decodeURIComponent(encodeURIComponent(t))};return e}();function o(e){function t(e,t,r,i){return(e|0)*3600+(t|0)*60+(r|0)+parseFloat(i||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);if(!r){return null}if(parseFloat(r[2])>59){return t(r[2],r[3],0,r[4])}return t(r[1],r[2],r[3],r[4])}var l=function(){function e(){this.values=Object.create(null)}var t=e.prototype;t.set=function e(t,r){if(!this.get(t)&&r!==""){this.values[t]=r}};t.get=function e(t,r,i){if(i){return this.has(t)?this.values[t]:r[i]}return this.has(t)?this.values[t]:r};t.has=function e(t){return t in this.values};t.alt=function e(t,r,i){for(var n=0;n<i.length;++n){if(r===i[n]){this.set(t,r);break}}};t.integer=function e(t,r){if(/^-?\d+$/.test(r)){this.set(t,parseInt(r,10))}};t.percent=function e(t,r){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(r)){var e=parseFloat(r);if(e>=0&&e<=100){this.set(t,e);return true}}return false};return e}();function c(e,t,r,i){var n=i?e.split(i):[e];for(var a in n){if(typeof n[a]!=="string"){continue}var s=n[a].split(r);if(s.length!==2){continue}var o=s[0];var l=s[1];t(o,l)}}var d=new u["default"](0,0,"");var f=d.align==="middle"?"middle":"center";function h(t,e,a){var r=t;function i(){var e=o(t);if(e===null){throw new Error("Malformed timestamp: "+r)}t=t.replace(/^[^\sa-zA-Z-]+/,"");return e}function n(e,t){var n=new l;c(e,function(e,t){var r;switch(e){case"region":for(var i=a.length-1;i>=0;i--){if(a[i].id===t){n.set(e,a[i].region);break}}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":r=t.split(",");n.integer(e,r[0]);if(n.percent(e,r[0])){n.set("snapToLines",false)}n.alt(e,r[0],["auto"]);if(r.length===2){n.alt("lineAlign",r[1],["start",f,"end"])}break;case"position":r=t.split(",");n.percent(e,r[0]);if(r.length===2){n.alt("positionAlign",r[1],["start",f,"end","line-left","line-right","auto"])}break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",f,"end","left","right"]);break}},/:/,/\s/);t.region=n.get("region",null);t.vertical=n.get("vertical","");var r=n.get("line","auto");if(r==="auto"&&d.line===-1){r=-1}t.line=r;t.lineAlign=n.get("lineAlign","start");t.snapToLines=n.get("snapToLines",true);t.size=n.get("size",100);t.align=n.get("align",f);var i=n.get("position","auto");if(i==="auto"&&d.position===50){i=t.align==="start"||t.align==="left"?0:t.align==="end"||t.align==="right"?100:50}t.position=i}function s(){t=t.replace(/^\s+/,"")}s();e.startTime=i();s();if(t.slice(0,3)!=="--\x3e"){throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r)}t=t.slice(3);s();e.endTime=i();s();n(t,e)}function v(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var n=function(){function e(){this.state="INITIAL";this.buffer="";this.decoder=new i;this.regionList=[];this.cue=null;this.oncue=void 0;this.onparsingerror=void 0;this.onflush=void 0}var t=e.prototype;t.parse=function e(t){var i=this;if(t){i.buffer+=i.decoder.decode(t,{stream:true})}function r(){var e=i.buffer;var t=0;e=v(e);while(t<e.length&&e[t]!=="\r"&&e[t]!=="\n"){++t}var r=e.slice(0,t);if(e[t]==="\r"){++t}if(e[t]==="\n"){++t}i.buffer=e.slice(t);return r}function n(e){c(e,function(e,t){},/:/)}try{var a="";if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer)){return this}a=r();var s=a.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0]){throw new Error("Malformed WebVTT signature.")}i.state="HEADER"}var o=false;while(i.buffer){if(!/\r\n|\n/.test(i.buffer)){return this}if(!o){a=r()}else{o=false}switch(i.state){case"HEADER":if(/:/.test(a)){n(a)}else if(!a){i.state="ID"}continue;case"NOTE":if(!a){i.state="ID"}continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){i.state="NOTE";break}if(!a){continue}i.cue=new u["default"](0,0,"");i.state="CUE";if(a.indexOf("--\x3e")===-1){i.cue.id=a;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{h(a,i.cue,i.regionList)}catch(e){i.cue=null;i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":{var l=a.indexOf("--\x3e")!==-1;if(!a||l&&(o=true)){if(i.oncue&&i.cue){i.oncue(i.cue)}i.cue=null;i.state="ID";continue}if(i.cue===null){continue}if(i.cue.text){i.cue.text+="\n"}i.cue.text+=a}continue;case"BADCUE":if(!a){i.state="ID"}}}}catch(e){if(i.state==="CUETEXT"&&i.cue&&i.oncue){i.oncue(i.cue)}i.cue=null;i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this};t.flush=function e(){var t=this;try{if(t.cue||t.state==="HEADER"){t.buffer+="\n\n";t.parse()}if(t.state==="INITIAL"||t.state==="BADWEBVTT"){throw new Error("Malformed WebVTT signature.")}}catch(e){if(t.onparsingerror){t.onparsingerror(e)}}if(t.onflush){t.onflush()}return this};return e}()},"./src/utils/webvtt-parser.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"generateCueId",function(){return A});r.d(t,"parseWebVTT",function(){return n});var s=r("./src/polyfills/number.ts");var m=r("./src/utils/vttparser.ts");var y=r("./src/demux/id3.ts");var b=r("./src/utils/timescale-conversion.ts");var T=r("./src/remux/mp4-remuxer.ts");var E=/\r\n|\n\r|\n|\r/g;var S=function e(t,r,i){if(i===void 0){i=0}return t.slice(i,i+r.length)===r};var k=function e(t){var r=parseInt(t.slice(-3));var i=parseInt(t.slice(-6,-4));var n=parseInt(t.slice(-9,-7));var a=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!Object(s["isFiniteNumber"])(r)||!Object(s["isFiniteNumber"])(i)||!Object(s["isFiniteNumber"])(n)||!Object(s["isFiniteNumber"])(a)){throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t)}r+=1e3*i;r+=60*1e3*n;r+=60*60*1e3*a;return r};var i=function e(t){var e=5381;var r=t.length;while(r){e=e*33^t.charCodeAt(--r)}return(e>>>0).toString()};function A(e,t,r){return i(e.toString())+i(t.toString())+i(r)}var L=function e(t,r,i){var n=t[r];var a=t[n.prevCC];if(!a||!a.new&&n.new){t.ccOffset=t.presentationOffset=n.start;n.new=false;return}while((s=a)!==null&&s!==void 0&&s.new){var s;t.ccOffset+=n.start-a.start;n.new=false;n=a;a=t[n.prevCC]}t.presentationOffset=i};function n(e,t,r,o,l,u,i,n){var a=new m["VTTParser"];var s=Object(y["utf8ArrayToStr"])(new Uint8Array(e)).trim().replace(E,"\n").split("\n");var c=[];var d=Object(b["toMpegTsClockFromTimescale"])(t,r);var f="00:00.000";var h=0;var v=0;var g;var p=true;a.oncue=function(e){var t=o[l];var r=o.ccOffset;var i=(h-d)/9e4;if(t!==null&&t!==void 0&&t.new){if(v!==undefined){r=o.ccOffset=t.start}else{L(o,l,i)}}if(i){r=i-o.presentationOffset}var n=e.endTime-e.startTime;var a=Object(T["normalizePts"])((e.startTime+r-v)*9e4,u*9e4)/9e4;e.startTime=Math.max(a,0);e.endTime=Math.max(a+n,0);var s=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(s));if(!e.id){e.id=A(e.startTime,e.endTime,s)}if(e.endTime>0){c.push(e)}};a.onparsingerror=function(e){g=e};a.onflush=function(){if(g){n(g);return}i(c)};s.forEach(function(e){if(p){if(S(e,"X-TIMESTAMP-MAP=")){p=false;e.slice(16).split(",").forEach(function(e){if(S(e,"LOCAL:")){f=e.slice(6)}else if(S(e,"MPEGTS:")){h=parseInt(e.slice(7))}});try{v=k(f)/1e3}catch(e){g=e}return}else if(e===""){p=false}}a.parse(e+"\n")});a.flush()}},"./src/utils/xhr-loader.ts":function(e,t,r){"use strict";r.r(t);var d=r("./src/utils/logger.ts");var i=r("./src/loader/load-stats.ts");var n=/^age:\s*[\d.]+\s*$/m;var a=function(){function e(e){this.xhrSetup=void 0;this.requestTimeout=void 0;this.retryTimeout=void 0;this.retryDelay=void 0;this.config=null;this.callbacks=null;this.context=void 0;this.loader=null;this.stats=void 0;this.xhrSetup=e?e.xhrSetup:null;this.stats=new i["LoadStats"];this.retryDelay=0}var t=e.prototype;t.destroy=function e(){this.callbacks=null;this.abortInternal();this.loader=null;this.config=null};t.abortInternal=function e(){var t=this.loader;self.clearTimeout(this.requestTimeout);self.clearTimeout(this.retryTimeout);if(t){t.onreadystatechange=null;t.onprogress=null;if(t.readyState!==4){this.stats.aborted=true;t.abort()}}};t.abort=function e(){var t;this.abortInternal();if((t=this.callbacks)!==null&&t!==void 0&&t.onAbort){this.callbacks.onAbort(this.stats,this.context,this.loader)}};t.load=function e(t,r,i){if(this.stats.loading.start){throw new Error("Loader can only be used once.")}this.stats.loading.start=self.performance.now();this.context=t;this.config=r;this.callbacks=i;this.retryDelay=r.retryDelay;this.loadInternal()};t.loadInternal=function e(){var t=this.config,r=this.context;if(!t){return}var i=this.loader=new self.XMLHttpRequest;var n=this.stats;n.loading.first=0;n.loaded=0;var a=this.xhrSetup;try{if(a){try{a(i,r.url)}catch(e){i.open("GET",r.url,true);a(i,r.url)}}if(!i.readyState){i.open("GET",r.url,true)}var s=this.context.headers;if(s){for(var o in s){i.setRequestHeader(o,s[o])}}}catch(e){this.callbacks.onError({code:i.status,text:e.message},r,i);return}if(r.rangeEnd){i.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1))}i.onreadystatechange=this.readystatechange.bind(this);i.onprogress=this.loadprogress.bind(this);i.responseType=r.responseType;self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout);i.send()};t.readystatechange=function e(){var t=this.context,r=this.loader,i=this.stats;if(!t||!r){return}var n=r.readyState;var a=this.config;if(i.aborted){return}if(n>=2){self.clearTimeout(this.requestTimeout);if(i.loading.first===0){i.loading.first=Math.max(self.performance.now(),i.loading.start)}if(n===4){r.onreadystatechange=null;r.onprogress=null;var s=r.status;if(s>=200&&s<300){i.loading.end=Math.max(self.performance.now(),i.loading.first);var o;var l;if(t.responseType==="arraybuffer"){o=r.response;l=o.byteLength}else{o=r.responseText;l=o.length}i.loaded=i.total=l;if(!this.callbacks){return}var u=this.callbacks.onProgress;if(u){u(i,t,o,r)}if(!this.callbacks){return}var c={url:r.responseURL,data:o};this.callbacks.onSuccess(c,i,t,r)}else{if(i.retry>=a.maxRetry||s>=400&&s<499){d["logger"].error(s+" while loading "+t.url);this.callbacks.onError({code:s,text:r.statusText},t,r)}else{d["logger"].warn(s+" while loading "+t.url+", retrying in "+this.retryDelay+"...");this.abortInternal();this.loader=null;self.clearTimeout(this.retryTimeout);this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay);i.retry++}}}else{self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}}};t.loadtimeout=function e(){d["logger"].warn("timeout while loading "+this.context.url);var t=this.callbacks;if(t){this.abortInternal();t.onTimeout(this.stats,this.context,this.loader)}};t.loadprogress=function e(t){var r=this.stats;r.loaded=t.loaded;if(t.lengthComputable){r.total=t.total}};t.getCacheAge=function e(){var t=null;if(this.loader&&n.test(this.loader.getAllResponseHeaders())){var r=this.loader.getResponseHeader("age");t=r?parseFloat(r):null}return t};return e}();t["default"]=a}})["default"]})},228:function(r,i){var n,a,s;(function(e,t){if(true){!(a=[],n=t,s=typeof n==="function"?n.apply(i,a):n,s!==undefined&&(r.exports=s))}else{}})(this,function(){var f=function(){},s={},u={},c={};function i(e,r){e=e.push?e:[e];var i=[],t=e.length,n=t,a,s,o,l;a=function(e,t){if(t.length)i.push(e);n--;if(!n)r(i)};while(t--){s=e[t];o=u[s];if(o){a(s,o);continue}l=c[s]=c[s]||[];l.push(a)}}function o(e,t){if(!e)return;var r=c[e];u[e]=t;if(!r)return;while(r.length){r[0](e,t);r.splice(0,1)}}function l(e,t){if(e.call)e={success:e};if(t.length)(e.error||f)(t);else(e.success||f)(e)}function h(r,i,n,a){var e=document,t=n.async,s=(n.numRetries||0)+1,o=n.before||f,l=r.replace(/[\?|#].*$/,""),u=r.replace(/^(css|img)!/,""),c,d;a=a||0;if(/(^css!|\.css$)/.test(l)){d=e.createElement("link");d.rel="stylesheet";d.href=u;c="hideFocus"in d;if(c&&d.relList){c=0;d.rel="preload";d.as="style"}}else if(/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(l)){d=e.createElement("img");d.src=u}else{d=e.createElement("script");d.src=r;d.async=t===undefined?true:t}d.onload=d.onerror=d.onbeforeload=function(e){var t=e.type[0];if(c){try{if(!d.sheet.cssText.length)t="e"}catch(e){if(e.code!=18)t="e"}}if(t=="e"){a+=1;if(a<s){return h(r,i,n,a)}}else if(d.rel=="preload"&&d.as=="style"){return d.rel="stylesheet"}i(r,t,e.defaultPrevented)};if(o(r,d)!==false)e.head.appendChild(d)}function d(e,i,t){e=e.push?e:[e];var n=e.length,r=n,a=[],s,o;s=function(e,t,r){if(t=="e")a.push(e);if(t=="b"){if(r)a.push(e);else return}n--;if(!n)i(a)};for(o=0;o<r;o++)h(e[o],s,t)}function n(e,t,r){var i,n;if(t&&t.trim)i=t;n=(i?r:t)||{};if(i){if(i in s){throw"LoadJS"}else{s[i]=true}}function a(t,r){d(e,function(e){l(n,e);if(t){l({success:t,error:r},e)}o(i,e)},n)}if(n.returnPromise)return new Promise(a);else a()}n.ready=function e(t,r){i(t,function(e){l(r,e)});return n};n.done=function e(t){o(t,[])};n.reset=function e(){s={};u={};c={}};n.isDefined=function e(t){return t in s};return n})},163:function(r){!function(e,t){true?r.exports=t():0}(this,function(){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach(function(e){n(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var o={addCSS:!0,thumbWidth:15,watch:!0};function l(e,t){return function(){return Array.from(document.querySelectorAll(t)).includes(this)}.call(e,t)}var t=function(e){return null!=e?e.constructor:null},r=function(e,t){return!!(e&&t&&e instanceof t)},u=function(e){return null==e},c=function(e){return t(e)===Object},d=function(e){return t(e)===String},f=function(e){return Array.isArray(e)},h=function(e){return r(e,NodeList)},v=d,g=f,p=h,m=function(e){return r(e,Element)},y=function(e){return r(e,Event)},b=function(e){return u(e)||(d(e)||f(e)||h(e))&&!e.length||c(e)&&!Object.keys(e).length};function T(e,t){if(1>t){var r=function(e){var t="".concat(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}(t);return parseFloat(e.toFixed(r))}return Math.round(e/t)*t}return function(){function u(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,u),m(e)?this.element=e:v(e)&&(this.element=document.querySelector(e)),m(this.element)&&b(this.element.rangeTouch)&&(this.config=s({},o,{},t),this.init())}return e=u,r=[{key:"setup",value:function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=null;if(b(t)||v(t)?e=Array.from(document.querySelectorAll(v(t)?t:'input[type="range"]')):m(t)?e=[t]:p(t)?e=Array.from(t):g(t)&&(e=t.filter(m)),b(e))return null;var i=s({},o,{},r);if(v(t)&&i.watch){var n=new MutationObserver(function(e){Array.from(e).forEach(function(e){Array.from(e.addedNodes).forEach(function(e){m(e)&&l(e,t)&&new u(e,i)})})});n.observe(document.body,{childList:!0,subtree:!0})}return e.map(function(e){return new u(e,r)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}],(t=[{key:"init",value:function(){u.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){u.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(e){var t=this,r=e?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(e){t.element[r](e,function(e){return t.set(e)},!1)})}},{key:"get",value:function(e){if(!u.enabled||!y(e))return null;var t,r=e.target,i=e.changedTouches[0],n=parseFloat(r.getAttribute("min"))||0,a=parseFloat(r.getAttribute("max"))||100,s=parseFloat(r.getAttribute("step"))||1,o=r.getBoundingClientRect(),l=100/o.width*(this.config.thumbWidth/2)/100;return 0>(t=100/o.width*(i.clientX-o.left))?t=0:100<t&&(t=100),50>t?t-=(100-2*t)*l:50<t&&(t+=2*(t-50)*l),n+T(t/100*(a-n),s)}},{key:"set",value:function(e){u.enabled&&y(e)&&!e.target.disabled&&(e.preventDefault(),e.target.value=this.get(e),function(e,t){if(e&&t){var r=new Event(t,{bubbles:!0});e.dispatchEvent(r)}}(e.target,"touchend"===e.type?"change":"input"))}}])&&i(e.prototype,t),r&&i(e,r),u;var e,t,r}()})}};var n={};function Ht(e){var t=n[e];if(t!==undefined){return t.exports}var r=n[e]={exports:{}};i[e].call(r.exports,r,r.exports,Ht);return r.exports}(()=>{Ht.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;Ht.d(t,{a:t});return t}})();(()=>{Ht.d=(e,t)=>{for(var r in t){if(Ht.o(t,r)&&!Ht.o(e,r)){Object.defineProperty(e,r,{enumerable:true,get:t[r]})}}}})();(()=>{Ht.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{Ht.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var Kt={};(()=>{"use strict";Ht.r(Kt);var e=Ht(163);var N=Ht.n(e);const t=e=>e!==null&&typeof e!=="undefined"?e.constructor:null;const r=(e,t)=>Boolean(e&&t&&e instanceof t);const U=e=>e===null||typeof e==="undefined";const B=e=>t(e)===Object;const j=e=>t(e)===Number&&!Number.isNaN(e);const i=e=>t(e)===String;const G=e=>t(e)===Boolean;const H=e=>typeof e==="function";const K=e=>Array.isArray(e);const V=e=>r(e,WeakMap);const W=e=>r(e,NodeList);const q=e=>t(e)===Text;const Y=e=>r(e,Event);const $=e=>r(e,KeyboardEvent);const z=e=>r(e,window.TextTrackCue)||r(e,window.VTTCue);const X=e=>r(e,TextTrack)||!U(e)&&i(e.kind);const Q=e=>r(e,Promise)&&H(e.then);const J=e=>e!==null&&typeof e==="object"&&e.nodeType===1&&typeof e.style==="object"&&typeof e.ownerDocument==="object";const Z=e=>U(e)||(i(e)||K(e)||W(e))&&!e.length||B(e)&&!Object.keys(e).length;const ee=e=>{if(r(e,window.URL)){return true}if(!i(e)){return false}let t=e;if(!e.startsWith("http://")||!e.startsWith("https://")){t=`http://${e}`}try{return!Z(new URL(t).hostname)}catch(e){return false}};const T={nullOrUndefined:U,object:B,number:j,string:i,boolean:G,function:H,array:K,weakMap:V,nodeList:W,element:J,textNode:q,event:Y,keyboardEvent:$,cue:z,track:X,promise:Q,url:ee,empty:Z};const te=(()=>{const t=document.createElement("span");const e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};const r=Object.keys(e).find(e=>t.style[e]!==undefined);return T.string(r)?e[r]:false})();function re(e,t){setTimeout(()=>{try{e.hidden=true;e.offsetHeight;e.hidden=false}catch(e){}},t)}const ie=Boolean(window.document.documentMode);const ne=/Edge/g.test(navigator.userAgent);const ae="WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent);const se=/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1;const oe=navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;const le=/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1;const E={isIE:ie,isEdge:ne,isWebKit:ae,isIPhone:se,isIPadOS:oe,isIos:le};function ue(e){return JSON.parse(JSON.stringify(e))}function ce(e,t){return t.split(".").reduce((e,t)=>e&&e[t],e)}function S(t={},...e){if(!e.length){return t}const r=e.shift();if(!T.object(r)){return t}Object.keys(r).forEach(e=>{if(T.object(r[e])){if(!Object.keys(t).includes(e)){Object.assign(t,{[e]:{}})}S(t[e],r[e])}else{Object.assign(t,{[e]:r[e]})}});return S(t,...e)}function de(e,a){const t=e.length?e:[e];Array.from(t).reverse().forEach((e,t)=>{const r=t>0?a.cloneNode(true):a;const i=e.parentNode;const n=e.nextSibling;r.appendChild(e);if(n){i.insertBefore(r,n)}else{i.appendChild(r)}})}function fe(r,e){if(!T.element(r)||T.empty(e))return;Object.entries(e).filter(([,e])=>!T.nullOrUndefined(e)).forEach(([e,t])=>r.setAttribute(e,t))}function k(e,t,r){const i=document.createElement(e);if(T.object(t)){fe(i,t)}if(T.string(r)){i.innerText=r}return i}function he(e,t){if(!T.element(e)||!T.element(t))return;t.parentNode.insertBefore(e,t.nextSibling)}function ve(e,t,r,i){if(!T.element(t))return;t.appendChild(k(e,r,i))}function o(e){if(T.nodeList(e)||T.array(e)){Array.from(e).forEach(o);return}if(!T.element(e)||!T.element(e.parentNode)){return}e.parentNode.removeChild(e)}function s(e){if(!T.element(e))return;let{length:t}=e.childNodes;while(t>0){e.removeChild(e.lastChild);t-=1}}function b(e,t){if(!T.element(t)||!T.element(t.parentNode)||!T.element(e))return null;t.parentNode.replaceChild(e,t);return e}function A(e,t){if(!T.string(e)||T.empty(e))return{};const l={};const u=S({},t);e.split(",").forEach(e=>{const t=e.trim();const r=t.replace(".","");const i=t.replace(/[[\]]/g,"");const n=i.split("=");const[a]=n;const s=n.length>1?n[1].replace(/["']/g,""):"";const o=t.charAt(0);switch(o){case".":if(T.string(u.class)){l.class=`${u.class} ${r}`}else{l.class=r}break;case"#":l.id=t.replace("#","");break;case"[":l[a]=s;break;default:break}});return S(u,l)}function l(e,t){if(!T.element(e))return;let r=t;if(!T.boolean(r)){r=!e.hidden}e.hidden=r}function f(t,r,i){if(T.nodeList(t)){return Array.from(t).map(e=>f(e,r,i))}if(T.element(t)){let e="toggle";if(typeof i!=="undefined"){e=i?"add":"remove"}t.classList[e](r);return t.classList.contains(r)}return false}function ge(e,t){return T.element(e)&&e.classList.contains(t)}function p(e,t){const{prototype:r}=Element;function i(){return Array.from(document.querySelectorAll(t)).includes(this)}const n=r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||i;return n.call(e,t)}function pe(e,t){const{prototype:r}=Element;function i(){let e=this;do{if(p.matches(e,t))return e;e=e.parentElement||e.parentNode}while(e!==null&&e.nodeType===1);return null}const n=r.closest||i;return n.call(e,t)}function h(e){return this.elements.container.querySelectorAll(e)}function u(e){return this.elements.container.querySelector(e)}function me(e=null,t=false){if(!T.element(e))return;e.focus({preventScroll:true,focusVisible:t})}const ye={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"};const be={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(e,t){const r=be[e]||t!=="html5";const i=r&&be.rangeInput;return{api:r,ui:i}},pip:(()=>{if(E.isIPhone){return false}if(T["function"](k("video").webkitSetPresentationMode)){return true}if(document.pictureInPictureEnabled&&!k("video").disablePictureInPicture){return true}return false})(),airplay:T["function"](window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(e){if(T.empty(e)){return false}const[t]=e.split("/");let r=e;if(!this.isHTML5||t!==this.type){return false}if(Object.keys(ye).includes(r)){r+=`; codecs="${ye[e]}"`}try{return Boolean(r&&this.media.canPlayType(r).replace(/no/,""))}catch(e){return false}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const e=document.createElement("input");e.type="range";return e.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:te!==false,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches};const L=be;const Te=(()=>{let e=false;try{const t=Object.defineProperty({},"passive",{get(){e=true;return null}});window.addEventListener("test",null,t);window.removeEventListener("test",null,t)}catch(e){}return e})();function c(t,e,r,i=false,n=true,a=false){if(!t||!("addEventListener"in t)||T.empty(e)||!T["function"](r)){return}const s=e.split(" ");let o=a;if(Te){o={passive:n,capture:a}}s.forEach(e=>{if(this&&this.eventListeners&&i){this.eventListeners.push({element:t,type:e,callback:r,options:o})}t[i?"addEventListener":"removeEventListener"](e,r,o)})}function D(e,t="",r,i=true,n=false){c.call(this,e,t,r,true,i,n)}function Ee(e,t="",r,i=true,n=false){c.call(this,e,t,r,false,i,n)}function Se(t,r="",i,n=true,a=false){const s=(...e)=>{Ee(t,r,s,n,a);i.apply(this,e)};c.call(this,t,r,s,true,n,a)}function w(e,t="",r=false,i={}){if(!T.element(e)||T.empty(t)){return}const n=new CustomEvent(t,{bubbles:r,detail:{...i,plyr:this}});e.dispatchEvent(n)}function ke(){if(this&&this.eventListeners){this.eventListeners.forEach(e=>{const{element:t,type:r,callback:i,options:n}=e;t.removeEventListener(r,i,n)});this.eventListeners=[]}}function Ae(){return new Promise(e=>this.ready?setTimeout(e,0):D.call(this,this.elements.container,"ready",e)).then(()=>{})}function m(e){if(T.promise(e)){e.then(null,()=>{})}}const Le={silencePromise:m};function De(r){if(!T.array(r)){return r}return r.filter((e,t)=>r.indexOf(e)===t)}function we(e,r){if(!T.array(e)||!e.length){return null}return e.reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e)}function Ce(e){if(!window||!window.CSS){return false}return window.CSS.supports(e)}const Re=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((e,[t,r])=>({...e,[t/r]:[t,r]}),{});function Ie(e){if(!T.array(e)&&(!T.string(e)||!e.includes(":"))){return false}const t=T.array(e)?e:e.split(":");return t.map(Number).every(T.number)}function _e(e){if(!T.array(e)||!e.every(T.number)){return null}const[t,r]=e;const i=(e,t)=>t===0?e:i(t,e%t);const n=i(t,r);return[t/n,r/n]}function Oe(e){const t=e=>Ie(e)?e.split(":").map(Number):null;let r=t(e);if(r===null){r=t(this.config.ratio)}if(r===null&&!T.empty(this.embed)&&T.array(this.embed.ratio)){({ratio:r}=this.embed)}if(r===null&&this.isHTML5){const{videoWidth:i,videoHeight:n}=this.media;r=[i,n]}return _e(r)}function C(e){if(!this.isVideo){return{}}const{wrapper:t}=this.elements;const r=Oe.call(this,e);if(!T.array(r)){return{}}const[i,n]=_e(r);const a=Ce(`aspect-ratio: ${i}/${n}`);const s=100/i*n;if(a){t.style.aspectRatio=`${i}/${n}`}else{t.style.paddingBottom=`${s}%`}if(this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const o=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10);const l=(o-s)/(o/50);if(this.fullscreen.active){t.style.paddingBottom=null}else{this.media.style.transform=`translateY(-${l}%)`}}else if(this.isHTML5){t.classList.add(this.config.classNames.videoFixedRatio)}return{padding:s,ratio:r}}function Pe(e,t,r=.05){const i=e/t;const n=we(Object.keys(Re),i);if(Math.abs(n-i)<=r){return Re[n]}return[e,t]}function xe(){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);const t=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);return[e,t]}const d={getSources(){if(!this.isHTML5){return[]}const e=Array.from(this.media.querySelectorAll("source"));return e.filter(e=>{const t=e.getAttribute("type");if(T.empty(t)){return true}return L.mime.call(this,t)})},getQualityOptions(){if(this.config.quality.forced){return this.config.quality.options}return d.getSources.call(this).map(e=>Number(e.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5){return}const l=this;l.options.speed=l.config.speed.options;if(!T.empty(this.config.ratio)){C.call(l)}Object.defineProperty(l.media,"quality",{get(){const e=d.getSources.call(l);const t=e.find(e=>e.getAttribute("src")===l.source);return t&&Number(t.getAttribute("size"))},set(t){if(l.quality===t){return}if(l.config.quality.forced&&T["function"](l.config.quality.onChange)){l.config.quality.onChange(t)}else{const r=d.getSources.call(l);const e=r.find(e=>Number(e.getAttribute("size"))===t);if(!e){return}const{currentTime:i,paused:n,preload:a,readyState:s,playbackRate:o}=l.media;l.media.src=e.getAttribute("src");if(a!=="none"||s){l.once("loadedmetadata",()=>{l.speed=o;l.currentTime=i;if(!n){m(l.play())}});l.media.load()}}w.call(l,l.media,"qualitychange",false,{quality:t})}})},cancelRequests(){if(!this.isHTML5){return}o(d.getSources.call(this));this.media.setAttribute("src",this.config.blankVideo);this.media.load();this.debug.log("Cancelled network requests")}};const Me=d;function Fe(e){return`${e}-${Math.floor(Math.random()*1e4)}`}function Ne(e,...r){if(T.empty(e))return e;return e.toString().replace(/{(\d+)}/g,(e,t)=>r[t].toString())}function Ue(e,t){if(e===0||t===0||Number.isNaN(e)||Number.isNaN(t)){return 0}return(e/t*100).toFixed(2)}const v=(e="",t="",r="")=>e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),r.toString());const Be=(e="")=>e.toString().replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());function je(e=""){let t=e.toString();t=v(t,"-"," ");t=v(t,"_"," ");t=Be(t);return v(t," ","")}function Ge(e=""){let t=e.toString();t=je(t);return t.charAt(0).toLowerCase()+t.slice(1)}function He(e){const t=document.createDocumentFragment();const r=document.createElement("div");t.appendChild(r);r.innerHTML=e;return t.firstChild.innerText}function Ke(e){const t=document.createElement("div");t.appendChild(e);return t.innerHTML}const Ve={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"};const We={get(e="",t={}){if(T.empty(e)||T.empty(t)){return""}let r=ce(t.i18n,e);if(T.empty(r)){if(Object.keys(Ve).includes(e)){return Ve[e]}return""}const i={"{seektime}":t.seekTime,"{title}":t.title};Object.entries(i).forEach(([e,t])=>{r=v(r,e,t)});return r}};const R=We;class qe{constructor(e){this.enabled=e.config.storage.enabled;this.key=e.config.storage.key}static get supported(){try{if(!("localStorage"in window)){return false}const e="___test";window.localStorage.setItem(e,e);window.localStorage.removeItem(e);return true}catch(e){return false}}get=e=>{if(!qe.supported||!this.enabled){return null}const t=window.localStorage.getItem(this.key);if(T.empty(t)){return null}const r=JSON.parse(t);return T.string(e)&&e.length?r[e]:r};set=e=>{if(!qe.supported||!this.enabled){return}if(!T.object(e)){return}let t=this.get();if(T.empty(t)){t={}}S(t,e);try{window.localStorage.setItem(this.key,JSON.stringify(t))}catch(e){}}}const Ye=qe;function I(e,n="text"){return new Promise((t,r)=>{try{const i=new XMLHttpRequest;if(!("withCredentials"in i)){return}i.addEventListener("load",()=>{if(n==="text"){try{t(JSON.parse(i.responseText))}catch(e){t(i.responseText)}}else{t(i.response)}});i.addEventListener("error",()=>{throw new Error(i.status)});i.open("GET",e,true);i.responseType=n;i.send()}catch(e){r(e)}})}function $e(e,t){if(!T.string(e)){return}const r="cache";const i=T.string(t);let n=false;const a=()=>document.getElementById(t)!==null;const s=(e,t)=>{e.innerHTML=t;if(i&&a()){return}document.body.insertAdjacentElement("afterbegin",e)};if(!i||!a()){const o=Ye.supported;const l=document.createElement("div");l.setAttribute("hidden","");if(i){l.setAttribute("id",t)}if(o){const u=window.localStorage.getItem(`${r}-${t}`);n=u!==null;if(n){const c=JSON.parse(u);s(l,c.content)}}I(e).then(e=>{if(T.empty(e)){return}if(o){try{window.localStorage.setItem(`${r}-${t}`,JSON.stringify({content:e}))}catch(e){}}s(l,e)}).catch(()=>{})}}const ze=e=>Math.trunc(e/60/60%60,10);const Xe=e=>Math.trunc(e/60%60,10);const Qe=e=>Math.trunc(e%60,10);function Je(e=0,t=false,r=false){if(!T.number(e)){return Je(undefined,t,r)}const i=e=>`0${e}`.slice(-2);let n=ze(e);const a=Xe(e);const s=Qe(e);if(t||n>0){n=`${n}:`}else{n=""}return`${r&&e>0?"-":""}${n}${i(a)}:${i(s)}`}const _={getIconUrl(){const e=new URL(this.config.iconUrl,window.location);const t=window.location.host?window.location.host:window.top.location.host;const r=e.host!==t||E.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:r}},findElements(){try{this.elements.controls=u.call(this,this.config.selectors.controls.wrapper);this.elements.buttons={play:h.call(this,this.config.selectors.buttons.play),pause:u.call(this,this.config.selectors.buttons.pause),restart:u.call(this,this.config.selectors.buttons.restart),rewind:u.call(this,this.config.selectors.buttons.rewind),fastForward:u.call(this,this.config.selectors.buttons.fastForward),mute:u.call(this,this.config.selectors.buttons.mute),pip:u.call(this,this.config.selectors.buttons.pip),airplay:u.call(this,this.config.selectors.buttons.airplay),settings:u.call(this,this.config.selectors.buttons.settings),captions:u.call(this,this.config.selectors.buttons.captions),fullscreen:u.call(this,this.config.selectors.buttons.fullscreen)};this.elements.progress=u.call(this,this.config.selectors.progress);this.elements.inputs={seek:u.call(this,this.config.selectors.inputs.seek),volume:u.call(this,this.config.selectors.inputs.volume)};this.elements.display={buffer:u.call(this,this.config.selectors.display.buffer),currentTime:u.call(this,this.config.selectors.display.currentTime),duration:u.call(this,this.config.selectors.display.duration)};if(T.element(this.elements.progress)){this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)}return true}catch(e){this.debug.warn("It looks like there is a problem with your custom controls HTML",e);this.toggleNativeControls(true);return false}},createIcon(e,t){const r="http://www.w3.org/2000/svg";const i=_.getIconUrl.call(this);const n=`${!i.cors?i.url:""}#${this.config.iconPrefix}`;const a=document.createElementNS(r,"svg");fe(a,S(t,{"aria-hidden":"true",focusable:"false"}));const s=document.createElementNS(r,"use");const o=`${n}-${e}`;if("href"in s){s.setAttributeNS("http://www.w3.org/1999/xlink","href",o)}s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);a.appendChild(s);return a},createLabel(e,t={}){const r=R.get(e,this.config);const i={...t,class:[t.class,this.config.classNames.hidden].filter(Boolean).join(" ")};return k("span",i,r)},createBadge(e){if(T.empty(e)){return null}const t=k("span",{class:this.config.classNames.menu.value});t.appendChild(k("span",{class:this.config.classNames.menu.badge},e));return t},createButton(e,t){const r=S({},t);let i=Ge(e);const n={element:"button",toggle:false,label:null,icon:null,labelPressed:null,iconPressed:null};["element","icon","label"].forEach(e=>{if(Object.keys(r).includes(e)){n[e]=r[e];delete r[e]}});if(n.element==="button"&&!Object.keys(r).includes("type")){r.type="button"}if(Object.keys(r).includes("class")){if(!r.class.split(" ").some(e=>e===this.config.classNames.control)){S(r,{class:`${r.class} ${this.config.classNames.control}`})}}else{r.class=this.config.classNames.control}switch(e){case"play":n.toggle=true;n.label="play";n.labelPressed="pause";n.icon="play";n.iconPressed="pause";break;case"mute":n.toggle=true;n.label="mute";n.labelPressed="unmute";n.icon="volume";n.iconPressed="muted";break;case"captions":n.toggle=true;n.label="enableCaptions";n.labelPressed="disableCaptions";n.icon="captions-off";n.iconPressed="captions-on";break;case"fullscreen":n.toggle=true;n.label="enterFullscreen";n.labelPressed="exitFullscreen";n.icon="enter-fullscreen";n.iconPressed="exit-fullscreen";break;case"play-large":r.class+=` ${this.config.classNames.control}--overlaid`;i="play";n.label="play";n.icon="play";break;default:if(T.empty(n.label)){n.label=i}if(T.empty(n.icon)){n.icon=e}}const a=k(n.element);if(n.toggle){a.appendChild(_.createIcon.call(this,n.iconPressed,{class:"icon--pressed"}));a.appendChild(_.createIcon.call(this,n.icon,{class:"icon--not-pressed"}));a.appendChild(_.createLabel.call(this,n.labelPressed,{class:"label--pressed"}));a.appendChild(_.createLabel.call(this,n.label,{class:"label--not-pressed"}))}else{a.appendChild(_.createIcon.call(this,n.icon));a.appendChild(_.createLabel.call(this,n.label))}S(r,A(this.config.selectors.buttons[i],r));fe(a,r);if(i==="play"){if(!T.array(this.elements.buttons[i])){this.elements.buttons[i]=[]}this.elements.buttons[i].push(a)}else{this.elements.buttons[i]=a}return a},createRange(e,t){const r=k("input",S(A(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":R.get(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));this.elements.inputs[e]=r;_.updateRangeFill.call(this,r);N().setup(r);return r},createProgress(e,t){const r=k("progress",S(A(this.config.selectors.display[e]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":true},t));if(e!=="volume"){r.appendChild(k("span",null,"0"));const i={played:"played",buffer:"buffered"}[e];const n=i?R.get(i,this.config):"";r.innerText=`% ${n.toLowerCase()}`}this.elements.display[e]=r;return r},createTime(e,t){const r=A(this.config.selectors.display[e],t);const i=k("div",S(r,{class:`${r.class?r.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":R.get(e,this.config),role:"timer"}),"00:00");this.elements.display[e]=i;return i},bindMenuItemShortcuts(i,e){D.call(this,i,"keydown keyup",t=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(t.key)){return}t.preventDefault();t.stopPropagation();if(t.type==="keydown"){return}const r=p(i,'[role="menuitemradio"]');if(!r&&[" ","ArrowRight"].includes(t.key)){_.showMenuPanel.call(this,e,true)}else{let e;if(t.key!==" "){if(t.key==="ArrowDown"||r&&t.key==="ArrowRight"){e=i.nextElementSibling;if(!T.element(e)){e=i.parentNode.firstElementChild}}else{e=i.previousElementSibling;if(!T.element(e)){e=i.parentNode.lastElementChild}}me.call(this,e,true)}}},false);D.call(this,i,"keyup",e=>{if(e.key!=="Return")return;_.focusFirstMenuItem.call(this,null,true)})},createMenuItem({value:t,list:e,type:r,title:i,badge:n=null,checked:a=false}){const s=A(this.config.selectors.inputs[r]);const o=k("button",S(s,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${s.class?s.class:""}`.trim(),"aria-checked":a,value:t}));const l=k("span");l.innerHTML=i;if(T.element(n)){l.appendChild(n)}o.appendChild(l);Object.defineProperty(o,"checked",{enumerable:true,get(){return o.getAttribute("aria-checked")==="true"},set(e){if(e){Array.from(o.parentNode.children).filter(e=>p(e,'[role="menuitemradio"]')).forEach(e=>e.setAttribute("aria-checked","false"))}o.setAttribute("aria-checked",e?"true":"false")}});this.listeners.bind(o,"click keyup",e=>{if(T.keyboardEvent(e)&&e.key!==" "){return}e.preventDefault();e.stopPropagation();o.checked=true;switch(r){case"language":this.currentTrack=Number(t);break;case"quality":this.quality=t;break;case"speed":this.speed=parseFloat(t);break;default:break}_.showMenuPanel.call(this,"home",T.keyboardEvent(e))},r,false);_.bindMenuItemShortcuts.call(this,o,r);e.appendChild(o)},formatTime(e=0,t=false){if(!T.number(e)){return e}const r=ze(this.duration)>0;return Je(e,r,t)},updateTimeDisplay(e=null,t=0,r=false){if(!T.element(e)||!T.number(t)){return}e.innerText=_.formatTime(t,r)},updateVolume(){if(!this.supported.ui){return}if(T.element(this.elements.inputs.volume)){_.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume)}if(T.element(this.elements.buttons.mute)){this.elements.buttons.mute.pressed=this.muted||this.volume===0}},setRange(e,t=0){if(!T.element(e)){return}e.value=t;_.updateRangeFill.call(this,e)},updateProgress(e){if(!this.supported.ui||!T.event(e)){return}let t=0;const r=(e,t)=>{const r=T.number(t)?t:0;const i=T.element(e)?e:this.elements.display.buffer;if(T.element(i)){i.value=r;const n=i.getElementsByTagName("span")[0];if(T.element(n)){n.childNodes[0].nodeValue=r}}};if(e){switch(e.type){case"timeupdate":case"seeking":case"seeked":t=Ue(this.currentTime,this.duration);if(e.type==="timeupdate"){_.setRange.call(this,this.elements.inputs.seek,t)}break;case"playing":case"progress":r(this.elements.display.buffer,this.buffered*100);break;default:break}}},updateRangeFill(e){const t=T.event(e)?e.target:e;if(!T.element(t)||t.getAttribute("type")!=="range"){return}if(p(t,this.config.selectors.inputs.seek)){t.setAttribute("aria-valuenow",this.currentTime);const r=_.formatTime(this.currentTime);const i=_.formatTime(this.duration);const e=R.get("seekLabel",this.config);t.setAttribute("aria-valuetext",e.replace("{currentTime}",r).replace("{duration}",i))}else if(p(t,this.config.selectors.inputs.volume)){const n=t.value*100;t.setAttribute("aria-valuenow",n);t.setAttribute("aria-valuetext",`${n.toFixed(1)}%`)}else{t.setAttribute("aria-valuenow",t.value)}if(!E.isWebKit&&!E.isIPadOS){return}t.style.setProperty("--value",`${t.value/t.max*100}%`)},updateSeekTooltip(e){if(!this.config.tooltips.seek||!T.element(this.elements.inputs.seek)||!T.element(this.elements.display.seekTooltip)||this.duration===0){return}const t=this.elements.display.seekTooltip;const r=`${this.config.classNames.tooltip}--visible`;const i=e=>f(t,r,e);if(this.touch){i(false);return}let n=0;const a=this.elements.progress.getBoundingClientRect();if(T.event(e)){n=100/a.width*(e.pageX-a.left)}else if(ge(t,r)){n=parseFloat(t.style.left,10)}else{return}if(n<0){n=0}else if(n>100){n=100}const s=this.duration/100*n;t.innerText=_.formatTime(s);const o=this.config.markers?.points?.find(({time:e})=>e===Math.round(s));if(o){t.insertAdjacentHTML("afterbegin",`${o.label}<br>`)}t.style.left=`${n}%`;if(T.event(e)&&["mouseenter","mouseleave"].includes(e.type)){i(e.type==="mouseenter")}},timeUpdate(e){const t=!T.element(this.elements.display.duration)&&this.config.invertTime;_.updateTimeDisplay.call(this,this.elements.display.currentTime,t?this.duration-this.currentTime:this.currentTime,t);if(e&&e.type==="timeupdate"&&this.media.seeking){return}_.updateProgress.call(this,e)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime){return}if(this.duration>=2**32){l(this.elements.display.currentTime,true);l(this.elements.progress,true);return}if(T.element(this.elements.inputs.seek)){this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration)}const e=T.element(this.elements.display.duration);if(!e&&this.config.displayDuration&&this.paused){_.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration)}if(e){_.updateTimeDisplay.call(this,this.elements.display.duration,this.duration)}if(this.config.markers.enabled){_.setMarkers.call(this)}_.updateSeekTooltip.call(this)},toggleMenuButton(e,t){l(this.elements.settings.buttons[e],!t)},updateSetting(e,t,r){const i=this.elements.settings.panels[e];let n=null;let a=t;if(e==="captions"){n=this.currentTrack}else{n=!T.empty(r)?r:this[e];if(T.empty(n)){n=this.config[e].default}if(!T.empty(this.options[e])&&!this.options[e].includes(n)){this.debug.warn(`Unsupported value of '${n}' for ${e}`);return}if(!this.config[e].options.includes(n)){this.debug.warn(`Disabled value of '${n}' for ${e}`);return}}if(!T.element(a)){a=i&&i.querySelector('[role="menu"]')}if(!T.element(a)){return}const s=this.elements.settings.buttons[e].querySelector(`.${this.config.classNames.menu.value}`);s.innerHTML=_.getLabel.call(this,e,n);const o=a&&a.querySelector(`[value="${n}"]`);if(T.element(o)){o.checked=true}},getLabel(e,t){switch(e){case"speed":return t===1?R.get("normal",this.config):`${t}&times;`;case"quality":if(T.number(t)){const r=R.get(`qualityLabel.${t}`,this.config);if(!r.length){return`${t}p`}return r}return Be(t);case"captions":return P.getLabel.call(this);default:return null}},setQualityMenu(e){if(!T.element(this.elements.settings.panels.quality)){return}const t="quality";const r=this.elements.settings.panels.quality.querySelector('[role="menu"]');if(T.array(e)){this.options.quality=De(e).filter(e=>this.config.quality.options.includes(e))}const i=!T.empty(this.options.quality)&&this.options.quality.length>1;_.toggleMenuButton.call(this,t,i);s(r);_.checkMenu.call(this);if(!i){return}const n=e=>{const t=R.get(`qualityBadge.${e}`,this.config);if(!t.length){return null}return _.createBadge.call(this,t)};this.options.quality.sort((e,t)=>{const r=this.config.quality.options;return r.indexOf(e)>r.indexOf(t)?1:-1}).forEach(e=>{_.createMenuItem.call(this,{value:e,list:r,type:t,title:_.getLabel.call(this,"quality",e),badge:n(e)})});_.updateSetting.call(this,t,r)},setCaptionsMenu(){if(!T.element(this.elements.settings.panels.captions)){return}const e="captions";const r=this.elements.settings.panels.captions.querySelector('[role="menu"]');const t=P.getTracks.call(this);const i=Boolean(t.length);_.toggleMenuButton.call(this,e,i);s(r);_.checkMenu.call(this);if(!i){return}const n=t.map((e,t)=>({value:t,checked:this.captions.toggled&&this.currentTrack===t,title:P.getLabel.call(this,e),badge:e.language&&_.createBadge.call(this,e.language.toUpperCase()),list:r,type:"language"}));n.unshift({value:-1,checked:!this.captions.toggled,title:R.get("disabled",this.config),list:r,type:"language"});n.forEach(_.createMenuItem.bind(this));_.updateSetting.call(this,e,r)},setSpeedMenu(){if(!T.element(this.elements.settings.panels.speed)){return}const t="speed";const r=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(e=>e>=this.minimumSpeed&&e<=this.maximumSpeed);const e=!T.empty(this.options.speed)&&this.options.speed.length>1;_.toggleMenuButton.call(this,t,e);s(r);_.checkMenu.call(this);if(!e){return}this.options.speed.forEach(e=>{_.createMenuItem.call(this,{value:e,list:r,type:t,title:_.getLabel.call(this,"speed",e)})});_.updateSetting.call(this,t,r)},checkMenu(){const{buttons:e}=this.elements.settings;const t=!T.empty(e)&&Object.values(e).some(e=>!e.hidden);l(this.elements.settings.menu,!t)},focusFirstMenuItem(e,t=false){if(this.elements.settings.popup.hidden){return}let r=e;if(!T.element(r)){r=Object.values(this.elements.settings.panels).find(e=>!e.hidden)}const i=r.querySelector('[role^="menuitem"]');me.call(this,i,t)},toggleMenu(e){const{popup:t}=this.elements.settings;const r=this.elements.buttons.settings;if(!T.element(t)||!T.element(r)){return}const{hidden:i}=t;let n=i;if(T.boolean(e)){n=e}else if(T.keyboardEvent(e)&&e.key==="Escape"){n=false}else if(T.event(e)){const a=T["function"](e.composedPath)?e.composedPath()[0]:e.target;const s=t.contains(a);if(s||!s&&e.target!==r&&n){return}}r.setAttribute("aria-expanded",n);l(t,!n);f(this.elements.container,this.config.classNames.menu.open,n);if(n&&T.keyboardEvent(e)){_.focusFirstMenuItem.call(this,null,true)}else if(!n&&!i){me.call(this,r,T.keyboardEvent(e))}},getMenuSize(e){const t=e.cloneNode(true);t.style.position="absolute";t.style.opacity=0;t.removeAttribute("hidden");e.parentNode.appendChild(t);const r=t.scrollWidth;const i=t.scrollHeight;o(t);return{width:r,height:i}},showMenuPanel(e="",t=false){const r=this.elements.container.querySelector(`#plyr-settings-${this.id}-${e}`);if(!T.element(r)){return}const i=r.parentNode;const n=Array.from(i.children).find(e=>!e.hidden);if(L.transitions&&!L.reducedMotion){i.style.width=`${n.scrollWidth}px`;i.style.height=`${n.scrollHeight}px`;const a=_.getMenuSize.call(this,r);const s=e=>{if(e.target!==i||!["width","height"].includes(e.propertyName)){return}i.style.width="";i.style.height="";Ee.call(this,i,te,s)};D.call(this,i,te,s);i.style.width=`${a.width}px`;i.style.height=`${a.height}px`}l(n,true);l(r,false);_.focusFirstMenuItem.call(this,r,t)},setDownloadUrl(){const e=this.elements.buttons.download;if(!T.element(e)){return}e.setAttribute("href",this.download)},create(d){const{bindMenuItemShortcuts:f,createButton:h,createProgress:v,createRange:g,createTime:p,setQualityMenu:e,setSpeedMenu:t,showMenuPanel:m}=_;this.elements.controls=null;if(T.array(this.config.controls)&&this.config.controls.includes("play-large")){this.elements.container.appendChild(h.call(this,"play-large"))}const y=k("div",A(this.config.selectors.controls.wrapper));this.elements.controls=y;const b={class:"plyr__controls__item"};De(T.array(this.config.controls)?this.config.controls:[]).forEach(t=>{if(t==="restart"){y.appendChild(h.call(this,"restart",b))}if(t==="rewind"){y.appendChild(h.call(this,"rewind",b))}if(t==="play"){y.appendChild(h.call(this,"play",b))}if(t==="fast-forward"){y.appendChild(h.call(this,"fast-forward",b))}if(t==="progress"){const e=k("div",{class:`${b.class} plyr__progress__container`});const r=k("div",A(this.config.selectors.progress));r.appendChild(g.call(this,"seek",{id:`plyr-seek-${d.id}`}));r.appendChild(v.call(this,"buffer"));if(this.config.tooltips.seek){const i=k("span",{class:this.config.classNames.tooltip},"00:00");r.appendChild(i);this.elements.display.seekTooltip=i}this.elements.progress=r;e.appendChild(this.elements.progress);y.appendChild(e)}if(t==="current-time"){y.appendChild(p.call(this,"currentTime",b))}if(t==="duration"){y.appendChild(p.call(this,"duration",b))}if(t==="mute"||t==="volume"){let{volume:e}=this.elements;if(!T.element(e)||!y.contains(e)){e=k("div",S({},b,{class:`${b.class} plyr__volume`.trim()}));this.elements.volume=e;y.appendChild(e)}if(t==="mute"){e.appendChild(h.call(this,"mute"))}if(t==="volume"&&!E.isIos&&!E.isIPadOS){const n={max:1,step:.05,value:this.config.volume};e.appendChild(g.call(this,"volume",S(n,{id:`plyr-volume-${d.id}`})))}}if(t==="captions"){y.appendChild(h.call(this,"captions",b))}if(t==="settings"&&!T.empty(this.config.settings)){const a=k("div",S({},b,{class:`${b.class} plyr__menu`.trim(),hidden:""}));a.appendChild(h.call(this,"settings",{"aria-haspopup":true,"aria-controls":`plyr-settings-${d.id}`,"aria-expanded":false}));const s=k("div",{class:"plyr__menu__container",id:`plyr-settings-${d.id}`,hidden:""});const o=k("div");const l=k("div",{id:`plyr-settings-${d.id}-home`});const u=k("div",{role:"menu"});l.appendChild(u);o.appendChild(l);this.elements.settings.panels.home=l;this.config.settings.forEach(e=>{const t=k("button",S(A(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":true,hidden:""}));f.call(this,t,e);D.call(this,t,"click",()=>{m.call(this,e,false)});const r=k("span",null,R.get(e,this.config));const i=k("span",{class:this.config.classNames.menu.value});i.innerHTML=d[e];r.appendChild(i);t.appendChild(r);u.appendChild(t);const n=k("div",{id:`plyr-settings-${d.id}-${e}`,hidden:""});const a=k("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});a.appendChild(k("span",{"aria-hidden":true},R.get(e,this.config)));a.appendChild(k("span",{class:this.config.classNames.hidden},R.get("menuBack",this.config)));D.call(this,n,"keydown",e=>{if(e.key!=="ArrowLeft")return;e.preventDefault();e.stopPropagation();m.call(this,"home",true)},false);D.call(this,a,"click",()=>{m.call(this,"home",false)});n.appendChild(a);n.appendChild(k("div",{role:"menu"}));o.appendChild(n);this.elements.settings.buttons[e]=t;this.elements.settings.panels[e]=n});s.appendChild(o);a.appendChild(s);y.appendChild(a);this.elements.settings.popup=s;this.elements.settings.menu=a}if(t==="pip"&&L.pip){y.appendChild(h.call(this,"pip",b))}if(t==="airplay"&&L.airplay){y.appendChild(h.call(this,"airplay",b))}if(t==="download"){const n=S({},b,{element:"a",href:this.download,target:"_blank"});if(this.isHTML5){n.download=""}const{download:c}=this.config.urls;if(!T.url(c)&&this.isEmbed){S(n,{icon:`logo-${this.provider}`,label:this.provider})}y.appendChild(h.call(this,"download",n))}if(t==="fullscreen"){y.appendChild(h.call(this,"fullscreen",b))}});if(this.isHTML5){e.call(this,Me.getQualityOptions.call(this))}t.call(this);return y},inject(){if(this.config.loadSprite){const s=_.getIconUrl.call(this);if(s.cors){$e(s.url,"sprite-plyr")}}this.id=Math.floor(Math.random()*1e4);let e=null;this.elements.controls=null;const t={id:this.id,seektime:this.config.seekTime,title:this.config.title};let r=true;if(T["function"](this.config.controls)){this.config.controls=this.config.controls.call(this,t)}if(!this.config.controls){this.config.controls=[]}if(T.element(this.config.controls)||T.string(this.config.controls)){e=this.config.controls}else{e=_.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:P.getLabel.call(this)});r=false}const i=e=>{let r=e;Object.entries(t).forEach(([e,t])=>{r=v(r,`{${e}}`,t)});return r};if(r){if(T.string(this.config.controls)){e=i(e)}}let n;if(T.string(this.config.selectors.controls.container)){n=document.querySelector(this.config.selectors.controls.container)}if(!T.element(n)){n=this.elements.container}const a=T.element(e)?"insertAdjacentElement":"insertAdjacentHTML";n[a]("afterbegin",e);if(!T.element(this.elements.controls)){_.findElements.call(this)}if(!T.empty(this.elements.buttons)){const o=t=>{const r=this.config.classNames.controlPressed;t.setAttribute("aria-pressed","false");Object.defineProperty(t,"pressed",{configurable:true,enumerable:true,get(){return ge(t,r)},set(e=false){f(t,r,e);t.setAttribute("aria-pressed",e?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(e=>{if(T.array(e)||T.nodeList(e)){Array.from(e).filter(Boolean).forEach(o)}else{o(e)}})}if(E.isEdge){re(n)}if(this.config.tooltips.controls){const{classNames:l,selectors:u}=this.config;const c=`${u.controls.wrapper} ${u.labels} .${l.hidden}`;const d=h.call(this,c);Array.from(d).forEach(e=>{f(e,this.config.classNames.hidden,false);f(e,this.config.classNames.tooltip,true)})}},setMediaMetadata(){try{if("mediaSession"in navigator){navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork})}}catch(e){}},setMarkers(){if(!this.duration||this.elements.markers)return;const e=this.config.markers?.points?.filter(({time:e})=>e>0&&e<this.duration);if(!e?.length)return;const t=document.createDocumentFragment();const i=document.createDocumentFragment();let n=null;const r=`${this.config.classNames.tooltip}--visible`;const a=e=>f(n,r,e);e.forEach(e=>{const t=k("span",{class:this.config.classNames.marker},"");const r=`${e.time/this.duration*100}%`;if(n){t.addEventListener("mouseenter",()=>{if(e.label)return;n.style.left=r;n.innerHTML=e.label;a(true)});t.addEventListener("mouseleave",()=>{a(false)})}t.addEventListener("click",()=>{this.currentTime=e.time});t.style.left=r;i.appendChild(t)});t.appendChild(i);if(!this.config.tooltips.seek){n=k("span",{class:this.config.classNames.tooltip},"");t.appendChild(n)}this.elements.markers={points:i,tip:n};this.elements.progress.appendChild(t)}};const O=_;function Ze(e,t=true){let r=e;if(t){const i=document.createElement("a");i.href=r;r=i.href}try{return new URL(r)}catch(e){return null}}function et(e){const r=new URLSearchParams;if(T.object(e)){Object.entries(e).forEach(([e,t])=>{r.set(e,t)})}return r}const g={setup(){if(!this.supported.ui){return}if(!this.isVideo||this.isYouTube||this.isHTML5&&!L.textTracks){if(T.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")){O.setCaptionsMenu.call(this)}return}if(!T.element(this.elements.captions)){this.elements.captions=k("div",A(this.config.selectors.captions));this.elements.captions.setAttribute("dir","auto");he(this.elements.captions,this.elements.wrapper)}if(E.isIE&&window.URL){const n=this.media.querySelectorAll("track");Array.from(n).forEach(t=>{const e=t.getAttribute("src");const r=Ze(e);if(r!==null&&r.hostname!==window.location.href.hostname&&["http:","https:"].includes(r.protocol)){I(e,"blob").then(e=>{t.setAttribute("src",window.URL.createObjectURL(e))}).catch(()=>{o(t)})}})}const e=navigator.languages||[navigator.language||navigator.userLanguage||"en"];const t=De(e.map(e=>e.split("-")[0]));let r=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();if(r==="auto"){[r]=t}let i=this.storage.get("captions");if(!T.boolean(i)){({active:i}=this.config.captions)}Object.assign(this.captions,{toggled:false,active:i,language:r,languages:t});if(this.isHTML5){const a=this.config.captions.update?"addtrack removetrack":"removetrack";D.call(this,this.media.textTracks,a,g.update.bind(this))}setTimeout(g.update.bind(this),0)},update(){const e=g.getTracks.call(this,true);const{active:t,language:r,meta:i,currentTrackNode:n}=this.captions;const a=Boolean(e.find(e=>e.language===r));if(this.isHTML5&&this.isVideo){e.filter(e=>!i.get(e)).forEach(e=>{this.debug.log("Track added",e);i.set(e,{default:e.mode==="showing"});if(e.mode==="showing"){e.mode="hidden"}D.call(this,e,"cuechange",()=>g.updateCues.call(this))})}if(a&&this.language!==r||!e.includes(n)){g.setLanguage.call(this,r);g.toggle.call(this,t&&a)}if(this.elements){f(this.elements.container,this.config.classNames.captions.enabled,!T.empty(e))}if(T.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")){O.setCaptionsMenu.call(this)}},toggle(e,t=true){if(!this.supported.ui){return}const{toggled:r}=this.captions;const i=this.config.classNames.captions.active;const n=T.nullOrUndefined(e)?!r:e;if(n!==r){if(!t){this.captions.active=n;this.storage.set({captions:n})}if(!this.language&&n&&!t){const a=g.getTracks.call(this);const s=g.findTrack.call(this,[this.captions.language,...this.captions.languages],true);this.captions.language=s.language;g.set.call(this,a.indexOf(s));return}if(this.elements.buttons.captions){this.elements.buttons.captions.pressed=n}f(this.elements.container,i,n);this.captions.toggled=n;O.updateSetting.call(this,"captions");w.call(this,this.media,n?"captionsenabled":"captionsdisabled")}setTimeout(()=>{if(n&&this.captions.toggled){this.captions.currentTrackNode.mode="hidden"}})},set(e,t=true){const r=g.getTracks.call(this);if(e===-1){g.toggle.call(this,false,t);return}if(!T.number(e)){this.debug.warn("Invalid caption argument",e);return}if(!(e in r)){this.debug.warn("Track not found",e);return}if(this.captions.currentTrack!==e){this.captions.currentTrack=e;const i=r[e];const{language:n}=i||{};this.captions.currentTrackNode=i;O.updateSetting.call(this,"captions");if(!t){this.captions.language=n;this.storage.set({language:n})}if(this.isVimeo){this.embed.enableTextTrack(n)}w.call(this,this.media,"languagechange")}g.toggle.call(this,true,t);if(this.isHTML5&&this.isVideo){g.updateCues.call(this)}},setLanguage(e,t=true){if(!T.string(e)){this.debug.warn("Invalid language argument",e);return}const r=e.toLowerCase();this.captions.language=r;const i=g.getTracks.call(this);const n=g.findTrack.call(this,[r]);g.set.call(this,i.indexOf(n),t)},getTracks(t=false){const e=Array.from((this.media||{}).textTracks||[]);return e.filter(e=>!this.isHTML5||t||this.captions.meta.has(e)).filter(e=>["captions","subtitles"].includes(e.kind))},findTrack(e,t=false){const r=g.getTracks.call(this);const i=e=>Number((this.captions.meta.get(e)||{}).default);const n=Array.from(r).sort((e,t)=>i(t)-i(e));let a;e.every(t=>{a=n.find(e=>e.language===t);return!a});return a||(t?n[0]:undefined)},getCurrentTrack(){return g.getTracks.call(this)[this.currentTrack]},getLabel(e){let t=e;if(!T.track(t)&&L.textTracks&&this.captions.toggled){t=g.getCurrentTrack.call(this)}if(T.track(t)){if(!T.empty(t.label)){return t.label}if(!T.empty(t.language)){return e.language.toUpperCase()}return R.get("enabled",this.config)}return R.get("disabled",this.config)},updateCues(e){if(!this.supported.ui){return}if(!T.element(this.elements.captions)){this.debug.warn("No captions element to render to");return}if(!T.nullOrUndefined(e)&&!Array.isArray(e)){this.debug.warn("updateCues: Invalid input",e);return}let t=e;if(!t){const n=g.getCurrentTrack.call(this);t=Array.from((n||{}).activeCues||[]).map(e=>e.getCueAsHTML()).map(Ke)}const r=t.map(e=>e.trim()).join("\n");const i=r!==this.elements.captions.innerHTML;if(i){s(this.elements.captions);const a=k("span",A(this.config.selectors.caption));a.innerHTML=r;this.elements.captions.appendChild(a);w.call(this,this.media,"cuechange")}}};const P=g;const tt={enabled:true,title:"",debug:false,autoplay:false,autopause:true,playsinline:true,seekTime:10,volume:1,muted:false,duration:null,displayDuration:true,invertTime:true,toggleInvert:true,ratio:null,clickToPlay:true,hideControls:true,resetOnEnd:false,disableContextMenu:true,loadSprite:true,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.8/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:false,onChange:null},loop:{active:false},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,2.5,3,4]},keyboard:{focused:true,global:false},tooltips:{controls:false,seek:true},captions:{active:false,language:"auto",update:false},fullscreen:{enabled:true,fallback:true,iosNative:false},storage:{enabled:true,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:false,publisherId:"",tagUrl:""},previewThumbnails:{enabled:false,src:""},vimeo:{byline:false,portrait:false,title:false,speed:true,transparent:false,customControls:true,referrerPolicy:null,premium:false},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:true,noCookie:false},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:false,points:[]}};const rt=tt;const it={active:"picture-in-picture",inactive:"inline"};const nt={pip:it};const y={html5:"html5",youtube:"youtube",vimeo:"vimeo"};const at={audio:"audio",video:"video"};function st(e){if(/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(e)){return y.youtube}if(/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(e)){return y.vimeo}return null}const ot={providers:y,types:at};const lt=()=>{};class ut{constructor(e=false){this.enabled=window.console&&e;if(this.enabled){this.log("Debugging enabled")}}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):lt}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):lt}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):lt}}class n{constructor(e){this.player=e;this.prefix=n.prefix;this.property=n.property;this.scrollPosition={x:0,y:0};this.forceFallback=e.config.fullscreen.fallback==="force";this.player.elements.fullscreen=e.config.fullscreen.container&&pe(this.player.elements.container,e.config.fullscreen.container);D.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()});D.call(this,this.player.elements.container,"keydown",e=>this.trapFocus(e));this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return n.nativeSupported&&!this.forceFallback}static get prefix(){if(T["function"](document.exitFullscreen))return"";let t="";const e=["webkit","moz","ms"];e.some(e=>{if(T["function"](document[`${e}ExitFullscreen`])||T["function"](document[`${e}CancelFullScreen`])){t=e;return true}return false});return t}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,n.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||n.nativeSupported||!E.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return false;if(!n.nativeSupported||this.forceFallback){return ge(this.target,this.player.config.classNames.fullscreen.fallback)}const e=!this.prefix?this.target.getRootNode().fullscreenElement:this.target.getRootNode()[`${this.prefix}${this.property}Element`];return e&&e.shadowRoot?e===this.target.getRootNode().host:e===this.target}get target(){return E.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}onChange=()=>{if(!this.supported)return;const e=this.player.elements.buttons.fullscreen;if(T.element(e)){e.pressed=this.active}const t=this.target===this.player.media?this.target:this.player.elements.container;w.call(this.player,t,this.active?"enterfullscreen":"exitfullscreen",true)};toggleFallback=(t=false)=>{if(t){this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}}else{window.scrollTo(this.scrollPosition.x,this.scrollPosition.y)}document.body.style.overflow=t?"hidden":"";f(this.target,this.player.config.classNames.fullscreen.fallback,t);if(E.isIos){let e=document.head.querySelector('meta[name="viewport"]');const r="viewport-fit=cover";if(!e){e=document.createElement("meta");e.setAttribute("name","viewport")}const i=T.string(e.content)&&e.content.includes(r);if(t){this.cleanupViewport=!i;if(!i)e.content+=`,${r}`}else if(this.cleanupViewport){e.content=e.content.split(",").filter(e=>e.trim()!==r).join(",")}}this.onChange()};trapFocus=e=>{if(E.isIos||E.isIPadOS||!this.active||e.key!=="Tab")return;const t=document.activeElement;const r=h.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]");const[i]=r;const n=r[r.length-1];if(t===n&&!e.shiftKey){i.focus();e.preventDefault()}else if(t===i&&e.shiftKey){n.focus();e.preventDefault()}};update=()=>{if(this.supported){let e;if(this.forceFallback)e="Fallback (forced)";else if(n.nativeSupported)e="Native";else e="Fallback";this.player.debug.log(`${e} fullscreen enabled`)}else{this.player.debug.log("Fullscreen not supported and fallback disabled")}f(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)};enter=()=>{if(!this.supported)return;if(E.isIos&&this.player.config.fullscreen.iosNative){if(this.player.isVimeo){this.player.embed.requestFullscreen()}else{this.target.webkitEnterFullscreen()}}else if(!n.nativeSupported||this.forceFallback){this.toggleFallback(true)}else if(!this.prefix){this.target.requestFullscreen({navigationUI:"hide"})}else if(!T.empty(this.prefix)){this.target[`${this.prefix}Request${this.property}`]()}};exit=()=>{if(!this.supported)return;if(E.isIos&&this.player.config.fullscreen.iosNative){if(this.player.isVimeo){this.player.embed.exitFullscreen()}else{this.target.webkitEnterFullscreen()}m(this.player.play())}else if(!n.nativeSupported||this.forceFallback){this.toggleFallback(false)}else if(!this.prefix){(document.cancelFullScreen||document.exitFullscreen).call(document)}else if(!T.empty(this.prefix)){const e=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${e}${this.property}`]()}};toggle=()=>{if(!this.active)this.enter();else this.exit()}}const ct=n;function dt(n,a=1){return new Promise((e,t)=>{const r=new Image;const i=()=>{delete r.onload;delete r.onerror;(r.naturalWidth>=a?e:t)(r)};Object.assign(r,{onload:i,onerror:i,src:n})})}const a={addStyleHook(){f(this.elements.container,this.config.selectors.container.replace(".",""),true);f(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(e=false){if(e&&this.isHTML5){this.media.setAttribute("controls","")}else{this.media.removeAttribute("controls")}},build(){this.listeners.media();if(!this.supported.ui){this.debug.warn(`Basic support only for ${this.provider} ${this.type}`);a.toggleNativeControls.call(this,true);return}if(!T.element(this.elements.controls)){O.inject.call(this);this.listeners.controls()}a.toggleNativeControls.call(this);if(this.isHTML5){P.setup.call(this)}this.volume=null;this.muted=null;this.loop=null;this.quality=null;this.speed=null;O.updateVolume.call(this);O.timeUpdate.call(this);O.durationUpdate.call(this);a.checkPlaying.call(this);f(this.elements.container,this.config.classNames.pip.supported,L.pip&&this.isHTML5&&this.isVideo);f(this.elements.container,this.config.classNames.airplay.supported,L.airplay&&this.isHTML5);f(this.elements.container,this.config.classNames.isTouch,this.touch);this.ready=true;setTimeout(()=>{w.call(this,this.media,"ready")},0);a.setTitle.call(this);if(this.poster){a.setPoster.call(this,this.poster,false).catch(()=>{})}if(this.config.duration){O.durationUpdate.call(this)}if(this.config.mediaMetadata){O.setMediaMetadata.call(this)}},setTitle(){let t=R.get("play",this.config);if(T.string(this.config.title)&&!T.empty(this.config.title)){t+=`, ${this.config.title}`}Array.from(this.elements.buttons.play||[]).forEach(e=>{e.setAttribute("aria-label",t)});if(this.isEmbed){const r=u.call(this,"iframe");if(!T.element(r)){return}const i=!T.empty(this.config.title)?this.config.title:"video";const e=R.get("frameTitle",this.config);r.setAttribute("title",e.replace("{title}",i))}},togglePoster(e){f(this.elements.container,this.config.classNames.posterEnabled,e)},setPoster(t,e=true){if(e&&this.poster){return Promise.reject(new Error("Poster already set"))}this.media.setAttribute("data-poster",t);this.elements.poster.removeAttribute("hidden");return Ae.call(this).then(()=>dt(t)).catch(e=>{if(t===this.poster){a.togglePoster.call(this,false)}throw e}).then(()=>{if(t!==this.poster){throw new Error("setPoster cancelled by later call to setPoster")}}).then(()=>{Object.assign(this.elements.poster.style,{backgroundImage:`url('${t}')`,backgroundSize:""});a.togglePoster.call(this,true);return t})},checkPlaying(e){f(this.elements.container,this.config.classNames.playing,this.playing);f(this.elements.container,this.config.classNames.paused,this.paused);f(this.elements.container,this.config.classNames.stopped,this.stopped);Array.from(this.elements.buttons.play||[]).forEach(e=>{Object.assign(e,{pressed:this.playing});e.setAttribute("aria-label",R.get(this.playing?"pause":"play",this.config))});if(T.event(e)&&e.type==="timeupdate"){return}a.toggleControls.call(this)},checkLoading(e){this.loading=["stalled","waiting"].includes(e.type);clearTimeout(this.timers.loading);this.timers.loading=setTimeout(()=>{f(this.elements.container,this.config.classNames.loading,this.loading);a.toggleControls.call(this)},this.loading?250:0)},toggleControls(e){const{controls:t}=this.elements;if(t&&this.config.hideControls){const r=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(Boolean(e||this.loading||this.paused||t.pressed||t.hover||r))}},migrateStyles(){Object.values({...this.media.style}).filter(e=>!T.empty(e)&&T.string(e)&&e.startsWith("--plyr")).forEach(e=>{this.elements.container.style.setProperty(e,this.media.style.getPropertyValue(e));this.media.style.removeProperty(e)});if(T.empty(this.media.style)){this.media.removeAttribute("style")}}};const x=a;class ft{constructor(e){this.player=e;this.lastKey=null;this.focusTimer=null;this.lastKeyDown=null;this.handleKey=this.handleKey.bind(this);this.toggleMenu=this.toggleMenu.bind(this);this.firstTouch=this.firstTouch.bind(this)}handleKey(e){const{player:t}=this;const{elements:r}=t;const{key:i,type:n,altKey:a,ctrlKey:s,metaKey:o,shiftKey:l}=e;const u=n==="keydown";const c=u&&i===this.lastKey;if(a||s||o||l){return}if(!i){return}const d=e=>{t.currentTime=t.duration/10*e};if(u){const f=document.activeElement;if(T.element(f)){const{editable:v}=t.config.selectors;const{seek:g}=r.inputs;if(f!==g&&p(f,v)){return}if(e.key===" "&&p(f,'button, [role^="menuitem"]')){return}}const h=[" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"];if(h.includes(i)){e.preventDefault();e.stopPropagation()}switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(!c){d(parseInt(i,10))}break;case" ":case"k":if(!c){m(t.togglePlay())}break;case"ArrowUp":t.increaseVolume(.1);break;case"ArrowDown":t.decreaseVolume(.1);break;case"m":if(!c){t.muted=!t.muted}break;case"ArrowRight":t.forward();break;case"ArrowLeft":t.rewind();break;case"f":t.fullscreen.toggle();break;case"c":if(!c){t.toggleCaptions()}break;case"l":t.loop=!t.loop;break;default:break}if(i==="Escape"&&!t.fullscreen.usingNative&&t.fullscreen.active){t.fullscreen.toggle()}this.lastKey=i}else{this.lastKey=null}}toggleMenu(e){O.toggleMenu.call(this.player,e)}firstTouch=()=>{const{player:e}=this;const{elements:t}=e;e.touch=true;f(t.container,e.config.classNames.isTouch,true)};global=(e=true)=>{const{player:t}=this;if(t.config.keyboard.global){c.call(t,window,"keydown keyup",this.handleKey,e,false)}c.call(t,document.body,"click",this.toggleMenu,e);Se.call(t,document.body,"touchstart",this.firstTouch)};container=()=>{const{player:l}=this;const{config:e,elements:u,timers:n}=l;if(!e.keyboard.global&&e.keyboard.focused){D.call(l,u.container,"keydown keyup",this.handleKey,false)}D.call(l,u.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",e=>{const{controls:t}=u;if(t&&e.type==="enterfullscreen"){t.pressed=false;t.hover=false}const r=["touchstart","touchmove","mousemove"].includes(e.type);let i=0;if(r){x.toggleControls.call(l,true);i=l.touch?3e3:2e3}clearTimeout(n.controls);n.controls=setTimeout(()=>x.toggleControls.call(l,false),i)});const i=()=>{if(!l.isVimeo||l.config.vimeo.premium){return}const e=u.wrapper;const{active:t}=l.fullscreen;const[r,i]=Oe.call(l);const n=Ce(`aspect-ratio: ${r} / ${i}`);if(!t){if(n){e.style.width=null;e.style.height=null}else{e.style.maxWidth=null;e.style.margin=null}return}const[a,s]=xe();const o=a/s>r/i;if(n){e.style.width=o?"auto":"100%";e.style.height=o?"100%":"auto"}else{e.style.maxWidth=o?`${s/i*r}px`:null;e.style.margin=o?"0 auto":null}};const a=()=>{clearTimeout(n.resized);n.resized=setTimeout(i,50)};D.call(l,u.container,"enterfullscreen exitfullscreen",e=>{const{target:t}=l.fullscreen;if(t!==u.container){return}if(!l.isEmbed&&T.empty(l.config.ratio)){return}i();const r=e.type==="enterfullscreen"?D:Ee;r.call(l,window,"resize",a)})};media=()=>{const{player:n}=this;const{elements:a}=n;D.call(n,n.media,"timeupdate seeking seeked",e=>O.timeUpdate.call(n,e));D.call(n,n.media,"durationchange loadeddata loadedmetadata",e=>O.durationUpdate.call(n,e));D.call(n,n.media,"ended",()=>{if(n.isHTML5&&n.isVideo&&n.config.resetOnEnd){n.restart();n.pause()}});D.call(n,n.media,"progress playing seeking seeked",e=>O.updateProgress.call(n,e));D.call(n,n.media,"volumechange",e=>O.updateVolume.call(n,e));D.call(n,n.media,"playing play pause ended emptied timeupdate",e=>x.checkPlaying.call(n,e));D.call(n,n.media,"waiting canplay seeked playing",e=>x.checkLoading.call(n,e));let s=null;let o=0;if(n.supported.ui&&n.config.clickToPlay&&!n.isAudio){const l=u.call(n,`.${n.config.classNames.video}`);if(!T.element(l)){return}D.call(n,a.container,"click",e=>{const t=[a.container,l];if(!t.includes(e.target)&&!l.contains(e.target)){return}++o;if(o===1){s=setTimeout(()=>{if(n.touch&&n.config.hideControls){return}if(n.ended){this.proxy(e,n.restart,"restart");this.proxy(e,()=>{m(n.play())},"play")}else{this.proxy(e,()=>{m(n.togglePlay())},"play")}o=0},300);return}if(s){clearTimeout(s);s=null}const{offsetX:r,target:{offsetWidth:i}}=e;if(r>i/2){n.forward()}else{n.rewind()}o=0})}if(n.supported.ui&&n.config.disableContextMenu){D.call(n,a.wrapper,"contextmenu",e=>{e.preventDefault()},false)}D.call(n,n.media,"volumechange",()=>{n.storage.set({volume:n.volume,muted:n.muted})});D.call(n,n.media,"ratechange",()=>{O.updateSetting.call(n,"speed");n.storage.set({speed:n.speed})});D.call(n,n.media,"qualitychange",e=>{O.updateSetting.call(n,"quality",null,e.detail.quality)});D.call(n,n.media,"ready qualitychange",()=>{O.setDownloadUrl.call(n)});const e=n.config.events.concat(["keyup","keydown"]).join(" ");D.call(n,n.media,e,e=>{let{detail:t={}}=e;if(e.type==="error"){t=n.media.error}w.call(n,a.container,e.type,true,t)})};proxy=(e,t,r)=>{const{player:i}=this;const n=i.config.listeners[r];const a=T["function"](n);let s=true;if(a){s=n.call(i,e)}if(s!==false&&T["function"](t)){t.call(i,e)}};bind=(e,t,r,i,n=true)=>{const{player:a}=this;const s=a.config.listeners[i];const o=T["function"](s);D.call(a,e,t,e=>this.proxy(e,r,i),n&&!o)};controls=()=>{const{player:s}=this;const{elements:i}=s;const t=E.isIE?"change":"input";if(i.buttons.play){Array.from(i.buttons.play).forEach(e=>{this.bind(e,"click",()=>{m(s.togglePlay())},"play")})}this.bind(i.buttons.restart,"click",s.restart,"restart");this.bind(i.buttons.rewind,"click",()=>{s.lastSeekTime=Date.now();s.rewind()},"rewind");this.bind(i.buttons.fastForward,"click",()=>{s.lastSeekTime=Date.now();s.forward()},"fastForward");this.bind(i.buttons.mute,"click",()=>{s.muted=!s.muted},"mute");this.bind(i.buttons.captions,"click",()=>s.toggleCaptions());this.bind(i.buttons.download,"click",()=>{w.call(s,s.media,"download")},"download");this.bind(i.buttons.fullscreen,"click",()=>{s.fullscreen.toggle()},"fullscreen");this.bind(i.buttons.pip,"click",()=>{s.pip="toggle"},"pip");this.bind(i.buttons.airplay,"click",s.airplay,"airplay");this.bind(i.buttons.settings,"click",e=>{e.stopPropagation();e.preventDefault();O.toggleMenu.call(s,e)},null,false);this.bind(i.buttons.settings,"keyup",e=>{if(![" ","Enter"].includes(e.key)){return}if(e.key==="Enter"){O.focusFirstMenuItem.call(s,null,true);return}e.preventDefault();e.stopPropagation();O.toggleMenu.call(s,e)},null,false);this.bind(i.settings.menu,"keydown",e=>{if(e.key==="Escape"){O.toggleMenu.call(s,e)}});this.bind(i.inputs.seek,"mousedown mousemove",e=>{const t=i.progress.getBoundingClientRect();const r=100/t.width*(e.pageX-t.left);e.currentTarget.setAttribute("seek-value",r)});this.bind(i.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",e=>{const t=e.currentTarget;const r="play-on-seeked";if(T.keyboardEvent(e)&&!["ArrowLeft","ArrowRight"].includes(e.key)){return}s.lastSeekTime=Date.now();const i=t.hasAttribute(r);const n=["mouseup","touchend","keyup"].includes(e.type);if(i&&n){t.removeAttribute(r);m(s.play())}else if(!n&&s.playing){t.setAttribute(r,"");s.pause()}});if(E.isIos){const e=h.call(s,'input[type="range"]');Array.from(e).forEach(e=>this.bind(e,t,e=>re(e.target)))}this.bind(i.inputs.seek,t,e=>{const t=e.currentTarget;let r=t.getAttribute("seek-value");if(T.empty(r)){r=t.value}t.removeAttribute("seek-value");s.currentTime=r/t.max*s.duration},"seek");this.bind(i.progress,"mouseenter mouseleave mousemove",e=>O.updateSeekTooltip.call(s,e));this.bind(i.progress,"mousemove touchmove",e=>{const{previewThumbnails:t}=s;if(t&&t.loaded){t.startMove(e)}});this.bind(i.progress,"mouseleave touchend click",()=>{const{previewThumbnails:e}=s;if(e&&e.loaded){e.endMove(false,true)}});this.bind(i.progress,"mousedown touchstart",e=>{const{previewThumbnails:t}=s;if(t&&t.loaded){t.startScrubbing(e)}});this.bind(i.progress,"mouseup touchend",e=>{const{previewThumbnails:t}=s;if(t&&t.loaded){t.endScrubbing(e)}});if(E.isWebKit){Array.from(h.call(s,'input[type="range"]')).forEach(e=>{this.bind(e,"input",e=>O.updateRangeFill.call(s,e.target))})}if(s.config.toggleInvert&&!T.element(i.display.duration)){this.bind(i.display.currentTime,"click",()=>{if(s.currentTime===0){return}s.config.invertTime=!s.config.invertTime;O.timeUpdate.call(s)})}this.bind(i.inputs.volume,t,e=>{s.volume=e.target.value},"volume");this.bind(i.controls,"mouseenter mouseleave",e=>{i.controls.hover=!s.touch&&e.type==="mouseenter"});if(i.fullscreen){Array.from(i.fullscreen.children).filter(e=>!e.contains(i.container)).forEach(e=>{this.bind(e,"mouseenter mouseleave",e=>{if(i.controls){i.controls.hover=!s.touch&&e.type==="mouseenter"}})})}this.bind(i.controls,"mousedown mouseup touchstart touchend touchcancel",e=>{i.controls.pressed=["mousedown","touchstart"].includes(e.type)});this.bind(i.controls,"focusin",()=>{const{config:e,timers:t}=s;f(i.controls,e.classNames.noTransition,true);x.toggleControls.call(s,true);setTimeout(()=>{f(i.controls,e.classNames.noTransition,false)},0);const r=this.touch?3e3:4e3;clearTimeout(t.controls);t.controls=setTimeout(()=>x.toggleControls.call(s,false),r)});this.bind(i.inputs.volume,"wheel",e=>{const t=e.webkitDirectionInvertedFromDevice;const[r,i]=[e.deltaX,-e.deltaY].map(e=>t?-e:e);const n=Math.sign(Math.abs(r)>Math.abs(i)?r:i);s.increaseVolume(n/50);const{volume:a}=s.media;if(n===1&&a<1||n===-1&&a>0){e.preventDefault()}},"volume",false)}}const ht=ft;var vt=Ht(228);var gt=Ht.n(vt);function pt(r){return new Promise((e,t)=>{gt()(r,{success:e,error:t})})}function mt(e){if(T.empty(e)){return null}if(T.number(Number(e))){return e}const t=/^.*(vimeo.com\/|video\/)(\d+).*/;return e.match(t)?RegExp.$2:e}function yt(e){const t=/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/;const r=e.match(t);return r&&r.length===5?r[4]:null}function M(e){if(e&&!this.embed.hasPlayed){this.embed.hasPlayed=true}if(this.media.paused===e){this.media.paused=!e;w.call(this,this.media,e?"play":"pause")}}const bt={setup(){const t=this;f(t.elements.wrapper,t.config.classNames.embed,true);t.options.speed=t.config.speed.options;C.call(t);if(!T.object(window.Vimeo)){pt(t.config.urls.vimeo.sdk).then(()=>{bt.ready.call(t)}).catch(e=>{t.debug.warn("Vimeo SDK (player.js) failed to load",e)})}else{bt.ready.call(t)}},ready(){const s=this;const e=s.config.vimeo;const{premium:t,referrerPolicy:r,...i}=e;let n=s.media.getAttribute("src");let a="";if(T.empty(n)){n=s.media.getAttribute(s.config.attributes.embed.id);a=s.media.getAttribute(s.config.attributes.embed.hash)}else{a=yt(n)}const o=a?{h:a}:{};if(t){Object.assign(i,{controls:false,sidedock:false})}const l=et({loop:s.config.loop.active,autoplay:s.autoplay,muted:s.muted,gesture:"media",playsinline:s.config.playsinline,...o,...i});const u=mt(n);const c=k("iframe");const d=Ne(s.config.urls.vimeo.iframe,u,l);c.setAttribute("src",d);c.setAttribute("allowfullscreen","");c.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; "));if(!T.empty(r)){c.setAttribute("referrerPolicy",r)}if(t||!e.customControls){c.setAttribute("data-poster",s.poster);s.media=b(c,s.media)}else{const y=k("div",{class:s.config.classNames.embedContainer,"data-poster":s.poster});y.appendChild(c);s.media=b(y,s.media)}if(!e.customControls){I(Ne(s.config.urls.vimeo.api,d)).then(e=>{if(T.empty(e)||!e.thumbnail_url){return}x.setPoster.call(s,e.thumbnail_url).catch(()=>{})})}s.embed=new window.Vimeo.Player(c,{autopause:s.config.autopause,muted:s.muted});s.media.paused=true;s.media.currentTime=0;if(s.supported.ui){s.embed.disableTextTrack()}s.media.play=()=>{M.call(s,true);return s.embed.play()};s.media.pause=()=>{M.call(s,false);return s.embed.pause()};s.media.stop=()=>{s.pause();s.currentTime=0};let{currentTime:f}=s.media;Object.defineProperty(s.media,"currentTime",{get(){return f},set(e){const{embed:t,media:r,paused:i,volume:n}=s;const a=i&&!t.hasPlayed;r.seeking=true;w.call(s,r,"seeking");Promise.resolve(a&&t.setVolume(0)).then(()=>t.setCurrentTime(e)).then(()=>a&&t.pause()).then(()=>a&&t.setVolume(n)).catch(()=>{})}});let h=s.config.speed.selected;Object.defineProperty(s.media,"playbackRate",{get(){return h},set(e){s.embed.setPlaybackRate(e).then(()=>{h=e;w.call(s,s.media,"ratechange")}).catch(()=>{s.options.speed=[1]})}});let{volume:v}=s.config;Object.defineProperty(s.media,"volume",{get(){return v},set(e){s.embed.setVolume(e).then(()=>{v=e;w.call(s,s.media,"volumechange")})}});let{muted:g}=s.config;Object.defineProperty(s.media,"muted",{get(){return g},set(e){const t=T.boolean(e)?e:false;s.embed.setMuted(t?true:s.config.muted).then(()=>{g=t;w.call(s,s.media,"volumechange")})}});let{loop:p}=s.config;Object.defineProperty(s.media,"loop",{get(){return p},set(e){const t=T.boolean(e)?e:s.config.loop.active;s.embed.setLoop(t).then(()=>{p=t})}});let m;s.embed.getVideoUrl().then(e=>{m=e;O.setDownloadUrl.call(s)}).catch(e=>{this.debug.warn(e)});Object.defineProperty(s.media,"currentSrc",{get(){return m}});Object.defineProperty(s.media,"ended",{get(){return s.currentTime===s.duration}});Promise.all([s.embed.getVideoWidth(),s.embed.getVideoHeight()]).then(e=>{const[t,r]=e;s.embed.ratio=Pe(t,r);C.call(this)});s.embed.setAutopause(s.config.autopause).then(e=>{s.config.autopause=e});s.embed.getVideoTitle().then(e=>{s.config.title=e;x.setTitle.call(this)});s.embed.getCurrentTime().then(e=>{f=e;w.call(s,s.media,"timeupdate")});s.embed.getDuration().then(e=>{s.media.duration=e;w.call(s,s.media,"durationchange")});s.embed.getTextTracks().then(e=>{s.media.textTracks=e;P.setup.call(s)});s.embed.on("cuechange",({cues:e=[]})=>{const t=e.map(e=>He(e.text));P.updateCues.call(s,t)});s.embed.on("loaded",()=>{s.embed.getPaused().then(e=>{M.call(s,!e);if(!e){w.call(s,s.media,"playing")}});if(T.element(s.embed.element)&&s.supported.ui){const e=s.embed.element;e.setAttribute("tabindex",-1)}});s.embed.on("bufferstart",()=>{w.call(s,s.media,"waiting")});s.embed.on("bufferend",()=>{w.call(s,s.media,"playing")});s.embed.on("play",()=>{M.call(s,true);w.call(s,s.media,"playing")});s.embed.on("pause",()=>{M.call(s,false)});s.embed.on("timeupdate",e=>{s.media.seeking=false;f=e.seconds;w.call(s,s.media,"timeupdate")});s.embed.on("progress",e=>{s.media.buffered=e.percent;w.call(s,s.media,"progress");if(parseInt(e.percent,10)===1){w.call(s,s.media,"canplaythrough")}s.embed.getDuration().then(e=>{if(e!==s.media.duration){s.media.duration=e;w.call(s,s.media,"durationchange")}})});s.embed.on("seeked",()=>{s.media.seeking=false;w.call(s,s.media,"seeked")});s.embed.on("ended",()=>{s.media.paused=true;w.call(s,s.media,"ended")});s.embed.on("error",e=>{s.media.error=e;w.call(s,s.media,"error")});if(e.customControls){setTimeout(()=>x.build.call(s),0)}}};const Tt=bt;function Et(e){if(T.empty(e)){return null}const t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;return e.match(t)?RegExp.$2:e}function F(e){if(e&&!this.embed.hasPlayed){this.embed.hasPlayed=true}if(this.media.paused===e){this.media.paused=!e;w.call(this,this.media,e?"play":"pause")}}function St(e){if(e.noCookie){return"https://www.youtube-nocookie.com"}if(window.location.protocol==="http:"){return"http://www.youtube.com"}return undefined}const kt={setup(){f(this.elements.wrapper,this.config.classNames.embed,true);if(T.object(window.YT)&&T["function"](window.YT.Player)){kt.ready.call(this)}else{const e=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{if(T["function"](e)){e()}kt.ready.call(this)};pt(this.config.urls.youtube.sdk).catch(e=>{this.debug.warn("YouTube API failed to load",e)})}},getTitle(e){const t=Ne(this.config.urls.youtube.api,e);I(t).then(e=>{if(T.object(e)){const{title:t,height:r,width:i}=e;this.config.title=t;x.setTitle.call(this);this.embed.ratio=Pe(i,r)}C.call(this)}).catch(()=>{C.call(this)})},ready(){const a=this;const s=a.config.youtube;const e=a.media&&a.media.getAttribute("id");if(!T.empty(e)&&e.startsWith("youtube-")){return}let t=a.media.getAttribute("src");if(T.empty(t)){t=a.media.getAttribute(this.config.attributes.embed.id)}const o=Et(t);const r=Fe(a.provider);const i=k("div",{id:r,"data-poster":s.customControls?a.poster:undefined});a.media=b(i,a.media);if(s.customControls){const n=e=>`https://i.ytimg.com/vi/${o}/${e}default.jpg`;dt(n("maxres"),121).catch(()=>dt(n("sd"),121)).catch(()=>dt(n("hq"))).then(e=>x.setPoster.call(a,e.src)).then(e=>{if(!e.includes("maxres")){a.elements.poster.style.backgroundSize="cover"}}).catch(()=>{})}a.embed=new window.YT.Player(a.media,{videoId:o,host:St(s),playerVars:S({},{autoplay:a.config.autoplay?1:0,hl:a.config.hl,controls:a.supported.ui&&s.customControls?0:1,disablekb:1,playsinline:a.config.playsinline&&!a.config.fullscreen.iosNative?1:0,cc_load_policy:a.captions.active?1:0,cc_lang_pref:a.config.captions.language,widget_referrer:window?window.location.href:null},s),events:{onError(e){if(!a.media.error){const t=e.data;const r={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[t]||"An unknown error occurred";a.media.error={code:t,message:r};w.call(a,a.media,"error")}},onPlaybackRateChange(e){const t=e.target;a.media.playbackRate=t.getPlaybackRate();w.call(a,a.media,"ratechange")},onReady(e){if(T["function"](a.media.play)){return}const r=e.target;kt.getTitle.call(a,o);a.media.play=()=>{F.call(a,true);r.playVideo()};a.media.pause=()=>{F.call(a,false);r.pauseVideo()};a.media.stop=()=>{r.stopVideo()};a.media.duration=r.getDuration();a.media.paused=true;a.media.currentTime=0;Object.defineProperty(a.media,"currentTime",{get(){return Number(r.getCurrentTime())},set(e){if(a.paused&&!a.embed.hasPlayed){a.embed.mute()}a.media.seeking=true;w.call(a,a.media,"seeking");r.seekTo(e)}});Object.defineProperty(a.media,"playbackRate",{get(){return r.getPlaybackRate()},set(e){r.setPlaybackRate(e)}});let{volume:i}=a.config;Object.defineProperty(a.media,"volume",{get(){return i},set(e){i=e;r.setVolume(i*100);w.call(a,a.media,"volumechange")}});let{muted:n}=a.config;Object.defineProperty(a.media,"muted",{get(){return n},set(e){const t=T.boolean(e)?e:n;n=t;r[t?"mute":"unMute"]();r.setVolume(i*100);w.call(a,a.media,"volumechange")}});Object.defineProperty(a.media,"currentSrc",{get(){return r.getVideoUrl()}});Object.defineProperty(a.media,"ended",{get(){return a.currentTime===a.duration}});const t=r.getAvailablePlaybackRates();a.options.speed=t.filter(e=>a.config.speed.options.includes(e));if(a.supported.ui&&s.customControls){a.media.setAttribute("tabindex",-1)}w.call(a,a.media,"timeupdate");w.call(a,a.media,"durationchange");clearInterval(a.timers.buffering);a.timers.buffering=setInterval(()=>{a.media.buffered=r.getVideoLoadedFraction();if(a.media.lastBuffered===null||a.media.lastBuffered<a.media.buffered){w.call(a,a.media,"progress")}a.media.lastBuffered=a.media.buffered;if(a.media.buffered===1){clearInterval(a.timers.buffering);w.call(a,a.media,"canplaythrough")}},200);if(s.customControls){setTimeout(()=>x.build.call(a),50)}},onStateChange(e){const t=e.target;clearInterval(a.timers.playing);const r=a.media.seeking&&[1,2].includes(e.data);if(r){a.media.seeking=false;w.call(a,a.media,"seeked")}switch(e.data){case-1:w.call(a,a.media,"timeupdate");a.media.buffered=t.getVideoLoadedFraction();w.call(a,a.media,"progress");break;case 0:F.call(a,false);if(a.media.loop){t.stopVideo();t.playVideo()}else{w.call(a,a.media,"ended")}break;case 1:if(s.customControls&&!a.config.autoplay&&a.media.paused&&!a.embed.hasPlayed){a.media.pause()}else{F.call(a,true);w.call(a,a.media,"playing");a.timers.playing=setInterval(()=>{w.call(a,a.media,"timeupdate")},50);if(a.media.duration!==t.getDuration()){a.media.duration=t.getDuration();w.call(a,a.media,"durationchange")}}break;case 2:if(!a.muted){a.embed.unMute()}F.call(a,false);break;case 3:w.call(a,a.media,"waiting");break;default:break}w.call(a,a.elements.container,"statechange",false,{code:e.data})}}})}};const At=kt;const Lt={setup(){if(!this.media){this.debug.warn("No media element found!");return}f(this.elements.container,this.config.classNames.type.replace("{0}",this.type),true);f(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),true);if(this.isEmbed){f(this.elements.container,this.config.classNames.type.replace("{0}","video"),true)}if(this.isVideo){this.elements.wrapper=k("div",{class:this.config.classNames.video});de(this.media,this.elements.wrapper);this.elements.poster=k("div",{class:this.config.classNames.poster});this.elements.wrapper.appendChild(this.elements.poster)}if(this.isHTML5){Me.setup.call(this)}else if(this.isYouTube){At.setup.call(this)}else if(this.isVimeo){Tt.setup.call(this)}}};const Dt=Lt;const wt=e=>{if(e.manager){e.manager.destroy()}if(e.elements.displayContainer){e.elements.displayContainer.destroy()}e.elements.container.remove()};class Ct{constructor(e){this.player=e;this.config=e.config.ads;this.playing=false;this.initialized=false;this.elements={container:null,displayContainer:null};this.manager=null;this.loader=null;this.cuePoints=null;this.events={};this.safetyTimer=null;this.countdownTimer=null;this.managerPromise=new Promise((e,t)=>{this.on("loaded",e);this.on("error",t)});this.load()}get enabled(){const{config:e}=this;return this.player.isHTML5&&this.player.isVideo&&e.enabled&&(!T.empty(e.publisherId)||T.url(e.tagUrl))}load=()=>{if(!this.enabled){return}if(!T.object(window.google)||!T.object(window.google.ima)){pt(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))})}else{this.ready()}};ready=()=>{if(!this.enabled){wt(this)}this.startSafetyTimer(12e3,"ready()");this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")});this.listeners();this.setupIMA()};get tagUrl(){const{config:e}=this;if(T.url(e.tagUrl)){return e.tagUrl}const t={AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:e.publisherId};const r="https://go.aniview.com/api/adserver6/vast/";return`${r}?${et(t)}`}setupIMA=()=>{this.elements.container=k("div",{class:this.player.config.classNames.ads});this.player.elements.container.appendChild(this.elements.container);google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED);google.ima.settings.setLocale(this.player.config.ads.language);google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline);this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media);this.loader=new google.ima.AdsLoader(this.elements.displayContainer);this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,e=>this.onAdsManagerLoaded(e),false);this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,e=>this.onAdError(e),false);this.requestAds()};requestAds=()=>{const{container:e}=this.player.elements;try{const t=new google.ima.AdsRequest;t.adTagUrl=this.tagUrl;t.linearAdSlotWidth=e.offsetWidth;t.linearAdSlotHeight=e.offsetHeight;t.nonLinearAdSlotWidth=e.offsetWidth;t.nonLinearAdSlotHeight=e.offsetHeight;t.forceNonLinearFullSlot=false;t.setAdWillPlayMuted(!this.player.muted);this.loader.requestAds(t)}catch(e){this.onAdError(e)}};pollCountdown=(e=false)=>{if(!e){clearInterval(this.countdownTimer);this.elements.container.removeAttribute("data-badge-text");return}const t=()=>{const e=Je(Math.max(this.manager.getRemainingTime(),0));const t=`${R.get("advertisement",this.player.config)} - ${e}`;this.elements.container.setAttribute("data-badge-text",t)};this.countdownTimer=setInterval(t,100)};onAdsManagerLoaded=e=>{if(!this.enabled){return}const t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=true;t.enablePreloading=true;this.manager=e.getAdsManager(this.player,t);this.cuePoints=this.manager.getCuePoints();this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,e=>this.onAdError(e));Object.keys(google.ima.AdEvent.Type).forEach(e=>{this.manager.addEventListener(google.ima.AdEvent.Type[e],e=>this.onAdEvent(e))});this.trigger("loaded")};addCuePoints=()=>{if(!T.empty(this.cuePoints)){this.cuePoints.forEach(e=>{if(e!==0&&e!==-1&&e<this.player.duration){const t=this.player.elements.progress;if(T.element(t)){const r=100/this.player.duration*e;const i=k("span",{class:this.player.config.classNames.cues});i.style.left=`${r.toString()}%`;t.appendChild(i)}}})}};onAdEvent=e=>{const{container:t}=this.player.elements;const r=e.getAd();const i=e.getAdData();const n=e=>{w.call(this.player,this.player.media,`ads${e.replace(/_/g,"").toLowerCase()}`)};n(e.type);switch(e.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded");this.pollCountdown(true);if(!r.isLinear()){r.width=t.offsetWidth;r.height=t.offsetHeight}break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:if(this.player.ended){this.loadAds()}else{this.loader.contentComplete()}break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown();this.resumeContent();break;case google.ima.AdEvent.Type.LOG:if(i.adError){this.player.debug.warn(`Non-fatal ad error: ${i.adError.getMessage()}`)}break;default:break}};onAdError=e=>{this.cancel();this.player.debug.warn("Ads error",e)};listeners=()=>{const{container:e}=this.player.elements;let i;this.player.on("canplay",()=>{this.addCuePoints()});this.player.on("ended",()=>{this.loader.contentComplete()});this.player.on("timeupdate",()=>{i=this.player.currentTime});this.player.on("seeked",()=>{const r=this.player.currentTime;if(T.empty(this.cuePoints)){return}this.cuePoints.forEach((e,t)=>{if(i<e&&e<r){this.manager.discardAdBreak();this.cuePoints.splice(t,1)}})});window.addEventListener("resize",()=>{if(this.manager){this.manager.resize(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL)}})};play=()=>{const{container:e}=this.player.elements;if(!this.managerPromise){this.resumeContent()}this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume);this.elements.displayContainer.initialize();try{if(!this.initialized){this.manager.init(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL);this.manager.start()}this.initialized=true}catch(e){this.onAdError(e)}}).catch(()=>{})};resumeContent=()=>{this.elements.container.style.zIndex="";this.playing=false;m(this.player.media.play())};pauseContent=()=>{this.elements.container.style.zIndex=3;this.playing=true;this.player.media.pause()};cancel=()=>{if(this.initialized){this.resumeContent()}this.trigger("error");this.loadAds()};loadAds=()=>{this.managerPromise.then(()=>{if(this.manager){this.manager.destroy()}this.managerPromise=new Promise(e=>{this.on("loaded",e);this.player.debug.log(this.manager)});this.initialized=false;this.requestAds()}).catch(()=>{})};trigger=(e,...t)=>{const r=this.events[e];if(T.array(r)){r.forEach(e=>{if(T["function"](e)){e.apply(this,t)}})}};on=(e,t)=>{if(!T.array(this.events[e])){this.events[e]=[]}this.events[e].push(t);return this};startSafetyTimer=(e,t)=>{this.player.debug.log(`Safety timer invoked from: ${t}`);this.safetyTimer=setTimeout(()=>{this.cancel();this.clearSafetyTimer("startSafetyTimer()")},e)};clearSafetyTimer=e=>{if(!T.nullOrUndefined(this.safetyTimer)){this.player.debug.log(`Safety timer cleared from: ${e}`);clearTimeout(this.safetyTimer);this.safetyTimer=null}}}const Rt=Ct;function It(e=0,t=0,r=255){return Math.min(Math.max(e,t),r)}const _t={clamp:It};const Ot=e=>{const r=[];const t=e.split(/\r\n\r\n|\n\n|\r\r/);t.forEach(e=>{const i={};const t=e.split(/\r\n|\n|\r/);t.forEach(e=>{if(!T.number(i.startTime)){const t=e.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);if(t){i.startTime=Number(t[1]||0)*60*60+Number(t[2])*60+Number(t[3])+Number(`0.${t[4]}`);i.endTime=Number(t[6]||0)*60*60+Number(t[7])*60+Number(t[8])+Number(`0.${t[9]}`)}}else if(!T.empty(e.trim())&&T.empty(i.text)){const r=e.trim().split("#xywh=");[i.text]=r;if(r[1]){[i.x,i.y,i.w,i.h]=r[1].split(",")}}});if(i.text){r.push(i)}});return r};const Pt=(e,t)=>{const r=t.width/t.height;const i={};if(e>r){i.width=t.width;i.height=1/e*t.width}else{i.height=t.height;i.width=e*t.height}return i};class xt{constructor(e){this.player=e;this.thumbnails=[];this.loaded=false;this.lastMouseMoveTime=Date.now();this.mouseDown=false;this.loadedImages=[];this.elements={thumb:{},scrubbing:{}};this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}load=()=>{if(this.player.elements.display.seekTooltip){this.player.elements.display.seekTooltip.hidden=this.enabled}if(!this.enabled)return;this.getThumbnails().then(()=>{if(!this.enabled){return}this.render();this.determineContainerAutoSizing();this.listeners();this.loaded=true})};getThumbnails=()=>{return new Promise(e=>{const{src:t}=this.player.config.previewThumbnails;if(T.empty(t)){throw new Error("Missing previewThumbnails.src config attribute")}const r=()=>{this.thumbnails.sort((e,t)=>e.height-t.height);this.player.debug.log("Preview thumbnails",this.thumbnails);e()};if(T["function"](t)){t(e=>{this.thumbnails=e;r()})}else{const i=T.string(t)?[t]:t;const n=i.map(e=>this.getThumbnail(e));Promise.all(n).then(r)}})};getThumbnail=n=>{return new Promise(i=>{I(n).then(e=>{const t={frames:Ot(e),height:null,urlPrefix:""};if(!t.frames[0].text.startsWith("/")&&!t.frames[0].text.startsWith("http://")&&!t.frames[0].text.startsWith("https://")){t.urlPrefix=n.substring(0,n.lastIndexOf("/")+1)}const r=new Image;r.onload=()=>{t.height=r.naturalHeight;t.width=r.naturalWidth;this.thumbnails.push(t);i()};r.src=t.urlPrefix+t.frames[0].text})})};startMove=e=>{if(!this.loaded)return;if(!T.event(e)||!["touchmove","mousemove"].includes(e.type))return;if(!this.player.media.duration)return;if(e.type==="touchmove"){this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100)}else{const t=this.player.elements.progress.getBoundingClientRect();const r=100/t.width*(e.pageX-t.left);this.seekTime=this.player.media.duration*(r/100);if(this.seekTime<0){this.seekTime=0}if(this.seekTime>this.player.media.duration-1){this.seekTime=this.player.media.duration-1}this.mousePosX=e.pageX;this.elements.thumb.time.innerText=Je(this.seekTime);const i=this.player.config.markers?.points?.find(({time:e})=>e===Math.round(this.seekTime));if(i){this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${i.label}<br>`)}}this.showImageAtCurrentTime()};endMove=()=>{this.toggleThumbContainer(false,true)};startScrubbing=e=>{if(T.nullOrUndefined(e.button)||e.button===false||e.button===0){this.mouseDown=true;if(this.player.media.duration){this.toggleScrubbingContainer(true);this.toggleThumbContainer(false,true);this.showImageAtCurrentTime()}}};endScrubbing=()=>{this.mouseDown=false;if(Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)){this.toggleScrubbingContainer(false)}else{Se.call(this.player,this.player.media,"timeupdate",()=>{if(!this.mouseDown){this.toggleScrubbingContainer(false)}})}};listeners=()=>{this.player.on("play",()=>{this.toggleThumbContainer(false,true)});this.player.on("seeked",()=>{this.toggleThumbContainer(false)});this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})};render=()=>{this.elements.thumb.container=k("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer});this.elements.thumb.imageContainer=k("div",{class:this.player.config.classNames.previewThumbnails.imageContainer});this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const e=k("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=k("span",{},"00:00");e.appendChild(this.elements.thumb.time);this.elements.thumb.imageContainer.appendChild(e);if(T.element(this.player.elements.progress)){this.player.elements.progress.appendChild(this.elements.thumb.container)}this.elements.scrubbing.container=k("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer});this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)};destroy=()=>{if(this.elements.thumb.container){this.elements.thumb.container.remove()}if(this.elements.scrubbing.container){this.elements.scrubbing.container.remove()}};showImageAtCurrentTime=()=>{if(this.mouseDown){this.setScrubbingContainerSize()}else{this.setThumbContainerSizeAndPos()}const r=this.thumbnails[0].frames.findIndex(e=>this.seekTime>=e.startTime&&this.seekTime<=e.endTime);const e=r>=0;let i=0;if(!this.mouseDown){this.toggleThumbContainer(e)}if(!e){return}this.thumbnails.forEach((e,t)=>{if(this.loadedImages.includes(e.frames[r].text)){i=t}});if(r!==this.showingThumb){this.showingThumb=r;this.loadImage(i)}};loadImage=(e=0)=>{const t=this.showingThumb;const r=this.thumbnails[e];const{urlPrefix:i}=r;const n=r.frames[t];const a=r.frames[t].text;const s=i+a;if(!this.currentImageElement||this.currentImageElement.dataset.filename!==a){if(this.loadingImage&&this.usingSprites){this.loadingImage.onload=null}const o=new Image;o.src=s;o.dataset.index=t;o.dataset.filename=a;this.showingThumbFilename=a;this.player.debug.log(`Loading image: ${s}`);o.onload=()=>this.showImage(o,n,e,t,a,true);this.loadingImage=o;this.removeOldImages(o)}else{this.showImage(this.currentImageElement,n,e,t,a,false);this.currentImageElement.dataset.index=t;this.removeOldImages(this.currentImageElement)}};showImage=(e,t,r,i,n,a=true)=>{this.player.debug.log(`Showing thumb: ${n}. num: ${i}. qual: ${r}. newimg: ${a}`);this.setImageSizeAndOffset(e,t);if(a){this.currentImageContainer.appendChild(e);this.currentImageElement=e;if(!this.loadedImages.includes(n)){this.loadedImages.push(n)}}this.preloadNearby(i,true).then(this.preloadNearby(i,false)).then(this.getHigherQuality(r,e,t,n))};removeOldImages=i=>{Array.from(this.currentImageContainer.children).forEach(e=>{if(e.tagName.toLowerCase()!=="img"){return}const t=this.usingSprites?500:1e3;if(e.dataset.index!==i.dataset.index&&!e.dataset.deleting){e.dataset.deleting=true;const{currentImageContainer:r}=this;setTimeout(()=>{r.removeChild(e);this.player.debug.log(`Removing thumb: ${e.dataset.filename}`)},t)}})};preloadNearby=(t,r=true)=>{return new Promise(o=>{setTimeout(()=>{const s=this.thumbnails[0].frames[t].text;if(this.showingThumbFilename===s){let e;if(r){e=this.thumbnails[0].frames.slice(t)}else{e=this.thumbnails[0].frames.slice(0,t).reverse()}let a=false;e.forEach(e=>{const t=e.text;if(t!==s){if(!this.loadedImages.includes(t)){a=true;this.player.debug.log(`Preloading thumb filename: ${t}`);const{urlPrefix:r}=this.thumbnails[0];const i=r+t;const n=new Image;n.src=i;n.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${t}`);if(!this.loadedImages.includes(t))this.loadedImages.push(t);o()}}}});if(!a){o()}}},300)})};getHigherQuality=(t,r,i,n)=>{if(t<this.thumbnails.length-1){let e=r.naturalHeight;if(this.usingSprites){e=i.h}if(e<this.thumbContainerHeight){setTimeout(()=>{if(this.showingThumbFilename===n){this.player.debug.log(`Showing higher quality thumb for: ${n}`);this.loadImage(t+1)}},300)}}};get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){if(this.usingSprites){return this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h}return this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:e}=Pt(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return e}if(this.sizeSpecifiedInCSS){return this.elements.thumb.imageContainer.clientHeight}return Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(e){if(this.mouseDown){this.currentScrubbingImageElement=e}else{this.currentThumbnailImageElement=e}}toggleThumbContainer=(e=false,t=false)=>{const r=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(r,e);if(!e&&t){this.showingThumb=null;this.showingThumbFilename=null}};toggleScrubbingContainer=(e=false)=>{const t=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(t,e);if(!e){this.showingThumb=null;this.showingThumbFilename=null}};determineContainerAutoSizing=()=>{if(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20){this.sizeSpecifiedInCSS=true}};setThumbContainerSizeAndPos=()=>{const{imageContainer:e}=this.elements.thumb;if(!this.sizeSpecifiedInCSS){const t=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);e.style.height=`${this.thumbContainerHeight}px`;e.style.width=`${t}px`}else if(e.clientHeight>20&&e.clientWidth<20){const t=Math.floor(e.clientHeight*this.thumbAspectRatio);e.style.width=`${t}px`}else if(e.clientHeight<20&&e.clientWidth>20){const r=Math.floor(e.clientWidth/this.thumbAspectRatio);e.style.height=`${r}px`}this.setThumbContainerPos()};setThumbContainerPos=()=>{const e=this.player.elements.progress.getBoundingClientRect();const t=this.player.elements.container.getBoundingClientRect();const{container:r}=this.elements.thumb;const i=t.left-e.left+10;const n=t.right-e.left-r.clientWidth-10;const a=this.mousePosX-e.left-r.clientWidth/2;const s=It(a,i,n);r.style.left=`${s}px`;r.style.setProperty("--preview-arrow-offset",`${a-s}px`)};setScrubbingContainerSize=()=>{const{width:e,height:t}=Pt(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${e}px`;this.elements.scrubbing.container.style.height=`${t}px`};setImageSizeAndOffset=(e,t)=>{if(!this.usingSprites)return;const r=this.thumbContainerHeight/t.h;e.style.height=`${e.naturalHeight*r}px`;e.style.width=`${e.naturalWidth*r}px`;e.style.left=`-${t.x*r}px`;e.style.top=`-${t.y*r}px`}}const Mt=xt;const Ft={insertElements(t,e){if(T.string(e)){ve(t,this.media,{src:e})}else if(T.array(e)){e.forEach(e=>{ve(t,this.media,e)})}},change(s){if(!ce(s,"sources.length")){this.debug.warn("Invalid source format");return}Me.cancelRequests.call(this);this.destroy.call(this,()=>{this.options.quality=[];o(this.media);this.media=null;if(T.element(this.elements.container)){this.elements.container.removeAttribute("class")}const{sources:e,type:t}=s;const[{provider:r=y.html5,src:i}]=e;const n=r==="html5"?t:"div";const a=r==="html5"?{}:{src:i};Object.assign(this,{provider:r,type:t,supported:L.check(t,r,this.config.playsinline),media:k(n,a)});this.elements.container.appendChild(this.media);if(T.boolean(s.autoplay)){this.config.autoplay=s.autoplay}if(this.isHTML5){if(this.config.crossorigin){this.media.setAttribute("crossorigin","")}if(this.config.autoplay){this.media.setAttribute("autoplay","")}if(!T.empty(s.poster)){this.poster=s.poster}if(this.config.loop.active){this.media.setAttribute("loop","")}if(this.config.muted){this.media.setAttribute("muted","")}if(this.config.playsinline){this.media.setAttribute("playsinline","")}}x.addStyleHook.call(this);if(this.isHTML5){Ft.insertElements.call(this,"source",e)}this.config.title=s.title;Dt.setup.call(this);if(this.isHTML5){if(Object.keys(s).includes("tracks")){Ft.insertElements.call(this,"track",s.tracks)}}if(this.isHTML5||this.isEmbed&&!this.supported.ui){x.build.call(this)}if(this.isHTML5){this.media.load()}if(!T.empty(s.previewThumbnails)){Object.assign(this.config.previewThumbnails,s.previewThumbnails);if(this.previewThumbnails&&this.previewThumbnails.loaded){this.previewThumbnails.destroy();this.previewThumbnails=null}if(this.config.previewThumbnails.enabled){this.previewThumbnails=new Mt(this)}}this.fullscreen.update()},true)}};const Nt=Ft;class Ut{constructor(e,t){this.timers={};this.ready=false;this.loading=false;this.failed=false;this.touch=L.touch;this.media=e;if(T.string(this.media)){this.media=document.querySelectorAll(this.media)}if(window.jQuery&&this.media instanceof jQuery||T.nodeList(this.media)||T.array(this.media)){this.media=this.media[0]}this.config=S({},rt,Ut.defaults,t||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch(e){return{}}})());this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}};this.captions={active:null,currentTrack:-1,meta:new WeakMap};this.fullscreen={active:false};this.options={speed:[],quality:[]};this.debug=new ut(this.config.debug);this.debug.log("Config",this.config);this.debug.log("Support",L);if(T.nullOrUndefined(this.media)||!T.element(this.media)){this.debug.error("Setup failed: no suitable element passed");return}if(this.media.plyr){this.debug.warn("Target already setup");return}if(!this.config.enabled){this.debug.error("Setup failed: disabled by config");return}if(!L.check().api){this.debug.error("Setup failed: no support");return}const r=this.media.cloneNode(true);r.autoplay=false;this.elements.original=r;const i=this.media.tagName.toLowerCase();let n=null;let a=null;switch(i){case"div":n=this.media.querySelector("iframe");if(T.element(n)){a=Ze(n.getAttribute("src"));this.provider=st(a.toString());this.elements.container=this.media;this.media=n;this.elements.container.className="";if(a.search.length){const s=["1","true"];if(s.includes(a.searchParams.get("autoplay"))){this.config.autoplay=true}if(s.includes(a.searchParams.get("loop"))){this.config.loop.active=true}if(this.isYouTube){this.config.playsinline=s.includes(a.searchParams.get("playsinline"));this.config.youtube.hl=a.searchParams.get("hl")}else{this.config.playsinline=true}}}else{this.provider=this.media.getAttribute(this.config.attributes.embed.provider);this.media.removeAttribute(this.config.attributes.embed.provider)}if(T.empty(this.provider)||!Object.values(y).includes(this.provider)){this.debug.error("Setup failed: Invalid provider");return}this.type=at.video;break;case"video":case"audio":this.type=i;this.provider=y.html5;if(this.media.hasAttribute("crossorigin")){this.config.crossorigin=true}if(this.media.hasAttribute("autoplay")){this.config.autoplay=true}if(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline")){this.config.playsinline=true}if(this.media.hasAttribute("muted")){this.config.muted=true}if(this.media.hasAttribute("loop")){this.config.loop.active=true}break;default:this.debug.error("Setup failed: unsupported type");return}this.supported=L.check(this.type,this.provider);if(!this.supported.api){this.debug.error("Setup failed: no support");return}this.eventListeners=[];this.listeners=new ht(this);this.storage=new Ye(this);this.media.plyr=this;if(!T.element(this.elements.container)){this.elements.container=k("div");de(this.media,this.elements.container)}x.migrateStyles.call(this);x.addStyleHook.call(this);Dt.setup.call(this);if(this.config.debug){D.call(this,this.elements.container,this.config.events.join(" "),e=>{this.debug.log(`event: ${e.type}`)})}this.fullscreen=new ct(this);if(this.isHTML5||this.isEmbed&&!this.supported.ui){x.build.call(this)}this.listeners.container();this.listeners.global();if(this.config.ads.enabled){this.ads=new Rt(this)}if(this.isHTML5&&this.config.autoplay){this.once("canplay",()=>m(this.play()))}this.lastSeekTime=0;if(this.config.previewThumbnails.enabled){this.previewThumbnails=new Mt(this)}}get isHTML5(){return this.provider===y.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===y.youtube}get isVimeo(){return this.provider===y.vimeo}get isVideo(){return this.type===at.video}get isAudio(){return this.type===at.audio}play=()=>{if(!T["function"](this.media.play)){return null}if(this.ads&&this.ads.enabled){this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>m(this.media.play()))}return this.media.play()};pause=()=>{if(!this.playing||!T["function"](this.media.pause)){return null}return this.media.pause()};get playing(){return Boolean(this.ready&&!this.paused&&!this.ended)}get paused(){return Boolean(this.media.paused)}get stopped(){return Boolean(this.paused&&this.currentTime===0)}get ended(){return Boolean(this.media.ended)}togglePlay=e=>{const t=T.boolean(e)?e:!this.playing;if(t){return this.play()}return this.pause()};stop=()=>{if(this.isHTML5){this.pause();this.restart()}else if(T["function"](this.media.stop)){this.media.stop()}};restart=()=>{this.currentTime=0};rewind=e=>{this.currentTime-=T.number(e)?e:this.config.seekTime};forward=e=>{this.currentTime+=T.number(e)?e:this.config.seekTime};set currentTime(e){if(!this.duration){return}const t=T.number(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0;this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:e}=this.media;if(T.number(e)){return e}if(e&&e.length&&this.duration>0){return e.end(0)/this.duration}return 0}get seeking(){return Boolean(this.media.seeking)}get duration(){const e=parseFloat(this.config.duration);const t=(this.media||{}).duration;const r=!T.number(t)||t===Infinity?0:t;return e||r}set volume(e){let t=e;const r=1;const i=0;if(T.string(t)){t=Number(t)}if(!T.number(t)){t=this.storage.get("volume")}if(!T.number(t)){({volume:t}=this.config)}if(t>r){t=r}if(t<i){t=i}this.config.volume=t;this.media.volume=t;if(!T.empty(e)&&this.muted&&t>0){this.muted=false}}get volume(){return Number(this.media.volume)}increaseVolume=e=>{const t=this.media.muted?0:this.volume;this.volume=t+(T.number(e)?e:0)};decreaseVolume=e=>{this.increaseVolume(-e)};set muted(e){let t=e;if(!T.boolean(t)){t=this.storage.get("muted")}if(!T.boolean(t)){t=this.config.muted}this.config.muted=t;this.media.muted=t}get muted(){return Boolean(this.media.muted)}get hasAudio(){if(!this.isHTML5){return true}if(this.isAudio){return true}return Boolean(this.media.mozHasAudio)||Boolean(this.media.webkitAudioDecodedByteCount)||Boolean(this.media.audioTracks&&this.media.audioTracks.length)}set speed(e){let t=null;if(T.number(e)){t=e}if(!T.number(t)){t=this.storage.get("speed")}if(!T.number(t)){t=this.config.speed.selected}const{minimumSpeed:r,maximumSpeed:i}=this;t=It(t,r,i);this.config.speed.selected=t;setTimeout(()=>{if(this.media){this.media.playbackRate=t}},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){if(this.isYouTube){return Math.min(...this.options.speed)}if(this.isVimeo){return.5}return.0625}get maximumSpeed(){if(this.isYouTube){return Math.max(...this.options.speed)}if(this.isVimeo){return 2}return 16}set quality(e){const t=this.config.quality;const r=this.options.quality;if(!r.length){return}let i=[!T.empty(e)&&Number(e),this.storage.get("quality"),t.selected,t.default].find(T.number);let n=true;if(!r.includes(i)){const a=we(r,i);this.debug.warn(`Unsupported quality option: ${i}, using ${a} instead`);i=a;n=false}t.selected=i;this.media.quality=i;if(n){this.storage.set({quality:i})}}get quality(){return this.media.quality}set loop(e){const t=T.boolean(e)?e:this.config.loop.active;this.config.loop.active=t;this.media.loop=t}get loop(){return Boolean(this.media.loop)}set source(e){Nt.change.call(this,e)}get source(){return this.media.currentSrc}get download(){const{download:e}=this.config.urls;return T.url(e)?e:this.source}set download(e){if(!T.url(e)){return}this.config.urls.download=e;O.setDownloadUrl.call(this)}set poster(e){if(!this.isVideo){this.debug.warn("Poster can only be set for video");return}x.setPoster.call(this,e,false).catch(()=>{})}get poster(){if(!this.isVideo){return null}return this.media.getAttribute("poster")||this.media.getAttribute("data-poster")}get ratio(){if(!this.isVideo){return null}const e=_e(Oe.call(this));return T.array(e)?e.join(":"):e}set ratio(e){if(!this.isVideo){this.debug.warn("Aspect ratio can only be set for video");return}if(!T.string(e)||!Ie(e)){this.debug.error(`Invalid aspect ratio specified (${e})`);return}this.config.ratio=_e(e);C.call(this)}set autoplay(e){this.config.autoplay=T.boolean(e)?e:this.config.autoplay}get autoplay(){return Boolean(this.config.autoplay)}toggleCaptions(e){P.toggle.call(this,e,false)}set currentTrack(e){P.set.call(this,e,false);P.setup.call(this)}get currentTrack(){const{toggled:e,currentTrack:t}=this.captions;return e?t:-1}set language(e){P.setLanguage.call(this,e,false)}get language(){return(P.getCurrentTrack.call(this)||{}).language}set pip(e){if(!L.pip){return}const t=T.boolean(e)?e:!this.pip;if(T["function"](this.media.webkitSetPresentationMode)){this.media.webkitSetPresentationMode(t?it.active:it.inactive)}if(T["function"](this.media.requestPictureInPicture)){if(!this.pip&&t){this.media.requestPictureInPicture()}else if(this.pip&&!t){document.exitPictureInPicture()}}}get pip(){if(!L.pip){return null}if(!T.empty(this.media.webkitPresentationMode)){return this.media.webkitPresentationMode===it.active}return this.media===document.pictureInPictureElement}setPreviewThumbnails(e){if(this.previewThumbnails&&this.previewThumbnails.loaded){this.previewThumbnails.destroy();this.previewThumbnails=null}Object.assign(this.config.previewThumbnails,e);if(this.config.previewThumbnails.enabled){this.previewThumbnails=new Mt(this)}}airplay=()=>{if(L.airplay){this.media.webkitShowPlaybackTargetPicker()}};toggleControls=e=>{if(this.supported.ui&&!this.isAudio){const t=ge(this.elements.container,this.config.classNames.hideControls);const r=typeof e==="undefined"?undefined:!e;const i=f(this.elements.container,this.config.classNames.hideControls,r);if(i&&T.array(this.config.controls)&&this.config.controls.includes("settings")&&!T.empty(this.config.settings)){O.toggleMenu.call(this,false)}if(i!==t){const n=i?"controlshidden":"controlsshown";w.call(this,this.media,n)}return!i}return false};on=(e,t)=>{D.call(this,this.elements.container,e,t)};once=(e,t)=>{Se.call(this,this.elements.container,e,t)};off=(e,t)=>{Ee(this.elements.container,e,t)};destroy=(e,t=false)=>{if(!this.ready){return}const r=()=>{document.body.style.overflow="";this.embed=null;if(t){if(Object.keys(this.elements).length){o(this.elements.buttons.play);o(this.elements.captions);o(this.elements.controls);o(this.elements.wrapper);this.elements.buttons.play=null;this.elements.captions=null;this.elements.controls=null;this.elements.wrapper=null}if(T["function"](e)){e()}}else{ke.call(this);Me.cancelRequests.call(this);b(this.elements.original,this.elements.container);w.call(this,this.elements.original,"destroyed",true);if(T["function"](e)){e.call(this.elements.original)}this.ready=false;setTimeout(()=>{this.elements=null;this.media=null},200)}};this.stop();clearTimeout(this.timers.loading);clearTimeout(this.timers.controls);clearTimeout(this.timers.resized);if(this.isHTML5){x.toggleNativeControls.call(this,true);r()}else if(this.isYouTube){clearInterval(this.timers.buffering);clearInterval(this.timers.playing);if(this.embed!==null&&T["function"](this.embed.destroy)){this.embed.destroy()}r()}else if(this.isVimeo){if(this.embed!==null){this.embed.unload().then(r)}setTimeout(r,200)}};supports=e=>L.mime.call(this,e);static supported(e,t){return L.check(e,t)}static loadSprite(e,t){return $e(e,t)}static setup(e,t={}){let r=null;if(T.string(e)){r=Array.from(document.querySelectorAll(e))}else if(T.nodeList(e)){r=Array.from(e)}else if(T.array(e)){r=e.filter(T.element)}if(T.empty(r)){return null}return r.map(e=>new Ut(e,t))}}Ut.defaults=ue(rt);const Bt=Ut;var jt=Ht(434);var Gt=Ht.n(jt);window.Plyr=Bt;window.Hls=Gt()})()})();
</script>
<script>
/* Javascript for VideoXBlock. */
function VideoXBlock(runtime, element, context) {
    //console.log(context);
    var playerElement = $(".videoxblock-player", element).get(0);
    var playerOptions = {
        title: context['display_name'],
        invertTime: false, // show time properly
        storage: { // save settings with custom key
            enabled: true,
            key: 'videoxblock'
        },
        keyboard: {
            global: true,
        },
        seekTime: 5,
        captions: {
            active: true,
            update: true,
            language: 'auto'
        },
        previewThumbnails: {
            enabled: context['previews'].length > 0,
            src: context['previews']
        },
        i18n: {
            qualityLabel: {
                '0': "Auto"
            }
        },
        fullscreen: {
            iosNative: true,
        },
    };
    //console.debug(context)

    if (Hls.isSupported()) {
        var hls = new Hls({
            autoStartLoad: false,
            maxBufferLength: 30, // Max guaranteed (or by buffered size)
            maxMaxBufferLength: 90, // Max
        });
        hls.loadSource(context['hls_url']);
        hls.on(Hls.Events.ERROR, function() { // No videos, etc
            initPlayer(playerElement, false);
        });
        hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
            //console.debug('levels', hls.levels);

            var levels = hls.levels.map((level) => level.height);
            levels.unshift(0); // Add stub for auto
            playerOptions.quality = {
                default: 0, // Default - auto
                options: levels,
                forced: true,
                // Manage quality changes
                onChange: onQualityChange
            };
            hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
                console.debug(event, hls.levels[data.level].height);
                $(".plyr__menu__container [data-plyr='quality'][value='0'] span", element)
                    .text('Auto' + (hls.autoLevelEnabled ? ' (' + hls.levels[data.level].height + 'p)' : ''));
            });
            /*hls.on(Hls.Events.SUBTITLE_TRACKS_UPDATED, function(event, data) {
                playerElement.remove("track[kind='captions']");
                hls.subtitleTracks.forEach(function(sub) {
                    var track = $('<track kind="captions" />')
                        .attr('label', sub.lang)
                        .attr('url', sub.url)
                        .attr('srclang', sub.lang)
                    playerElement.append(track);
                });
            });*/
            initPlayer(playerElement, true);
            hls.attachMedia(playerElement);
            hls.subtitleTrackController.switchLevel(0);
        });
    } else {
        if (playerElement.canPlayType('application/vnd.apple.mpegurl')) {
            playerElement.src = context['hls_url'];
        }
        initPlayer(playerElement, false);
    }
    var is_initialized = false;
    function initPlayer(el, isHls) {
        if (is_initialized) {
            return;
        }
        var player = new Plyr(el, playerOptions);

        if (isHls) {
            player.on('play', () => hls.startLoad());

            // Handle HLS quality changes
            player.on('qualitychange', () => {
                if (player.currentTime !== 0) {
                    hls.startLoad();
                }
            });
        }
        is_initialized = true;
        // console.log(player);
    }

    function onQualityChange(newQuality) {
        if (newQuality === 0) {
            hls.currentLevel = -1;
            console.debug('quality change', 'Auto');
        } else {
            console.debug('quality change', newQuality);
            hls.levels.forEach((level, levelIndex) => {
                if (level.height === newQuality) {
                    hls.currentLevel = levelIndex;
                }
            });
        }
    }
}

</script>
<script src='https://cdn2.openedu.ru/static/bundles/ProblemBlockPreview.3c293987029be310b69a.40765775f6c6.js' type='application/javascript'></script>
<script src='https://cdn2.openedu.ru/static/bundles/VerticalStudentView.218999454019487e3bbe.50411955078b.js' type='application/javascript'></script>







  <script type="text/javascript" src="https://cdn2.openedu.ru/static/js/vendor/noreferrer.aa62a3e70ffa.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://cdn2.openedu.ru/static/js/utils/navigation.08930e16ab3d.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://cdn2.openedu.ru/static/js/header/header.309a1243e175.js"></script>

  <script type="text/javascript" src="https://cdn2.openedu.ru/static/js/src/jquery_extend_patch.54dddef28d15.js"></script>
  <div id="lean_overlay"></div>

</body>
</html>


